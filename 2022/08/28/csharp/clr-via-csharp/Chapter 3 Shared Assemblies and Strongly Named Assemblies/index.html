<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Sakupinera" href="http://sakupinera.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Sakupinera" href="http://sakupinera.github.io/atom.xml"><link rel="alternate" type="application/json" title="Sakupinera" href="http://sakupinera.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="è¯»ä¹¦ç¬”è®°,C#"><link rel="canonical" href="http://sakupinera.github.io/2022/08/28/csharp/clr-via-csharp/Chapter%203%20Shared%20Assemblies%20and%20Strongly%20Named%20Assemblies/"><title>CLR via C# - Chapter 3 Shared Assemblies and Strongly Named Assemblies - CLR-via-CSharp - CSharp | Hanamai Sora = Sakupinera</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">CLR via C# - Chapter 3 Shared Assemblies and Strongly Named Assemblies</h1><div class="meta"><span class="item" title="Created: 2022-08-28 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2022-08-28T00:00:00+08:00">2022-08-28</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>38k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>35 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Hanamai Sora</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipesrnqv3j20zk0m8ava.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipexoj0moj20zk0m8kgu.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipexbei4hj20zk0m8npd.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclhtuo6nj20zk0m8ttm.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipey0a334j20zk0m8qpt.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipevgoki5j20zk0m84qp.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CSharp/" itemprop="item" rel="index" title="In CSharp"><span itemprop="name">CSharp</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CSharp/CLR-via-CSharp/" itemprop="item" rel="index" title="In CLR-via-CSharp"><span itemprop="name">CLR-via-CSharp</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="http://sakupinera.github.io/2022/08/28/csharp/clr-via-csharp/Chapter%203%20Shared%20Assemblies%20and%20Strongly%20Named%20Assemblies/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Sakupinera"><meta itemprop="description" content=", ä¿æŒä½ çš„å†³å¿ƒï¼"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sakupinera"></span><div class="body md" itemprop="articleBody"><h1 id="chapter-3-shared-assemblies-and-strongly-named-assemblies"><a class="anchor" href="#chapter-3-shared-assemblies-and-strongly-named-assemblies">#</a> Chapter 3 Shared Assemblies and Strongly Named Assemblies</h1><blockquote><p>In this chapter, Iâ€™ll concentrate on creating assemblies that can be accessed by multiple applications. The assemblies that ship with the Microsoft .NET Framework are an excellent example of globally deployed assemblies, because all managed applications use types defined by Microsoft in the .NET Framework Class Library (FCL).</p></blockquote><h2 id="two-kinds-of-assemblies-two-kinds-of-deployment"><a class="anchor" href="#two-kinds-of-assemblies-two-kinds-of-deployment">#</a> <strong>Two Kinds of Assemblies, Two Kinds of Deployment</strong></h2><blockquote><p>The CLR supports two kinds of assemblies: weakly named assemblies and strongly named assemblies.</p></blockquote><blockquote><p>Weakly named assemblies and strongly named assemblies are structurally identicalâ€”that is, they use the same portable executable (PE) file format, PE32(+) header, CLR header, metadata, manifest tables, and Intermediate Language (IL) that we examined in Chapter 1, â€œThe CLRâ€™s Execution Model,â€ and Chapter 2. And you use the same tools, such as the C# compiler and AL.exe, to build both kinds of assemblies. The real difference between weakly named and strongly named assemblies is that a strongly named assembly is signed with a publisherâ€™s public/private key pair that uniquely identifies the assemblyâ€™s publisher. This key pair allows the assembly to be uniquely identified, secured, and versioned, and it allows the assembly to be deployed anywhere on the userâ€™s machine or even on the Internet. This ability to uniquely identify an assembly allows the CLR to enforce certain known-to-be-safe policies when an application tries to bind to a strongly named assembly. This chapter is dedicated to explaining what strongly named assemblies are and what policies the CLR applies to them.</p></blockquote><blockquote><p>An assembly can be deployed in two ways: privately or globally. A privately deployed assembly is an assembly that is deployed in the applicationâ€™s base directory or one of its subdirectories. A weakly named assembly can be deployed only privately. I talked about privately deployed assemblies in Chapter 2. A globally deployed assembly is an assembly that is deployed into some well-known location that the CLR looks in when itâ€™s searching for the assembly. A strongly named assembly can be deployed privately or globally. Iâ€™ll explain how to create and deploy strongly named assemblies in this chapter. Table 3-1 summarizes the kinds of assemblies and the ways that they can be deployed.</p></blockquote><p><img data-src="/2022/08/28/csharp/clr-via-csharp/Chapter%203%20Shared%20Assemblies%20and%20Strongly%20Named%20Assemblies/Untitled.png" alt="Untitled"></p><p>ğŸ’¡ å°ç»“ï¼šCLR æ”¯æŒä¸¤ç§ç¨‹åºé›†ï¼šå¼±å‘½åç¨‹åºé›†ï¼ˆweekly namely assemblyï¼‰å’Œå¼ºå‘½åç¨‹åºé›†ï¼ˆstrong named assemblyï¼‰ã€‚ä¸¤ç§ç¨‹åºé›†çš„ç»“æ„å®Œå…¨ç›¸åŒï¼Œä¸¤è€…çœŸæ­£çš„åŒºåˆ«åœ¨äºï¼Œå¼ºå‘½åç¨‹åºé›†ä½¿ç”¨å‘å¸ƒè€…çš„å…¬é’¥ / ç§é’¥è¿›è¡Œäº†ç­¾åã€‚è¿™ä¸€å¯¹å¯†é’¥å…è®¸å¯¹ç¨‹åºé›†è¿›è¡Œå”¯ä¸€æ€§çš„æ ‡è¯†ã€ä¿æŠ¤å’Œç‰ˆæœ¬æ§åˆ¶ï¼Œå¹¶å…è®¸ç¨‹åºé›†éƒ¨ç½²åˆ°ç”¨æˆ·æœºå™¨çš„ä»»ä½•åœ°æ–¹ï¼Œç”šè‡³å¯ä»¥éƒ¨ç½²åˆ° Internet ä¸Šã€‚ç¨‹åºé›†åˆå¯é‡‡ç”¨ä¸¤ç§æ”¾æš‘éƒ¨ç½²ï¼šç§æœ‰æˆ–å…¨å±€ã€‚å¼±å‘½åç¨‹åºé›†åªèƒ½ä»¥ç§æœ‰æ–¹å¼éƒ¨ç½²ã€‚å…¨å±€éƒ¨ç½²çš„ç¨‹åºé›†æ˜¯æŒ‡éƒ¨ç½²åˆ°ä¸€äº›å…¬è®¤ä½ç½®çš„ç¨‹åºé›†ã€‚å¼ºå‘½åç¨‹åºé›†æ—¢å¯ç§æœ‰éƒ¨ç½²ï¼Œä¹Ÿå¯å…¨å±€éƒ¨ç½²ã€‚</p><h2 id="giving-an-assembly-a-strong-name"><a class="anchor" href="#giving-an-assembly-a-strong-name">#</a> <strong>Giving an Assembly a Strong Name</strong></h2><blockquote><p>If multiple applications are going to access an assembly, the assembly must be placed in a well-known directory, and the CLR must know to look in this directory automatically when a reference to the assembly is detected. However, we have a problem: Two (or more) companies could produce assemblies that have the same file name. Then, if both of these assemblies get copied into the same well-known directory, the last one installed wins, and all of the applications that were using the old assembly no longer function as desired. (This is exactly why DLL hell exists today in Windows, in which shared DLLs are all just copied into the System32 directory.)</p></blockquote><blockquote><p>Obviously, differentiating assemblies simply by using a file name isnâ€™t good enough. The CLR needs to support some mechanism that allows assemblies to be uniquely identified. This is what the term strongly named assembly refers to. A strongly named assembly consists of four attributes that uniquely identify the assembly: a file name (without an extension), a version number, a culture identity, and a public key. Because public keys are very large numbers, we frequently use a small hash value derived from a public key. This hash value is called a public key token. The following assembly identity strings (sometimes called an assembly display name) identify four completely different assembly files.</p></blockquote><pre><code>&quot;MyTypes, Version=1.0.8123.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;
&quot;MyTypes, Version=1.0.8123.0, Culture=&quot;en-US&quot;, PublicKeyToken=b77a5c561934e089&quot;
&quot;MyTypes, Version=2.0.1234.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&quot;
&quot;MyTypes, Version=1.0.8123.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot;
</code></pre><blockquote><p>There must be a way to distinguish this companyâ€™s assembly from another companyâ€™s assembly that happens to have the same attributes. For several reasons, Microsoft chose to use standard public/ private key cryptographic technologies instead of any other unique identification technique such as GUIDs, URLs, or URNs. Specifically, cryptographic techniques provide a way to check the integrity of the assemblyâ€™s bits as they are installed on a machine, and they also allow permissions to be granted on a per-publisher basis. Iâ€™ll discuss these techniques later in this chapter. So a company that wants to uniquely mark its assemblies must create a public/private key pair. Then the public key can be associated with the assembly. No two companies should have the same public/private key pair, and this distinction is what allows two companies to create assemblies that have the same name, version, and culture without causing any conflict.</p></blockquote><blockquote><p>A strongly named assembly has a file name, an assembly version, and a culture. In addition, a strongly named assembly is signed with the publisherâ€™s private key.</p></blockquote><blockquote><p>The first step in creating a strongly named assembly is to obtain a key by using the Strong Name utility, SN.exe, that ships with the .NET Framework SDK and Microsoft Visual Studio. This utility offers a whole slew of features depending on the command-line switch you specify. Note that all SN.exeâ€™s command-line switches are case-sensitive. To generate a public/private key pair, you run SN.exe as follows.</p></blockquote><pre><code>SN â€“k MyCompany.snk
</code></pre><blockquote><p>This line tells SN.exe to create a file called <code>MyCompany.snk</code> . This file will contain the public and private key numbers persisted in a binary format.</p></blockquote><blockquote><p>Public key numbers are very big. If you want to, after creating the file that contains the public and private key, you can use the SN.exe utility again to see the actual public key. To do this, you must execute the SN.exe utility twice. First, you invoke SN.exe with the â€“p switch to create a file that contains only the public key ( <code>MyCompany.PublicKey</code> ).</p></blockquote><pre><code>SN â€“p MyCompany.snk MyCompany.PublicKey sha256
</code></pre><blockquote><p>Then, you invoke SN.exe, passing it the â€“tp switch and the file that contains just the public key.</p></blockquote><pre><code>SN â€“tp MyCompany.PublicKey
</code></pre><blockquote><p>The SN.exe utility doesnâ€™t offer any way for you to display the private key.</p></blockquote><blockquote><p>The size of public keys makes them difficult to work with. To make things easier for the developer (and for end users too), public key tokens were created. A public key token is a 64-bit hash of the public key. SN.exeâ€™s â€“tp switch shows the public key token that corresponds to the complete public key at the end of its output.</p></blockquote><blockquote><p>Now that you know how to create a public/private key pair, creating a strongly named assembly is simple. When you compile your assembly, you use the <code>/keyfile</code> : compiler switch.</p></blockquote><pre><code>csc /keyfile:MyCompany.snk Program.cs
</code></pre><blockquote><p>When the C# compiler sees this switch, the compiler opens the specified file (MyCompany.snk), signs the assembly with the private key, and embeds the public key in the manifest. Note that you sign only the assembly file that contains the manifest; the assemblyâ€™s other files canâ€™t be signed explicitly.</p></blockquote><blockquote><p>Hereâ€™s what it means to sign a file: When you build a strongly named assembly, the assemblyâ€™s <code>FileDef</code> manifest metadata table includes the list of all the files that make up the assembly. As each fileâ€™s name is added to the manifest, the fileâ€™s contents are hashed, and this hash value is stored along with the fileâ€™s name in the <code>FileDef</code> table. You can override the default hash algorithm used with AL.exeâ€™s /algid switch or apply the assembly-level <code>System.Reflection.AssemblyAlgorithmIdAttribute</code> custom attribute in one of the assemblyâ€™s source code files. By default, a SHA-1 algorithm is used.</p></blockquote><blockquote><p>After the PE file containing the manifest is built, the PE fileâ€™s entire contents (except for any Authenticode Signature, the assemblyâ€™s strong name data, and the PE header checksum) are hashed, as shown in Figure 3-1. This hash value is signed with the publisherâ€™s private key, and the resulting RSA digital signature is stored in a reserved section (not included in the hash) within the PE file. The CLR header of the PE file is updated to reflect where the digital signature is embedded within the file.</p></blockquote><p><img data-src="/2022/08/28/csharp/clr-via-csharp/Chapter%203%20Shared%20Assemblies%20and%20Strongly%20Named%20Assemblies/Untitled1.png" alt="Untitled"></p><blockquote><p>The publisherâ€™s public key is also embedded into the <code>AssemblyDef</code> manifest metadata table in this PE file. The combination of the file name, the assembly version, the culture, and the public key gives this assembly a strong name, which is guaranteed to be unique. There is no way that two companies could each produce an assembly named OurLibrary with the same public/private keys unless the companies share this key pair with each other.</p></blockquote><blockquote><p>As described in Chapter 2, when you compile your source code, the compiler detects the types and members that your code references. You must specify the referenced assemblies to the compiler. For the C# compiler, you use the /reference compiler switch. Part of the compilerâ€™s job is to emit an <code>AssemblyRef</code> metadata table inside the resulting managed module. Each entry in the <code>AssemblyRef</code> metadata table indicates the referenced assemblyâ€™s name (without path and extension), version number, culture, and public key information.</p></blockquote><p>ğŸ’¡ å°ç»“ï¼šè¦ç”±å¤šä¸ªåº”ç”¨ç¨‹åºè®¿é—®çš„ç¨‹åºé›†å¿…é¡»æ”¾åˆ°å…¬è®¤çš„ç›®å½•ã€‚å¦å¤–ï¼Œæ£€æµ‹åˆ°å¯¹ç¨‹åºé›†çš„å¼•ç”¨æ—¶ï¼ŒCLR å¿…é¡»èƒ½è‡ªåŠ¨æ£€æŸ¥è¯¥ç›®å½•ã€‚ä½†åŠ å…¥ä¸¤ä¸ªç›¸åŒæ–‡ä»¶åçš„ç¨‹åºé›†éƒ½å¤åˆ¶åˆ°ç›¸åŒçš„å…¬è®¤ç›®å½•ï¼Œé‚£ä¹ˆæœ€åä¸€ä¸ªå®‰è£…çš„å°±æ˜¯ â€œè€å¤§â€ï¼Œé€ æˆæ­£åœ¨ä½¿ç”¨æ—§ç¨‹åºé›†çš„æ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼ˆè¿™æ­£æ˜¯ Windowsâ€DLL hellâ€œçš„ç”±æ¥ï¼Œå› ä¸ºå…±äº« DLL å…¨éƒ¨å¤åˆ¶åˆ° System32 ç›®å½•ï¼‰ã€‚æ‰€è°“çš„â€ å¼ºå‘½åç¨‹åºé›† â€œå°±æ˜¯ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ CLR å¯¹ç¨‹åºé›†è¿›è¡Œå”¯ä¸€æ€§æ ‡è¯†çš„æœºåˆ¶ã€‚å¼ºå‘½åç¨‹åºé›†å…·æœ‰ 4 ä¸ªé‡è¦ç‰¹æ€§ï¼Œå®ƒä»¬å…±åŒå¯¹ç¨‹åºé›†è¿›è¡Œå”¯ä¸€æ€§æ ‡è¯†ï¼šæ–‡ä»¶åï¼ˆä¸è®¡æ‰©å±•åï¼‰ã€ç‰ˆæœ¬å·ã€è¯­è¨€æ–‡åŒ–å’Œå…¬é’¥ã€‚ç”±äºå…¬é’¥æ•°å­—å¾ˆå¤§æ‰€ä»¥ç»å¸¸ä½¿ç”¨ä»å…¬é’¥æ´¾ç”Ÿçš„å°å“ˆå¸Œå€¼ï¼Œç§°ä¸ºå…¬é’¥æ ‡è®°ï¼ˆpublic key tokenï¼‰ï¼Œè¿™ç§æ ‡è®°å¯ä»¥åœ¨ AssemblyRef å…ƒæ•°æ®ä¿¡æ¯ä¸­çœ‹åˆ°ï¼ˆè¯¥è¡¨æŒ‡åäº†è¢«å¼•ç”¨ç¨‹åºé›†çš„åç§°ã€ç‰ˆæœ¬å·ã€è¯­è¨€æ–‡åŒ–å’Œå…¬é’¥ä¿¡æ¯ï¼‰ã€‚å¼±å‘½åç¨‹åºé›†æ˜¯æ²¡æœ‰å…¬é’¥æ ‡è®°çš„ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒCLR åœ¨åšå‡ºå®‰å…¨æˆ–ä¿¡ä»»å†³ç­–æ—¶ï¼Œæ°¸è¿œéƒ½ä¸ä¼šä½¿ç”¨å…¬é’¥æ ‡è®°ï¼Œå› ä¸ºå‡ ä¸ªå…¬é’¥å¯èƒ½åœ¨å“ˆå¸Œå¤„ç†ä¹‹åå¾—åˆ°åŒä¸€ä¸ªå…¬é’¥æ ‡è®°ã€‚è€Œ AssemblyDef çš„è®°å½•é¡¹æ€»æ˜¯å­˜å‚¨å®Œæ•´å…¬é’¥ï¼Œè€Œä¸æ˜¯å…¬é’¥æ ‡è®°ï¼Œè¿™æ˜¯ä¸ºäº†ä¿è¯æ–‡ä»¶æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œæœ¬ç« åé¢å°†è§£æ—¶å¼ºå‘½åç¨‹åºé›†å¦‚ä½•æ”¾ç¯¡æ”¹ã€‚â€ å¯¹æ–‡ä»¶è¿›è¡Œç­¾å â€œçš„å‡†ç¡®å«ä¹‰æ˜¯ï¼šç”Ÿæˆå¼ºå‘½åç¨‹åºé›†æ—¶ï¼Œç¨‹åºé›†çš„ FileDef æ¸…å•å…ƒæ•°æ®è¡¨åˆ—å‡ºæ„æˆç¨‹åºé›†çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ¯å°†ä¸€ä¸ªæ–‡ä»¶åæ·»åŠ åˆ°æ¸…å•ï¼Œéƒ½å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚å“ˆå¸Œå€¼å’Œæ–‡ä»¶åä¸€é“å­˜å‚¨åˆ° FileDef è¡¨ä¸­ã€‚å“ˆå¸Œå€¼ç”¨å‘å¸ƒè€…çš„ç§é’¥è¿›è¡Œç­¾åï¼Œå¾—åˆ°çš„ RSA æ•°å­—ç­¾åå­˜å‚¨åˆ° PE æ–‡ä»¶çš„ä¸€ä¸ªä¿ç•™åŒºåŸŸã€‚PE æ–‡ä»¶çš„ CLR å¤´è¿›è¡Œæ›´æ–°ï¼Œåæ˜ æ•°å­—ç­¾ååœ¨æ–‡ä»¶ä¸­çš„åµŒå…¥ä½ç½®ã€‚</p><h2 id="the-global-assembly-cache"><a class="anchor" href="#the-global-assembly-cache">#</a> <strong>The Global Assembly Cache</strong></h2><blockquote><p>If an assembly is to be accessed by multiple applications, the assembly must be placed into a well-known directory, and the CLR must know to look in this directory automatically when a reference to the assembly is detected. This well-known location is called the global assembly cache (GAC). The exact location of the GAC is an implementation detail that is subject to change with different versions of the .NET Framework. However, you can typically find it in the following directory:</p></blockquote><pre><code>%SystemRoot%\Microsoft.NET\Assembly
</code></pre><blockquote><p>The GAC directory is structured. It contains many subdirectories, and an algorithm is used to generate the names of these subdirectories. You should never manually copy assembly files into the GAC; instead, you should use tools to accomplish this task. These tools know the GACâ€™s internal structure and how to generate the proper subdirectory names.</p></blockquote><blockquote><p>While developing and testing, you can use the most common tool for installing a strongly named assembly into the GAC, which is GACUtil.exe. Running this tool without any command-line arguments yields the following usage.</p></blockquote><pre><code>Microsoft (R) .NET Global Assembly Cache Utility. Version 4.0.30319.17929
Copyright (c) Microsoft Corporation. All rights reserved.
Usage: Gacutil &lt;command&gt; [ &lt;options&gt; ]
Commands:
 /i &lt;assembly_path&gt; [ /r &lt;...&gt; ] [ /f ]
 Installs an assembly to the global assembly cache.
 /il &lt;assembly_path_list_file&gt; [ /r &lt;...&gt; ] [ /f ]
 Installs one or more assemblies to the global assembly cache.
 /u &lt;assembly_display_name&gt; [ /r &lt;...&gt; ]
 Uninstalls an assembly from the global assembly cache.
 /ul &lt;assembly_display_name_list_file&gt; [ /r &lt;...&gt; ]
 Uninstalls one or more assemblies from the global assembly cache.
 /l [ &lt;assembly_name&gt; ]
 List the global assembly cache filtered by &lt;assembly_name&gt;
 /lr [ &lt;assembly_name&gt; ]
 List the global assembly cache with all traced references.
 /cdl
 Deletes the contents of the download cache
 /ldl
 Lists the contents of the download cache
 /?
 Displays a detailed help screen
 Options:
 /r &lt;reference_scheme&gt; &lt;reference_id&gt; &lt;description&gt;
 Specifies a traced reference to install (/i, /il) or uninstall (/u, /ul).
 /f
 Forces reinstall of an assembly.
 /nologo
 Suppresses display of the logo banner
 /silent
 Suppresses display of all output
</code></pre><p>ğŸ’¡ Note: GAC é»˜è®¤åªèƒ½ç”± Windows Administrators ç”¨æˆ·ç»„çš„æˆå‘˜æ“ä½œã€‚å¦‚æœæ‰§è¡Œ GACUtil.exe çš„ç”¨æˆ·ä¸æ˜¯æ”¹ç»„çš„æˆå‘˜ï¼ŒGACUtil.exe å°†æ— æ³•å®‰è£…æˆ–å¸è½½ç¨‹åºé›†ã€‚å¦‚æœå°†å¼ºå‘½åç¨‹åºé›†æ‰“åŒ…åˆ°.cab æ–‡ä»¶ä¸­ï¼Œæˆ–è€…ä»¥å…¶ä»–æ–¹å¼è¿›è¡Œå‹ç¼©ï¼Œç¨‹åºé›†çš„æ–‡ä»¶é¦–å…ˆå¿…é¡»è§£å‹æˆä¸´æ—¶æ–‡ä»¶ï¼Œç„¶åæ‰èƒ½ä½¿ç”¨ GACUtil.exe å°†ç¨‹åºé›†æ–‡ä»¶å®‰è£…åˆ° GAC ä¸­ã€‚å®‰è£…å¥½ç¨‹åºé›†çš„æ–‡ä»¶ä¹‹åï¼Œä¸´æ—¶æ–‡ä»¶å¯ä»¥åˆ é™¤ã€‚</p><blockquote><p>Using GACUtil.exeâ€™s /i switch is very convenient for developer testing. However, if you use GACUtil.exe to deploy an assembly in a production environment, itâ€™s recommended that you use GACUtil.exeâ€™s /r switch in addition to specifying the /i or /u switch to install or uninstall the assembly. The /r switch integrates the assembly with the Windows install and uninstall engine. Basically, it tells the system which application requires the assembly and then ties the application and the assembly together.</p></blockquote><blockquote><p>The GACUtil.exe tool doesnâ€™t ship with the end-user .NET Framework redistributable package. If your application includes some assemblies that you want deployed into the GAC, you should use the Windows Installer (MSI), because MSI is the only tool that is guaranteed to be on end-user machines and capable of installing assemblies into the GAC.</p></blockquote><p>ğŸ’¡ Note: åœ¨ GAC ä¸­å…¨å±€éƒ¨ç½²æ˜¯å¯¹ç¨‹åºé›†è¿›è¡Œæ³¨å†Œçš„ä¸€ç§å½¢å¼ï¼Œè™½ç„¶è¿™ä¸ªè¿‡ç¨‹å¯¹ Windows æ³¨å†Œè¡¨æ²¡æœ‰åŠç‚¹å½±å“ã€‚å°†ç¨‹åºé›†å®‰è£…åˆ° GAC ç ´åäº†æˆ‘ä»¬æƒ³è¦è¾¾æˆçš„ä¸€ä¸ªåŸºæœ¬ç›®æ ‡ï¼Œå³ï¼šç®€å•åœ°å®‰è£…ã€å¤‡ä»½ã€è¿˜åŸã€ç§»åŠ¨å’Œå¸è½½åº”ç”¨ç¨‹åºã€‚æ‰€ä»¥ï¼Œå»ºè®®å°½é‡è¿›è¡Œç§æœ‰è€Œä¸æ˜¯å…¨å±€éƒ¨ç½²ã€‚</p><blockquote><p>What is the purpose of â€œregisteringâ€ an assembly in the GAC? Well, say two companies each produce an OurLibrary assembly consisting of one file: OurLibrary.dll. Obviously, both of these files canâ€™t go in the same directory because the last one installed would overwrite the first one, surely breaking some application. When you install an assembly into the GAC, dedicated subdirectories are created under the %SystemRoot%\<span class="exturl" data-url="aHR0cDovL01pY3Jvc29mdC5ORVQ=">Microsoft.NET</span>\Assembly directory, and the assembly files are copied into one of these subdirectories.</p></blockquote><p>ğŸ’¡ å°ç»“ï¼šç”±å¤šä¸ªåº”ç”¨ç¨‹åºè®¿é—®çš„ç¨‹åºé›†å¿…é¡»æ”¾åˆ°å…¬è®¤çš„ç›®å½•ï¼Œè€Œä¸” CLR åœ¨æ£€æµ‹åˆ°å¯¹è¯¥ç¨‹åºé›†çš„å¼•ç”¨æ—¶ï¼Œå¿…é¡»çŸ¥é“æ£€æŸ¥è¯¥ç›®å½•ã€‚è¿™ä¸ªå…¬è®¤ä½ç½®å°±æ˜¯å…¨å±€ç¨‹åºé›†ç¼“å­˜ï¼ˆGlobal Assembly Cacheï¼ŒGACï¼‰ã€‚GAC ç›®å½•æ˜¯ç»“æ„åŒ–çš„ï¼Œå…¶ä¸­åŒ…å«è®¸å¤šå­ç›®å½•ï¼Œå­ç›®å½•åç§°ç”¨ç®—æ³•ç”Ÿæˆã€‚æ°¸è¿œä¸è¦å°†ç¨‹åºé›†æ–‡ä»¶æ‰‹åŠ¨å¤åˆ¶åˆ° GAC ç›®å½•ï¼›ç›¸åï¼Œè¦ç”¨å·¥å…·å®Œæˆè¿™é¡¹ä»»åŠ¡ï¼Œæœ€å¸¸ç”¨çš„å·¥å…·æ˜¯ GACUtil.exeï¼Œå·¥å…·çŸ¥é“ GAC çš„å†…éƒ¨ç»“æ„ï¼Œå¹¶çŸ¥é“å¦‚ä½•ç”Ÿæˆæ­£ç¡®çš„å­ç›®å½•åã€‚è¿™ç§æ–¹å¼ä¿è¯äº†å³ä½¿ä¸¤å®¶å…¬å¸éƒ½ç”Ÿæˆäº†ä¸€ä¸ªåŒåç¨‹åºé›†ï¼Œç”±äºå…¬ç§é’¥ä¸åŒï¼Œæœ€åå°†åœ¨ % SystemRoot%\<span class="exturl" data-url="aHR0cDovL01pY3Jvc29mdC5ORVQ=">Microsoft.NET</span>\Assembly ä¸‹ç”Ÿæˆä¸åŒçš„å­ç›®å½•ï¼Œå› æ­¤ä¸ä¼šäº§ç”Ÿåç§°å†²çªè¦†ç›–é—®é¢˜ã€‚æ­¤å¤–ï¼Œå¼±å‘½åç¨‹åºé›†ä¸èƒ½æ”¾åˆ° GACã€‚</p><h2 id="building-an-assembly-that-references-a-strongly-named-assembly"><a class="anchor" href="#building-an-assembly-that-references-a-strongly-named-assembly">#</a> <strong>Building an Assembly That References a Strongly Named Assembly</strong></h2><blockquote><p>Whenever you build an assembly, the assembly will have references to other strongly named assemblies. This is true because System.Object is defined in MSCorLib.dll, which is strongly named. However, itâ€™s likely that an assembly will reference types in other strongly named assemblies published either by Microsoft, a third party, or your own organization. In Chapter 2, I showed you how to use CSC.exeâ€™s /reference compiler switch to specify the assembly file names you want to reference. If the file name is a full path, CSC.exe loads the specified file and uses its metadata information to build the assembly. As mentioned in Chapter 2, if you specify a file name without a path, CSC.exe attempts to find the assembly by looking in the following directories (in order of their presentation here):</p><ol><li>Working directory.</li><li>The directory that contains the CSC.exe file itself. This directory also contains the CLR DLLs.</li><li>Any directories specified using the /lib compiler switch.</li><li>Any directories specified using the LIB environment variable.</li></ol></blockquote><blockquote><p>So if youâ€™re building an assembly that references Microsoftâ€™s System.Drawing.dll, you can specify the /reference:System.Drawing.dll switch when invoking CSC.exe. The compiler will examine the directories shown earlier and will find the System.Drawing.dll file in the directory that contains the CSC.exe file itself, which is the same directory that contains the DLLs for the version of the CLR the compiler is tied to. Even though this is the directory where the assembly is found at compile time, this isnâ€™t the directory where the assembly will be loaded from at run time.</p></blockquote><blockquote><p>You see, when you install the .NET Framework, two copies of Microsoftâ€™s assembly files are actually installed. One set is installed into the compiler/CLR directory, and another set is installed into a GAC subdirectory. The files in the compiler/CLR directory exist so that you can easily build your assembly, whereas the copies in the GAC exist so that they can be loaded at run time.</p></blockquote><blockquote><p>The reason that CSC.exe doesnâ€™t look in the GAC for referenced assemblies is that youâ€™d have to know the path to the assembly file and the structure of the GAC is undocumented. Alternatively, CSC.exe could allow you to specify a still long but slightly nicer-looking string, such as â€œSystem.Drawing, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a.â€ Both of these solutions were deemed worse than having the assembly files installed twice on the userâ€™s hard drive.</p></blockquote><blockquote><p>In addition, the assemblies in the compiler/CLR directory are machine agnostic. That is, these assemblies contain only metadata in them. Because the IL code is not required at build time, this directory does not have to contain x86, x64, and ARM versions of an assembly. The assemblies in the GAC contain metadata and IL code because the code is needed only at run time. And, because the code can be fine-tuned for a specific CPU architecture, the GAC allows multiple copies of an assembly to reside within it; each copy is located under a different subdirectory for each CPU architecture.</p></blockquote><p>ğŸ’¡ å°ç»“ï¼šç¬¬äºŒç« ä»‹ç»è¿‡å¦‚ä½•ä½¿ç”¨ CSC.exe çš„ /reference ç¼–è¯‘å™¨å¼€å…³æŒ‡å®šæƒ³å¼•ç”¨çš„ç¨‹åºé›†æ–‡ä»¶åã€‚å¦‚æœæ–‡ä»¶åæ˜¯å®Œæ•´è·¯å¾„ï¼ŒCSC.exe ä¼šåŠ è½½æŒ‡å®šæ–‡ä»¶ï¼Œå¹¶æ ¹æ®å®ƒçš„å…ƒæ•°æ®ç”Ÿæˆç¨‹åºé›†ã€‚å¦‚æœæŒ‡å®šä¸å«è·¯å¾„çš„æ–‡ä»¶åï¼ŒCSC.exe åˆ™ä¼šä¾æ¬¡åœ¨å·¥ä½œç›®å½•ã€CSC.exe æ‰€åœ¨ç›®å½•ã€ä½¿ç”¨ /lib ç¼–è¯‘å™¨å¼€å…³æŒ‡å®šçš„ä»»ä½•ç›®å½•ã€ä½¿ç”¨ LIB ç¯å¢ƒå˜é‡æŒ‡å®šçš„ä»»ä½•ç›®å½•ã€‚<span class="exturl" data-url="aHR0cDovL3huLS00OXNxNjZoLk5FVA==">å®‰è£….NET</span> Framework æ—¶ï¼Œå®é™…ä¼šå®‰è£… Microsoft çš„ç¨‹åºé›†æ–‡ä»¶çš„ä¸¤å¥—æ‹·è´ã€‚ä¸€å¥—å®‰è£…åˆ°ç¼–è¯‘å™¨ / CLR ç›®å½•ï¼Œå¦ä¸€å¥—å®‰è£…åˆ° GAC çš„å­ç›®å½•ã€‚ç¼–è¯‘å™¨ / CLR ç›®å½•ä¸­çš„æ–‡ä»¶æ–¹ä¾¿ä½ ç”Ÿæˆç¨‹åºé›†ï¼Œè€Œ GAC ä¸­çš„æ‹·è´åˆ™æ–¹ä¾¿åœ¨è¿è¡Œæ—¶åŠ è½½ã€‚ç¼–è¯‘å™¨ / CLR ç›®å½•ä¸­çš„ç¨‹åºé›†åªåŒ…å«å…ƒæ•°æ®ï¼ˆç”±äºä¸éœ€è¦ IL ä»£ç ï¼Œæ‰€ä»¥äº CPU æ¡†æ¶æ— å…³ï¼Œæ•…ç§°è¿™äº›ç¨‹åºé›†ä¸ä¾èµ–æœºå™¨ï¼‰ã€‚GAC ä¸­ç¨‹åºé›†æ‰åŒæ—¶åŒ…å«å…ƒæ•°æ®å’Œ IL ä»£ç ï¼Œå› ä¸ºä»…åœ¨è¿è¡Œæ—¶æ‰éœ€è¦ä»£ç ã€‚å¦å¤–ï¼Œç”±äºä»£ç å¯é’ˆå¯¹ç‰¹å®š CPU æ¶æ„è¿›è¡Œä¼˜åŒ–ï¼Œæ‰€ä»¥ GAC å…è®¸å­˜åœ¨ä¸€ä¸ªç¨‹åºé›†çš„å¤šä¸ªæ‹·è´ï¼Œæ¯ä¸ª CPU æ¡†æ¶éƒ½æœ‰ä¸€ä¸ªä¸“é—¨çš„å­ç›®å½•æ¥å®¹çº³è¿™äº›æ‹·è´ã€‚CSC.exe ä¹‹æ‰€ä»¥ä¸åœ¨ GAC ä¸­æŸ¥æ‰¾å¼•ç”¨çš„ç¨‹åºé›†ï¼Œæ˜¯å› ä¸ºä½ å¿…é¡»çŸ¥é“ç¨‹åºé›†è·¯å¾„ï¼Œè€Œ GAC çš„ç»“æ„æœ‰æ²¡æœ‰æ­£å¼å…¬å¼€ã€‚</p><h2 id="strongly-named-assemblies-are-tamper-resistant"><a class="anchor" href="#strongly-named-assemblies-are-tamper-resistant">#</a> <strong>Strongly Named Assemblies Are Tamper-Resistant</strong></h2><blockquote><p>Signing an assembly with a private key and embedding the signature and public key within an assembly allows the CLR to verify that the assembly has not been modified or corrupted. When an assembly is installed into the GAC, the system hashes the contents of the file containing the manifest and compares the hash value with the RSA digital signature value embedded within the PE file (after unsigning it with the public key). If the values are identical, the fileâ€™s contents havenâ€™t been tampered with. In addition, the system hashes the contents of the assemblyâ€™s other files and compares the hash values with the hash values stored in the manifest fileâ€™s FileDef table. If any of the hash values donâ€™t match, at least one of the assemblyâ€™s files has been tampered with, and the assembly will fail to install into the GAC.</p></blockquote><blockquote><p>When an application needs to bind to an assembly, the CLR uses the referenced assemblyâ€™s properties (name, version, culture, and public key) to locate the assembly in the GAC. If the referenced assembly can be found, its containing subdirectory is returned, and the file holding the manifest is loaded. Finding the assembly this way assures the caller that the assembly loaded at run time came from the same publisher that built the assembly the code was compiled against. This assurance is possible because the public key token in the referencing assemblyâ€™s AssemblyRef table corresponds to the public key in the referenced assemblyâ€™s AssemblyDef table. If the referenced assembly isnâ€™t in the GAC, the CLR looks in the applicationâ€™s base directory and then in any of the private paths identified in the applicationâ€™s configuration file; then, if the application was installed using MSI, the CLR asks MSI to locate the assembly. If the assembly canâ€™t be found in any of these locations, the bind fails, and a System.IO.FileNotFoundException is thrown.</p></blockquote><blockquote><p>When strongly named assembly files are loaded from a location other than the GAC (via the applicationâ€™s base directory or via a codeBase element in a configuration file), the CLR compares hash values when the assembly is loaded. In other words, a hash of the file is performed every time an application executes and loads the assembly. This performance hit is a tradeoff for being certain that the assembly fileâ€™s content hasnâ€™t been tampered with. When the CLR detects mismatched hash values at run time, it throws a System.IO.FileLoadException.</p></blockquote><p>ğŸ’¡ å°ç»“ï¼šç”¨ç§é’¥å¯¹ç¨‹åºé›†è¿›è¡Œç­¾åï¼Œå¹¶å°†å…¬é’¥å’Œç­¾ååµŒå…¥ç¨‹åºé›†ï¼ŒCLR å°±å¯ä»¥éªŒè¯ç¨‹åºé›†æœªè¢«ä¿®æ”¹æˆ–ç ´åã€‚ç¨‹åºé›†å®‰è£…åˆ° GAC æ—¶ï¼Œç³»ç»Ÿä¼šå¯¹åŒ…å«æ¸…å•çš„é‚£ä¸ªæ–‡ä»¶çš„å†…å®¹è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå°†å“ˆå¸Œå€¼ä¸ PE æ–‡ä»¶ä¸­åµŒå…¥çš„ RSA æ•°å­—ç­¾åè¿›è¡Œæ¯”è¾ƒï¼Œä¹Ÿä¼šä¸æ¸…å•æ–‡ä»¶çš„ FileDef è¡¨ä¸­å­˜å‚¨çš„å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒã€‚ä»»ä½•ä¸€ä¸ªå“ˆå¸Œå€¼ä¸åŒ¹é…ï¼Œè¡¨æ˜ç¨‹åºé›†è‡³å°‘æœ‰ä¸€ä¸ªæ–‡ä»¶è¢«ç¯¡æ”¹ï¼Œç¨‹åºé›†å°†æ— æ³•å®‰è£…åˆ° GACã€‚åº”ç”¨ç¨‹åºéœ€è¦ç»‘å®šåˆ°ç¨‹åºé›†æ—¶ï¼ŒCLR æ ¹æ®è¢«å¼•ç”¨ç¨‹åºé›†çš„å±æ€§ï¼ˆåç§°ã€ç‰ˆæœ¬ã€è¯­è¨€æ–‡åŒ–å’Œå…¬é’¥ï¼‰åœ¨ GAC ä¸­å®šä½è¯¥ç¨‹åºé›†ã€‚æ‰¾åˆ°è¢«å¼•ç”¨çš„ï¼Œå°±è¿”å›åŒ…å«å®ƒçš„å­ç›®å½•ï¼Œå¹¶åŠ è½½æ¸…å•æ‰€åœ¨çš„æ–‡ä»¶ã€‚å¦‚æœè¢«å¼•ç”¨ç¨‹åºé›†ä¸åœ¨ GAC ä¸­ï¼ŒCLR ä¼šæŸ¥æ‰¾åº”ç”¨ç¨‹åºçš„åŸºç›®å½•ï¼Œç„¶åæŸ¥æ‰¾åº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ä¸­æ ‡æ³¨çš„ä»»ä½•ç§æœ‰è·¯å¾„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…¥å®«å¼ºå‘½åç¨‹åºé›†æ–‡ä»¶ä» GAC ä¹‹å¤–çš„ä½ç½®åŠ è½½ï¼ŒCLR ä¼šåœ¨ç¨‹åºé›†åŠ è½½åæ¯”è¾ƒå“ˆå¸Œå€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡åº”ç”¨ç¨‹åºæ‰§è¡Œå¹¶åŠ è½½ç¨‹åºé›†æ—¶ï¼Œéƒ½ä¼šå¯¹æ–‡ä»¶è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œä»¥ç‰ºç‰²æ€§èƒ½ä¸ºä»£ä»·ï¼Œä¿è¯ç¨‹åºé›†æ–‡ä»¶å†…å®¹æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚è€Œå°†å¼ºå‘½åç¨‹åºé›†å®‰è£…åˆ° GAC æ—¶ï¼Œç³»ç»Ÿä»…ä¼šåœ¨å®‰è£…æ—¶æ‰§è¡Œä¸€æ¬¡æ£€æŸ¥æ“ä½œã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸ºäº†å¢å¼ºæ€§èƒ½ï¼Œå¦‚æœå¼ºå‘½åç¨‹åºé›†è¢«å®Œå…¨ä¿¡ä»»ï¼Œå¹¶åŠ è½½åˆ°å®Œå…¨ä¿¡ä»»çš„ AppDomain ä¸­ï¼ŒCLR å°†ä¸æ£€æŸ¥è¯¥ç¨‹åºé›†æ˜¯å¦è¢«ç¯¡æ”¹ã€‚</p><h2 id="delayed-signing"><a class="anchor" href="#delayed-signing">#</a> <strong>Delayed Signing</strong></h2><blockquote><p>When youâ€™re ready to package your strongly named assembly, youâ€™ll have to use the secure private key to sign it. However, while developing and testing your assembly, gaining access to the secure private key can be a hassle. For this reason, the .NET Framework supports delayed signing, sometimes referred to as partial signing. Delayed signing allows you to build an assembly by using only your companyâ€™s public key; the private key isnâ€™t necessary. Using the public key allows assemblies that reference your assembly to embed the correct public key value in their AssemblyRef metadata entries. It also allows the assembly to be placed in the GAC appropriately. If you donâ€™t sign the file with your companyâ€™s private key, you lose all of the tampering protection afforded to you because the assemblyâ€™s files wonâ€™t be hashed, and a digital signature wonâ€™t be embedded in the file. This loss of protection shouldnâ€™t be a problem, however, because you use delayed signing only while developing your own assembly, not when youâ€™re ready to package and deploy the assembly.</p></blockquote><blockquote><p>Basically, you get your companyâ€™s public key value in a file and pass the file name to whatever utility you use to build the assembly. (As I have shown earlier in this chapter, you can use SN.exeâ€™s â€“p switch to extract a public key from a file that contains a public/private key pair.) You must also tell the tool that you want the assembly to be delay signed, meaning that youâ€™re not supplying a private key. For the C# compiler, you do this by specifying the /delaysign compiler switch. In Visual Studio, you display the properties for your project, click the Signing tab, and then select the Delay Sign Only check box. If youâ€™re using AL.exe, you can specify the /delay[sign] commandline switch.</p></blockquote><blockquote><p>When the compiler or AL.exe detects that youâ€™re delay signing an assembly, it will emit the assemblyâ€™s AssemblyDef manifest entry, which will contain the assemblyâ€™s public key. Again, the presence of the public key allows the assembly to be placed in the GAC. It also allows you to build other assemblies that reference this assembly; the referencing assemblies will have the correct public key in their AssemblyRef metadata table entries. When creating the resulting assembly, space is left in the resulting PE file for the RSA digital signature. (The utility can determine how much space is necessary from the size of the public key.) Note that the fileâ€™s contents wonâ€™t be hashed at this time either.</p></blockquote><blockquote><p>At this point, the resulting assembly doesnâ€™t have a valid signature. Attempting to install the assembly into the GAC will fail because a hash of the fileâ€™s contents hasnâ€™t been doneâ€”the file appears to have been tampered with. On every machine on which the assembly needs to be installed into the GAC, you must prevent the system from verifying the integrity of the assemblyâ€™s files. To do this, you use the SN.exe utility, specifying the â€“Vr command-line switch. Executing SN.exe with this switch also tells the CLR to skip checking hash values for any of the assemblyâ€™s files when loaded at run time. Internally, SNâ€™s â€“Vr switch adds the assemblyâ€™s identity under the following registry subkey:</p></blockquote><pre><code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\StrongName\Verification
</code></pre><blockquote><p>When youâ€™re finished developing and testing the assembly, you need to officially sign it so that you can package and deploy it. To sign the assembly, use the SN.exe utility again, this time with the â€“R switch and the name of the file that contains the actual private key. The â€“R switch causes SN.exe to hash the fileâ€™s contents, sign it with the private key, and embed the RSA digital signature in the file where the space for it had previously been reserved. After this step, you can deploy the fully signed assembly. On the developing and testing machines, donâ€™t forget to turn verification of this assembly back on by using SN.exeâ€™s â€“Vu or â€“Vx command-line switch.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre>csc <span class="token operator">/</span>keyfile<span class="token punctuation">:</span>MyCompany<span class="token punctuation">.</span>PublicKey <span class="token operator">/</span>delaysign MyAssembly<span class="token punctuation">.</span>cs</pre></td></tr><tr><td data-num="2"></td><td><pre>SN<span class="token punctuation">.</span>exe â€“Vr MyAssembly<span class="token punctuation">.</span>dll</pre></td></tr><tr><td data-num="3"></td><td><pre>SN<span class="token punctuation">.</span>exe <span class="token operator">-</span>Ra MyAssembly<span class="token punctuation">.</span>dll MyCompany<span class="token punctuation">.</span>PrivateKey</pre></td></tr><tr><td data-num="4"></td><td><pre>SN<span class="token punctuation">.</span>exe â€“Vu MyAssembly<span class="token punctuation">.</span>dll</pre></td></tr></table></figure><p>ğŸ’¡ å°ç»“ï¼šå‡†å¤‡æ‰“åŒ…è‡ªå·±çš„å¼ºå‘½åç¨‹åºé›†æ—¶ï¼Œå¿…é¡»ä½¿ç”¨å—ä¸¥å¯†ä¿æŠ¤çš„ç§é’¥å¯¹å®ƒè¿›è¡Œç­¾åã€‚ç„¶è€Œï¼Œåœ¨å¼€å‘å’Œæµ‹è¯•ç¨‹åºé›†æ—¶ï¼Œè®¿é—®è¿™äº›å—ä¸¥å¯†ä¿æŠ¤çš„ç§é’¥å¯èƒ½æœ‰ç‚¹ç¢äº‹å„¿ã€‚æœ‰é‰´äºæ­¤ï¼Œ.NET Framework æä¾›äº†å¯¹å»¶è¿Ÿç­¾åï¼ˆdelayed signingï¼‰çš„æ”¯æŒï¼Œè¯¥æŠ€æœ¯ä¹Ÿç§°ä¸ºéƒ¨åˆ†ç­¾åï¼ˆpartial signingï¼‰ã€‚å»¶è¿Ÿç­¾åå…è®¸åªç”¨å…¬å¸çš„å…¬é’¥ç”Ÿæˆç¨‹åºé›†ï¼Œæš‚æ—¶ä¸ç”¨ç§é’¥ã€‚ç¼–è¯‘å™¨æˆ– AL.exe ä¸€æ—¦æ£€æµ‹åˆ°è¦å¯¹ç¨‹åºé›†è¿›è¡Œå»¶è¿Ÿç­¾åï¼Œå°±ä¼šç”Ÿæˆç¨‹åºé›†çš„ AssemblyDef æ¸…å•è®°å½•é¡¹ï¼Œå…¶ä¸­å°†åŒ…å«ç¨‹åºé›†çš„å…¬é’¥ã€‚å…¬é’¥ä½¿ç¨‹åºé›†èƒ½æ­£ç¡®å­˜å‚¨åˆ° GACã€‚åˆ›å»ºç¨‹åºé›†æ—¶ï¼Œä¼šåœ¨ç”Ÿæˆçš„ PE æ–‡ä»¶ä¸­ä¸º RSA æ•°å­—ç­¾åé¢„ç•™ç©ºé—´ï¼ˆå®é™…ç¨‹åºæ ¹æ®å…¬é’¥å¤§å°åˆ¤æ–­éœ€é¢„ç•™å¤šå¤§ç©ºé—´ï¼‰ã€‚è¦æ³¨æ„çš„æ—¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ä¼šå†è¿™ä¸ªæ—¶å€™è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œç”±äºç¨‹åºé›†æ²¡æœ‰æœ‰æ•ˆç­¾åï¼Œå› æ­¤åœ¨éœ€è¦å®‰è£…åˆ° GAC çš„æ¯å°æœºå™¨ä¸Šï¼Œéƒ½å¿…é¡»ç¦æ­¢ç³»ç»ŸéªŒè¯ç¨‹åºé›†æ–‡ä»¶çš„å®Œæ•´æ€§ã€‚ç»“æŸç¨‹åºé›†çš„å¼€å‘å’Œæµ‹è¯•ä¹‹åï¼Œè¦æ­£å¼å¯¹å…¶è¿›è¡Œç­¾åï¼Œä»¥ä¾¿æ‰“åŒ…å’Œéƒ¨ç½²å®ƒã€‚</p><h2 id="privately-deploying-strongly-named-assemblies"><a class="anchor" href="#privately-deploying-strongly-named-assemblies">#</a> <strong>Privately Deploying Strongly Named Assemblies</strong></h2><blockquote><p>Installing assemblies into the GAC offers several benefits. The GAC enables many applications to share assemblies, reducing physical memory usage on the whole. In addition, itâ€™s easy to deploy a new version of the assembly into the GAC and have all applications use the new version via a publisher policy (described later in this chapter). The GAC also provides side-by-side management for an assemblyâ€™s different versions. However, the GAC is usually secured so that only an administrator can install an assembly into it. Also, installing into the GAC breaks the simple copy deployment story.</p></blockquote><blockquote><p>Although strongly named assemblies can be installed into the GAC, they certainly donâ€™t have to be. In fact, itâ€™s recommended that you deploy assemblies into the GAC only if the assembly is intended to be shared by many applications. If an assembly isnâ€™t intended to be shared, it should be deployed privately. Deploying privately preserves the simple copy install deployment story and better isolates the application and its assemblies. Also, the GAC isnâ€™t intended to be the new C:\Windows\System32 dumping ground for common files. The reason is because new versions of assemblies donâ€™t overwrite each other; they are installed side by side, eating up disk space.</p></blockquote><blockquote><p>In addition to deploying a strongly named assembly in the GAC or privately, a strongly named assembly can be deployed to some arbitrary directory that a small set of applications know about. For example, you might be producing three applications, all of which want to share a strongly named assembly. Upon installation, you can create four directories: one for each application and an additional directory for the assembly you want shared. When you install each application into its directory, also install an XML configuration file, and have the shared assemblyâ€™s codeBase element indicate the path of the shared assembly. Now at run time, the CLR will know to look in the strongly named assemblyâ€™s directory for the shared assembly. For the record, this technique is rarely used and is somewhat discouraged because no single application controls when the assemblyâ€™s files should be uninstalled.</p></blockquote><p>ğŸ’¡ Noteï¼šé…ç½®æ–‡ä»¶çš„ codeBase å…ƒç´ å®é™…æ ‡è®°äº†ä¸€ä¸ª URLã€‚è¿™ä¸ª URL å¯å¼•ç”¨ç”¨æˆ·æœºå™¨ä¸Šçš„äººæˆ·ç›®å½•ï¼Œä¹Ÿå¯å¼•ç”¨ Web åœ°å€ã€‚å¦‚æœå¼•ç”¨ Web åœ°å€ï¼ŒCLR ä¼šè‡ªåŠ¨ä¸‹è½½æ–‡ä»¶ï¼Œå¹¶æŠŠå®ƒå­˜å‚¨åˆ°ç”¨æˆ·çš„ä¸‹è½½ç¼“å­˜ï¼ˆ% UserProfile%\Local Settings\Application Data\Assembly ä¸‹çš„å­ç›®å½•ï¼‰ã€‚å°†æ¥å¼•ç”¨æ—¶ï¼ŒCLR å°†ä¸‹è½½æ–‡ä»¶çš„æ—¶é—´æˆ³ä¸ URL å¤„çš„æ–‡ä»¶çš„æ—¶é—´æˆ³è¿›è¡Œå¯¹æ¯”ã€‚å¦‚æœ URL å¤„çš„æ–‡ä»¶å…·æœ‰è¾ƒæ–°çš„æ—¶é—´æˆ³ï¼ŒCLR ä¸‹è½½æ–°ç‰ˆæœ¬å¹¶åŠ è½½ã€‚å¦åˆ™ï¼ŒCLR åŠ è½½ç°æœ‰æ–‡ä»¶ï¼Œä¸é‡å¤ä¸‹è½½ï¼ˆä»è€Œå¢å¼ºæ€§èƒ½ï¼‰ã€‚</p><p>ğŸ’¡ å°ç»“ï¼šGAC ä½¿ç¨‹åºé›†èƒ½è¢«å¤šä¸ªåº”ç”¨ç¨‹åºå…±äº«ï¼Œå‡å°‘äº†æ€»ä½“ç‰©ç†å†…å­˜æ¶ˆè€—ã€‚å¦å¤–ï¼Œå¾ˆå®¹æ˜“å°†ç¨‹åºé›†çš„æ–°ç‰ˆæœ¬éƒ¨ç½²åˆ° GACï¼Œè®©æ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½é€šè¿‡å‘å¸ƒè€…ç­–ç•¥ä½¿ç”¨æ–°ç‰ˆæœ¬ã€‚GAC è¿˜å®ç°äº†å¯¹ç¨‹åºé›†å¤šä¸ªç‰ˆæœ¬çš„å¹¶è¡Œç®¡ç†ã€‚ä½† GAC é€šå¸¸å—åˆ°ä¸¥å¯†ä¿æŠ¤ï¼Œåªæœ‰ç®¡ç†å‘˜æ‰èƒ½åœ¨å…¶ä¸­å®‰è£…ç¨‹åºé›†ï¼Œå¹¶ä¸”è¿™ç§æ–¹å¼è¿åäº† â€œç®€å•å¤åˆ¶éƒ¨ç½²â€ çš„ç›®æ ‡ã€‚å¼ºå‘½åç¨‹åºé›†å¹¶éå¿…é¡»å®‰è£…åˆ° GACï¼Œç§æœ‰éƒ¨ç½²è¾¾æˆäº† â€œç®€å•å¤åˆ¶éƒ¨ç½²â€ ç›®æ ‡ï¼Œè€Œä¸”èƒ½æ›´å¥½åœ°éš”ç¦»åº”ç”¨ç¨‹åºåŠå…¶ç¨‹åºé›†ã€‚å¦å¤–ï¼Œä¸è¦å°† GAC æƒ³è±¡æˆæ–°çš„ C:\Windows\System32 åƒåœ¾å †æœºåœºã€‚è¿™æ˜¯æ–°ç‰ˆæœ¬ç¨‹åºé›†ä¸ä¼šç›¸äº’è¦†ç›–ï¼Œå®ƒä»¬å¹¶è¡Œå®‰è£…ï¼Œæ¯ä¸ªå®‰è£…éƒ½å ç”¨ç£ç›˜ç©ºé—´ã€‚</p><h2 id="how-the-runtime-resolves-type-references"><a class="anchor" href="#how-the-runtime-resolves-type-references">#</a> <strong>How the Runtime Resolves Type References</strong></h2><blockquote><p>At the beginning of Chapter 2, we saw the following source code.</p></blockquote><pre><code>public sealed class Program &#123;
 public static void Main() &#123;
 System.Console.WriteLine(&quot;Hi&quot;);
 &#125;
&#125;
</code></pre><blockquote><p>This code is compiled and built into an assembly, say Program.exe. When you run this application, the CLR loads and initializes. Then the CLR reads the assemblyâ€™s CLR header, looking for the MethodDefToken that identifies the applicationâ€™s entry point method (Main). From the MethodDef metadata table, the offset within the file for the methodâ€™s IL code is located and JIT-compiled into native code, which includes having the code verified for type safety. The native code then starts executing. Following is the IL code for the Main method. To obtain this output, I ran ILDasm.exe, chose the View menuâ€™s Show Bytes menu item, and then double-clicked the Main method in the tree view.</p></blockquote><pre><code>.method public hidebysig static void Main() cil managed
// SIG: 00 00 01
&#123;
 .entrypoint
 // Method begins at RVA 0x2050
 // Code size 11 (0xb)
 .maxstack 8
 IL_0000: /* 72 | (70)000001 */
 ldstr &quot;Hi&quot;
 IL_0005: /* 28 | (0A)000003 */
 call void [mscorlib]System.Console::WriteLine(string)
 IL_000a: /* 2A | */
 ret
&#125; // end of method Program::Main
</code></pre><blockquote><p>When JIT-compiling this code, the CLR detects all references to types and members and loads their defining assemblies (if not already loaded). As you can see, the preceding IL code has a reference to <code>System.Console.WriteLine</code> . Specifically, the IL call instruction references metadata token 0A000003. This token identifies entry 3 in the <code>MemberRef</code> metadata table (table 0A). The CLR looks up this <code>MemberRef</code> entry and sees that one of its fields refers to an entry in a <code>TypeRef</code> table (the <code>System.Console</code> type). From the <code>TypeRef</code> entry, the CLR is directed to an <code>AssemblyRef</code> entry: â€œmscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089â€. At this point, the CLR knows which assembly it needs. Now the CLR must locate the assembly in order to load it.</p></blockquote><blockquote><p>When resolving a referenced type, the CLR can find the type in one of three places:</p><p>â–  Same file Access to a type that is in the same file is determined at compile time (sometimes referred to as early bound). The type is loaded out of the file directly, and execution continues.</p><p>â–  Different file, same assembly The runtime ensures that the file being referenced is, in fact, in the assemblyâ€™s <code>ModuleRef</code> table of the current assemblyâ€™s manifest. The runtime then looks in the directory where the assemblyâ€™s manifest file was loaded. The file is loaded, its hash value is checked to ensure the fileâ€™s integrity, the typeâ€™s member is found, and execution continues.</p><p>â–  Different file, different assembly When a referenced type is in a different assemblyâ€™s file, the runtime loads the file that contains the referenced assemblyâ€™s manifest. If this file doesnâ€™t contain the type, the appropriate file is loaded. The typeâ€™s member is found, and execution continues.</p></blockquote><p>ğŸ’¡ Noteï¼šModuleDefï¼ŒModuleRef å’Œ FileDef å…ƒæ•°æ®è¡¨åœ¨å¼•ç”¨æ–‡ä»¶æ—¶ä½¿ç”¨äº†æ–‡ä»¶åå’Œæ‰©å±•åã€‚ä½† AssemblyRef å…ƒæ•°æ®è¡¨åªä½¿ç”¨æ–‡ä»¶åï¼Œæ— æ‰©å±•åã€‚</p><p><img data-src="/2022/08/28/csharp/clr-via-csharp/Chapter%203%20Shared%20Assemblies%20and%20Strongly%20Named%20Assemblies/Untitled2.png" alt="Untitled"></p><blockquote><p>There is one more twist to this story: to the CLR, all assemblies are identified by name, version, culture, and public key. However, the GAC identifies assemblies by using name, version, culture, public key, and CPU architecture. When searching the GAC for an assembly, the CLR figures out what type of process the application is currently running in: 32-bit x86 (possibly using the WoW64 technology), 64-bit x64, or 32-bit ARM. Then, when searching the GAC for an assembly, the CLR first searches for a CPU architectureâ€“specific version of the assembly. If it does not find a matching assembly, it then searches for a CPU-agnostic version of the assembly.</p></blockquote><p>ğŸ’¡ Noteï¼šCLR æä¾›äº†å°†ç±»å‹ï¼ˆç±»ã€ç»“æ„ä½“ã€æšä¸¾ã€æ¥å£æˆ–å§”æ‰˜ï¼‰ä»ä¸€ä¸ªç¨‹åºé›†ç§»åŠ¨åˆ°å¦ä¸€ä¸ªç¨‹åºé›†çš„åŠŸèƒ½ã€‚CLR æä¾›äº†åä¸º <code>System.Runtime.CompilerServices.TypeForwardedToAttribute</code> ç‰¹æ€§ï¼Œå¯å°†å®ƒåº”ç”¨äºåŸå§‹ç¨‹åºé›†ã€‚è¦å‘è¯¥ç‰¹æ€§çš„æ„é€ å™¨ä¼ é€’ä¸€ä¸ª System.Type ç±»å‹çš„å‚æ•°ï¼Œä¹‹å¤„åº”ç”¨ç¨‹åºè¦ä½¿ç”¨çš„æ–°ç±»å‹ã€‚CLR ç»‘å®šå™¨ï¼ˆbinderï¼‰ä¼šåˆ©ç”¨è¿™ä¸ªä¿¡æ¯ã€‚ç”±äº TypeForwardedToAttribute çš„æ„é€ å™¨è·å–çš„æ˜¯ Typeï¼Œæ‰€ä»¥åŒ…å«è¯¥ç‰¹æ€§çš„ç¨‹åºé›†è¦ä¾èµ–äºç°åœ¨å®šä¹‰ç±»å‹çš„ç¨‹åºé›†ã€‚ä¸ºäº†ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œè¿˜è¦å‘æ–°ç¨‹åºé›†ä¸­çš„ç±»å‹åº”ç”¨åä¸º <code>System.Runtime.CompilerServices.TypeForwardedFromAttribute</code> çš„ç‰¹æ€§ï¼Œå‘è¯¥ç‰¹æ€§çš„æ„é€ å™¨ä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²æ¥ä¹‹å¤„å®šä¹‰ç±»å‹çš„æ—§ç¨‹åºé›†çš„å…¨åã€‚ç”±äº <code>TypeForwardedFromAttribute</code> çš„æ„é€ å™¨è·å–çš„æ˜¯ Stringï¼Œæ‰€ä»¥åŒ…å«è¯¥ç‰¹æ€§çš„ç¨‹åºé›†ä¸ä¾èµ–äºè¿‡å»å®šä¹‰ç±»å‹çš„ç¨‹åºé›†ã€‚</p><p>ğŸ’¡ å°ç»“ï¼šâ€ è¿è¡Œæ—¶ â€œè§£æå¼•ç”¨ç±»å‹æ—¶ï¼ŒCLR å¯èƒ½åœ¨ä»¥ä¸‹ä¸‰ä¸ªåœ°æ–¹æ‰¾åˆ°ç±»å‹ï¼š1. ç›¸åŒæ–‡ä»¶ã€‚ç¼–è¯‘æ—¶ä¾¿èƒ½å‘ç°å¯¹ç›¸åŒæ–‡ä»¶ä¸­çš„ç±»å‹çš„è®¿é—®ï¼Œè¿™ç§°ä¸ºæ—©æœŸç»‘å®šï¼ˆearly bindingï¼‰ã€‚ç±»å‹ç›´æ¥ä»æ–‡ä»¶ä¸­åŠ è½½ï¼Œæ‰§è¡Œç»§ç»­ã€‚2. ä¸åŒæ–‡ä»¶ï¼Œç›¸åŒç¨‹åºé›†ã€‚â€ è¿è¡Œæ—¶ â€œç¡®ä¿è¢«å¼•ç”¨çš„æ–‡ä»¶åœ¨å½“å‰ç¨‹åºé›†å…ƒæ•°æ®çš„ FileDef è¡¨ä¸­ï¼Œæ£€æŸ¥åŠ è½½ç¨‹åºé›†æ¸…å•æ–‡ä»¶çš„ç›®å½•ï¼ŒåŠ è½½è¢«å¼•ç”¨çš„æ–‡ä»¶ï¼Œæ£€æŸ¥å“ˆå¸Œå€¼ä»¥ç¡®ä¿æ–‡ä»¶å®Œæ•´æ€§ã€‚å‘ç°ç±»å‹çš„æˆå‘˜ï¼Œæ‰§è¡Œç»§ç»­ã€‚3. ä¸åŒæ–‡ä»¶ï¼Œä¸åŒç¨‹åºé›†ã€‚å¦‚æœå¼•ç”¨çš„ç±»å‹åœ¨å…¶ä»–ç¨‹åºé›†ä¸­ï¼Œâ€ è¿è¡Œæ—¶ â€œä¼šåŠ è½½è¢«å¼•ç”¨ç¨‹åºé›†çš„æ¸…å•æ–‡ä»¶ã€‚å¦‚æœéœ€è¦çš„ç±»å‹ä¸åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œå°±ç»§ç»­åŠ è½½åŒ…å«äº†è¯¥ç±»å‹çš„æ–‡ä»¶ã€‚å‘ç°ç±»å‹çš„æˆå‘˜ï¼Œæ‰§è¡Œç»§ç»­ã€‚è¿˜è¦æ³¨æ„ï¼Œå¯¹äº CLRï¼Œæ‰€æœ‰ç¨‹åºé›†éƒ½æ ¹æ®åç§°ã€ç‰ˆæœ¬ã€è¯­è¨€æ–‡åŒ–å’Œå…¬é’¥æ¥è¯†åˆ«ã€‚ä½† GAC æ ¹æ®åç§°ã€ç‰ˆæœ¬ã€è¯­è¨€æ–‡åŒ–ã€å…¬é’¥å’Œ CPU æ¶æ„æ¥è¯†åˆ«ã€‚åœ¨ GAC ä¸­æœç´¢ç¨‹åºé›†æ—¶ï¼ŒCLR é¦–å…ˆæœç´¢ç¨‹åºé›†çš„ CPU æ¶æ„ä¸“ç”¨ç‰ˆæœ¬ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„ï¼Œå°±æœç´¢ä¸åŒºåˆ† CPU çš„ç‰ˆæœ¬ã€‚</p><h2 id="advanced-administrative-control-configuration"><a class="anchor" href="#advanced-administrative-control-configuration">#</a> <strong>Advanced Administrative Control (Configuration)</strong></h2><blockquote><p>Having discussed only the probing elementâ€™s privatePath attribute in Chapter 2, Iâ€™m going to discuss the other XML configuration file elements in this section. Following is an XML configuration file.</p></blockquote><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token prolog">&lt;?xml version="1.0"?></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>runtime</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assemblyBinding</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>urn:schemas-microsoft-com:asm.v1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>probing</span> <span class="token attr-name">privatePath</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>AuxFiles;bin\subdir<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependentAssembly</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assemblyIdentity</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>SomeClassLibrary<span class="token punctuation">"</span></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token attr-name">publicKeyToken</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>32ab4ba45e0a69a1<span class="token punctuation">"</span></span> <span class="token attr-name">culture</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neutral<span class="token punctuation">"</span></span><span class="token punctuation">/></span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bindingRedirect</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token attr-name">oldVersion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.0.0.0<span class="token punctuation">"</span></span> <span class="token attr-name">newVersion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2.0.0.0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>codeBase</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2.0.0.0<span class="token punctuation">"</span></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.Wintellect.com/SomeClassLibrary.dll<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependentAssembly</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependentAssembly</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assemblyIdentity</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>TypeLib<span class="token punctuation">"</span></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token attr-name">publicKeyToken</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1f2e74e897abbcfe<span class="token punctuation">"</span></span> <span class="token attr-name">culture</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neutral<span class="token punctuation">"</span></span><span class="token punctuation">/></span></pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bindingRedirect</span></span></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token attr-name">oldVersion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3.0.0.0-3.5.0.0<span class="token punctuation">"</span></span> <span class="token attr-name">newVersion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4.0.0.0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>publisherPolicy</span> <span class="token attr-name">apply</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>no<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependentAssembly</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>assemblyBinding</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>runtime</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><blockquote><p>This XML file gives a wealth of information to the CLR. Hereâ€™s what it says:</p><p>â–  <strong>probing element</strong></p><p>Look in the application base directoryâ€™s AuxFiles and bin\subdir subdirectories when trying to find a weakly named assembly. For strongly named assemblies, the CLR looks in the GAC or in the URL specified by the <code>codeBase</code> element. The CLR looks in the applicationâ€™s private paths for a strongly named assembly only if no <code>codeBase</code> element is specified.</p><p>â–  <strong>First dependentAssembly, assemblyIdentity, and bindingRedirect elements</strong></p><p>When attempting to locate version 1.0.0.0 of the culture-neutral <code>SomeClassLibrary</code> assembly published by the organization that controls the 32ab4ba45e0a69a1 public key token, locate version 2.0.0.0 of the same assembly instead.</p><p>â–  <strong><code>codeBase</code> element</strong></p><p>When attempting to locate version 2.0.0.0 of the culture-neutral <code>SomeClassLibrary</code> assembly published by the organization that controls the 32ab4ba45e0a69a1 public key token, try to find it at the following URL: <span class="exturl" data-url="bm90aW9uOi8vd3d3Lm5vdGlvbi5zby93d3cuV2ludGVsbGVjdC5jb20vU29tZUNsYXNzTGlicmFyeS5kbGw=">www.Wintellect.com/SomeClassLibrary.dll</span>. Although I didnâ€™t mention it in Chapter 2, a codeBase element can also be used with weakly named assemblies. In this case, the assemblyâ€™s version number is ignored and should be omitted from the XMLâ€™s codeBase element. Also, the codeBase URL must refer to a directory under the applicationâ€™s base directory.</p><p>â–  <strong>Second dependentAssembly, assemblyIdentity, and bindingRedirect elements</strong></p><p>When attempting to locate version 3.0.0.0 through version 3.5.0.0 inclusive of the culture-neutral TypeLib assembly published by the organization that controls the 1f2e74e897abbcfe public key token, locate version 4.0.0.0 of the same assembly instead.</p><p>â–  <strong>publisherPolicy element</strong></p><p>If the organization that produces the TypeLib assembly has deployed a publisher policy file (described in the next section), the CLR should ignore this file.</p></blockquote><blockquote><p>When compiling a method, the CLR determines the types and members being referenced. Using this information, the runtime determines, by looking in the referencing assemblyâ€™s AssemblyRef table, the assembly that was originally referenced when the calling assembly was built. The CLR then looks up the assembly/version in the applicationâ€™s configuration file and applies any version number redirections; the CLR is now looking for this assembly/version.</p></blockquote><blockquote><p>Using these configuration files, an administrator can really control what assembly the CLR decides to load. If an application is experiencing a bug, the administrator can contact the publisher of the errant assembly. The publisher can send the administrator a new assembly that the administrator can install. By default, the CLR wonâ€™t load this new assembly because the already-built assemblies donâ€™t reference the new version. However, the administrator can modify the applicationâ€™s XML configuration file to instruct the CLR to load the new assembly.</p></blockquote><blockquote><p>If the administrator wants all applications on the machine to pick up the new assembly, the administrator can modify the machineâ€™s Machine.config file instead, and the CLR will load the new assembly whenever an application refers to the old assembly.</p></blockquote><blockquote><p>If the new assembly doesnâ€™t fix the original bug, the administrator can delete the binding redirection lines from the configuration file, and the application will behave as it did before. Itâ€™s important to note that the system allows the use of an assembly that doesnâ€™t exactly match the assembly version recorded in the metadata. This extra flexibility is very handy.</p></blockquote><p><strong>Publisher Policy Control</strong></p><blockquote><p>In the scenario described in the previous section, the publisher of an assembly simply sent a new version of the assembly to the administrator, who installed the assembly and manually edited the applicationâ€™s or machineâ€™s XML configuration files. In general, when a publisher fixes a bug in an assembly, the publisher would like an easy way to package and distribute the new assembly to all of the users. But the publisher also needs a way to tell each userâ€™s CLR to use the new assembly version instead of the old assembly version. Sure, each user could modify his or her applicationâ€™s or machineâ€™s XML configuration file, but this is terribly inconvenient and error prone. What the publisher needs is a way to create policy information that is installed on the userâ€™s computer when the new assembly is installed. In this section, Iâ€™ll show how an assemblyâ€™s publisher can create this policy information.</p></blockquote><blockquote><p>Letâ€™s say that youâ€™re a publisher of an assembly and that youâ€™ve just created a new version of your assembly that fixes some bugs. When you package your new assembly to send out to all of your users, you should also create an XML configuration file. This configuration file looks just like the configuration files weâ€™ve been talking about. Hereâ€™s an example file (called SomeClassLibrary.config) for the SomeClassLibrary.dll assembly.</p></blockquote><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>runtime</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assemblyBinding</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>urn:schemas-microsoft-com:asm.v1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependentAssembly</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>assemblyIdentity</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>SomeClassLibrary<span class="token punctuation">"</span></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token attr-name">publicKeyToken</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>32ab4ba45e0a69a1<span class="token punctuation">"</span></span> <span class="token attr-name">culture</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neutral<span class="token punctuation">"</span></span><span class="token punctuation">/></span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bindingRedirect</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token attr-name">oldVersion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.0.0.0<span class="token punctuation">"</span></span> <span class="token attr-name">newVersion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2.0.0.0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>codeBase</span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2.0.0.0<span class="token punctuation">"</span></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.Wintellect.com/SomeClassLibrary.dll<span class="token punctuation">"</span></span><span class="token punctuation">/></span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependentAssembly</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>assemblyBinding</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>runtime</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><blockquote><p>Of course, publishers can set policies only for the assemblies that they themselves create. In addition, the elements shown here are the only elements that can be specified in a publisher policy configuration file; you canâ€™t specify the probing or publisherPolicy elements, for example.</p></blockquote><blockquote><p>This configuration file tells the CLR to load version 2.0.0.0 of the SomeClassLibrary assembly whenever version 1.0.0.0 of the assembly is referenced. Now you, the publisher, can create an assembly that contains this publisher policy configuration file. You create the publisher policy assembly by running AL.exe as follows.</p></blockquote><pre><code>AL.exe /out:Policy.1.0.SomeClassLibrary.dll
 /version:1.0.0.0
 /keyfile:MyCompany.snk
 /linkresource:SomeClassLibrary.config
</code></pre><blockquote><p>Let me explain the meaning of AL.exeâ€™s command-line switches:</p><p>â–  <strong>/out</strong></p><p>This switch tells AL.exe to create a new PE file, called Policy.1.0.SomeClassLibrary.dll, which contains nothing but a manifest. The name of this assembly is very important. The first part of the name, Policy, tells the CLR that this assembly contains publisher policy information. The second and third parts of the name, 1.0, tell the CLR that this publisher policy assembly is for any version of the SomeClassLibrary assembly that has a major and minor version of 1.0. Publisher policies apply to the major and minor version numbers of an assembly only; you canâ€™t create a publisher policy that is specific to individual builds or revisions of an assembly. The fourth part of the name, SomeClassLibrary, indicates the name of the assembly that this publisher policy corresponds to. The fifth and last part of the name, dll, is simply the extension given to the resulting assembly file.</p><p>â–  <strong>/version</strong></p><p>This switch identifies the version of the publisher policy assembly; this version number has nothing to do with the SomeClassLibrary assembly itself. You see, publisher policy assemblies can also be versioned. Today, the publisher might create a publisher policy redirecting version 1.0.0.0 of SomeClassLibrary to version 2.0.0.0. In the future, the publisher might want to direct version 1.0.0.0 of SomeClassLibrary to version 2.5.0.0. The CLR uses this version number so that it knows to pick up the latest version of the publisher policy assembly.</p><p>â–  <strong>/keyfile</strong></p><p>This switch causes AL.exe to sign the publisher policy assembly by using the publisherâ€™s public/private key pair. This key pair must also match the key pair used for all versions of the SomeClassLibrary assembly. After all, this is how the CLR knows that the same publisher created both the SomeClassLibrary assembly and this publisher policy file.</p><p>â–  <strong>/linkresource</strong></p><p>This switch tells AL.exe that the XML configuration file is to be considered a separate file of the assembly. The resulting assembly consists of two files, both of which must be packaged and deployed to the users along with the new version of the SomeClassLibrary assembly. By the way, you canâ€™t use AL.exeâ€™s /embedresource switch to embed the XML configuration file into the assembly file, making a single file assembly, because the CLR requires the XML file to be contained in its own separate file.</p></blockquote><blockquote><p>After this publisher policy assembly is built, it can be packaged together with the new SomeClassLibrary.dll assembly file and deployed to users. The publisher policy assembly must be installed into the GAC. Although the SomeClassLibrary assembly can also be installed into the GAC, it doesnâ€™t have to be. It could be deployed into an applicationâ€™s base directory or some other directory identified by a codeBase URL.</p></blockquote><blockquote><p>I want to make one last point about publisher policy. Say that a publisher distributes a publisher policy assembly, and for some reason, the new assembly introduces more bugs than it fixes. If this happens, the administrator would like to tell the CLR to ignore the publisher policy assembly. To have the runtime do this, the administrator can edit the applicationâ€™s configuration file and add the following publisherPolicy element.</p></blockquote><pre><code>&lt;publisherPolicy apply=&quot;no&quot;/&gt;
</code></pre><blockquote><p>This element can be placed as a child element of the element in the applicationâ€™s configuration file so that it applies to all assemblies, or as a child element of the element in the applicationâ€™s configuration file to have it apply to a specific assembly. When the CLR processes the applicationâ€™s configuration file, it will see that the GAC shouldnâ€™t be examined for the publisher policy assembly. So the CLR will continue to operate using the older version of the assembly. Note, however, that the CLR will still examine and apply any policy specified in the Machine.config file.</p></blockquote><p>ğŸ’¡ å°ç»“ï¼šç³»ç»Ÿå…è®¸ä½¿ç”¨å’Œå…ƒæ•°æ®è®°å½•çš„ä¸å®Œå…¨åŒ¹é…çš„ç¨‹åºé›†ç‰ˆæœ¬ï¼Œè¿™ç§æ§åˆ¶ç”±åº”ç”¨ç¨‹åºçš„ XML é…ç½®æ–‡ä»¶å®Œæˆã€‚è€Œå‘å¸ƒè€…ç­–ç•¥ç¨‹åºé›†åˆ™æ˜¯ä¸ºäº†è§£å†³ç”¨æˆ·æ‰‹åŠ¨ä¿®æ”¹åº”ç”¨ç¨‹åºæˆ–æœºå™¨çš„ XML é…ç½®æ–‡ä»¶ä¸æ–¹ä¾¿å’Œå®¹æ˜“å‡ºé”™çš„é—®é¢˜ã€‚å°†ç”±å‘å¸ƒè€…æ¥åˆ›å»ºç­–ç•¥ä¿¡æ¯ã€‚åªæœ‰éƒ¨ç½²ç¨‹åºé›†æ›´æ–°æˆ– Service Pack æ—¶æ‰åº”åˆ›å»ºå‘å¸ƒè€…ç­–ç•¥ç¨‹åºé›†ã€‚æ‰§è¡Œåº”ç”¨ç¨‹åºçš„å…¨æ–°å®‰è£…ä¸åº”å®‰è£…å‘å¸ƒè€…ç­–ç•¥ç¨‹åºé›†ã€‚åˆ›å»ºå‘å¸ƒè€…ç­–ç•¥ç¨‹åºé›†ï¼Œå‘å¸ƒè€…ç›¸å½“äºè‚¯å®šäº†ç¨‹åºé›†ä¸åŒç‰ˆæœ¬çš„å…¼å®¹æ€§ã€‚å¦‚æœæ–°ç‰ˆæœ¬ç¨‹åºé›†ä¸å…¼å®¹æŸä¸ªè€ç‰ˆæœ¬ï¼Œå°±ä¸åº”åˆ›å»ºå‘å¸ƒè€…ç­–ç•¥ç¨‹åºé›†ã€‚é€šå¸¸ï¼Œå¦‚æœéœ€è¦ç”Ÿæˆç¨‹åºé›†çš„ bug ä¿®å¤ç‰ˆæœ¬ï¼Œå°±åº”è¯¥æä¾›å‘å¸ƒè€…ç­–ç•¥ç¨‹åºé›†ã€‚ä½œä¸ºå‘å¸ƒè€…ï¼Œåº”ä¸»åŠ¨æµ‹è¯•æ–°ç‰ˆæœ¬ç¨‹åºé›†çš„å‘åå…¼å®¹æ€§ã€‚ç›¸åï¼Œå¦‚æœè¦åœ¨ç¨‹åºé›†ä¸­å¢æ·»æ–°åŠŸèƒ½ï¼Œå°±åº”è¯¥æŠŠå®ƒè§†ä¸ºä¸ä¹‹å‰ç‰ˆæœ¬æ²¡æœ‰å…³è”çš„ç¨‹åºé›†ï¼Œä¸è¦éšå¸¦å‘å¸ƒè€…ç­–ç•¥ç¨‹åºé›†ã€‚å¦å¤–ï¼Œä¹Ÿä¸å¿…æµ‹è¯•è¿™ç±»ç¨‹åºé›†çš„å‘åå…¼å®¹æ€§ã€‚</p><div class="tags"><a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag"><i class="ic i-tag"></i> è¯»ä¹¦ç¬”è®°</a> <a href="/tags/C/" rel="tag"><i class="ic i-tag"></i> C#</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2023-11-22 08:09:50" itemprop="dateModified" datetime="2023-11-22T08:09:50+08:00">2023-11-22</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(ï¿£â–½ï¿£)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Sakupinera WeChat Pay"><p>WeChat Pay</p></div><div><img data-src="/images/alipay.png" alt="Sakupinera Alipay"><p>Alipay</p></div><div><img data-src="/images/paypal.png" alt="Sakupinera PayPal"><p>PayPal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Sakupinera <i class="ic i-at"><em>@</em></i>Sakupinera</li><li class="link"><strong>Post link: </strong><a href="http://sakupinera.github.io/2022/08/28/csharp/clr-via-csharp/Chapter%203%20Shared%20Assemblies%20and%20Strongly%20Named%20Assemblies/" title="CLR via C# - Chapter 3 Shared Assemblies and Strongly Named Assemblies">http://sakupinera.github.io/2022/08/28/csharp/clr-via-csharp/Chapter 3 Shared Assemblies and Strongly Named Assemblies/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/08/28/linux/learn-linux/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gicit31ffoj20zk0m8naf.jpg" title="LearnLinux - Linuxå¸¸ç”¨å‘½ä»¤"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i> Learn-Linux</span><h3>LearnLinux - Linuxå¸¸ç”¨å‘½ä»¤</h3></a></div><div class="item right"><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%202%20Building,%20Packaging,%20Deploying,%20and%20Administering%20Applications%20and%20Types/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipey0a334j20zk0m8qpt.jpg" title="CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i> CLR-via-CSharp</span><h3>CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#chapter-3-shared-assemblies-and-strongly-named-assemblies"><span class="toc-number">1.</span> <span class="toc-text">Chapter 3 Shared Assemblies and Strongly Named Assemblies</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#two-kinds-of-assemblies-two-kinds-of-deployment"><span class="toc-number">1.1.</span> <span class="toc-text">Two Kinds of Assemblies, Two Kinds of Deployment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#giving-an-assembly-a-strong-name"><span class="toc-number">1.2.</span> <span class="toc-text">Giving an Assembly a Strong Name</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#the-global-assembly-cache"><span class="toc-number">1.3.</span> <span class="toc-text">The Global Assembly Cache</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#building-an-assembly-that-references-a-strongly-named-assembly"><span class="toc-number">1.4.</span> <span class="toc-text">Building an Assembly That References a Strongly Named Assembly</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#strongly-named-assemblies-are-tamper-resistant"><span class="toc-number">1.5.</span> <span class="toc-text">Strongly Named Assemblies Are Tamper-Resistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delayed-signing"><span class="toc-number">1.6.</span> <span class="toc-text">Delayed Signing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#privately-deploying-strongly-named-assemblies"><span class="toc-number">1.7.</span> <span class="toc-text">Privately Deploying Strongly Named Assemblies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#how-the-runtime-resolves-type-references"><span class="toc-number">1.8.</span> <span class="toc-text">How the Runtime Resolves Type References</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#advanced-administrative-control-configuration"><span class="toc-number">1.9.</span> <span class="toc-text">Advanced Administrative Control (Configuration)</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%201%20The%20CLR%E2%80%99s%20Execution%20Model/" rel="bookmark" title="CLR via C# - Chapter 1 The CLRâ€™s Execution Model">CLR via C# - Chapter 1 The CLRâ€™s Execution Model</a></li><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%202%20Building,%20Packaging,%20Deploying,%20and%20Administering%20Applications%20and%20Types/" rel="bookmark" title="CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types">CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types</a></li><li class="active"><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%203%20Shared%20Assemblies%20and%20Strongly%20Named%20Assemblies/" rel="bookmark" title="CLR via C# - Chapter 3 Shared Assemblies and Strongly Named Assemblies">CLR via C# - Chapter 3 Shared Assemblies and Strongly Named Assemblies</a></li><li><a href="/2022/09/27/csharp/clr-via-csharp/Chapter%204%20Type%20Fundamentals/" rel="bookmark" title="CLR via C# - Chapter 4 Type Fundamentals">CLR via C# - Chapter 4 Type Fundamentals</a></li><li><a href="/2022/10/15/csharp/clr-via-csharp/Chapter%205%20Primitive,%20Reference,%20and%20Value%20%20Types/" rel="bookmark" title="CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals">CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals</a></li><li><a href="/2022/10/21/csharp/clr-via-csharp/Chapter%206%20Type%20and%20Member%20Basics/" rel="bookmark" title="CLR via C# - Chapter 6 Type and Member Basics">CLR via C# - Chapter 6 Type and Member Basics</a></li><li><a href="/2022/10/24/csharp/clr-via-csharp/Chapter%207%20Constants%20and%20Fields/" rel="bookmark" title="CLR via C# - Chapter 7 Constants and Fields">CLR via C# - Chapter 7 Constants and Fields</a></li><li><a href="/2022/10/25/csharp/clr-via-csharp/Chapter%208%20Methods/" rel="bookmark" title="CLR via C# - Chapter 8 Methods">CLR via C# - Chapter 8 Methods</a></li><li><a href="/2022/10/27/csharp/clr-via-csharp/Chapter%209%20Parameters/" rel="bookmark" title="CLR via C# - Chapter 9 Parameters">CLR via C# - Chapter 9 Parameters</a></li><li><a href="/2022/10/28/csharp/clr-via-csharp/Chapter%2010%20Properties/" rel="bookmark" title="CLR via C# - Chapter 10 Properties">CLR via C# - Chapter 10 Properties</a></li><li><a href="/2022/10/29/csharp/clr-via-csharp/Chapter%2011%20Events/" rel="bookmark" title="CLR via C# - Chapter 11 Events">CLR via C# - Chapter 11 Events</a></li><li><a href="/2022/11/02/csharp/clr-via-csharp/Chapter%2012%20Generics/" rel="bookmark" title="CLR via C# - Chapter 12 Generics">CLR via C# - Chapter 12 Generics</a></li><li><a href="/2022/11/04/csharp/clr-via-csharp/Chapter%2013%20Interfaces/" rel="bookmark" title="CLR via C# - Chapter 13 Interfaces">CLR via C# - Chapter 13 Interfaces</a></li><li><a href="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/" rel="bookmark" title="CLR via C# - Chapter 14 Chars, Strings, and Working with Text">CLR via C# - Chapter 14 Chars, Strings, and Working with Text</a></li><li><a href="/2022/11/17/csharp/clr-via-csharp/Chapter%2015%20Enumerated%20Types%20and%20Bit%20Flags/" rel="bookmark" title="CLR via C# - Chapter 15 Enumerated Types and Bit Flags">CLR via C# - Chapter 15 Enumerated Types and Bit Flags</a></li><li><a href="/2022/11/19/csharp/clr-via-csharp/Chapter%2016%20Arrays/" rel="bookmark" title="CLR via C# - Chapter 16 Arrays">CLR via C# - Chapter 16 Arrays</a></li><li><a href="/2022/11/21/csharp/clr-via-csharp/Chapter%2017%20Delegates/" rel="bookmark" title="CLR via C# - Chapter 17 Delegates">CLR via C# - Chapter 17 Delegates</a></li><li><a href="/2022/11/22/csharp/clr-via-csharp/Chapter%2018%20Custom%20Attributes/" rel="bookmark" title="CLR via C# - Chapter 18 Custom Attributes">CLR via C# - Chapter 18 Custom Attributes</a></li><li><a href="/2022/11/23/csharp/clr-via-csharp/Chapter%2019%20Nullable%20Value%20Types/" rel="bookmark" title="CLR via C# - Chapter 19 Nullable Value Types">CLR via C# - Chapter 19 Nullable Value Types</a></li><li><a href="/2022/11/25/csharp/clr-via-csharp/Chapter%2020%20Exceptions%20and%20State%20Management/" rel="bookmark" title="CLR via C# - Chapter 20 Exceptions and State Management">CLR via C# - Chapter 20 Exceptions and State Management</a></li><li><a href="/2022/11/27/csharp/clr-via-csharp/Chapter%2021%20The%20Managed%20Heap%20and%20Garbage%20%20Collection/" rel="bookmark" title="CLR via C# - Chapter 21 The Managed Heap and Garbage  Collection">CLR via C# - Chapter 21 The Managed Heap and Garbage Collection</a></li><li><a href="/2022/11/28/csharp/clr-via-csharp/Chapter%2022%20CLR%20Hosting%20and%20AppDomains/" rel="bookmark" title="CLR via C# - Chapter 22 CLR Hosting and AppDomains">CLR via C# - Chapter 22 CLR Hosting and AppDomains</a></li><li><a href="/2022/11/29/csharp/clr-via-csharp/Chapter%2023%20Assembly%20Loading%20and%20Reflection/" rel="bookmark" title="CLR via C# - Chapter 23 Assembly Loading and Reflection">CLR via C# - Chapter 23 Assembly Loading and Reflection</a></li><li><a href="/2022/11/30/csharp/clr-via-csharp/Chapter%2024%20Runtime%20Serialization/" rel="bookmark" title="CLR via C# - Chapter 24 Runtime Serialization">CLR via C# - Chapter 24 Runtime Serialization</a></li><li><a href="/2022/12/06/csharp/clr-via-csharp/Chapter%2025%20Interoperating%20with%20WinRT%20%20Components/" rel="bookmark" title="CLR via C# - Chapter 25 Interoperating with WinRT Components">CLR via C# - Chapter 25 Interoperating with WinRT Components</a></li><li><a href="/2023/02/06/csharp/clr-via-csharp/Chapter%2026%20Thread%20Basics/" rel="bookmark" title="CLR via C# - Chapter 26 Thread Basics">CLR via C# - Chapter 26 Thread Basics</a></li><li><a href="/2023/02/07/csharp/clr-via-csharp/Chapter%2027%20Compute-Bound%20Asynchronous%20Operations/" rel="bookmark" title="CLR via C# - Chapter 27 Compute-Bound Asynchronous Operations">CLR via C# - Chapter 27 Compute-Bound Asynchronous Operations</a></li><li><a href="/2023/02/08/csharp/clr-via-csharp/Chapter%2028%20IO-Bound%20Asynchronous%20Operations/" rel="bookmark" title="CLR via C# - Chapter 28 IO-Bound Asynchronous Operations">CLR via C# - Chapter 28 IO-Bound Asynchronous Operations</a></li><li><a href="/2023/02/09/csharp/clr-via-csharp/Chapter%2029%20Primitive%20Thread%20Synchronization%20Constructs/" rel="bookmark" title="CLR via C# - Chapter 29 Primitive Thread Synchronization">CLR via C# - Chapter 29 Primitive Thread Synchronization</a></li><li><a href="/2023/02/10/csharp/clr-via-csharp/Chapter%2030%20Hybrid%20Thread%20Synchronization%20Constructs/" rel="bookmark" title="CLR via C# - Chapter 30 Hybrid Thread Synchronization">CLR via C# - Chapter 30 Hybrid Thread Synchronization</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Sakupinera" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Sakupinera</p><div class="description" itemprop="description">ä¿æŒä½ çš„å†³å¿ƒï¼</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">89</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">17</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">8</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Nha3VwaW5lcmE=" title="https:&#x2F;&#x2F;github.com&#x2F;sakupinera"><i class="ic i-github"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTQwNzIyOTA3MQ==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;407229071"><i class="ic i-cloud-music"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjIzMDczOTg/c3BtX2lkX2Zyb209MzMzLjEwMDcuMC4w" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;22307398?spm_id_from&#x3D;333.1007.0.0"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li><li class="item"><a href="/games/" rel="section"><i class="ic i-flag"></i>games</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-person"></i>About</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/08/28/linux/learn-linux/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%202%20Building,%20Packaging,%20Deploying,%20and%20Administering%20Applications%20and%20Types/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Computer-Graphics/" title="In Computer-Graphics">Computer-Graphics</a> <i class="ic i-angle-right"></i> <a href="/categories/Computer-Graphics/GAMES101/" title="In GAMES101">GAMES101</a></div><span><a href="/2022/10/09/computer-graphics/games101/%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA/" title="GAMES101 - Ray Tracingï¼ˆå…‰çº¿è¿½è¸ªï¼‰">GAMES101 - Ray Tracingï¼ˆå…‰çº¿è¿½è¸ªï¼‰</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Computer-Graphics/" title="In Computer-Graphics">Computer-Graphics</a> <i class="ic i-angle-right"></i> <a href="/categories/Computer-Graphics/GAMES101/" title="In GAMES101">GAMES101</a></div><span><a href="/2022/10/31/computer-graphics/games101/%E7%9B%B8%E6%9C%BA%EF%BC%8C%E9%80%8F%E9%95%9C%E5%92%8C%E5%85%89%E5%9C%BA/" title="GAMES101 - Cameras, Lenses and Light Fieldsï¼ˆç›¸æœºï¼Œé€é•œå’Œå…‰åœºï¼‰">GAMES101 - Cameras, Lenses and Light Fieldsï¼ˆç›¸æœºï¼Œé€é•œå’Œå…‰åœºï¼‰</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="In Linux">Linux</a> <i class="ic i-angle-right"></i> <a href="/categories/Linux/Learn-Linux/" title="In Learn-Linux">Learn-Linux</a></div><span><a href="/2022/09/05/linux/learn-linux/%E5%90%AF%E5%8A%A8%E7%AE%A1%E7%90%86/" title="LearnLinux - å¯åŠ¨ç®¡ç†">LearnLinux - å¯åŠ¨ç®¡ç†</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CSharp-in-a-Nutshell/" title="In CSharp-in-a-Nutshell">CSharp-in-a-Nutshell</a></div><span><a href="/2022/08/29/csharp/csharp-in-a-nutshell/%E7%AC%AC3%E7%AB%A0%20%E5%9C%A8CSharp%E4%B8%AD%E5%88%9B%E5%BB%BA%E7%B1%BB%E5%9E%8B/" title="C# in a Nutshell - ç¬¬3ç«  åœ¨C#ä¸­åˆ›å»ºç±»å‹">C# in a Nutshell - ç¬¬3ç«  åœ¨C#ä¸­åˆ›å»ºç±»å‹</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Game-Engine/" title="In Game-Engine">Game-Engine</a> <i class="ic i-angle-right"></i> <a href="/categories/Game-Engine/Unity/" title="In Unity">Unity</a></div><span><a href="/2023/08/24/game-engine/unity/UI/" title="Unity - UI">Unity - UI</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="In Linux">Linux</a> <i class="ic i-angle-right"></i> <a href="/categories/Linux/Learn-Linux/" title="In Learn-Linux">Learn-Linux</a></div><span><a href="/2022/08/28/linux/learn-linux/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86/" title="LearnLinux - æ–‡ä»¶ç³»ç»Ÿç®¡ç†">LearnLinux - æ–‡ä»¶ç³»ç»Ÿç®¡ç†</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Computer-Graphics/" title="In Computer-Graphics">Computer-Graphics</a> <i class="ic i-angle-right"></i> <a href="/categories/Computer-Graphics/GAMES101/" title="In GAMES101">GAMES101</a></div><span><a href="/2022/10/21/computer-graphics/games101/%E6%B8%B2%E6%9F%93%E4%B8%AD%E7%9A%84%E9%AB%98%E7%BA%A7%E4%B8%BB%E9%A2%98/" title="GAMES101 - Advanced Topics in Renderingï¼ˆæ¸²æŸ“ä¸­çš„é«˜çº§ä¸»é¢˜ï¼‰">GAMES101 - Advanced Topics in Renderingï¼ˆæ¸²æŸ“ä¸­çš„é«˜çº§ä¸»é¢˜ï¼‰</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Cpp/" title="In Cpp">Cpp</a> <i class="ic i-angle-right"></i> <a href="/categories/Cpp/Cpp-Primer/" title="In Cpp-Primer">Cpp-Primer</a></div><span><a href="/2023/01/08/cpp/cpp-primer/Chapter%2016%20Templates%20and%20Generic%20Programming/" title="C++ Primer - Chapter 16 Templates and Generic Programming">C++ Primer - Chapter 16 Templates and Generic Programming</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="In Linux">Linux</a> <i class="ic i-angle-right"></i> <a href="/categories/Linux/Learn-Linux/" title="In Learn-Linux">Learn-Linux</a></div><span><a href="/2022/08/28/linux/learn-linux/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/" title="LearnLinux - Linuxç³»ç»Ÿå®‰è£…">LearnLinux - Linuxç³»ç»Ÿå®‰è£…</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/10/27/csharp/clr-via-csharp/Chapter%209%20Parameters/" title="CLR via C# - Chapter 9 Parameters">CLR via C# - Chapter 9 Parameters</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 â€“ <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Sakupinera @ Hanamai Sora</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">2.2m words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">34:05</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/08/28/csharp/clr-via-csharp/Chapter 3 Shared Assemblies and Strongly Named Assemblies/",favicon:{show:"ï¼ˆâ—Â´3ï½€â—ï¼‰Goooood",hide:"(Â´Ğ”ï½€)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/assets/shifuku.model.json"},display:{position:"left",width:250,height:500},mobile:{show:!1},react:{opacity:.9},log:!1})</script></body></html>
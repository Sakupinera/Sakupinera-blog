<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Sakupinera" href="http://sakupinera.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Sakupinera" href="http://sakupinera.github.io/atom.xml"><link rel="alternate" type="application/json" title="Sakupinera" href="http://sakupinera.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="è¯»ä¹¦ç¬”è®°,C#"><link rel="canonical" href="http://sakupinera.github.io/2022/10/29/csharp/clr-via-csharp/Chapter%2011%20Events/"><title>CLR via C# - Chapter 11 Events - CLR-via-CSharp - CSharp | Hanamai Sora = Sakupinera</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">CLR via C# - Chapter 11 Events</h1><div class="meta"><span class="item" title="Created: 2022-10-29 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2022-10-29T00:00:00+08:00">2022-10-29</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>29k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>26 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Hanamai Sora</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://s2.loli.net/2023/03/08/hr2Sybs5CRvjFdI.png"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/5rFIQnpK6fEoLOU.png"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/vWqdDn4KtmcIXr3.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/Qi9cMFjDZq5V3tB.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/hub7DjxPVYvzoB4.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/tNhsmAqoTDncM1b.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CSharp/" itemprop="item" rel="index" title="In CSharp"><span itemprop="name">CSharp</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CSharp/CLR-via-CSharp/" itemprop="item" rel="index" title="In CLR-via-CSharp"><span itemprop="name">CLR-via-CSharp</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="http://sakupinera.github.io/2022/10/29/csharp/clr-via-csharp/Chapter%2011%20Events/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Sakupinera"><meta itemprop="description" content=", ä¿æŒä½ çš„å†³å¿ƒï¼"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sakupinera"></span><div class="body md" itemprop="articleBody"><h1 id="chapter-11-events"><a class="anchor" href="#chapter-11-events">#</a> Chapter 11 Events</h1><blockquote><p>In this chapter, Iâ€™ll talk about the last kind of member a type can define: events. A type that defines an event member allows the type (or instances of the type) to notify other objects that something special has happened. For example, the Button class offers an event called Click. When a Button object is clicked, one or more objects in an application may want to receive notification about this event in order to perform some action. Events are type members that allow this interaction. Specifically, defining an event member means that a type is offering the following capabilities:</p></blockquote><ul><li><p>A method can register its interest in the event.</p></li><li><p>A method can unregister its interest in the event.</p></li><li><p>Registered methods will be notified when the event occurs.</p></li></ul><blockquote><p>Types can offer this functionality when defining an event because they maintain a list of the registered methods. When the event occurs, the type notifies all of the registered methods in the collection.</p></blockquote><blockquote><p>The common language runtimeâ€™s (CLRâ€™s) event model is based on delegates. A delegate is a typesafe way to invoke a callback method. Callback methods are the means by which objects receive the notifications they subscribed to. In this chapter, Iâ€™ll be using delegates, but I wonâ€™t fully explain all their details until Chapter 17, â€œDelegates.â€</p></blockquote><blockquote><p>To help you fully understand the way events work within the CLR, Iâ€™ll start with a scenario in which events are useful. Suppose you want to design an email application. When an email message arrives, the user might like the message to be forwarded to a fax machine or a pager. In architecting this application, letâ€™s say that youâ€™ll first design a type called MailManager that receives the incoming email messages. MailManager will expose an event called NewMail. Other types (such as Fax and Pager) may register interest in this event. When MailManager receives a new email message, it will raise the event, causing the message to be distributed to each of the registered objects. Each object can process the message in any way it desires.</p></blockquote><blockquote><p>When the application initializes, letâ€™s instantiate just one MailManager instanceâ€”the application can then instantiate any number of Fax and Pager types. Figure 11-1 shows how the application initializes and what happens when a new email message arrives.</p></blockquote><p><img data-src="image-20221029231618598.png" alt="image-20221029231618598"></p><blockquote><p>Hereâ€™s how the application illustrated in Figure 11-1 works: the application initializes by constructing an instance of MailManager. MailManager offers a NewMail event. When the Fax and Pager objects are constructed, they register an instance method with MailManagerâ€™s NewMail event so that MailManager knows to notify the Fax and Pager objects when new email messages arrive. Now, when MailManager receives a new email message (sometime in the future), it will raise the NewMail event, giving all of the registered methods an opportunity to process the new message in any way they want.</p></blockquote><h2 id="designing-a-type-that-exposes-an-event"><a class="anchor" href="#designing-a-type-that-exposes-an-event">#</a> Designing a Type That Exposes an Event</h2><blockquote><p>There are many steps a developer must take in order to define a type that exposes one or more event members. In this section, Iâ€™ll walk through each of the necessary steps. The MailManager sample application (which can be downloaded from the Books section in Resources at <span class="exturl" data-url="aHR0cDovL3dpbnRlbGxlY3QuY29tLw==">http://wintellect.com/</span> Books) shows all of the source code for the MailManager type, the Fax type, and the Pager type. Youâ€™ll notice that the Pager type is practically identical to the Fax type.</p></blockquote><h3 id="step-1-define-a-type-that-will-hold-any-additional-information-that-should-be-sent-to-receivers-of-the-event-notification"><a class="anchor" href="#step-1-define-a-type-that-will-hold-any-additional-information-that-should-be-sent-to-receivers-of-the-event-notification">#</a> Step #1: Define a type that will hold any additional information that should be sent to receivers of the event notification</h3><blockquote><p>When an event is raised, the object raising the event may want to pass some additional information to the objects receiving the event notification. This additional information needs to be encapsulated into its own class, which typically contains a bunch of private fields along with some read-only public properties to expose these fields. By convention, classes that hold event information to be passed to the event handler should be derived from System.EventArgs, and the name of the class should be suffixed with EventArgs. In this example, the NewMailEventArgs class has fields identifying who sent the message (m_from), who is receiving the message (m_to), and the subject of the message (m_subject).</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Step #1: Define a type that will hold any additional information that </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// should be sent to receivers of the event notification </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">NewMailEventArgs</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">EventArgs</span></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">String</span> m_from<span class="token punctuation">,</span> m_to<span class="token punctuation">,</span> m_subject<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">public</span> <span class="token function">NewMailEventArgs</span><span class="token punctuation">(</span><span class="token class-name">String</span> from<span class="token punctuation">,</span> <span class="token class-name">String</span> to<span class="token punctuation">,</span> <span class="token class-name">String</span> subject<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> m_from <span class="token operator">=</span> from<span class="token punctuation">;</span> m_to <span class="token operator">=</span> to<span class="token punctuation">;</span> m_subject <span class="token operator">=</span> subject<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name">String</span> From <span class="token punctuation">&#123;</span> <span class="token keyword">get</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> m_from<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name">String</span> To <span class="token punctuation">&#123;</span> <span class="token keyword">get</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> m_to<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name">String</span> Subject <span class="token punctuation">&#123;</span> <span class="token keyword">get</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> m_subject<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ğŸ’¡æ³¨æ„ï¼š <code>EventArgs</code> ç±»åœ¨ Microsoft .NET Framework ç±»åº“ (FCL) ä¸­å®šä¹‰ï¼Œå…¶å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ComVisible</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span></span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventArgs</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">EventArgs</span> Empty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">public</span> <span class="token function">EventArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œè¯¥ç±»å‹çš„å®ç°éå¸¸ç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªè®©å…¶ä»–ç±»å‹ç»§æ‰¿çš„åŸºç±»å‹ã€‚è®¸å¤šäº‹ä»¶éƒ½æ²¡æœ‰é™„åŠ ä¿¡æ¯éœ€è¦ä¼ é€’ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ª <code>Button</code> å‘å·²ç™»è®°çš„æ¥æ”¶è€…é€šçŸ¥è‡ªå·±è¢«å•å‡»æ—¶ï¼Œè°ƒç”¨å›è°ƒæ–¹æ³•å°±å¯ä»¥äº†ã€‚å®šä¹‰ä¸éœ€è¦ä¼ é€’é™„åŠ æ•°æ®çš„äº‹ä»¶æ—¶ï¼Œå¯ç›´æ¥ä½¿ç”¨ <code>EventArgs.Empty</code> ï¼Œä¸ç”¨æ„é€ æ–°çš„ <code>EventArgs</code> å¯¹è±¡ã€‚</p><h3 id="step-2-define-the-event-member"><a class="anchor" href="#step-2-define-the-event-member">#</a> Step #2: Define the event member</h3><blockquote><p>An event member is defined using the C# keyword event. Each event member is given accessibility (which is almost always public so that other code can access the event member), a type of delegate indicating the prototype of the method(s) that will be called, and a name (which can be any valid identifier). Here is what the event member in our MailManager class looks like.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">MailManager</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token comment">// Step #2: Define the event member </span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span></span> NewMail<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token range operator">..</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>NewMail is the name of this event. The type of the event member is EventHandler, which means that all receivers of the event notification must supply a callback method whose prototype matches that of the EventHandler delegate type. Because the generic System.EventHandler delegate is defined as follows.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">EventHandler</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TEventArgs<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token class-name">Object</span> sender<span class="token punctuation">,</span> <span class="token class-name">TEventArgs</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>the method prototypes must look like the following.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">MethodName</span><span class="token punctuation">(</span><span class="token class-name">Object</span> sender<span class="token punctuation">,</span> <span class="token class-name">NewMailEventArgs</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>ğŸ’¡æ³¨æ„ï¼šè®¸å¤šäººå¥‡æ€ªäº‹ä»¶æ¨¡å¼ä¸ºä»€ä¹ˆè¦æ±‚ <code>sender</code> å‚æ•°æ˜¯ <code>Object</code> ç±»å‹ã€‚æ¯•ç«Ÿï¼Œåªæœ‰ <code>MailManager</code> æ‰ä¼šå¼•å‘ä¼ é€’äº† <code>NewMailEventArgs</code> å¯¹è±¡çš„äº‹ä»¶ï¼Œæ‰€ä»¥å›è°ƒæ–¹æ³•æ›´åˆé€‚çš„åŸå‹ä¼¼ä¹æ˜¯ä¸‹é¢è¿™ä¸ªï¼š<br><code>void MethodName(MailManager sender, NewMailEventArgs e);</code></p><p>è¦æ±‚ <code>sender</code> æ˜¯ <code>Object</code> ä¸»è¦æ˜¯å› ä¸ºç»§æ‰¿ã€‚ä¾‹å¦‚ï¼Œå‡å®š <code>MailManager</code> æˆä¸º <code>SmtpMailManager</code> çš„åŸºç±»ï¼Œé‚£ä¹ˆå›è°ƒæ–¹æ³•çš„ <code>sender</code> å‚æ•°åº”è¯¥æ˜¯ <code>SmtpMailManager</code> ç±»å‹è€Œä¸æ˜¯ <code>MailManager</code> ç±»å‹ã€‚ä½†è¿™ä¸å¯èƒ½å‘ç”Ÿï¼Œå› ä¸º <code>SmtpMailManager</code> ç»§æ‰¿äº† <code>NewMail</code> äº‹ä»¶ã€‚æ‰€ä»¥ï¼Œå¦‚æœä»£ç éœ€è¦ç”± <code>SmtpMailManager</code> å¼•å‘äº‹ä»¶ï¼Œè¿˜æ˜¯è¦å°† <code>sender</code> å®å‚è½¬å‹ä¸º <code>SmtpMailManager</code> ã€‚åæ­£éƒ½è¦è¿›è¡Œç±»å‹è½¬æ¢ï¼Œè¿™å’Œå°† <code>sender</code> å®šä¸º <code>Object</code> ç±»å‹æ²¡ä»€ä¹ˆä¸¤æ ·ã€‚</p><p>å°† <code>sender</code> å‚æ•°çš„ç±»å‹å®šä¸º <code>Object</code> çš„å¦ä¸€ä¸ªåŸå› æ˜¯çµæ´»æ€§ã€‚å®ƒä½¿å§”æ‰˜èƒ½ç”±å¤šä¸ªç±»å‹ä½¿ç”¨ï¼Œåªè¦ç±»å‹æä¾›äº†ä¸€ä¸ªä¼šä¼ é€’ <code>NewMailEventArgs</code> å¯¹è±¡çš„äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œå³ä½¿ <code>PopMailManager</code> ç±»ä¸æ˜¯ä» <code>MailManager</code> ç±»æ´¾ç”Ÿçš„ï¼Œä¹Ÿèƒ½ä½¿ç”¨è¿™ä¸ªå§”æ‰˜ã€‚</p><p>æ­¤å¤–ï¼Œäº‹ä»¶æ¨¡å¼è¦æ±‚å§”æ‰˜å®šä¹‰å’Œå›è°ƒæ–¹æ³•å°†æ´¾ç”Ÿè‡ª <code>EventArgs</code> çš„å‚æ•°å‘½åä¸º <code>e</code> ã€‚è¿™ä¸ªè¦æ±‚å”¯ä¸€çš„ä½œç”¨å°±æ˜¯åŠ å¼ºäº‹ä»¶æ¨¡å¼çš„ä¸€è‡´æ€§ï¼Œä½¿å¼€å‘äººå‘˜æ›´å®¹æ˜“å­¦ä¹ å’Œå®ç°è¿™ä¸ªæ¨¡å¼ã€‚æ³¨æ„ï¼Œèƒ½è‡ªåŠ¨ç”Ÿæˆæºä»£ç çš„å·¥å…· (æ¯”å¦‚ Microsoft Visual Studio) ä¹ŸçŸ¥é“å°†å‚æ•°å‘½åä¸º <code>e</code> ã€‚</p><p>æœ€åï¼Œäº‹ä»¶æ¨¡å¼è¦æ±‚æ‰€æœ‰äº‹ä»¶å¤„ç†ç¨‹åº &lt;sup&gt;â‘ &lt;/sup &gt; çš„è¿”å›éƒ½æ˜¯ <code>void</code> ã€‚è¿™å¾ˆæœ‰å¿…è¦ï¼Œå› ä¸ºå¼•å‘äº‹ä»¶åå¯èƒ½è¦è°ƒç”¨å¥½å‡ ä¸ªå›è°ƒæ–¹æ³•ï¼Œä½†æ²¡åŠæ³•è·å¾—æ‰€æœ‰æ–¹æ³•çš„è¿”å›å€¼ã€‚å°†è¿”å›ç±»å‹å®šä¸º <code>void</code> ï¼Œå°±ä¸å…è®¸å›è°ƒ (æ–¹æ³•) è¿”å›å€¼ã€‚é—æ†¾çš„æ˜¯ï¼ŒFCL ä¸­çš„ä¸€äº›äº‹ä»¶å¤„ç†ç¨‹åº (æ¯”å¦‚ <code>ResolveEventHandler</code> ) æ²¡æœ‰éµå¾ª Microsoft è‡ªå®šçš„æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œ <code>ResolveEventHandler</code> äº‹ä»¶å¤„ç†ç¨‹åºä¼šè¿”å› <code>Assembly</code> ç±»å‹çš„å¯¹è±¡ã€‚</p><h3 id="step-3-define-a-method-responsible-for-raising-the-event-to-notify-registered-objects-that-the-event-has-occurred"><a class="anchor" href="#step-3-define-a-method-responsible-for-raising-the-event-to-notify-registered-objects-that-the-event-has-occurred">#</a> Step #3: Define a method responsible for raising the event to notify registered objects that the event has occurred</h3><blockquote><p>By convention, the class should define a protected, virtual method that is called by code internally within the class and its derived classes when the event is to be raised. This method takes one parameter, a NewMailEventArgs object, which includes the information passed to the objects receiving the notification. The default implementation of this method simply checks if any objects have registered interest in the event and, if so, the event will be raised, thereby notifying the registered methods that the event has occurred. Here is what the method in our MailManager class looks like.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">MailManager</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token range operator">..</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token comment">// Step #3: Define a method responsible for raising the event </span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token comment">// to notify registered objects that the event has occurred </span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token comment">// If this class is sealed, make this method private and nonvirtual </span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnNewMail</span><span class="token punctuation">(</span><span class="token class-name">NewMailEventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token comment">// Copy a reference to the delegate field now into a temporary field for thread safety </span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span></span> temp <span class="token operator">=</span> Volatile<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token keyword">ref</span> NewMail<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token comment">// If any methods registered interest with our event, notify them </span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>temp <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token function">temp</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token range operator">..</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>ä»¥çº¿ç¨‹å®‰å…¨çš„æ–¹å¼å¼•å‘äº‹ä»¶</strong><br>.NET Framework åˆšå‘å¸ƒæ—¶å»ºè®®å¼€å‘è€…ç”¨ä»¥ä¸‹æ–¹å¼å¼•å‘äº‹ä»¶ï¼š</p><pre><code class="language-C#">// ç‰ˆæœ¬ 1 
protected virtual void OnNewMail(NewMailEventArgs e) &#123;
    if (NewNmil != null) NewMail(this, e);
&#125;
</code></pre><p><code>OnNewMail</code> æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼Œè™½ç„¶çº¿ç¨‹æ£€æŸ¥å‡º <code>NewMail</code> ä¸ä¸º <code>null</code> ï¼Œä½†å°±åœ¨è°ƒç”¨ <code>NewMail</code> ä¹‹å‰ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä»å§”æ‰˜é“¾ä¸­ç§»é™¤ä¸€ä¸ªå§”æ‰˜ï¼Œä½¿ <code>NewMail</code> æˆäº† <code>null</code> ã€‚è¿™ä¼šæŠ›å‡º <code>NullReferenceException</code> å¼‚å¸¸ã€‚ä¸ºäº†ä¿®æ­£è¿™ä¸ªç«æ€é—®é¢˜ï¼Œè®¸å¤šå¼€å‘è€…éƒ½åƒä¸‹é¢è¿™æ ·å†™ <code>OnNewMail</code> æ–¹æ³•</p><pre><code class="language-C#">// ç‰ˆæœ¬ 2
protected virtual void OnNewMail (NewMailEventArgs e) &#123;
    EventHandler&lt;NewMailEventArgs&gt; temp = NewMail;
    if (temp != null)  temp(this, e);
&#125;
</code></pre><p>å®ƒçš„æ€è·¯æ˜¯ï¼Œå°†å¯¹ <code>NewMail</code> çš„å¼•ç”¨å¤åˆ¶åˆ°ä¸´æ—¶å˜é‡ <code>temp</code> ä¸­ï¼Œåè€…å¼•ç”¨èµ‹å€¼å‘ç”Ÿæ—¶çš„å§”æ‰˜é“¾ã€‚ç„¶åï¼Œæ–¹æ³•æ¯”è¾ƒ <code>temp</code> å’Œ <code>null</code> ï¼Œå¹¶è°ƒç”¨ (invoke) <code>temp</code> ï¼›æ‰€ä»¥ï¼Œå‘ <code>temp</code> èµ‹å€¼åï¼Œå³ä½¿å¦ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹äº† <code>NewMail</code> ä¹Ÿæ²¡æœ‰å…³ç³»ã€‚å§”æ‰˜æ˜¯ä¸å¯å˜çš„ (immutable)ï¼Œæ‰€ä»¥è¿™ä¸ªæŠ€æœ¯ç†è®ºä¸Šè¡Œçš„é€šã€‚ä½†è®¸å¤šå¤šå¼€å‘è€…æ²¡æœ‰æ„è¯†åˆ°çš„æ˜¯ï¼Œç¼–è¯‘å™¨å¯èƒ½ â€œæ“…ä½œä¸»å¼ â€ï¼Œé€šè¿‡å®Œå…¨ç§»é™¤å±€éƒ¨å˜é‡ <code>temp</code> çš„æ–¹å¼å¯¹ä¸Šè¿°ä»£ç è¿›è¡Œä¼˜åŒ–ã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œç‰ˆæœ¬ 2 å°±å’Œç‰ˆæœ¬ 1 å°±æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚æ‰€ä»¥ï¼Œäººæœ‰å¯èƒ½æŠ›å‡º <code>NullReferenceException</code> å¼‚å¸¸ã€‚</p><p>è¦æƒ³æ•´ä¸ªä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼Œåº”è¯¥åƒä¸‹é¢è¿™æ ·é‡å†™ <code>OnNewMail</code> ï¼š</p><pre><code class="language-C#">// ç‰ˆæœ¬ 3
protected virtual void OnNewMail(NewMailEventArgs e) &#123;
    EventHandler&lt;NewMailEventArgs&gt; temp = Volatile.Read(ref NewMail);
    if (temp != null) temp(this, e);
&#125;
</code></pre><p>å¯¹ <code>Volatile.Read</code> çš„è°ƒç”¨å¼ºè¿« <code>NewMail</code> åœ¨è¿™ä¸ªè°ƒç”¨å‘ç”Ÿæ—¶è¯»å–ï¼Œå¼•ç”¨çœŸçš„å¿…é¡»å¤åˆ¶åˆ° <code>temp</code> å˜é‡ä¸­ (ç¼–è¯‘å™¨åˆ«æƒ³èµ°æ·å¾„)ã€‚ç„¶åï¼Œ <code>temp</code> å˜é‡åªæœ‰åœ¨ä¸ä¸º <code>null</code> æ—¶æ‰ä¼šè¢«è°ƒç”¨ (invoke)ã€‚ç¬¬ 29 ç«  â€œåŸºå…ƒçº¿ç¨‹åŒæ­¥æ„é€ â€ å°†è¯¦ç»†è®¨è®º <code>Volatile.Read</code> æ–¹æ³•ã€‚</p><p>è™½ç„¶æœ€åä¸€ä¸ªç‰ˆæœ¬å¾ˆå®Œç¾ï¼Œæ˜¯æŠ€æœ¯æ­£ç¡®çš„ç‰ˆæœ¬ï¼Œä½†ç‰ˆæœ¬ 2 å®é™…ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œå› ä¸º JIT ç¼–è¯‘å™¨ç†è§£è¿™ä¸ªæ¨¡å¼ï¼ŒçŸ¥é“è‡ªå·±ä¸è¯¥å°†å±€éƒ¨å˜é‡ <code>temp</code> â€œä¼˜åŒ–â€ æ‰ã€‚å…·ä½“åœ°è¯´ï¼ŒMIcrosoft çš„æ‰€æœ‰ JIT ç¼–è¯‘å™¨éƒ½ â€œå°Šé‡â€ é‚£äº›ä¸ä¼šé€ æˆå¯¹å †å†…å­˜çš„æ–°çš„è¯»å–åŠ¨ä½œçš„ä¸å˜é‡ (invariant)ã€‚æ‰€ä»¥ï¼Œåœ¨å±€éƒ¨å˜é‡ä¸­ç¼“å­˜ä¸€ä¸ªå¼•ç”¨ï¼Œå¯ç¡®ä¿å †å¼•ç”¨åªè¢«è®¿é—®ä¸€æ¬¡ã€‚è¿™ä¸€ç‚¹å¹¶æœªåœ¨æ–‡æ¡£ä¸­åæ˜ ï¼Œç†è®ºä¸Šè¯´å°†æ¥å¯èƒ½æ”¹å˜ï¼Œè¿™æ­£æ˜¯ä¸ºä»€ä¹ˆåº”è¯¥ä½¿ç”¨æœ€åä¸€ä¸ªç‰ˆæœ¬çš„åŸå› ã€‚ä½†å®é™…ä¸Šï¼ŒMicrosoft çš„ JIT ç¼–è¯‘å™¨æ°¸è¿œæ²¡æœ‰å¯èƒ½çœŸçš„è¿›è¡Œä¿®æ”¹æ¥ç ´åè¿™ä¸ªæ¨¡å¼ï¼Œå¦åˆ™å¤ªå¤šçš„åº”ç”¨ç¨‹åºéƒ½ä¼š â€œé­æ®ƒâ€ã€‚æ­¤å¤–ï¼Œäº‹ä»¶ä¸»è¦åœ¨å•çº¿ç¨‹çš„æƒ…å½¢ (WPF å’Œ Windows Store åº”ç”¨) ä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥çº¿ç¨‹å®‰å…¨ä¸æ˜¯é—®é¢˜ã€‚</p><p>è¿˜è¦æ³¨æ„ï¼Œè€ƒè™‘åˆ°çº¿ç¨‹ç«æ€æ¡ä»¶ï¼Œæ–¹æ³•æœ‰å¯èƒ½åœ¨ä»äº‹ä»¶çš„å§”æ‰˜é“¾ä¸­ç§»é™¤ä¹‹åå¾—åˆ°è°ƒç”¨ã€‚</p><blockquote><p>As a convenience, you could define an extension method (as discussed in Chapter 8, â€œMethodsâ€) that encapsulates this thread-safety logic. Define the extension method as follows.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">EventArgExtensions</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">Raise</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TEventArgs<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">TEventArgs</span> e<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token class-name">Object</span> sender<span class="token punctuation">,</span> <span class="token keyword">ref</span> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>TEventArgs<span class="token punctuation">></span></span> eventDelegate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token comment">// Copy a reference to the delegate field now into a temporary field for thread safety </span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>TEventArgs<span class="token punctuation">></span></span> temp <span class="token operator">=</span> Volatile<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token keyword">ref</span> eventDelegate<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token comment">// If any methods registered interest with our event, notify them </span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>temp <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token function">temp</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>And now, we can rewrite the OnNewMail method as follows.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnNewMail</span><span class="token punctuation">(</span><span class="token class-name">NewMailEventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> e<span class="token punctuation">.</span><span class="token function">Raise</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">ref</span> m_NewMail<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>A class that uses MailManager as a base type is free to override the OnNewMail method. This capability gives the derived class control over the raising of the event. The derived class can handle the new email message in any way it sees fit. Usually, a derived type calls the base typeâ€™s OnNewMail method so that the registered method(s) receive the notification. However, the derived class might decide to disallow the event from being forwarded.</p></blockquote><h3 id="step-4-define-a-method-that-translates-the-input-into-the-desired-event"><a class="anchor" href="#step-4-define-a-method-that-translates-the-input-into-the-desired-event">#</a> Step #4: Define a method that translates the input into the desired event</h3><blockquote><p>Your class must have some method that takes some input and translates it into the raising of the event. In my MailManager example, the SimulateNewMail method is called to indicate that a new email message has arrived into MailManager.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">MailManager</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token comment">// Step #4: Define a method that translates the </span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token comment">// input into the desired event </span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SimulateNewMail</span><span class="token punctuation">(</span><span class="token class-name">String</span> from<span class="token punctuation">,</span> <span class="token class-name">String</span> to<span class="token punctuation">,</span> <span class="token class-name">String</span> subject<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token comment">// Construct an object to hold the information we want </span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token comment">// to pass to the receivers of our notification </span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token class-name">NewMailEventArgs</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NewMailEventArgs</span><span class="token punctuation">(</span>from<span class="token punctuation">,</span> to<span class="token punctuation">,</span> subject<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token comment">// Call our virtual method notifying our object that the event </span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token comment">// occurred. If no type overrides this method, our object will </span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token comment">// notify all the objects that registered interest in the event </span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token function">OnNewMail</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>SimulateNewMail accepts information about the message and constructs a NewMailEventArgs object, passing the message information to its constructor. MailManagerâ€™s own virtual OnNewMail method is then called to formally notify the MailManager object of the new email message. Usually, this causes the event to be raised, notifying all of the registered methods. (As mentioned before, a class using MailManager as a base class can override this behavior.)</p></blockquote><p>ğŸ’¡å°ç»“ï¼šåœ¨.NET ç¨‹åºåº“ä¸­å‡ ä¹æ‰€æœ‰å’Œäº‹ä»¶ç›¸å…³çš„å®šä¹‰ä¸­ï¼Œéƒ½ä½“ç°äº†ä¸€ä¸ªæ ‡å‡†çš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼ä¿è¯äº†ç¨‹åºåº“å’Œç”¨æˆ·ä»£ç ä½¿ç”¨äº‹ä»¶çš„ä¸€è‡´æ€§ã€‚ç¬¬ä¸€æ­¥ï¼šå®šä¹‰ç±»å‹æ¥å®¹çº³æ‰€æœ‰éœ€è¦å‘é€ç»™äº‹ä»¶é€šçŸ¥æ¥æ”¶è€…çš„é™„åŠ ä¿¡æ¯ã€‚æ ¹æ®çº¦å®šï¼Œè¿™ç§ç±»åº”è¯¥ä» <code>System.EventArgs</code> æ´¾ç”Ÿï¼Œè€Œä¸”ç±»åä»¥ <code>EventArgs</code> ç»“æŸã€‚ç¬¬äºŒæ­¥ï¼šå®šä¹‰äº‹ä»¶æˆå‘˜ã€‚äº‹ä»¶æˆå‘˜ä½¿ç”¨ C# å…³é”®å­— event å®šä¹‰ã€‚æ¯ä¸ªäº‹ä»¶æˆå‘˜éƒ½è¦æŒ‡å®šä»¥ä¸‹å†…å®¹ï¼šå¯è®¿é—®æ€§æ ‡è¯†ç¬¦ï¼ˆå‡ ä¹è‚¯å®šæ˜¯ publicï¼Œè¿™æ ·å…¶ä»–ä»£ç æ‰èƒ½è®¿é—®è¯¥äº‹ä»¶æˆå‘˜ï¼‰ï¼›å§”æ‰˜ç±»å‹ï¼ŒæŒ‡å‡ºè¦è°ƒç”¨çš„æ–¹æ³•çš„åŸå‹ï¼›ä»¥åŠåç§°ï¼ˆå¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„æ ‡è¯†ç¬¦ï¼‰ã€‚ç¬¬ä¸‰æ­¥ï¼šå®šä¹‰è´Ÿè´£å¼•å‘äº‹ä»¶çš„æ–¹æ³•æ¥é€šçŸ¥äº‹ä»¶çš„ç™»è®°å¯¹è±¡ã€‚æŒ‰ç…§çº¦å®šï¼Œç±»è¦å®šä¹‰ä¸€ä¸ªå—ä¿æŠ¤çš„è™šæ–¹æ³•ã€‚å¼•å‘äº‹ä»¶æ—¶ï¼Œç±»åŠå…¶æ´¾ç”Ÿç±»ä¸­çš„ä»£ç ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚æ–¹æ³•åªè·å–ä¸€ä¸ªå‚æ•°ï¼Œå³ä¸€ä¸ª EventArgs çš„æ´¾ç”Ÿç±»ï¼Œå…¶ä¸­åŒ…å«äº†ä¼ ç»™æ¥å—é€šçŸ¥çš„å¯¹è±¡çš„æ¶ˆæ¯ã€‚æ–¹æ³•çš„é»˜è®¤å®ç°åªæ˜¯æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦æœ‰å¯¹è±¡ç™»è®°äº†å¯¹äº‹ä»¶çš„å…³æ³¨ã€‚å¦‚æœæœ‰ï¼Œå°±å¼•å‘äº‹ä»¶æ¥é€šçŸ¥äº‹ä»¶çš„ç™»è®°å¯¹è±¡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ´¾ç”Ÿç±»ä¼šè°ƒç”¨åŸºç±»çš„ OnXXX æ–¹æ³•ï¼Œä½¿ç™»è®°çš„æ–¹æ³•èƒ½æ”¶åˆ°é€šçŸ¥ã€‚ä½†æ˜¯ï¼Œæ´¾ç”Ÿç±»ä¹Ÿå¯ä»¥ä¸å…è®¸äº‹ä»¶è½¬å‘ã€‚ç¬¬å››æ­¥ï¼šå®šä¹‰æ–¹æ³•å°†è¾“å…¥è½¬åŒ–ä¸ºæœŸæœ›äº‹ä»¶ã€‚</p><h2 id="how-the-compiler-implements-an-event"><a class="anchor" href="#how-the-compiler-implements-an-event">#</a> How the Compiler Implements an Event</h2><blockquote><p>Now that you know how to define a class that offers an event member, letâ€™s take a closer look at what an event really is and how it works. In the MailManager class, we have a line of code that defines the event member itself.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span></span> NewMail<span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>When the C# compiler compiles the line above, it translates this single line of source code into the following three constructs.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 1. A PRIVATE delegate field that is initialized to null </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">private</span> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span></span> NewMail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 2. A PUBLIC add_Xxx method (where Xxx is the Event name) </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// Allows methods to register interest in the event. </span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">add_NewMail</span><span class="token punctuation">(</span><span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span></span> <span class="token keyword">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token comment">// The loop and the call to CompareExchange is all just a fancy way </span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token comment">// of adding a delegate to the event in a thread-safe way</span></pre></td></tr><tr><td data-num="8"></td><td><pre> EventHandler<span class="token operator">&lt;</span>NewMailEventArgs<span class="token operator">></span>prevHandler<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span></span> newMail <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>NewMail<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">do</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre> prevHandler <span class="token operator">=</span> newMail<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span></span> newHandler <span class="token operator">=</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token punctuation">(</span>EventHandler<span class="token operator">&lt;</span>NewMailEventArgs<span class="token operator">></span><span class="token punctuation">)</span> Delegate<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>prevHandler<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre> newMail <span class="token operator">=</span> Interlocked<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CompareExchange</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span><span class="token punctuation">></span></span></span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token keyword">ref</span> <span class="token keyword">this</span><span class="token punctuation">.</span>NewMail<span class="token punctuation">,</span> newHandler<span class="token punctuation">,</span> prevHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>newMail <span class="token operator">!=</span> prevHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">// 3. A PUBLIC remove_Xxx method (where Xxx is the Event name) </span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">// Allows methods to unregister interest in the event. </span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">remove_NewMail</span><span class="token punctuation">(</span><span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span></span> <span class="token keyword">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token comment">// The loop and the call to CompareExchange is all just a fancy way </span></pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token comment">// of removing a delegate from the event in a thread-safe way</span></pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span></span> prevHandler<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span></span> newMail <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>NewMail<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token keyword">do</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre> prevHandler <span class="token operator">=</span> newMail<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token class-name">EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span></span> newHandler <span class="token operator">=</span> </pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token punctuation">(</span>EventHandler<span class="token operator">&lt;</span>NewMailEventArgs<span class="token operator">></span><span class="token punctuation">)</span> Delegate<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>prevHandler<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre> newMail <span class="token operator">=</span> Interlocked<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CompareExchange</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span><span class="token punctuation">></span></span></span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="30"></td><td><pre> <span class="token keyword">ref</span> <span class="token keyword">this</span><span class="token punctuation">.</span>NewMail<span class="token punctuation">,</span> newHandler<span class="token punctuation">,</span> prevHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre> <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>newMail <span class="token operator">!=</span> prevHandler<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>The first construct is simply a field of the appropriate delegate type. This field is a reference to the head of a list of delegates that will be notified when this event occurs. This field is initialized to null, meaning that no listeners have registered interest in the event. When a method registers interest in the event, this field refers to an instance of the EventHandler delegate, which may refer to additional EventHandler delegates. When a listener registers interest in an event, the listener is simply adding an instance of the delegate type to the list. Obviously, unregistering means removing the delegate from the list.</p></blockquote><blockquote><p>Youâ€™ll notice that the delegate field, NewMail in this example, is always private even though the original line of source code defines the event as public. The reason for making the delegate field private is to prevent code outside the defining class from manipulating it improperly. If the field were public, any code could alter the value in the field and potentially wipe out all of the delegates that have registered interest in the event.</p></blockquote><blockquote><p>The second construct the C# compiler generates is a method that allows other objects to register their interest in the event. The C# compiler automatically names this function by prepending add_ to the eventâ€™s name (NewMail). The C# compiler automatically generates the code that is inside this method. The code always calls System.Delegateâ€™s static Combine method, which adds the instance of a delegate to the list of delegates and returns the new head of the list, which gets saved back in the field.</p></blockquote><blockquote><p>The third construct the C# compiler generates is a method that allows an object to unregister its interest in the event. Again, the C# compiler automatically names this function by prepending remove_ to the eventâ€™s name (NewMail). The code inside this method always calls Delegateâ€™s static Remove method, which removes the instance of a delegate from the list of delegates and returns the new head of the list, which gets saved back in the field.</p></blockquote><p>ğŸ’¡è­¦å‘Šï¼šè¯•å›¾åˆ é™¤ä»æœªæ·»åŠ è¿‡çš„æ–¹æ³•ï¼Œ <code>Delegate</code> çš„ <code>Remove</code> æ–¹æ³•åœ¨å†…éƒ¨ä¸åšä»»ä½•äº‹æƒ…ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ä¼šæŠ›å‡ºä»»ä½•å¼‚å¸¸ï¼Œä¹Ÿä¸ä¼šæ˜¾ç¤ºä»»ä½•è­¦å‘Šï¼›äº‹ä»¶çš„æ–¹æ³•é›†åˆä¿æŒä¸å˜ã€‚</p><p>ğŸ’¡æ³¨æ„ï¼š <code>add</code> å’Œ <code>remove</code> æ–¹æ³•ä»¥çº¿ç¨‹å®‰å…¨çš„ä¸€ç§æ¨¡å¼æ›´æ–°å€¼ã€‚è¯¥æ¨¡å¼çš„è¯¦æƒ…å°†åœ¨ 29.3.4 èŠ‚ â€œInterlocked Anything æ¨¡å¼â€ è®¨è®ºã€‚</p><blockquote><p>In this example, the add and remove methods are public. The reason they are public is that the original line of source code declared the event to be public. If the event had been declared protected, the add and remove methods generated by the compiler would also have been declared protected. So, when you define an event in a type, the accessibility of the event determines what code can register and unregister interest in the event, but only the type itself can ever access the delegate field directly. Event members can also be declared as static or virtual, in which case the add and remove methods generated by the compiler would be either static or virtual, respectively.</p></blockquote><blockquote><p>In addition to emitting the aforementioned three constructs, compilers also emit an event definition entry into the managed assemblyâ€™s metadata. This entry contains some flags and the underlying delegate type, and refers to the add and remove accessor methods. This information exists simply to draw an association between the abstract concept of an â€œeventâ€ and its accessor methods. Compilers and other tools can use this metadata, and this information can also be obtained by using the System.Reflection.EventInfo class. However, the CLR itself doesnâ€™t use this metadata information and requires only the accessor methods at run time.</p></blockquote><p>ğŸ’¡å°ç»“ï¼šå®šä¹‰äº†æä¾›äº‹ä»¶æˆå‘˜çš„ç±»ä¹‹åï¼ŒC# ç¼–è¯‘å™¨ç¼–è¯‘æ—¶ä¼šæŠŠå®ƒè½¬æ¢æˆ 3 ä¸ªæ„é€ ã€‚ç¬¬ä¸€ä¸ªæ„é€ æ˜¯å…·æœ‰æ°å½“å§”æ‰˜ç±»å‹çš„å­—æ®µã€‚è¯¥å­—æ®µæ˜¯å¯¹ä¸€ä¸ªå§”æ‰˜åˆ—è¡¨çš„å¤´éƒ¨çš„å¼•ç”¨ã€‚äº‹ä»¶å‘ç”Ÿæ—¶ä¼šé€šçŸ¥è¿™ä¸ªåˆ—è¡¨ä¸­çš„å§”æ‰˜ã€‚å­—æ®µåˆå§‹åŒ–ä¸º nullï¼Œè¡¨æ˜æ— ä¾¦å¬è€…ï¼ˆlistenerï¼‰ç™»è®°å¯¹è¯¥äº‹ä»¶çš„å…³æ³¨ã€‚ä¾¦å¬è€…ç™»è®°å¯¹äº‹ä»¶çš„å…³æ³¨æ—¶ï¼Œåªéœ€å°†å§”æ‰˜ç±»å‹çš„ä¸€ä¸ªå®ä¾‹æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚æ˜¾ç„¶ï¼Œæ³¨é”€ï¼ˆå¯¹äº‹ä»¶çš„å…³æ³¨ï¼‰æ„å‘³ç€ä»åˆ—è¡¨ä¸­ç§»é™¤å§”æ‰˜ã€‚æ³¨æ„ï¼Œå³ä½¿åŸå§‹ä»£ç è¡Œå°†äº‹ä»¶å®šä¹‰ä¸º publicï¼Œå§”æ‰˜å­—æ®µä¹Ÿå§‹ç»ˆæ˜¯ privateã€‚å°†å§”æ‰˜å­—æ®µå®šä¹‰ä¸º privateï¼Œç›®çš„æ˜¯é˜²æ­¢ç±»å¤–éƒ¨çš„ä»£ç ä¸æ­£ç¡®åœ°æ“çºµå®ƒã€‚å¦‚æœå­—æ®µæ˜¯ publicï¼Œä»»ä½•ä»£ç éƒ½èƒ½æ›´æ”¹å­—æ®µä¸­çš„å€¼ï¼Œå¹¶å¯èƒ½åˆ é™¤å·²ç™»è®°äº†å¯¹äº‹ä»¶çš„å…³æ³¨çš„å§”æ‰˜ã€‚C# ç¼–è¯‘å™¨ç”Ÿæˆçš„ç¬¬äºŒä¸ªæ„é€ æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå…è®¸å…¶ä»–å¯¹è±¡ç™»è®°å¯¹äº‹ä»¶çš„å…³æ³¨ã€‚ç”Ÿæˆçš„ä»£ç æ€»æ˜¯è°ƒç”¨ <code>System.Delegate</code> çš„é™æ€ <code>Combine</code> æ–¹æ³•ï¼Œå®ƒå°†å§”æ‰˜å®ä¾‹æ·»åŠ åˆ°å§”æ‰˜åˆ—è¡¨ä¸­ï¼Œè¿”å›æ–°çš„åˆ—è¡¨å¤´ï¼ˆåœ°å€ï¼‰ï¼Œå¹¶å°†è¿™ä¸ªåœ°å€å­˜å›å­—æ®µã€‚C# ç¼–è¯‘å™¨ç”Ÿæˆçš„ç¬¬ä¸‰ä¸ªæ„é€ ä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå…è®¸å¯¹è±¡æ³¨é”€å¯¹äº‹ä»¶çš„å…³æ³¨ã€‚æ–¹æ³•ä¸­çš„ä»£ç æ€»æ˜¯è°ƒç”¨ <code>Delegate</code> çš„é™æ€ <code>Remove</code> æ–¹æ³•ï¼Œå°†å§”æ‰˜å®ä¾‹ä»å§”æ‰˜åˆ—è¡¨ä¸­åˆ é™¤ï¼Œè¿”å›æ–°çš„åˆ—è¡¨å¤´ï¼ˆåœ°å€ï¼‰ï¼Œå¹¶å°†è¿™ä¸ªåœ°å€å­˜å›å­—æ®µã€‚åœ¨ç±»å‹ä¸­å®šä¹‰äº‹ä»¶æ—¶ï¼Œäº‹ä»¶çš„å¯è®¿é—®æ€§å†³å®šäº†ä»€ä¹ˆä»£ç èƒ½ç™»è®°å’Œæ³¨é”€å¯¹äº‹ä»¶çš„å…³æ³¨ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œåªæœ‰ç±»å‹æœ¬èº«æ‰èƒ½ç›´æ¥è®¿é—®å§”æ‰˜å­—æ®µã€‚äº‹ä»¶æˆå‘˜ä¹Ÿå¯å£°æ˜ä¸º static æˆ– virtualã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ç”Ÿæˆçš„ add å’Œ remove æ–¹æ³•åˆ†åˆ«æ ‡è®°ä¸º static æˆ– virtualã€‚é™¤äº†ç”Ÿæˆä¸Šè¿° 3 ä¸ªæ„é€ ï¼Œç¼–è¯‘å™¨è¿˜ä¼šåœ¨æ‰˜ç®¡ç¨‹åºé›†çš„å…ƒæ•°æ®ä¸­ç”Ÿæˆä¸€ä¸ªäº‹ä»¶å®šä¹‰è®°å½•é¡¹ã€‚è¿™ä¸ªè®°å½•é¡¹åŒ…å«äº†ä¸€äº›æ ‡å¿—ï¼ˆflagï¼‰å’ŒåŸºç¡€å§”æ‰˜ç±»å‹ï¼ˆunderlying delegate typeï¼‰ï¼Œè¿˜å¼•ç”¨äº† add å’Œ remove è®¿é—®å™¨æ–¹æ³•ã€‚è¿™äº›ä¿¡æ¯ç”¨äºå»ºç«‹ â€œäº‹ä»¶â€ çš„æŠ½è±¡æ¦‚å¿µå’Œå®ƒçš„è®¿é—®å™¨æ–¹æ³•ä¹‹é—´çš„è”ç³»ã€‚ç¼–è¯‘å™¨å’Œå…¶ä»–å·¥å…·å¯åˆ©ç”¨è¿™äº›å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¹¶å¯é€šè¿‡ <code>System.Reflection.EventInfo</code> ç±»è·å–è¿™äº›ä¿¡æ¯ã€‚ä½†æ˜¯ï¼ŒCLR æœ¬èº«å¹¶ä¸ä½¿ç”¨è¿™äº›å…ƒæ•°æ®ä¿¡æ¯ï¼Œå®ƒåœ¨è¿è¡Œæ—¶åªéœ€è¦è®¿é—®å™¨æ–¹æ³•ã€‚</p><h2 id="designing-a-type-that-listens-for-an-event"><a class="anchor" href="#designing-a-type-that-listens-for-an-event">#</a> Designing a Type That Listens for an Event</h2><blockquote><p>The hard work is definitely behind you at this point. In this section, Iâ€™ll show you how to define a type that uses an event provided by another type. Letâ€™s start off by examining the code for the Fax type.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Fax</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token comment">// Pass the MailManager object to the constructor </span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token function">Fax</span><span class="token punctuation">(</span><span class="token class-name">MailManager</span> mm<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token comment">// Construct an instance of the EventHandler&lt;NewMailEventArgs> </span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token comment">// delegate that refers to our FaxMsg callback method. </span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token comment">// Register our callback with MailManager's NewMail event </span></pre></td></tr><tr><td data-num="7"></td><td><pre> mm<span class="token punctuation">.</span>NewMail <span class="token operator">+=</span> FaxMsg<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token comment">// This is the method the MailManager will call </span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token comment">// when a new email message arrives </span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">FaxMsg</span><span class="token punctuation">(</span><span class="token class-name">Object</span> sender<span class="token punctuation">,</span> <span class="token class-name">NewMailEventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token comment">// 'sender' identifies the MailManager object in case </span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token comment">// we want to communicate back to it. </span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token comment">// 'e' identifies the additional event information </span></pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token comment">// the MailManager wants to give us. </span></pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token comment">// Normally, the code here would fax the email message. </span></pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token comment">// This test implementation displays the info in the console </span></pre></td></tr><tr><td data-num="18"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Faxing mail message:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" From=&#123;0&#125;, To=&#123;1&#125;, Subject=&#123;2&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="20"></td><td><pre> e<span class="token punctuation">.</span>From<span class="token punctuation">,</span> e<span class="token punctuation">.</span>To<span class="token punctuation">,</span> e<span class="token punctuation">.</span>Subject<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token comment">// This method could be executed to have the Fax object unregister </span></pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token comment">// itself with the NewMail event so that it no longer receives </span></pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token comment">// notifications </span></pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Unregister</span><span class="token punctuation">(</span><span class="token class-name">MailManager</span> mm<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token comment">// Unregister with MailManager's NewMail event </span></pre></td></tr><tr><td data-num="27"></td><td><pre> mm<span class="token punctuation">.</span>NewMail <span class="token operator">-=</span> FaxMsg<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>When the email application initializes, it would first construct a MailManager object and save the reference to this object in a variable. Then the application would construct a Fax object, passing the reference to the MailManager object as a parameter. In the Fax constructor, the Fax object registers its interest in MailManagerâ€™s NewMail event using C#â€™s += operator.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre>mm<span class="token punctuation">.</span>NewMail <span class="token operator">+=</span> FaxMsg<span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>Because the C# compiler has built-in support for events, the compiler translates the use of the += operator into the following line of code to add the objectâ€™s interest in the event.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre>mm<span class="token punctuation">.</span><span class="token function">add_NewMail</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>FaxMsg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>As you can see, the C# compiler is generating code that will construct an EventHandler delegate object that wraps the Fax classâ€™s FaxMsg method. Then, the C# compiler calls the MailManagerâ€™s add_NewMail method, passing it the new delegate. Of course, you can verify all of this by compiling the code and looking at the IL with a tool such as ILDasm.exe.</p></blockquote><blockquote><p>Even if youâ€™re using a programming language that doesnâ€™t directly support events, you can still register a delegate with the event by calling the add accessor method explicitly. The effect is identical; the source code will just not look as pretty. Itâ€™s the add method that registers the delegate with the event by adding it to the eventâ€™s list of delegates.</p></blockquote><blockquote><p>When the MailManager object raises the event, the Fax objectâ€™s FaxMsg method gets called. The method is passed a reference to the MailManager object as the first parameter, sender. Most of the time, this parameter is ignored, but it can be used if the Fax object wants to access members of the MailManager object in response to the event notification. The second parameter is a reference to a NewMailEventArgs object. This object contains any additional information the designer of MailManager and NewMailEventArgs thought would be useful to the event receivers.</p></blockquote><blockquote><p>From the NewMailEventArgs object, the FaxMsg method has easy access to the messageâ€™s sender, the messageâ€™s recipient, and the messageâ€™s subject. In a real Fax object, this information would be faxed somewhere. In this example, the information is simply displayed in the console window.</p></blockquote><blockquote><p>When an object is no longer interested in receiving event notifications, it should unregister its interest. For example, the Fax object would unregister its interest in the NewMail event if the user no longer wanted his or her email forwarded to a fax. As long as an object has registered one of its methods with an event, the object canâ€™t be garbage collected. If your type implements IDisposableâ€™s Dispose method, the implementation should cause it to unregister interest in all events. (See Chapter 21, â€œThe Managed Heap and Garbage Collection,â€ for more information about IDisposable.)</p></blockquote><blockquote><p>Code that demonstrates how to unregister for an event is shown in Faxâ€™s Unregister method. This method is practically identical to the code shown in the Fax constructor. The only difference is that this code uses -= instead of +=. When the C# compiler sees code using the -= operator to unregister a delegate with an event, the compiler emits a call to the eventâ€™s remove method</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre>mm<span class="token punctuation">.</span><span class="token function">remove_NewMail</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventHandler<span class="token punctuation">&lt;</span>NewMailEventArgs<span class="token punctuation">></span></span><span class="token punctuation">(</span>FaxMsg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>As with the += operator, even if youâ€™re using a programming language that doesnâ€™t directly support events, you can still unregister a delegate with the event by calling the remove accessor method explicitly. The remove method unregisters the delegate from the event by scanning the list for a delegate that wraps the same method as the one passed in. If a match is found, the existing delegate is removed from the eventâ€™s list of delegates. If a match isnâ€™t found, no error occurs, and the list is unaltered.</p></blockquote><blockquote><p>By the way, C# requires your code to use the += and -= operators to add and remove delegates from the list. If you try to call the add or remove method explicitly, the C# compiler produces the CS0571 cannot explicitly call operator or accessor error message.</p></blockquote><p>ğŸ’¡å°ç»“ï¼šC# ç¼–è¯‘å™¨å†…å»ºäº†å¯¹äº‹ä»¶çš„æ”¯æŒï¼Œä¼šå°† += æ“ä½œç¬¦ç¿»è¯‘æˆå…·ä½“ä»£ç æ¥æ·»åŠ å¯¹è±¡å¯¹äº‹ä»¶çš„å…³æ³¨ã€‚å³ä½¿ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ä¸ç›´æ¥æ”¯æŒäº‹ä»¶ï¼Œä¹Ÿå¯æ˜¾å¼è°ƒç”¨ add è®¿é—®å™¨æ–¹æ³•å‘äº‹ä»¶ç™»è®°å§”æ‰˜ã€‚ä¸¤è€…æ•ˆæœä¸€æ ·ï¼Œæœ€ç»ˆéƒ½æ˜¯ç”¨ add è®¿é—®å™¨å°†å§”æ‰˜æ·»åŠ åˆ°äº‹ä»¶çš„å§”æ‰˜åˆ—è¡¨ä¸­ï¼Œä»è€Œå®Œæˆå§”æ‰˜å‘äº‹ä»¶çš„ç™»è®°ã€‚å¯¹è±¡ä¸å†å¸Œæœ›æ¥æ”¶äº‹ä»¶é€šçŸ¥æ—¶ï¼Œåº”æ³¨é”€å¯¹äº‹ä»¶çš„å…³æ³¨ã€‚å¯¹è±¡åªè¦å‘äº‹ä»¶ç™»è®°äº†ä¸€ä¸ªæ–¹æ³•ï¼Œä¾¿ä¸èƒ½è¢«åƒåœ¾å›æ”¶ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çš„ç±»å‹è¦å®ç° <code>IDisposable</code> å’Œ <code>Dispose</code> æ–¹æ³•ï¼Œå°±åº”è¯¥åœ¨å®ç°ä¸­æ³¨é”€å¯¹æ‰€æœ‰äº‹ä»¶çš„å…³æ³¨ã€‚å’Œ += æ“ä½œç¬¦ä¸€æ ·ï¼Œå³ä½¿ç¼–ç¨‹è¯­è¨€ä¸ç›´æ¥æ”¯æŒäº‹ä»¶ï¼Œä¹Ÿå¯æ˜¾ç¤ºè°ƒç”¨ remove è®¿é—®å™¨æ–¹æ³•å‘äº‹ä»¶æ³¨é”€å§”æ‰˜ã€‚remove æ–¹æ³•ä¸ºäº†å‘äº‹ä»¶æ³¨é”€å§”æ‰˜ï¼Œéœ€è¦æ‰«æå§”æ‰˜åˆ—è¡¨æ¥å¯»æ‰¾ä¸€ä¸ªæ°å½“çš„å§”æ‰˜ï¼ˆå…¶ä¸­åŒ…è£…çš„æ–¹æ³•å’Œä¼ é€’çš„æ–¹æ³•ç›¸åŒï¼‰ã€‚æ‰¾åˆ°åŒ¹é…ï¼Œç°æœ‰å§”æ‰˜ä¼šä»äº‹ä»¶çš„å§”æ‰˜åˆ—è¡¨ä¸­åˆ é™¤ã€‚æ²¡æœ‰æ‰¾åˆ°ä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œåˆ—è¡¨ä¸å‘ç”Ÿä»»ä½•å˜åŠ¨ã€‚C# è¦æ±‚ä»£ç ä½¿ç”¨ += å’Œ -= æ“ä½œç¬¦åœ¨åˆ—è¡¨ä¸­å¢åˆ å§”æ‰˜ã€‚å¦‚æœæ˜¾å¼è°ƒç”¨ add å’Œ remove æ–¹æ³•ï¼ŒC# ç¼–è¯‘å™¨ä¼šæŠ¥å‘Šä»¥ä¸‹é”™è¯¯æ¶ˆæ¯ï¼šCS0571ï¼šæ— æ³•æ˜¾å¼è°ƒç”¨è¿ç®—ç¬¦æˆ–è®¿é—®å™¨ã€‚</p><h2 id="explicitly-implementing-an-event"><a class="anchor" href="#explicitly-implementing-an-event">#</a> Explicitly Implementing an Event</h2><blockquote><p>The System.Windows.Forms.Control type defines about 70 events. If the Control type implemented the events by allowing the compiler to implicitly generate the add and remove accessor methods and delegate fields, every Control object would have 70 delegate fields in it just for the events! Because most programmers care about just a few events, an enormous amount of memory would be wasted for each object created from a Control-derived type. By the way, the <span class="exturl" data-url="aHR0cDovL0FTUC5ORVQ=">ASP.NET</span> System.Web.UI.Control and the Windows Presentation Foundation (WPF) System.Windows.UIElement type also offer many events that most programmers do not use.</p></blockquote><blockquote><p>In this section, I discuss how the C# compiler allows a class developer to explicitly implement an event, allowing the developer to control how the add and remove methods manipulate the callback delegates. Iâ€™m going to demonstrate how explicitly implementing an event can be used to efficiently implement a class that offers many events. However, there are certainly other scenarios where you might want to explicitly implement a typeâ€™s event.</p></blockquote><blockquote><p>To efficiently store event delegates, each object that exposes events will maintain a collection (usually a dictionary) with some sort of event identifier as the key and a delegate list as the value. When a new object is constructed, this collection is empty. When interest in an event is registered, the eventâ€™s identifier is looked up in the collection. If the event identifier is there, the new delegate is combined with the list of delegates for this event. If the event identifier isnâ€™t in the collection, the event identifier is added with the delegate.</p></blockquote><blockquote><p>When the object needs to raise an event, the event identifier is looked up in the collection. If the collection doesnâ€™t have an entry for the event identifier, nothing has registered interest in the event and no delegates need to be called back. If the event identifier is in the collection, the delegate list associated with the event identifier is invoked. Implementing this design pattern is the responsibility of the developer who is designing the type that defines the events; the developer using the type has no idea how the events are implemented internally.</p></blockquote><blockquote><p>Here is an example of how you could accomplish this pattern. First, I implemented an EventSet class that represents a collection of events and each eventâ€™s delegate list as follows.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// This class exists to provide a bit more type safety and </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// code maintainability when using EventSet</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">EventKey</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">EventSet</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token comment">// The private dictionary used to maintain EventKey -> Delegate mappings</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span>EventKey<span class="token punctuation">,</span> Delegate<span class="token punctuation">></span></span> m_events <span class="token operator">=</span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span>EventKey<span class="token punctuation">,</span> Delegate<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// Adds an EventKey -> Delegate mapping if it doesn't exist or </span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// combines a delegate to an existing EventKey</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name">EventKey</span> eventKey<span class="token punctuation">,</span> <span class="token class-name">Delegate</span> handler<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre> Monitor<span class="token punctuation">.</span><span class="token function">Enter</span><span class="token punctuation">(</span>m_events<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token class-name">Delegate</span> d<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre> m_events<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>eventKey<span class="token punctuation">,</span> <span class="token keyword">out</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre> m_events<span class="token punctuation">[</span>eventKey<span class="token punctuation">]</span> <span class="token operator">=</span> Delegate<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre> Monitor<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span>m_events<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">// Removes a delegate from an EventKey (if it exists) and </span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">// removes the EventKey -> Delegate mapping the last delegate is removed</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Remove</span><span class="token punctuation">(</span><span class="token class-name">EventKey</span> eventKey<span class="token punctuation">,</span> <span class="token class-name">Delegate</span> handler<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre> Monitor<span class="token punctuation">.</span><span class="token function">Enter</span><span class="token punctuation">(</span>m_events<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token comment">// Call TryGetValue to ensure that an exception is not thrown if</span></pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token comment">// attempting to remove a delegate from an EventKey not in the set</span></pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token class-name">Delegate</span> d<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>m_events<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>eventKey<span class="token punctuation">,</span> <span class="token keyword">out</span> d<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre> d <span class="token operator">=</span> Delegate<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token comment">// If a delegate remains, set the new head else remove the EventKey</span></pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> m_events<span class="token punctuation">[</span>eventKey<span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre> <span class="token keyword">else</span> m_events<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>eventKey<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre> Monitor<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span>m_events<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment">// Raises the event for the indicated EventKey</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Raise</span><span class="token punctuation">(</span><span class="token class-name">EventKey</span> eventKey<span class="token punctuation">,</span> <span class="token class-name">Object</span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre> <span class="token comment">// Don't throw an exception if the EventKey is not in the set</span></pre></td></tr><tr><td data-num="37"></td><td><pre> <span class="token class-name">Delegate</span> d<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre> Monitor<span class="token punctuation">.</span><span class="token function">Enter</span><span class="token punctuation">(</span>m_events<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre> m_events<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span>eventKey<span class="token punctuation">,</span> <span class="token keyword">out</span> d<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre> Monitor<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span>m_events<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>d <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre> <span class="token comment">// Because the dictionary can contain several different delegate types,</span></pre></td></tr><tr><td data-num="43"></td><td><pre> <span class="token comment">// it is impossible to construct a type-safe call to the delegate at </span></pre></td></tr><tr><td data-num="44"></td><td><pre> <span class="token comment">// compile time. So, I call the System.Delegate type's DynamicInvoke </span></pre></td></tr><tr><td data-num="45"></td><td><pre> <span class="token comment">// method, passing it the callback method's parameters as an array of </span></pre></td></tr><tr><td data-num="46"></td><td><pre> <span class="token comment">// objects. Internally, DynamicInvoke will check the type safety of the </span></pre></td></tr><tr><td data-num="47"></td><td><pre> <span class="token comment">// parameters with the callback method being called and call the method.</span></pre></td></tr><tr><td data-num="48"></td><td><pre> <span class="token comment">// If there is a type mismatch, then DynamicInvoke will throw an exception.</span></pre></td></tr><tr><td data-num="49"></td><td><pre> d<span class="token punctuation">.</span><span class="token function">DynamicInvoke</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Object<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> sender<span class="token punctuation">,</span> e <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="51"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ğŸ’¡Note : The FCL defines a type, System.Windows.EventHandlersStore, which does essentially the same thing as my EventSet class. Various WPF types use the EventHandlersStore type internally to maintain their sparse set of events. Youâ€™re certainly welcome to use the FCLâ€™s EventHandlersStore type if youâ€™d like. The big difference between the EventHandlersStore type and my EventSet type is that EventHandlersStore doesnâ€™t offer any thread-safe way to access the events; you would have to implement your own thread-safe wrapper around the EventHandlersStore collection if you need to do this.</p><blockquote><p>Now, I show a class that uses my EventSet class. This class has a field that refers to an EventSet object, and each of this classâ€™s events is explicitly implemented so that each eventâ€™s add method stores the specified callback delegate in the EventSet object and each eventâ€™s remove method eliminates the specified callback delegate (if found).</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// Define the EventArgs-derived type for this event.</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FooEventArgs</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">EventArgs</span></span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TypeWithLotsOfEvents</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token comment">// Define a private instance field that references a collection.</span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token comment">// The collection manages a set of Event/Delegate pairs.</span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token comment">// NOTE: The EventSet type is not part of the FCL, it is my own type.</span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">EventSet</span> m_eventSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token comment">// The protected property allows derived types access to the collection.</span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">protected</span> <span class="token return-type class-name">EventSet</span> EventSet <span class="token punctuation">&#123;</span> <span class="token keyword">get</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> m_eventSet<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token preprocessor property">#<span class="token directive keyword">region</span> Code to support the Foo event (repeat this pattern for additional events)</span></pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token comment">// Define the members necessary for the Foo event.</span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token comment">// 2a. Construct a static, read-only object to identify this event.</span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token comment">// Each object has its own hash code for looking up this</span></pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token comment">// event's delegate linked list in the object's collection.</span></pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">EventKey</span> s_fooEventKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EventKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token comment">// 2b. Define the event's accessor methods that add/remove the</span></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token comment">// delegate from the collection.</span></pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token return-type class-name">EventHandler<span class="token punctuation">&lt;</span>FooEventArgs<span class="token punctuation">></span></span> Foo <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token keyword">add</span> <span class="token punctuation">&#123;</span> m_eventSet<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>s_fooEventKey<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token keyword">remove</span> <span class="token punctuation">&#123;</span> m_eventSet<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>s_fooEventKey<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token comment">// 2c. Define the protected, virtual On method for this event.</span></pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnFoo</span><span class="token punctuation">(</span><span class="token class-name">FooEventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre> m_eventSet<span class="token punctuation">.</span><span class="token function">Raise</span><span class="token punctuation">(</span>s_fooEventKey<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token comment">// 2d. Define the method that translates input to this event.</span></pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SimulateFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">OnFoo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">FooEventArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Code that uses the TypeWithLotsOfEvents type canâ€™t tell whether the events have been implemented implicitly by the compiler or explicitly by the developer. They just register the events by using normal syntax. Here is some code demonstrating this.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token class-name">TypeWithLotsOfEvents</span> twle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TypeWithLotsOfEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token comment">// Add a callback here</span></pre></td></tr><tr><td data-num="5"></td><td><pre> twle<span class="token punctuation">.</span>Foo <span class="token operator">+=</span> HandleFooEvent<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token comment">// Prove that it worked</span></pre></td></tr><tr><td data-num="7"></td><td><pre> twle<span class="token punctuation">.</span><span class="token function">SimulateFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">HandleFooEvent</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">FooEventArgs</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Handling Foo Event here..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ğŸ’¡å°ç»“ï¼š <code>System.Windows.Forms.Control</code> ç±»å‹å®šä¹‰äº†å¤§çº¦ 70 ä¸ªäº‹ä»¶ã€‚å‡å¦‚ Control ç±»å‹åœ¨å®ç°äº‹ä»¶æ—¶ï¼Œå…è®¸ç¼–è¯‘å™¨éšå¼ç”Ÿæˆ add å’Œ remove è®¿é—®å™¨æ–¹æ³•ä»¥åŠå§”æ‰˜å­—æ®µï¼Œé‚£ä¹ˆæ¯ä¸ª Control å¯¹è±¡ä»…ä¸ºäº‹ä»¶å°±è¦å‡†å¤‡ 70 ä¸ªå§”æ‰˜å­—æ®µã€‚ç”±äºå¤§å¤šæ•°ç¨‹åºå‘˜åªå…³å¿ƒå°‘æ•°å‡ ä¸ªäº‹ä»¶ï¼Œæ‰€ä»¥æ¯ä¸ªä» <code>Control</code> æ´¾ç”Ÿç±»å‹åˆ›å»ºçš„å¯¹è±¡éƒ½è¦æµªè´¹å¤§é‡å†…å­˜ã€‚å› æ­¤ï¼Œæœ¬èŠ‚è®¨è®ºäº† C# ç¼–è¯‘å™¨å¦‚ä½•å¦‚ä½•å…è®¸ç±»çš„å¼€å‘äººå‘˜æ˜¾å¼å®ç°ä¸€ä¸ªäº‹ä»¶ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿæ§åˆ¶ add å’Œ remove æ–¹æ³•å¤„ç†å›è°ƒå§”æ‰˜çš„æ–¹æ³•ï¼Œå¹¶æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡æ˜¾å¼å®ç°äº‹ä»¶æ¥é«˜æ•ˆç‡åœ°å®ç°æä¾›äº†å¤§é‡äº‹ä»¶çš„ç±»ã€‚ä¸ºäº†é«˜æ•ˆç‡å­˜å‚¨äº‹ä»¶å§”æ‰˜ï¼Œå…¬å¼€äº†äº‹ä»¶çš„æ¯ä¸ªå¯¹è±¡éƒ½è¦ç»´æŠ¤ä¸€ä¸ªé›†åˆï¼ˆé€šå¸¸æ—¶å­—å…¸ï¼‰ã€‚é›†åˆå°†æŸç§å½¢å¼çš„äº‹ä»¶æ ‡è¯†ç¬¦ä½œä¸ºé”®ï¼ˆkeyï¼‰ï¼Œå°†å§”æ‰˜åˆ—è¡¨ä½œä¸ºå€¼ï¼ˆvalueï¼‰ã€‚ä½¿ç”¨ <code>TypeWithLotsOfEvents</code> ç±»å‹çš„ä»£ç ä¸çŸ¥é“äº‹ä»¶æ˜¯ç”±ç¼–è¯‘å™¨éšå¼å®ç°ï¼Œè¿˜æ˜¯ç”±å¼€å‘äººå‘˜æ˜¾å¼å®ç°ã€‚å®ƒä»¬åªéœ€è¦æ ‡å‡†çš„è¯­æ³•å‘äº‹ä»¶ç™»è®°å³å¯ã€‚</p><div class="tags"><a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag"><i class="ic i-tag"></i> è¯»ä¹¦ç¬”è®°</a> <a href="/tags/C/" rel="tag"><i class="ic i-tag"></i> C#</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2022-10-31 23:21:27" itemprop="dateModified" datetime="2022-10-31T23:21:27+08:00">2022-10-31</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(ï¿£â–½ï¿£)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Sakupinera WeChat Pay"><p>WeChat Pay</p></div><div><img data-src="/images/alipay.png" alt="Sakupinera Alipay"><p>Alipay</p></div><div><img data-src="/images/paypal.png" alt="Sakupinera PayPal"><p>PayPal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Sakupinera <i class="ic i-at"><em>@</em></i>Sakupinera</li><li class="link"><strong>Post link: </strong><a href="http://sakupinera.github.io/2022/10/29/csharp/clr-via-csharp/Chapter%2011%20Events/" title="CLR via C# - Chapter 11 Events">http://sakupinera.github.io/2022/10/29/csharp/clr-via-csharp/Chapter 11 Events/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/10/28/csharp/clr-via-csharp/Chapter%2010%20Properties/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;03&#x2F;08&#x2F;dhkXYZz7ENHoCeL.png" title="CLR via C# - Chapter 10 Properties"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i> CLR-via-CSharp</span><h3>CLR via C# - Chapter 10 Properties</h3></a></div><div class="item right"><a href="/2022/10/31/computer-graphics/games101/%E7%9B%B8%E6%9C%BA%EF%BC%8C%E9%80%8F%E9%95%9C%E5%92%8C%E5%85%89%E5%9C%BA/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;03&#x2F;08&#x2F;AK1D84aqsYghTOC.jpg" title="GAMES101 - Cameras, Lenses and Light Fieldsï¼ˆç›¸æœºï¼Œé€é•œå’Œå…‰åœºï¼‰"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i> GAMES101</span><h3>GAMES101 - Cameras, Lenses and Light Fieldsï¼ˆç›¸æœºï¼Œé€é•œå’Œå…‰åœºï¼‰</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#chapter-11-events"><span class="toc-number">1.</span> <span class="toc-text">Chapter 11 Events</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#designing-a-type-that-exposes-an-event"><span class="toc-number">1.1.</span> <span class="toc-text">Designing a Type That Exposes an Event</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#step-1-define-a-type-that-will-hold-any-additional-information-that-should-be-sent-to-receivers-of-the-event-notification"><span class="toc-number">1.1.1.</span> <span class="toc-text">Step #1: Define a type that will hold any additional information that should be sent to receivers of the event notification</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#step-2-define-the-event-member"><span class="toc-number">1.1.2.</span> <span class="toc-text">Step #2: Define the event member</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#step-3-define-a-method-responsible-for-raising-the-event-to-notify-registered-objects-that-the-event-has-occurred"><span class="toc-number">1.1.3.</span> <span class="toc-text">Step #3: Define a method responsible for raising the event to notify registered objects that the event has occurred</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#step-4-define-a-method-that-translates-the-input-into-the-desired-event"><span class="toc-number">1.1.4.</span> <span class="toc-text">Step #4: Define a method that translates the input into the desired event</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#how-the-compiler-implements-an-event"><span class="toc-number">1.2.</span> <span class="toc-text">How the Compiler Implements an Event</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#designing-a-type-that-listens-for-an-event"><span class="toc-number">1.3.</span> <span class="toc-text">Designing a Type That Listens for an Event</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#explicitly-implementing-an-event"><span class="toc-number">1.4.</span> <span class="toc-text">Explicitly Implementing an Event</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%201%20The%20CLR%E2%80%99s%20Execution%20Model/" rel="bookmark" title="CLR via C# - Chapter 1 The CLRâ€™s Execution Model">CLR via C# - Chapter 1 The CLRâ€™s Execution Model</a></li><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%202%20Building,%20Packaging,%20Deploying,%20and%20Administering%20Applications%20and%20Types/" rel="bookmark" title="CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types">CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types</a></li><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%203%20Shared%20Assemblies%20and%20Strongly%20Named%20Assemblies/" rel="bookmark" title="CLR via C# - Chapter 3 Shared Assemblies and Strongly Named Assemblies">CLR via C# - Chapter 3 Shared Assemblies and Strongly Named Assemblies</a></li><li><a href="/2022/09/27/csharp/clr-via-csharp/Chapter%204%20Type%20Fundamentals/" rel="bookmark" title="CLR via C# - Chapter 4 Type Fundamentals">CLR via C# - Chapter 4 Type Fundamentals</a></li><li><a href="/2022/10/15/csharp/clr-via-csharp/Chapter%205%20Primitive,%20Reference,%20and%20Value%20%20Types/" rel="bookmark" title="CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals">CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals</a></li><li><a href="/2022/10/21/csharp/clr-via-csharp/Chapter%206%20Type%20and%20Member%20Basics/" rel="bookmark" title="CLR via C# - Chapter 6 Type and Member Basics">CLR via C# - Chapter 6 Type and Member Basics</a></li><li><a href="/2022/10/24/csharp/clr-via-csharp/Chapter%207%20Constants%20and%20Fields/" rel="bookmark" title="CLR via C# - Chapter 7 Constants and Fields">CLR via C# - Chapter 7 Constants and Fields</a></li><li><a href="/2022/10/25/csharp/clr-via-csharp/Chapter%208%20Methods/" rel="bookmark" title="CLR via C# - Chapter 8 Methods">CLR via C# - Chapter 8 Methods</a></li><li><a href="/2022/10/27/csharp/clr-via-csharp/Chapter%209%20Parameters/" rel="bookmark" title="CLR via C# - Chapter 9 Parameters">CLR via C# - Chapter 9 Parameters</a></li><li><a href="/2022/10/28/csharp/clr-via-csharp/Chapter%2010%20Properties/" rel="bookmark" title="CLR via C# - Chapter 10 Properties">CLR via C# - Chapter 10 Properties</a></li><li class="active"><a href="/2022/10/29/csharp/clr-via-csharp/Chapter%2011%20Events/" rel="bookmark" title="CLR via C# - Chapter 11 Events">CLR via C# - Chapter 11 Events</a></li><li><a href="/2022/11/02/csharp/clr-via-csharp/Chapter%2012%20Generics/" rel="bookmark" title="CLR via C# - Chapter 12 Generics">CLR via C# - Chapter 12 Generics</a></li><li><a href="/2022/11/04/csharp/clr-via-csharp/Chapter%2013%20Interfaces/" rel="bookmark" title="CLR via C# - Chapter 13 Interfaces">CLR via C# - Chapter 13 Interfaces</a></li><li><a href="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/" rel="bookmark" title="CLR via C# - Chapter 14 Chars, Strings, and Working with Text">CLR via C# - Chapter 14 Chars, Strings, and Working with Text</a></li><li><a href="/2022/11/17/csharp/clr-via-csharp/Chapter%2015%20Enumerated%20Types%20and%20Bit%20Flags/" rel="bookmark" title="CLR via C# - Chapter 15 Enumerated Types and Bit Flags">CLR via C# - Chapter 15 Enumerated Types and Bit Flags</a></li><li><a href="/2022/11/19/csharp/clr-via-csharp/Chapter%2016%20Arrays/" rel="bookmark" title="CLR via C# - Chapter 16 Arrays">CLR via C# - Chapter 16 Arrays</a></li><li><a href="/2022/11/21/csharp/clr-via-csharp/Chapter%2017%20Delegates/" rel="bookmark" title="CLR via C# - Chapter 17 Delegates">CLR via C# - Chapter 17 Delegates</a></li><li><a href="/2022/11/22/csharp/clr-via-csharp/Chapter%2018%20Custom%20Attributes/" rel="bookmark" title="CLR via C# - Chapter 18 Custom Attributes">CLR via C# - Chapter 18 Custom Attributes</a></li><li><a href="/2022/11/23/csharp/clr-via-csharp/Chapter%2019%20Nullable%20Value%20Types/" rel="bookmark" title="CLR via C# - Chapter 19 Nullable Value Types">CLR via C# - Chapter 19 Nullable Value Types</a></li><li><a href="/2022/11/25/csharp/clr-via-csharp/Chapter%2020%20Exceptions%20and%20State%20Management/" rel="bookmark" title="CLR via C# - Chapter 20 Exceptions and State Management">CLR via C# - Chapter 20 Exceptions and State Management</a></li><li><a href="/2022/11/27/csharp/clr-via-csharp/Chapter%2021%20The%20Managed%20Heap%20and%20Garbage%20%20Collection/" rel="bookmark" title="CLR via C# - Chapter 21 The Managed Heap and Garbage  Collection">CLR via C# - Chapter 21 The Managed Heap and Garbage Collection</a></li><li><a href="/2022/11/28/csharp/clr-via-csharp/Chapter%2022%20CLR%20Hosting%20and%20AppDomains/" rel="bookmark" title="CLR via C# - Chapter 22 CLR Hosting and AppDomains">CLR via C# - Chapter 22 CLR Hosting and AppDomains</a></li><li><a href="/2022/11/29/csharp/clr-via-csharp/Chapter%2023%20Assembly%20Loading%20and%20Reflection/" rel="bookmark" title="CLR via C# - Chapter 23 Assembly Loading and Reflection">CLR via C# - Chapter 23 Assembly Loading and Reflection</a></li><li><a href="/2022/11/30/csharp/clr-via-csharp/Chapter%2024%20Runtime%20Serialization/" rel="bookmark" title="CLR via C# - Chapter 24 Runtime Serialization">CLR via C# - Chapter 24 Runtime Serialization</a></li><li><a href="/2022/12/06/csharp/clr-via-csharp/Chapter%2025%20Interoperating%20with%20WinRT%20%20Components/" rel="bookmark" title="CLR via C# - Chapter 25 Interoperating with WinRT Components">CLR via C# - Chapter 25 Interoperating with WinRT Components</a></li><li><a href="/2023/02/06/csharp/clr-via-csharp/Chapter%2026%20Thread%20Basics/" rel="bookmark" title="CLR via C# - Chapter 26 Thread Basics">CLR via C# - Chapter 26 Thread Basics</a></li><li><a href="/2023/02/07/csharp/clr-via-csharp/Chapter%2027%20Compute-Bound%20Asynchronous%20Operations/" rel="bookmark" title="CLR via C# - Chapter 27 Compute-Bound Asynchronous Operations">CLR via C# - Chapter 27 Compute-Bound Asynchronous Operations</a></li><li><a href="/2023/02/08/csharp/clr-via-csharp/Chapter%2028%20IO-Bound%20Asynchronous%20Operations/" rel="bookmark" title="CLR via C# - Chapter 28 IO-Bound Asynchronous Operations">CLR via C# - Chapter 28 IO-Bound Asynchronous Operations</a></li><li><a href="/2023/02/09/csharp/clr-via-csharp/Chapter%2029%20Primitive%20Thread%20Synchronization%20Constructs/" rel="bookmark" title="CLR via C# - Chapter 29 Primitive Thread Synchronization">CLR via C# - Chapter 29 Primitive Thread Synchronization</a></li><li><a href="/2023/02/10/csharp/clr-via-csharp/Chapter%2030%20Hybrid%20Thread%20Synchronization%20Constructs/" rel="bookmark" title="CLR via C# - Chapter 30 Hybrid Thread Synchronization">CLR via C# - Chapter 30 Hybrid Thread Synchronization</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Sakupinera" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Sakupinera</p><div class="description" itemprop="description">ä¿æŒä½ çš„å†³å¿ƒï¼</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">86</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">13</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">6</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Nha3VwaW5lcmE=" title="https:&#x2F;&#x2F;github.com&#x2F;sakupinera"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9zYWt1cGluZXJh" title="https:&#x2F;&#x2F;twitter.com&#x2F;sakupinera"><i class="ic i-twitter"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTQwNzIyOTA3MQ==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;407229071"><i class="ic i-cloud-music"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjIzMDczOTg/c3BtX2lkX2Zyb209MzMzLjEwMDcuMC4w" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;22307398?spm_id_from&#x3D;333.1007.0.0"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li><li class="item"><a href="/games/" rel="section"><i class="ic i-flag"></i>Games</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-person"></i>About</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/10/28/csharp/clr-via-csharp/Chapter%2010%20Properties/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/10/31/computer-graphics/games101/%E7%9B%B8%E6%9C%BA%EF%BC%8C%E9%80%8F%E9%95%9C%E5%92%8C%E5%85%89%E5%9C%BA/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Cpp/" title="In Cpp">Cpp</a> <i class="ic i-angle-right"></i> <a href="/categories/Cpp/Cpp-Primer/" title="In Cpp-Primer">Cpp-Primer</a></div><span><a href="/2023/01/05/cpp/cpp-primer/Chapter%2013%20Copy%20Control/" title="C++ Primer - Chapter 13 Copy Control">C++ Primer - Chapter 13 Copy Control</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/11/02/csharp/clr-via-csharp/Chapter%2012%20Generics/" title="CLR via C# - Chapter 12 Generics">CLR via C# - Chapter 12 Generics</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/11/30/csharp/clr-via-csharp/Chapter%2024%20Runtime%20Serialization/" title="CLR via C# - Chapter 24 Runtime Serialization">CLR via C# - Chapter 24 Runtime Serialization</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CMake/" title="In CMake">CMake</a></div><span><a href="/2022/08/28/cmake/CMake/" title="CMake">CMake</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Cpp/" title="In Cpp">Cpp</a> <i class="ic i-angle-right"></i> <a href="/categories/Cpp/Cpp-Primer/" title="In Cpp-Primer">Cpp-Primer</a></div><span><a href="/2022/12/17/cpp/cpp-primer/Chapter%209%20Sequential%20Containers/" title="C++ Primer - Chapter 9 Sequential Containers">C++ Primer - Chapter 9 Sequential Containers</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="In Linux">Linux</a> <i class="ic i-angle-right"></i> <a href="/categories/Linux/Learn-Linux/" title="In Learn-Linux">Learn-Linux</a></div><span><a href="/2022/09/04/linux/learn-linux/Shell%E7%BC%96%E7%A8%8B/" title="LearnLinux - Shellç¼–ç¨‹">LearnLinux - Shellç¼–ç¨‹</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/10/15/csharp/clr-via-csharp/Chapter%205%20Primitive,%20Reference,%20and%20Value%20%20Types/" title="CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals">CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="In Linux">Linux</a> <i class="ic i-angle-right"></i> <a href="/categories/Linux/Learn-Linux/" title="In Learn-Linux">Learn-Linux</a></div><span><a href="/2022/08/28/linux/learn-linux/Linux%E7%B3%BB%E7%BB%9F%E7%AE%80%E4%BB%8B/" title="LearnLinux - Linuxç³»ç»Ÿç®€ä»‹">LearnLinux - Linuxç³»ç»Ÿç®€ä»‹</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/11/04/csharp/clr-via-csharp/Chapter%2013%20Interfaces/" title="CLR via C# - Chapter 13 Interfaces">CLR via C# - Chapter 13 Interfaces</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Cpp/" title="In Cpp">Cpp</a> <i class="ic i-angle-right"></i> <a href="/categories/Cpp/Cpp-Primer/" title="In Cpp-Primer">Cpp-Primer</a></div><span><a href="/2022/12/09/cpp/cpp-primer/Chapter%201%20Getting%20Started/" title="C++ Primer - Chapter 1 Getting Started">C++ Primer - Chapter 1 Getting Started</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 â€“ <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Sakupinera @ Hanamai Sora</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">2.2m words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">33:30</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/10/29/csharp/clr-via-csharp/Chapter 11 Events/",favicon:{show:"ï¼ˆâ—Â´3ï½€â—ï¼‰Goooood",hide:"(Â´Ğ”ï½€)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/assets/shifuku.model.json"},display:{position:"left",width:250,height:500},mobile:{show:!1},react:{opacity:.9},log:!1})</script></body></html>
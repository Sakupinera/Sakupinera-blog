<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Sakupinera" href="http://sakupinera.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Sakupinera" href="http://sakupinera.github.io/atom.xml"><link rel="alternate" type="application/json" title="Sakupinera" href="http://sakupinera.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="è¯»ä¹¦ç¬”è®°,C#"><link rel="canonical" href="http://sakupinera.github.io/2022/11/22/csharp/clr-via-csharp/Chapter%2018%20Custom%20Attributes/"><title>CLR via C# - Chapter 18 Custom Attributes - CLR-via-CSharp - CSharp | Hanamai Sora = Sakupinera</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">CLR via C# - Chapter 18 Custom Attributes</h1><div class="meta"><span class="item" title="Created: 2022-11-22 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2022-11-22T00:00:00+08:00">2022-11-22</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>40k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>37 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Hanamai Sora</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://s2.loli.net/2023/03/08/OQq9sc7VlKfnvGL.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/Jxa8Trdmc4uFsqW.png"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/wi84uPUELq2rcnD.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/jV3gF2wSUYTdtsp.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/AOrFYJ8qeP512Sx.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/EXaiHD39BF7QWok.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CSharp/" itemprop="item" rel="index" title="In CSharp"><span itemprop="name">CSharp</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CSharp/CLR-via-CSharp/" itemprop="item" rel="index" title="In CLR-via-CSharp"><span itemprop="name">CLR-via-CSharp</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="http://sakupinera.github.io/2022/11/22/csharp/clr-via-csharp/Chapter%2018%20Custom%20Attributes/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Sakupinera"><meta itemprop="description" content=", ä¿æŒä½ çš„å†³å¿ƒï¼"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sakupinera"></span><div class="body md" itemprop="articleBody"><h1 id="chapter-18-custom-attributes"><a class="anchor" href="#chapter-18-custom-attributes">#</a> Chapter 18 Custom Attributes</h1><h2 id="using-custom-attributes"><a class="anchor" href="#using-custom-attributes">#</a> Using Custom Attributes</h2><blockquote><p>Attributes, such as public, private, static, and so on, can be applied to types and members. I think weâ€™d all agree on the usefulness of applying attributes, but wouldnâ€™t it be even more useful if we could define our own attributes? For example, what if I could define a type and somehow indicate that the type can be remoted via serialization? Or maybe I could apply an attribute to a method to indicate that certain security permissions must be granted before the method can execute.</p></blockquote><blockquote><p>Of course, creating and applying user-defined attributes to types and methods would be great and convenient, but it would require the compiler to be aware of these attributes so it would emit the attribute information into the resulting metadata. Because compiler vendors usually prefer not to release the source code for their compiler, Microsoft came up with another way to allow user-defined attributes. This mechanism, called custom attributes, is an incredibly powerful mechanism thatâ€™s useful at both application design time and run time. Anyone can define and use custom attributes, and all compilers that target the common language runtime (CLR) must be designed to recognize custom attributes and emit them into the resulting metadata.</p></blockquote><blockquote><p>The first thing you should realize about custom attributes is that theyâ€™re just a way to associate additional information with a target. The compiler emits this additional information into the managed moduleâ€™s metadata. Most attributes have no meaning for the compiler; the compiler simply detects the attributes in the source code and emits the corresponding metadata.</p></blockquote><blockquote><p>The .NET Framework Class Library (FCL) defines literally hundreds of custom attributes that can be applied to items in your own source code. Here are some examples:</p><ul><li><p>Applying the DllImport attribute to a method informs the CLR that the implementation of the method is actually in unmanaged code contained in the specified DLL.</p></li><li><p>Applying the Serializable attribute to a type informs the serialization formatters that an instanceâ€™s fields may be serialized and deserialized.</p></li><li><p>Applying the AssemblyVersion attribute to an assembly sets the version number of the assembly.</p></li><li><p>Applying the Flags attribute to an enumerated type causes the enumerated type to act as a set of bit flags.</p></li></ul></blockquote><blockquote><p>Following is some C# code with many attributes applied to it. In C#, you apply a custom attribute to a target by placing the attribute in square brackets immediately before the target. Itâ€™s not important to understand what this code does. I just want you to see what attributes look like.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>InteropServices</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">StructLayout</span><span class="token attribute-arguments"><span class="token punctuation">(</span>LayoutKind<span class="token punctuation">.</span>Sequential<span class="token punctuation">,</span> CharSet <span class="token operator">=</span> CharSet<span class="token punctuation">.</span>Auto<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">OSVERSIONINFO</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">public</span> <span class="token function">OSVERSIONINFO</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> OSVersionInfoSize <span class="token operator">=</span> <span class="token punctuation">(</span>UInt32<span class="token punctuation">)</span> Marshal<span class="token punctuation">.</span><span class="token function">SizeOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token keyword">public</span> <span class="token class-name">UInt32</span> OSVersionInfoSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token keyword">public</span> <span class="token class-name">UInt32</span> MajorVersion <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">public</span> <span class="token class-name">UInt32</span> MinorVersion <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token keyword">public</span> <span class="token class-name">UInt32</span> BuildNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token keyword">public</span> <span class="token class-name">UInt32</span> PlatformId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MarshalAs</span><span class="token attribute-arguments"><span class="token punctuation">(</span>UnmanagedType<span class="token punctuation">.</span>ByValTStr<span class="token punctuation">,</span> SizeConst <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token keyword">public</span> <span class="token class-name">String</span> CSDVersion <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Kernel32"</span><span class="token punctuation">,</span> CharSet <span class="token operator">=</span> CharSet<span class="token punctuation">.</span>Auto<span class="token punctuation">,</span> SetLastError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">extern</span> <span class="token return-type class-name">Boolean</span> <span class="token function">GetVersionEx</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">In</span><span class="token punctuation">,</span> <span class="token class-name">Out</span></span><span class="token punctuation">]</span> <span class="token class-name">OSVERSIONINFO</span> ver<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>In this case, the StructLayout attribute is applied to the OSVERSIONINFO class, the MarshalAs attribute is applied to the CSDVersion field, the DllImport attribute is applied to the GetVersionEx method, and the In and Out attributes are applied to GetVersionExâ€™s ver parameter. Every programming language defines the syntax a developer must use in order to apply a custom attribute to a target. Microsoft Visual Basic .NET, for example, requires angle brackets (&lt;, &gt;) instead of square brackets.</p></blockquote><blockquote><p>The CLR allows attributes to be applied to just about anything that can be represented in a fileâ€™s metadata. Most commonly, attributes are applied to entries in the following definition tables: TypeDef (classes, structures, enumerations, interfaces, and delegates), MethodDef (including constructors), ParamDef, FieldDef, PropertyDef, EventDef, AssemblyDef, and ModuleDef. Specifically, C# allows you to apply an attribute only to source code that defines any of the following targets: assembly, module, type (class, struct, enum, interface, delegate), field, method (including constructors), method parameter, method return value, property, event, and generic type parameter.</p></blockquote><blockquote><p>When youâ€™re applying an attribute, C# allows you to specify a prefix specifically indicating the target the attribute applies to. The following code shows all of the possible prefixes. In many cases, if you leave out the prefix, the compiler can still determine the target an attribute applies to, as shown in the previous example. In some cases, the prefix must be specified to make your intentions clear to the compiler. The prefixes shown in italics in the following code are mandatory.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">SomeAttr</span></span><span class="token punctuation">]</span> <span class="token comment">// Applied to assembly </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>module<span class="token punctuation">:</span> SomeAttr<span class="token punctuation">]</span> <span class="token comment">// Applied to module </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>type<span class="token punctuation">:</span> SomeAttr<span class="token punctuation">]</span> <span class="token comment">// Applied to type </span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">SomeType<span class="token punctuation">&lt;</span><span class="token punctuation">[</span>typevar<span class="token punctuation">:</span> SomeAttr<span class="token punctuation">]</span> T<span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span> <span class="token comment">// Applied to generic type variable</span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token punctuation">[</span>field<span class="token punctuation">:</span> SomeAttr<span class="token punctuation">]</span> <span class="token comment">// Applied to field </span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token keyword">public</span> <span class="token class-name">Int32</span> SomeField <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">return</span><span class="token punctuation">:</span> <span class="token class-name">SomeAttr</span></span><span class="token punctuation">]</span> <span class="token comment">// Applied to return value </span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token punctuation">[</span>method<span class="token punctuation">:</span> SomeAttr<span class="token punctuation">]</span> <span class="token comment">// Applied to method </span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name">Int32</span> <span class="token function">SomeMethod</span><span class="token punctuation">(</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">param</span><span class="token punctuation">:</span> <span class="token class-name">SomeAttr</span></span><span class="token punctuation">]</span> <span class="token comment">// Applied to parameter </span></pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token class-name">Int32</span> SomeParam<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> SomeParam<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">property</span><span class="token punctuation">:</span> <span class="token class-name">SomeAttr</span></span><span class="token punctuation">]</span> <span class="token comment">// Applied to property </span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name">String</span> SomeProp <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">method</span><span class="token punctuation">:</span> <span class="token class-name">SomeAttr</span></span><span class="token punctuation">]</span> <span class="token comment">// Applied to get accessor method </span></pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token keyword">get</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">event</span><span class="token punctuation">:</span> <span class="token class-name">SomeAttr</span></span><span class="token punctuation">]</span> <span class="token comment">// Applied to event </span></pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token punctuation">[</span>field<span class="token punctuation">:</span> SomeAttr<span class="token punctuation">]</span> <span class="token comment">// Applied to compiler-generated field </span></pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token punctuation">[</span>method<span class="token punctuation">:</span> SomeAttr<span class="token punctuation">]</span> <span class="token comment">// Applied to compiler-generated add &amp; remove methods </span></pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">event</span> <span class="token class-name">EventHandler</span> SomeEvent<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Now that you know how to apply a custom attribute, letâ€™s find out what an attribute really is. A custom attribute is simply an instance of a type. For Common Language Specification (CLS) compliance, custom attribute classes must be derived, directly or indirectly, from the public abstract System.Attribute class. C# allows only CLS-compliant attributes. By examining the .NET Framework SDK documentation, youâ€™ll see that the following classes (from the earlier example) are defined: StructLayoutAttribute, MarshalAsAttribute, DllImportAttribute, InAttribute, and OutAttribute. All of these classes happen to be defined in the System.Runtime.InteropServices namespace, but attribute classes can be defined in any namespace. Upon further examination, youâ€™ll notice that all of these classes are derived from System.Attribute, as all CLS-compliant attribute classes must be.</p></blockquote><p>ğŸ’¡æ³¨æ„ï¼šå°†ç‰¹æ€§åº”ç”¨äºæºä»£ç ä¸­çš„ç›®æ ‡å…ƒç´ æ—¶ï¼ŒC# ç¼–è¯‘å™¨å…è®¸çœç•¥ <code>Attribute</code> åç¼€ä»¥å‡å°‘æ‰“å­—é‡ï¼Œå¹¶æå‡æºä»£ç çš„å¯è¯»æ€§ã€‚æœ¬ç« è®¸å¤šç¤ºä¾‹ä»£ç éƒ½åˆ©ç”¨äº† C# æä¾›çš„è¿™ä¸€ä¾¿åˆ©ã€‚ä¾‹å¦‚ï¼Œè®¸å¤šæºä»£ç ç”¨çš„éƒ½æ˜¯ <code>[DllImport(...)]</code> ï¼Œè€Œä¸æ˜¯ <code>[DllImportAttribute(...)]</code> ã€‚</p><blockquote><p>As I mentioned earlier, an attribute is an instance of a class. The class must have a public constructor so that instances of it can be created. So when you apply an attribute to a target, the syntax is similar to that for calling one of the classâ€™s instance constructors. In addition, a language might permit some special syntax to allow you to set any public fields or properties associated with the attribute class. Letâ€™s look at an example. Recall the application of the DllImport attribute as it was applied to the GetVersionEx method earlier.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DllImport</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Kernel32"</span><span class="token punctuation">,</span> CharSet <span class="token operator">=</span> CharSet<span class="token punctuation">.</span>Auto<span class="token punctuation">,</span> SetLastError <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span></pre></td></tr></table></figure><blockquote><p>The syntax of this line should look pretty strange to you because you could never use syntax like this when calling a constructor. If you examine the DllImportAttribute class in the documentation, youâ€™ll see that its constructor requires a single String parameter. In this example, &quot;Kernel32&quot; is being passed for this parameter. A constructorâ€™s parameters are called positional parameters and are mandatory; the parameter must be specified when the attribute is applied.</p></blockquote><blockquote><p>What are the other two â€œparametersâ€? This special syntax allows you to set any public fields or properties of the DllImportAttribute object after the object is constructed. In this example, when the DllImportAttribute object is constructed and &quot;Kernel32&quot; is passed to the constructor, the objectâ€™s public instance fields, CharSet and SetLastError, are set to CharSet.Auto and true, respectively. The â€œparametersâ€ that set fields or properties are called named parameters and are optional because the parameters donâ€™t have to be specified when youâ€™re applying an instance of the attribute. A little later on, Iâ€™ll explain what causes an instance of the DllImportAttribute class to actually be constructed.</p></blockquote><blockquote><p>Also note that itâ€™s possible to apply multiple attributes to a single target. For example, in this chapterâ€™s first program listing, the GetVersionEx methodâ€™s ver parameter has both the In and Out attributes applied to it. When applying multiple attributes to a single target, be aware that the order of attributes has no significance. Also, in C#, each attribute can be enclosed in square brackets, or multiple attributes can be comma-separated within a single set of square brackets. If the attribute classâ€™s constructor takes no parameters, the parentheses are optional. Finally, as mentioned earlier, the Attribute suffix is also optional. The following lines behave identically and demonstrate all of the possible ways of applying multiple attributes.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Serializable</span></span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Flags</span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Serializable</span><span class="token punctuation">,</span> <span class="token class-name">Flags</span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FlagsAttribute</span><span class="token punctuation">,</span> <span class="token class-name">SerializableAttribute</span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FlagsAttribute</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Serializable</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>ğŸ’¡å°ç»“ï¼šåˆ©ç”¨å®šåˆ¶ç‰¹æ€§ï¼ˆcustom attributeï¼‰ï¼Œå¯å®£å‘Šå¼åœ°ä¸ºè‡ªå·±çš„ä»£ç æ„é€ æ·»åŠ æ³¨è§£æ¥å®ç°ç‰¹æ®ŠåŠŸèƒ½ã€‚å®šåˆ¶ç‰¹æ€§å…è®¸ä¸ºå‡ ä¹æ¯ä¸€ä¸ªå…ƒæ•°æ®è®°å½•é¡¹å®šä¹‰å’Œåº”ç”¨ä¿¡æ¯ã€‚è¿™ç§å¯æ‰©å±•çš„å…ƒæ•°æ®ä¿¡æ¯èƒ½åœ¨è¿è¡Œæ—¶æŸ¥è¯¢ï¼Œä»è€ŒåŠ¨æ€æ”¹å˜ä»£ç çš„æ‰§è¡Œæ–¹å¼ã€‚å…³äºè‡ªå®šä¹‰ç‰¹æ€§ï¼Œé¦–å…ˆè¦çŸ¥é“å®ƒä»¬åªæ˜¯å°†ä¸€äº›é™„åŠ ä¿¡æ¯ä¸æŸä¸ªç›®æ ‡å…ƒç´ å…³è”èµ·æ¥çš„æ–¹å¼ã€‚ç¼–è¯‘å™¨åœ¨æ‰˜ç®¡æ¨¡å—çš„å…ƒæ•°æ®ä¸­ç”Ÿæˆï¼ˆåµŒå…¥ï¼‰è¿™äº›é¢å¤–çš„ä¿¡æ¯ã€‚å¤§å¤šæ•°ç‰¹æ€§å¯¹ç¼–è¯‘å™¨æ¥è¯´æ²¡æœ‰æ„ä¹‰ï¼šç¼–è¯‘å™¨åªæ˜¯æœºæ¢°åœ°æ£€æµ‹æºä»£ç ä¸­çš„ç‰¹æ€§ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„å…ƒæ•°æ®ã€‚æ¯ç§ç¼–ç¨‹è¯­è¨€éƒ½å®šä¹‰äº†å°†å®šåˆ¶ç‰¹æ€§åº”ç”¨äºç›®æ ‡å…ƒç´ æ‰€é‡‡ç”¨çš„è¯­æ³•ã€‚ä¾‹å¦‚ï¼ŒMicrosoft Visual Basic .NET è¦æ±‚ä½¿ç”¨ä¸€å¯¹å°–æ‹¬å·ï¼ˆ&lt;&gt;ï¼‰è€Œä¸æ˜¯æ–¹æ‹¬å·ã€‚CLR å…è®¸å°†ç‰¹æ€§åº”ç”¨äºå¯åœ¨æ–‡ä»¶çš„å…ƒæ•°æ®ä¸­è¡¨ç¤ºçš„å‡ ä¹ä»»ä½•ä¸œè¥¿ã€‚æ›´å…·ä½“åœ°è¯´ï¼ŒC# åªå…è®¸å°†ç‰¹æ€§åº”ç”¨äºå®šä¹‰ä»¥ä¸‹ä»»ä½•ç›®æ ‡å…ƒç´ çš„æºä»£ç ï¼šç¨‹åºé›†ã€æ¨¡å—ã€ç±»å‹ï¼ˆç±»ã€ç»“æ„ã€æ¥å£ã€å§”æ‰˜ï¼‰ã€å­—æ®µã€æ–¹æ³•ï¼ˆå«æ„é€ å™¨ï¼‰ã€æ–¹æ³•å‚æ•°ã€æ–¹æ³•è¿”å›å€¼ã€å±æ€§ã€äº‹ä»¶å’Œæ³›å‹ç±»å‹å‚æ•°ã€‚åº”ç”¨ç‰¹æ€§æ—¶ï¼ŒC# å…è®¸ç”¨ä¸€ä¸ªå‰ç¼€æ˜ç¡®æŒ‡å®šç‰¹æ€§è¦åº”ç”¨äºçš„ç›®æ ‡å…ƒç´ ã€‚è®¸å¤šæ—¶å€™ï¼Œå³ä½¿çœç•¥å‰ç¼€ï¼Œç¼–è¯‘å™¨ä¹Ÿèƒ½åˆ¤æ–­ç‰¹æ€§è¦åº”ç”¨äºä»€ä¹ˆç›®æ ‡å…ƒç´ ã€‚ä½†åœ¨å…¶ä»–æ—¶å€™ï¼Œå¿…é¡»æŒ‡å®šå‰ç¼€å‘ç¼–è¯‘å™¨æ¸…æ¥šè¡¨æ˜æˆ‘ä»¬çš„æ„å›¾ã€‚å®šåˆ¶ç‰¹æ€§å…¶å®æ˜¯ä¸€ä¸ªç±»å‹çš„å®ä¾‹ã€‚ä¸ºäº†ç¬¦åˆ â€œå…¬å…±è¯­è¨€è§„èŒƒâ€ï¼ˆCLSï¼‰çš„è¦æ±‚ï¼Œå®šåˆ¶ç‰¹æ€§ç±»å¿…é¡»ç›´æ¥æˆ–é—´æ¥ä»å…¬å…±æŠ½è±¡ç±» <code>System.Attribute</code> æ´¾ç”Ÿã€‚C# åªå…è®¸ç¬¦åˆ CLS è§„èŒƒçš„ç‰¹æ€§ã€‚å¦‚å‰æ‰€è¿°ï¼Œç‰¹æ€§æ˜¯ç±»çš„å®ä¾‹ã€‚ç±»å¿…é¡»æœ‰å…¬å…±æ„é€ å™¨æ‰èƒ½åˆ›å»ºå®ƒçš„å®ä¾‹ã€‚æ‰€ä»¥ï¼Œå°†ç‰¹æ€§åº”ç”¨äºç›®æ ‡å…ƒç´ æ—¶ï¼Œè¯­æ³•ç±»ä¼¼äºè°ƒç”¨ç±»çš„æŸä¸ªå®ä¾‹æ„é€ å™¨ã€‚æ„é€ å™¨çš„å‚æ•°ç§°ä¸ºå®šä½å‚æ•°ï¼ˆpositional parameterï¼‰ï¼Œè€Œä¸”æ˜¯å¼ºåˆ¶æ€§çš„ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œåº”ç”¨ç‰¹æ€§æ—¶å¿…é¡»æŒ‡å®šå‚æ•°ã€‚ç”¨äºè®¾ç½®å­—æ®µæˆ–å±æ€§çš„ â€œå‚æ•°â€ ç§°ä¸ºå‘½åå‚æ•°ï¼ˆnamed parameterï¼‰ã€‚è¿™ç§å‚æ•°æ˜¯å¯é€‰çš„ï¼Œå› ä¸ºåœ¨åº”ç”¨ç‰¹æ€§çš„å®ä¾‹æ—¶ä¸ä¸€å®šè¦æŒ‡å®šå‚æ•°ã€‚å°†å¤šä¸ªç‰¹æ€§åº”ç”¨äºå•ä¸ªç›®æ ‡å…ƒç´ æ—¶ï¼Œæ³¨æ„ç‰¹æ€§çš„é¡ºåºæ— å…³ç´§è¦ã€‚å¦å¤–ï¼Œåœ¨ C# ä¸­ï¼Œæ—¢å¯å°†æ¯ä¸ªç‰¹æ€§éƒ½å°é—­åˆ°ä¸€å¯¹æ–¹æ‹¬å·ä¸­ï¼Œä¹Ÿå¯åœ¨ä¸€å¯¹æ–¹æ‹¬å·ä¸­å°é—­å¤šä¸ªä»¥é€—å·åˆ†éš”çš„ç‰¹æ€§ã€‚å¦‚æœç‰¹æ€§ç±»çš„æ„é€ å™¨ä¸è·å–å‚æ•°ï¼Œé‚£ä¹ˆåœ†æ‹¬å·å¯ä»¥çœç•¥ã€‚æœ€åï¼Œ <code>Attribute</code> åç¼€ä¹Ÿæ˜¯å¯é€‰çš„ã€‚</p><h2 id="defining-your-own-attribute-class"><a class="anchor" href="#defining-your-own-attribute-class">#</a> Defining Your Own Attribute Class</h2><blockquote><p>You know that an attribute is an instance of a class derived from System.Attribute, and you also know how to apply an attribute. Letâ€™s now look at how to define your own custom attribute classes. Say youâ€™re the Microsoft employee responsible for adding the bit flag support to enumerated types. To accomplish this, the first thing you have to do is define a FlagsAttribute class.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">namespace</span> <span class="token namespace">System</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlagsAttribute</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Attribute</span></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token function">FlagsAttribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Notice that the FlagsAttribute class inherits from Attribute; this is what makes the FlagsAttribute class a CLS-compliant custom attribute. In addition, the classâ€™s name has a suffix of Attribute; this follows the standard convention but is not mandatory. Finally, all non-abstract attributes must contain at least one public constructor. The simple FlagsAttribute constructor takes no parameters and does absolutely nothing.</p></blockquote><p>ğŸ’¡é‡è¦æç¤ºï¼šåº”å°†ç‰¹æ€§æƒ³åƒæˆé€»è¾‘çŠ¶æ€å®¹å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶ç‰¹æ€§ç±»å‹æ˜¯ä¸€ä¸ªç±»ï¼Œä½†è¿™ä¸ªç±»åº”è¯¥å¾ˆç®€å•ã€‚åº”è¯¥åªæä¾›ä¸€ä¸ªå…¬å…±æ„é€ å™¨æ¥æ¥å—ç‰¹æ€§çš„å¼ºåˆ¶æ€§ (æˆ–å®šä½æ€§) çŠ¶æ€ä¿¡æ¯ï¼Œè€Œä¸”è¿™ä¸ªç±»å¯ä»¥æä¾›å…¬å…±å­—æ®µå’Œå±æ€§ï¼Œä»¥æ¥å—ç‰¹æ€§çš„å¯é€‰ (æˆ–å‘½å) çŠ¶æ€ä¿¡æ¯ã€‚ç±»ä¸åº”æä¾›ä»»ä½•å…¬å…±æ–¹æ³•ã€äº‹ä»¶æˆ–å…¶ä»–æˆå‘˜ã€‚</p><p>æˆ‘é€šå¸¸ä¸é¼“åŠ±ä½¿ç”¨å…¬å…±å­—æ®µã€‚ç‰¹æ€§ä¹Ÿä¸ä¾‹å¤–ï¼Œæˆ‘åŒæ ·ä¸é¼“åŠ±åœ¨è¿™ç§ç±»å‹ä¸­ä½¿ç”¨å…¬å…±å­—æ®µã€‚ä½¿ç”¨å±æ€§è¦å¥½å¾—å¤šã€‚å› ä¸ºåœ¨æ›´æ”¹ç‰¹æ€§ç±»çš„å®ç°æ–¹å¼æ—¶ï¼Œå±æ€§èƒ½æä¾›æ›´å¤§çš„çµæ´»æ€§ã€‚</p><blockquote><p>So far, instances of the <code>FlagsAttribute</code> class can be applied to any target, but this attribute should really be applied to enumerated types only. It doesnâ€™t make sense to apply the attribute to a property or a method. To tell the compiler where this attribute can legally be applied, you apply an instance of the <code>System.AttributeUsageAttribute</code> class to the attribute class. Hereâ€™s the new code.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">namespace</span> <span class="token namespace">System</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AttributeUsage</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AttributeTargets<span class="token punctuation">.</span>Enum<span class="token punctuation">,</span> Inherited <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FlagsAttribute</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Attribute</span></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">public</span> <span class="token function">FlagsAttribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>In this new version, Iâ€™ve applied an instance of <code>AttributeUsageAttribute</code> to the attribute. After all, the attribute type is just a class, and a class can have attributes applied to it. The <code>AttributeUsage</code> attribute is a simple class that allows you to specify to a compiler where your custom attribute can legally be applied. All compilers have built-in support for this attribute and generate errors when a user-defined custom attribute is applied to an invalid target. In this example, the <code>AttributeUsage</code> attribute specifies that instances of the Flags attribute can be applied only to enumerated type targets.</p></blockquote><blockquote><p>Because all attributes are just types, you can easily understand the <code>AttributeUsageAttribute</code> class. Hereâ€™s what the FCL source code for the class looks like.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Serializable</span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AttributeUsage</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AttributeTargets<span class="token punctuation">.</span>Class<span class="token punctuation">,</span> Inherited<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">AttributeUsageAttribute</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">internal</span> <span class="token keyword">static</span> <span class="token class-name">AttributeUsageAttribute</span> Default <span class="token operator">=</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AttributeUsageAttribute</span><span class="token punctuation">(</span>AttributeTargets<span class="token punctuation">.</span>All<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token keyword">internal</span> <span class="token class-name">Boolean</span> m_allowMultiple <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token keyword">internal</span> <span class="token class-name">AttributeTargets</span> m_attributeTarget <span class="token operator">=</span> AttributeTargets<span class="token punctuation">.</span>All<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token keyword">internal</span> <span class="token class-name">Boolean</span> m_inherited <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token comment">// This is the one public constructor </span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">public</span> <span class="token function">AttributeUsageAttribute</span><span class="token punctuation">(</span><span class="token class-name">AttributeTargets</span> validOn<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> m_attributeTarget <span class="token operator">=</span> validOn<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token keyword">internal</span> <span class="token function">AttributeUsageAttribute</span><span class="token punctuation">(</span><span class="token class-name">AttributeTargets</span> validOn<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token class-name">Boolean</span> allowMultiple<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> inherited<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> m_attributeTarget <span class="token operator">=</span> validOn<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre> m_allowMultiple <span class="token operator">=</span> allowMultiple<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> m_inherited <span class="token operator">=</span> inherited<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name">Boolean</span> AllowMultiple <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token keyword">get</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> m_allowMultiple<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token keyword">set</span> <span class="token punctuation">&#123;</span> m_allowMultiple <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name">Boolean</span> Inherited <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token keyword">get</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> m_inherited<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token keyword">set</span> <span class="token punctuation">&#123;</span> m_inherited <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name">AttributeTargets</span> ValidOn <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token keyword">get</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> m_attributeTarget<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>As you can see, the <code>AttributeUsageAttribute</code> class has a public constructor that allows you to pass bit flags that indicate where your attribute can legally be applied. The <code>System.AttributeTargets</code> enumerated type is defined in the FCL as follows.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Flags</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">AttributeTargets</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> Assembly <span class="token operator">=</span> <span class="token number">0x0001</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> Module <span class="token operator">=</span> <span class="token number">0x0002</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> Class <span class="token operator">=</span> <span class="token number">0x0004</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> Struct <span class="token operator">=</span> <span class="token number">0x0008</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> Enum <span class="token operator">=</span> <span class="token number">0x0010</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> Constructor <span class="token operator">=</span> <span class="token number">0x0020</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> Method <span class="token operator">=</span> <span class="token number">0x0040</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> Property <span class="token operator">=</span> <span class="token number">0x0080</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> Field <span class="token operator">=</span> <span class="token number">0x0100</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> Event <span class="token operator">=</span> <span class="token number">0x0200</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> Interface <span class="token operator">=</span> <span class="token number">0x0400</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> Parameter <span class="token operator">=</span> <span class="token number">0x0800</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> Delegate <span class="token operator">=</span> <span class="token number">0x1000</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="16"></td><td><pre> ReturnValue <span class="token operator">=</span> <span class="token number">0x2000</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> GenericParameter <span class="token operator">=</span> <span class="token number">0x4000</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> All <span class="token operator">=</span> Assembly <span class="token operator">|</span> Module <span class="token operator">|</span> Class <span class="token operator">|</span> Struct <span class="token operator">|</span> Enum <span class="token operator">|</span> </pre></td></tr><tr><td data-num="19"></td><td><pre> Constructor <span class="token operator">|</span> Method <span class="token operator">|</span> Property <span class="token operator">|</span> Field <span class="token operator">|</span> Event <span class="token operator">|</span> </pre></td></tr><tr><td data-num="20"></td><td><pre> Interface <span class="token operator">|</span> Parameter <span class="token operator">|</span> Delegate <span class="token operator">|</span> ReturnValue <span class="token operator">|</span> </pre></td></tr><tr><td data-num="21"></td><td><pre> GenericParameter </pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>The <code>AttributeUsageAttribute</code> class offers two additional public properties that can optionally be set when the attribute is applied to an attribute class: <code>AllowMultiple</code> and <code>Inherited</code> .</p></blockquote><blockquote><p>For most attributes, it makes no sense to apply them to a single target more than once. For example, nothing is gained by applying the Flags or Serializable attributes more than once to a single target. In fact, if you tried to compile the following code, the compiler would report the following message: error CS0579: Duplicate 'Flags' attribute.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Flags</span></span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Flags</span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">enum</span> <span class="token class-name">Color</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> Red </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>For a few attributes, however, it does make sense to apply the attribute multiple times to a single target. In the FCL, the <code>ConditionalAttribute</code> attribute class allows multiple instances of itself to be applied to a single target. If you donâ€™t explicitly set <code>AllowMultiple</code> to true, your attribute can be applied no more than once to a selected target.</p></blockquote><blockquote><p><code>AttributeUsageAttribute</code> â€™s other property, Inherited, indicates if the attribute should be applied to derived classes and overriding methods when applied on the base class. The following code demonstrates what it means for an attribute to be inherited.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AttributeUsage</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AttributeTargets<span class="token punctuation">.</span>Class <span class="token operator">|</span> AttributeTargets<span class="token punctuation">.</span>Method<span class="token punctuation">,</span> Inherited<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">TastyAttribute</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Tasty</span></span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Serializable</span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">BaseType</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Tasty</span></span><span class="token punctuation">]</span> <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">DerivedType</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">BaseType</span></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>In this code, <code>DerivedType</code> and its DoSomething method are both considered Tasty because the <code>TastyAttribute</code> class is marked as inherited. However, <code>DerivedType</code> is not serializable because the FCLâ€™s <code>SerializableAttribute</code> class is marked as a noninherited attribute.</p></blockquote><blockquote><p>Be aware that the .NET Framework considers targets only of classes, methods, properties, events, fields, method return values, and parameters to be inheritable. So when youâ€™re defining an attribute type, you should set Inherited to true only if your targets include any of these targets. Note that inherited attributes do not cause additional metadata to be emitted for the derived types into the managed module. Iâ€™ll say more about this a little later in the â€œDetecting the Use of a Custom Attributeâ€ section.</p></blockquote><p>ğŸ’¡æ³¨æ„ï¼šå®šä¹‰è‡ªå·±çš„ç‰¹æ€§ç±»æ—¶ï¼Œå¦‚æœå¿˜è®°å‘è‡ªå·±çš„ç±»åº”ç”¨ <code>AttributeUsage</code> ç‰¹æ€§ï¼Œç¼–è¯‘å™¨å’Œ CLR å°†å‡å®šè¯¥ç‰¹æ€§èƒ½åº”ç”¨äºæ‰€æœ‰ç›®æ ‡å…ƒç´ ï¼Œå‘æ¯ä¸ªç›®æ ‡å…ƒç´ éƒ½åªèƒ½åº”ç”¨ä¸€æ¬¡ï¼Œè€Œä¸”å¯ç»§æ‰¿ã€‚è¿™äº›å‡å®šæ¨¡ä»¿äº† <code>AttributeUsageAttribute</code> ç±»ä¸­çš„é»˜è®¤å­—æ®µå€¼ã€‚</p><p>ğŸ’¡å°ç»“ï¼šä¸ºäº†å‘Šè¯‰ç¼–è¯‘å™¨è‡ªå®šä¹‰ç‰¹æ€§çš„åˆæ³•åº”ç”¨èŒƒå›´ï¼Œéœ€è¦å‘ç‰¹æ€§ç±»åº”ç”¨ <code>System.AttributeUsageAttribute</code> ç±»çš„å®ä¾‹ã€‚ <code>AttributeUsage</code> ç‰¹æ€§æ˜¯ä¸€ä¸ªç®€å•çš„ç±»ï¼Œå¯åˆ©ç”¨å®ƒå‘Šè¯‰ç¼–è¯‘å™¨å®šåˆ¶ç‰¹æ€§çš„åˆæ³•åº”ç”¨èŒƒå›´ã€‚æ‰€æœ‰ç¼–è¯‘å™¨éƒ½å†…å»ºäº†å¯¹è¯¥ç‰¹æ€§çš„æ”¯æŒï¼Œå¹¶ä¼šåœ¨å®šåˆ¶ç‰¹æ€§åº”ç”¨äºæ— æ•ˆç›®æ ‡æ—¶æŠ¥é”™ã€‚å¤§å¤šæ•°ç‰¹æ€§å¤šæ¬¡åº”ç”¨äºåŒä¸€ä¸ªç›®æ ‡æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ä½†å°‘æ•°å‡ ä¸ªç‰¹æ€§ç¡®å®æœ‰å¿…è¦å¤šæ¬¡åº”ç”¨äºåŒä¸€ä¸ªç›®æ ‡ã€‚FCL ç‰¹æ€§ç±» <code>ConditionalAttribute</code> å…è®¸å°†å®ƒçš„å¤šä¸ªå®ä¾‹åº”ç”¨äºåŒä¸€ä¸ªç›®æ ‡å…ƒç´ ã€‚ä¸å°† <code>AllowMultiple</code> æ˜ç¡®è®¾ä¸º trueï¼Œç‰¹æ€§å°±åªèƒ½å‘é€‰å®šçš„ç›®æ ‡å…ƒç´ åº”ç”¨ä¸€æ¬¡ã€‚ <code>AttributeUsageAttribute</code> çš„å¦ä¸€ä¸ªå±æ€§æ˜¯ <code>Inherited</code> ï¼Œå®ƒæŒ‡å‡ºç‰¹æ€§åœ¨åº”ç”¨äºåŸºç±»æ—¶ï¼Œæ˜¯å¦åŒæ—¶åº”ç”¨äºæ´¾ç”Ÿç±»å’Œé‡å†™çš„æ–¹æ³•ã€‚.NET Framework åªè®¤ä¸ºç±»ã€æ–¹æ³•ã€å±æ€§ã€äº‹ä»¶ã€å­—æ®µã€æ–¹æ³•è¿”å›å€¼å’Œå‚æ•°ç­‰ç›®æ ‡å…ƒç´ æ˜¯å¯ç»§æ‰¿çš„ã€‚æ‰€ä»¥ï¼Œå®šä¹‰ç‰¹æ€§ç±»å‹æ—¶ï¼Œåªæœ‰åœ¨è¯¥ç‰¹æ€§åº”ç”¨äºä¸Šè¿°æŸä¸ªç›®æ ‡çš„å‰æä¸‹ï¼Œæ‰åº”è¯¥å°† <code>Inherited</code> è®¾ä¸º trueã€‚æ³¨æ„ï¼Œå¯ç»§æ‰¿ç‰¹æ€§ä¸ä¼šé€ æˆåœ¨æ‰˜ç®¡æ¨¡å—ä¸­ä¸ºæ´¾ç”Ÿç±»å‹ç”Ÿæˆé¢å¤–çš„å…ƒæ•°æ®ã€‚</p><h2 id="attribute-constructor-and-fieldproperty-data-types"><a class="anchor" href="#attribute-constructor-and-fieldproperty-data-types">#</a> Attribute Constructor and Field/Property Data Types</h2><blockquote><p>When defining your own custom attribute class, you can define its constructor to take parameters that must be specified by developers when they apply an instance of your attribute type. In addition, you can define nonstatic public fields and properties in your type that identify settings that a developer can optionally choose for an instance of your attribute class.</p></blockquote><blockquote><p>When defining an attribute classâ€™s instance constructor, fields, and properties, you must restrict yourself to a small subset of data types. Specifically, the legal set of data types is limited to the following: Boolean, Char, Byte, SByte, Int16, UInt16, Int32, UInt32, Int64, UInt64, Single, Double, String, Type, Object, or an enumerated type. In addition, you can use a single-dimensional, zero-based array of any of these types. However, you should avoid using arrays because a custom attribute class whose constructor takes an array is not CLS-compliant.</p></blockquote><blockquote><p>When applying an attribute, you must pass a compile-time constant expression that matches the type defined by the attribute class. Wherever the attribute class defines a Type parameter, Type field, or Type property, you must use C#â€™s typeof operator, as shown in the following code. Wherever the attribute class defines an Object parameter, Object field, or Object property, you can pass an Int32, String, or any other constant expression (including null). If the constant expression represents a value type, the value type will be boxed at run time when an instance of the attribute is constructed.</p></blockquote><blockquote><p>Hereâ€™s an example of an attribute and its usage.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">enum</span> <span class="token class-name">Color</span> <span class="token punctuation">&#123;</span> Red <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AttributeUsage</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AttributeTargets<span class="token punctuation">.</span>All<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">SomeAttribute</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">public</span> <span class="token function">SomeAttribute</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">Type<span class="token punctuation">[</span><span class="token punctuation">]</span></span> types<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token comment">// 'name' refers to a String </span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token comment">// 'o' refers to one of the legal types (boxing if necessary) </span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token comment">// 'types' refers to a 1-dimension, 0-based array of Types </span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Some</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Jeff"</span><span class="token punctuation">,</span> Color<span class="token punctuation">.</span>Red<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Type<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Math</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Console</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">SomeType</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Logically, when a compiler detects a custom attribute applied to a target, the compiler constructs an instance of the attribute class by calling its constructor, passing it any specified parameters. Then the compiler initializes any public fields and properties by using the values specified via the enhanced constructor syntax. Now that the custom attribute object is initialized, the compiler serializes the attribute objectâ€™s state out to the targetâ€™s metadata table entry.</p></blockquote><p>ğŸ’¡é‡è¦æç¤ºï¼šä¸ºæ–¹ä¾¿ç†è§£ï¼Œå¯ä»¥è¿™æ ·æƒ³è±¡å®šåˆ¶ç‰¹æ€§ï¼šå®ƒæ˜¯ç±»çš„å®ä¾‹ï¼Œè¢«åºåˆ—åŒ–æˆé©»ç•™åœ¨å…ƒæ•°æ®ä¸­çš„å­—èŠ‚æµã€‚è¿è¡Œæ—¶å¯å¯¹å…ƒæ•°æ®ä¸­çš„å­—èŠ‚è¿›è¡Œååºåˆ—åŒ–ï¼Œä»è€Œæ„é€ å‡ºç±»çš„å®ä¾‹ã€‚å®é™…å‘ç”Ÿçš„äº‹æƒ…æ˜¯ï¼šç¼–è¯‘å™¨åœ¨å…ƒæ•°æ®ä¸­ç”Ÿæˆåˆ›å»ºç‰¹æ€§ç±»çš„å®ä¾‹æ‰€éœ€çš„ä¿¡æ¯ã€‚æ¯ä¸ªæ„é€ å™¨å‚æ•°éƒ½ä¼š 1 å­—èŠ‚çš„ç±»å‹ IDï¼Œåè·Ÿå…·ä½“çš„å€¼ã€‚å¯¹æ„é€ å™¨çš„å‚æ•°è¿›è¡Œ â€œåºåˆ—åŒ–â€ æ—¶ï¼Œç¼–è¯‘å™¨å…ˆå†™å…¥å­—æ®µ / å±æ€§åç§°ï¼Œå†è·Ÿä¸Š 1 å­—èŠ‚çš„ç±»å‹ IDï¼Œæœ€åæ˜¯å…·ä½“çš„å€¼ã€‚å¦‚æœæ˜¯æ•°ç»„ï¼Œåˆ™ä¼šå…ˆä¿å­˜æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ï¼Œå†è·Ÿä¸Šæ¯ä¸ªå•ç‹¬çš„å…ƒç´ ã€‚</p><p>ğŸ’¡å°ç»“ï¼šå®šä¹‰ç‰¹æ€§ç±»çš„å®ä¾‹æ„é€ å™¨ã€å­—æ®µå’Œå±æ€§æ—¶ï¼Œå¯ä¾›é€‰æ‹©çš„æ•°æ®ç±»å‹å¹¶ä¸å¤šã€‚å…·ä½“åœ°è¯´ï¼Œåªå…è®¸ <code>Boolean</code> ï¼Œ <code>Char</code> ï¼Œ <code>Byte</code> ï¼Œ <code>SByte</code> ï¼Œ <code>Int16</code> ï¼Œ <code>UInt16</code> ï¼Œ <code>Int32</code> ï¼Œ <code>UInt32</code> ï¼Œ <code>Int64</code> ï¼Œ <code>UInt64</code> ï¼Œ <code>Single</code> ï¼Œ <code>Double</code> ï¼Œ <code>String</code> ï¼Œ <code>Type</code> ï¼Œ <code>Object</code> æˆ–æšä¸¾ç±»å‹ã€‚æ­¤å¤–ï¼Œå¯ä½¿ç”¨ä¸Šè¿°ä»»æ„ç±»å‹çš„ä¸€ç»´ 0 åŸºæ•°ç»„ã€‚ä½†åº”å°½é‡é¿å…ä½¿ç”¨æ•°ç»„ï¼Œå› ä¸ºå¯¹äºå®šåˆ¶ç‰¹æ€§ï¼Œå¦‚æœå®ƒçš„æ„é€ å™¨è¦è·å–æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå°±ä¼šå¤±å»ä¸ CLS çš„ç›¸å®¹æ€§ã€‚æ„é€ å¹¶åˆå§‹åŒ–å¥½å®šåˆ¶ç‰¹æ€§ç±»çš„å¯¹è±¡ä¹‹åï¼Œç¼–è¯‘å™¨å°†å®ƒçš„çŠ¶æ€åºåˆ—åŒ–åˆ°ç›®æ ‡å…ƒç´ çš„å…ƒæ•°æ®è¡¨è®°å½•é¡¹ä¸­ã€‚</p><h2 id="detecting-the-use-of-a-custom-attribute"><a class="anchor" href="#detecting-the-use-of-a-custom-attribute">#</a> Detecting the Use of a Custom Attribute</h2><blockquote><p>Defining an attribute class is useless by itself. Sure, you could define attribute classes all you want and apply instances of them all you want, but this would just cause additional metadata to be written out to the assemblyâ€”the behavior of your application code wouldnâ€™t change.</p></blockquote><blockquote><p>In Chapter 15, â€œEnumerated Types and Bit Flags,â€ you saw that applying the Flags attribute to an enumerated type altered the behavior of <code>System.Enum</code> â€™s <code>ToString</code> and Format methods. The reason that these methods behave differently is that they check at run time if the enumerated type that theyâ€™re operating on has the Flags attribute metadata associated with it. Code can look for the presence of attributes by using a technology called reflection. Iâ€™ll give some brief demonstrations of reflection here, but Iâ€™ll discuss it fully in Chapter 23, â€œAssembly Loading and Reflection.â€</p></blockquote><blockquote><p>If you were the Microsoft employee responsible for implementing <code>Enum</code> â€™s Format method, you would implement it like the following.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">String</span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token comment">// Does the enumerated type have an instance of </span></pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token comment">// the FlagsAttribute type applied to it? </span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">IsDefined</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">FlagsAttribute</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token comment">// Yes; execute code treating value as a bit flag enumerated type. </span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token range operator">..</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token comment">// No; execute code treating value as a normal enumerated type. </span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token range operator">..</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token range operator">..</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>This code calls Typeâ€™s <code>IsDefined</code> method, effectively asking the system to look up the metadata for the enumerated type and see whether an instance of the <code>FlagsAttribute</code> class is associated with it. If <code>IsDefined</code> returns true, an instance of <code>FlagsAttribute</code> is associated with the enumerated type, and the Format method knows to treat the value as though it contained a set of bit flags. If <code>IsDefined</code> returns false, Format treats the value as a normal enumerated type.</p></blockquote><blockquote><p>So if you define your own attribute classes, you must also implement some code that checks for the existence of an instance of your attribute class (on some target) and then execute some alternate code path. This is what makes custom attributes so useful!</p></blockquote><blockquote><p>The FCL offers many ways to check for the existence of an attribute. If youâ€™re checking for the existence of an attribute via a <code>System.Type</code> object, you can use the <code>IsDefined</code> method as shown earlier. However, sometimes you want to check for an attribute on a target other than a type, such as an assembly, a module, or a method. For this discussion, letâ€™s concentrate on the extension methods defined by the <code>System.Reflection.CustomAttributeExtensions</code> class. This class defines three static methods for retrieving the attributes associated with a target: <code>IsDefined</code> , <code>GetCustomAttributes</code> , and <code>GetCustomAttribute</code> . Each of these functions has several overloaded versions. For example, each method has a version that works on type members (classes, structs, enums, interfaces, delegates, constructors, methods, properties, fields, events, and return types), parameters, and assemblies. There are also versions that allow you to tell the system to walk up the derivation hierarchy to include inherited attributes in the results. Table 18-1 briefly describes what each method does.</p></blockquote><p><img data-src="/2022/11/22/csharp/clr-via-csharp/Chapter%2018%20Custom%20Attributes/image-20221122113657675.png" alt="image-20221122113657675"></p><blockquote><p>If you just want to see if an attribute has been applied to a target, you should call IsDefined because itâ€™s more efficient than the other two methods. However, you know that when an attribute is applied to a target, you can specify parameters to the attributeâ€™s constructor and optionally set fields and properties. Using IsDefined wonâ€™t construct an attribute object, call its constructor, or set its fields and properties.</p></blockquote><blockquote><p>If you want to construct an attribute object, you must call either GetCustomAttributes or GetCustomAttribute. Every time one of these methods is called, it constructs new instances of the specified attribute type and sets each of the instanceâ€™s fields and properties based on the values specified in the source code. These methods return references to fully constructed instances of the applied attribute classes.</p></blockquote><blockquote><p>When you call any of these methods, internally, they must scan the managed moduleâ€™s metadata, performing string comparisons to locate the specified custom attribute class. Obviously, these operations take time. If youâ€™re performance conscious, you should consider caching the result of calling these methods rather than calling them repeatedly asking for the same information.</p></blockquote><blockquote><p>The System.Reflection namespace defines several classes that allow you to examine the contents of a moduleâ€™s metadata: Assembly, Module, ParameterInfo, MemberInfo, Type, MethodInfo, ConstructorInfo, FieldInfo, EventInfo, PropertyInfo, and their respective *Builder classes. All of these classes also offer IsDefined and GetCustomAttributes methods.</p></blockquote><blockquote><p>The version of GetCustomAttributes defined by the reflection classes returns an array of Object instances (Object[]) instead of an array of Attribute instances (Attribute[]). This is because the reflection classes are able to return objects of nonâ€“CLS-compliant attribute classes. You shouldnâ€™t be concerned about this inconsistency because nonâ€“CLS-compliant attributes are incredibly rare. In fact, in all of the time Iâ€™ve been working with the .NET Framework, Iâ€™ve never even seen one.</p></blockquote><p>ğŸ’¡æ³¨æ„ï¼šåªæœ‰ <code>Attribute</code> ï¼Œ <code>Type</code> å’Œ <code>MethodInfo</code> ç±»æ‰å®ç°äº†æ”¯æŒ <code>Boolean</code> <code>inherit</code> å‚æ•°çš„åå°„æ–¹æ³•ã€‚å…¶ä»–èƒ½æ£€æŸ¥ç‰¹æ€§çš„æ‰€æœ‰åå°„æ–¹æ³•éƒ½ä¼šå¿½ç•¥ <code>inherit</code> å‚æ•°ï¼Œè€Œä¸”ä¸ä¼šæ£€æŸ¥ç»§æ‰¿å±‚æ¬¡ç»“æ„ã€‚è¦æ£€æŸ¥äº‹ä»¶ã€å±æ€§ã€å­—æ®µã€æ„é€ å™¨æˆ–å‚æ•°æ˜¯å¦åº”ç”¨äº†ç»§æ‰¿çš„ç‰¹æ€§ï¼Œåªèƒ½è°ƒç”¨ <code>Attribute</code> çš„æŸä¸ªæ–¹æ³•ã€‚</p><blockquote><p>Thereâ€™s one more thing you should be aware of: When you pass a class to IsDefined, GetCustomAttribute, or GetCustomAttributes, these methods search for the application of the attribute class you specify or any attribute class derived from the specified class. If your code is looking for a specific attribute class, you should perform an additional check on the returned value to ensure that what these methods returned is the exact class youâ€™re looking for. You might also want to consider defining your attribute class to be sealed to reduce potential confusion and eliminate this extra check.</p></blockquote><blockquote><p>Hereâ€™s some sample code that lists all of the methods defined within a type and displays the attributes applied to each method. The code is for demonstration purposes; normally, you wouldnâ€™t apply these particular custom attributes to these targets as Iâ€™ve done here.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Diagnostics</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Reflection</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">CLSCompliant</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Serializable</span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DefaultMemberAttribute</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Main"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DebuggerDisplayAttribute</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Richter"</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">"Jeff"</span><span class="token punctuation">,</span> Target <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Program</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Conditional</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Debug"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Conditional</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Release"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token keyword">public</span> <span class="token function">Program</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CLSCompliant</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">STAThread</span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token comment">// Show the set of attributes applied to this type </span></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token function">ShowAttributes</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Program</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token comment">// Get the set of methods associated with the type </span></pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token class-name"><span class="token keyword">var</span></span> members <span class="token operator">=</span> </pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token keyword">from</span> m <span class="token keyword">in</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Program</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetTypeInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>DeclaredMembers<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">OfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MethodBase<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token keyword">where</span> <span class="token class-name">m</span><span class="token punctuation">.</span>IsPublic</pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token keyword">select</span> m<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">MemberInfo</span> member <span class="token keyword">in</span> members<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token comment">// Show the set of attributes applied to this member </span></pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token function">ShowAttributes</span><span class="token punctuation">(</span>member<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowAttributes</span><span class="token punctuation">(</span><span class="token class-name">MemberInfo</span> attributeTarget<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="30"></td><td><pre> <span class="token class-name"><span class="token keyword">var</span></span> attributes <span class="token operator">=</span> attributeTarget<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCustomAttributes</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Attribute<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="31"></td><td><pre> </pre></td></tr><tr><td data-num="32"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Attributes applied to &#123;0&#125;: &#123;1&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="33"></td><td><pre> attributeTarget<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> <span class="token punctuation">(</span>attributes<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">?</span> <span class="token string">"None"</span> <span class="token punctuation">:</span> String<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="34"></td><td><pre> <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">Attribute</span> attribute <span class="token keyword">in</span> attributes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="35"></td><td><pre> <span class="token comment">// Display the type of each applied attribute </span></pre></td></tr><tr><td data-num="36"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" &#123;0&#125;"</span><span class="token punctuation">,</span> attribute<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="37"></td><td><pre> </pre></td></tr><tr><td data-num="38"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>attribute <span class="token keyword">is</span> <span class="token class-name">DefaultMemberAttribute</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="39"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" MemberName=&#123;0&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="40"></td><td><pre> <span class="token punctuation">(</span><span class="token punctuation">(</span>DefaultMemberAttribute<span class="token punctuation">)</span> attribute<span class="token punctuation">)</span><span class="token punctuation">.</span>MemberName<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="41"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>attribute <span class="token keyword">is</span> <span class="token class-name">ConditionalAttribute</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="42"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" ConditionString=&#123;0&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="43"></td><td><pre> <span class="token punctuation">(</span><span class="token punctuation">(</span>ConditionalAttribute<span class="token punctuation">)</span> attribute<span class="token punctuation">)</span><span class="token punctuation">.</span>ConditionString<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="44"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>attribute <span class="token keyword">is</span> <span class="token class-name">CLSCompliantAttribute</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="45"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" IsCompliant=&#123;0&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="46"></td><td><pre> <span class="token punctuation">(</span><span class="token punctuation">(</span>CLSCompliantAttribute<span class="token punctuation">)</span> attribute<span class="token punctuation">)</span><span class="token punctuation">.</span>IsCompliant<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="47"></td><td><pre> <span class="token class-name">DebuggerDisplayAttribute</span> dda <span class="token operator">=</span> attribute <span class="token keyword">as</span> <span class="token class-name">DebuggerDisplayAttribute</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="48"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>dda <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="49"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" Value=&#123;0&#125;, Name=&#123;1&#125;, Target=&#123;2&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="50"></td><td><pre> dda<span class="token punctuation">.</span>Value<span class="token punctuation">,</span> dda<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> dda<span class="token punctuation">.</span>Target<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="51"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="52"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="53"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="54"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Building and running this application yields the following output.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre>Attributes applied <span class="token class-name">to</span> Program<span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> System<span class="token punctuation">.</span>SerializableAttribute </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token class-name">System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>DebuggerDisplayAttribute</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> Value<span class="token operator">=</span>Richter<span class="token punctuation">,</span> Name<span class="token operator">=</span>Jeff<span class="token punctuation">,</span> Target<span class="token operator">=</span>Program </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token class-name">System<span class="token punctuation">.</span>Reflection<span class="token punctuation">.</span>DefaultMemberAttribute</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> MemberName<span class="token operator">=</span>Main </pre></td></tr><tr><td data-num="7"></td><td><pre>Attributes applied <span class="token class-name">to</span> DoSomething<span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token class-name">System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>ConditionalAttribute</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> ConditionString<span class="token operator">=</span>Release </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token class-name">System<span class="token punctuation">.</span>Diagnostics<span class="token punctuation">.</span>ConditionalAttribute</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> ConditionString<span class="token operator">=</span>Debug </pre></td></tr><tr><td data-num="12"></td><td><pre>Attributes applied <span class="token class-name">to</span> Main<span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token class-name">System<span class="token punctuation">.</span>CLSCompliantAttribute</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> IsCompliant<span class="token operator">=</span>True </pre></td></tr><tr><td data-num="15"></td><td><pre> System<span class="token punctuation">.</span>STAThreadAttribute </pre></td></tr><tr><td data-num="16"></td><td><pre>Attributes applied to <span class="token punctuation">.</span>ctor<span class="token punctuation">:</span> None</pre></td></tr></table></figure><p>ğŸ’¡å°ç»“ï¼šä»…ä»…å®šä¹‰ç‰¹æ€§ç±»æ²¡æœ‰ç”¨ã€‚ç¡®å®å¯ä»¥å®šä¹‰è‡ªå·±æƒ³è¦çš„æ‰€æœ‰ç‰¹æ€§ç±»ï¼Œå¹¶åº”ç”¨è‡ªå·±æƒ³è¦çš„æ‰€æœ‰å®ä¾‹ã€‚ä½†è¿™æ ·é™¤äº†åœ¨ç¨‹åºé›†ä¸­ç”Ÿæˆé¢å¤–çš„å…ƒæ•°æ®ï¼Œæ²¡æœ‰å…¶ä»–ä»»ä½•æ„ä¹‰ã€‚åº”ç”¨ç¨‹åºä»£ç çš„è¡Œä¸ºä¸ä¼šæœ‰ä»»ä½•æ”¹å˜ã€‚å› æ­¤ï¼Œåœ¨å®šä¹‰å®šåˆ¶ç‰¹æ€§æ—¶ï¼Œä¹Ÿå¿…é¡»å®ç°ä¸€äº›ä»£ç æ¥æ£€æµ‹æŸäº›ç›®æ ‡ä¸Šæ˜¯å¦å­˜åœ¨è¯¥ç‰¹æ€§ç±»çš„å®ä¾‹ï¼Œç„¶åæ‰§è¡Œä¸€äº›é€»è¾‘åˆ†æ”¯ä»£ç ã€‚è¿™æ ·å®šåˆ¶ç‰¹æ€§æ‰èƒ½çœŸæ­£å‘æŒ¥ä½œç”¨ã€‚FCL æä¾›äº†å¤šç§æ–¹å¼æ¥æ£€æµ‹ç‰¹æ€§çš„å­˜åœ¨ã€‚å¦‚æœé€šè¿‡ <code>System.Type</code> å¯¹è±¡æ¥æ£€æµ‹ç‰¹æ€§ï¼Œå¯ä»¥åƒå‰é¢å±•ç¤ºçš„é‚£æ ·ä½¿ç”¨ <code>IsDefined</code> æ–¹æ³•ã€‚ä½†æœ‰æ—¶éœ€è¦æ£€æµ‹é™¤äº†ç±»å‹ä¹‹å¤–çš„å…¶ä»–ç›®æ ‡ï¼ˆæ¯”å¦‚ç¨‹åºé›†ã€æ¨¡å—æˆ–æ–¹æ³•ï¼‰ä¸Šçš„ç‰¹æ€§ã€‚ <code>System.Reflection.CustomAttributeExtensions</code> ç±»å®šä¹‰äº†ä¸‰ä¸ªé™æ€æ–¹æ³•æ¥è·å–ä¸ç›®æ ‡å…³è”çš„ç‰¹æ€§ï¼š <code>IsDefined</code> ï¼Œ <code>GetCustomAttributes</code> å’Œ <code>GetCustomAttributes</code> ã€‚æ¯ä¸ªæ–¹æ³•éƒ½æœ‰å‡ ä¸ªé‡è½½ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½æœ‰ä¸€ä¸ªç‰ˆæœ¬èƒ½æ“ä½œç±»å‹æˆå‘˜ (ç±»ã€ç»“æ„ã€æšä¸¾ã€æ¥å£ã€å§”æ‰˜ã€æ„é€ å™¨ã€æ–¹æ³•ã€å±æ€§ã€å­—æ®µã€äº‹ä»¶å’Œè¿”å›ç±»å‹)ã€å‚æ•°ã€æ¨¡å—å’Œç¨‹åºé›†ã€‚è¿˜æœ‰ä¸€äº›ç‰ˆæœ¬èƒ½æŒ‡ç¤ºç³»ç»Ÿéå†ç»§æ‰¿å±‚æ¬¡ç»“æ„ï¼Œåœ¨ç»“æœä¸­åŒ…å«ç»§æ‰¿çš„ç‰¹æ€§ã€‚å®ƒä»¬åœ¨å…ƒæ•°æ®ä¸Šåå°„ä»¥æŸ¥æ‰¾ä¸ CLS ç›¸å®¹çš„å®šåˆ¶ç‰¹æ€§ç±»å‹çš„å®ä¾‹ã€‚è°ƒç”¨ä¸Šè¿°ä»»ä½•æ–¹æ³•ï¼Œå†…éƒ¨éƒ½å¿…é¡»æ‰«ææ‰˜ç®¡æ¨¡å—çš„å…ƒæ•°æ®ï¼Œæ‰§è¡Œå­—ç¬¦ä¸²æ¯”è¾ƒæ¥å®šä½æŒ‡å®šçš„å®šåˆ¶ç‰¹æ€§ç±»ã€‚æ˜¾ç„¶ï¼Œè¿™äº›æ“ä½œä¼šè€—è´¹ä¸€å®šæ—¶é—´ã€‚å‡å¦‚å¯¹æ€§èƒ½çš„è¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¯è€ƒè™‘ç¼“å­˜è¿™äº›æ–¹æ³•çš„è°ƒç”¨ç»“æœï¼Œè€Œä¸æ˜¯åå¤è°ƒç”¨æ¥è¯·æ±‚ç›¸åŒçš„ä¿¡æ¯ã€‚åå°„ç±»æä¾›çš„ <code>GetCustomAttribute</code> æ–¹æ³•è¿”å›çš„æ˜¯ç”± <code>Object</code> å®ä¾‹æ„æˆçš„æ•°ç»„ ( <code>Object[]</code> )ï¼Œè€Œä¸æ˜¯ç”± <code>Attribute</code> å®ä¾‹æ„æˆçš„æ•°ç»„ ( <code>Attribute[]</code> )ã€‚è¿™æ˜¯ç”±äºåå°„ç±»èƒ½è¿”å›ä¸ç›¸å®¹äº CLS è§„èŒƒçš„ç‰¹æ€§ç±»çš„å¯¹è±¡ã€‚ä¸è¿‡ï¼Œå¤§å¯ä¸å¿…å…³å¿ƒè¿™ç§ä¸ä¸€è‡´æ€§ï¼Œå› ä¸ºé CLS ç›¸å®¹çš„ç‰¹æ€§æ˜¯å¾ˆç¨€å°‘çš„ã€‚è¿˜è¦æ³¨æ„ï¼Œå°†ä¸€ä¸ªç±»ä¼ ç»™ <code>IsDefined</code> ï¼Œ <code>GetCustomAttribute</code> æˆ–è€… <code>GetCustomAttribute</code> æ–¹æ³•æ—¶ï¼Œè¿™äº›æ–¹æ³•ä¼šæ£€æµ‹æ˜¯å¦åº”ç”¨äº†æŒ‡å®šçš„ç‰¹æ€§ç±»æˆ–è€…å®ƒçš„æ´¾ç”Ÿç±»ã€‚å¦‚æœåªæ˜¯æƒ³æœç´¢ä¸€ä¸ªå…·ä½“çš„ç‰¹æ€§ç±»ï¼Œåº”é’ˆå¯¹è¿”å›å€¼æ‰§è¡Œä¸€æ¬¡é¢å¤–çš„æ£€æŸ¥ï¼Œç¡®ä¿æ–¹æ³•è¿”å›çš„æ­£æ˜¯æƒ³æœç´¢çš„ç±»ã€‚è¿˜å¯è€ƒè™‘å°†è‡ªå·±çš„ç‰¹æ€§ç±»å®šä¹‰æˆ <code>sealed</code> ï¼Œå‡å°‘å¯èƒ½å­˜åœ¨çš„æ··æ·†ï¼Œå¹¶é¿å…æ‰§è¡Œè¿™ä¸ªé¢å¤–çš„æ£€æŸ¥ã€‚</p><h2 id="matching-two-attribute-instances-against-each-other"><a class="anchor" href="#matching-two-attribute-instances-against-each-other">#</a> Matching Two Attribute Instances Against Each Other</h2><blockquote><p>Now that your code knows how to check whether an instance of an attribute is applied to a target, it might want to check the fields of the attribute to see what values they have. One way to do this is to write code that explicitly checks the values of the attribute classâ€™s fields. However, <code>System.Attribute</code> overrides Objectâ€™s Equals method, and internally, this method compares the types of the two objects. If they are not identical, Equals returns false. If the types are identical, then Equals uses reflection to compare the values of the two attribute objectsâ€™ fields (by calling Equals for each field). If all the fields match, then true is returned; otherwise, false is returned. You might override Equals in your own attribute class to remove the use of reflection, improving performance.</p></blockquote><blockquote><p>System.Attribute also exposes a virtual Match method that you can override to provide richer semantics. The default implementation of Match simply calls Equals and returns its result. The following code demonstrates how to override Equals and Match (which returns true if one attribute represents a subset of the other) and then shows how Match is used.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Flags</span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">enum</span> <span class="token class-name">Accounts</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> Savings <span class="token operator">=</span> <span class="token number">0x0001</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> Checking <span class="token operator">=</span> <span class="token number">0x0002</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> Brokerage <span class="token operator">=</span> <span class="token number">0x0004</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AttributeUsage</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AttributeTargets<span class="token punctuation">.</span>Class<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">AccountsAttribute</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">private</span> <span class="token class-name">Accounts</span> m_accounts<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token keyword">public</span> <span class="token function">AccountsAttribute</span><span class="token punctuation">(</span><span class="token class-name">Accounts</span> accounts<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> m_accounts <span class="token operator">=</span> accounts<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">Boolean</span> <span class="token function">Match</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token comment">// If the base class implements Match and the base class </span></pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token comment">// is not Attribute, then uncomment the following line. </span></pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token comment">// if (!base.Match(obj)) return false; </span></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token comment">// Since 'this' isn't null, if obj is null, </span></pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token comment">// then the objects can't match </span></pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token comment">// NOTE: This line may be deleted if you trust </span></pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token comment">// that the base type implemented Match correctly. </span></pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token comment">// If the objects are of different types, they can't match </span></pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token comment">// NOTE: This line may be deleted if you trust </span></pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token comment">// that the base type implemented Match correctly. </span></pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> obj<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token comment">// Cast obj to our type to access fields. NOTE: This cast </span></pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token comment">// can't fail since we know objects are of the same type </span></pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token class-name">AccountsAttribute</span> other <span class="token operator">=</span> <span class="token punctuation">(</span>AccountsAttribute<span class="token punctuation">)</span> obj<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="30"></td><td><pre> <span class="token comment">// Compare the fields as you see fit </span></pre></td></tr><tr><td data-num="31"></td><td><pre> <span class="token comment">// This example checks if 'this' accounts is a subset </span></pre></td></tr><tr><td data-num="32"></td><td><pre> <span class="token comment">// of others' accounts </span></pre></td></tr><tr><td data-num="33"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>m_accounts <span class="token operator">&amp;</span> m_accounts<span class="token punctuation">)</span> <span class="token operator">!=</span> m_accounts<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="34"></td><td><pre> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="35"></td><td><pre> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// Objects match </span></pre></td></tr><tr><td data-num="36"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="37"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">Boolean</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="38"></td><td><pre> <span class="token comment">// If the base class implements Equals, and the base class </span></pre></td></tr><tr><td data-num="39"></td><td><pre> <span class="token comment">// is not Object, then uncomment the following line. </span></pre></td></tr><tr><td data-num="40"></td><td><pre> <span class="token comment">// if (!base.Equals(obj)) return false; </span></pre></td></tr><tr><td data-num="41"></td><td><pre> <span class="token comment">// Since 'this' isn't null, if obj is null, </span></pre></td></tr><tr><td data-num="42"></td><td><pre> <span class="token comment">// then the objects can't be equal </span></pre></td></tr><tr><td data-num="43"></td><td><pre> <span class="token comment">// NOTE: This line may be deleted if you trust </span></pre></td></tr><tr><td data-num="44"></td><td><pre> <span class="token comment">// that the base type implemented Equals correctly. </span></pre></td></tr><tr><td data-num="45"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="46"></td><td><pre> <span class="token comment">// If the objects are of different types, they can't be equal </span></pre></td></tr><tr><td data-num="47"></td><td><pre> <span class="token comment">// NOTE: This line may be deleted if you trust </span></pre></td></tr><tr><td data-num="48"></td><td><pre> <span class="token comment">// that the base type implemented Equals correctly. </span></pre></td></tr><tr><td data-num="49"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> obj<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="50"></td><td><pre> <span class="token comment">// Cast obj to our type to access fields. NOTE: This cast </span></pre></td></tr><tr><td data-num="51"></td><td><pre> <span class="token comment">// can't fail since we know objects are of the same type </span></pre></td></tr><tr><td data-num="52"></td><td><pre> <span class="token class-name">AccountsAttribute</span> other <span class="token operator">=</span> <span class="token punctuation">(</span>AccountsAttribute<span class="token punctuation">)</span> obj<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="53"></td><td><pre> <span class="token comment">// Compare the fields to see if they have the same value </span></pre></td></tr><tr><td data-num="54"></td><td><pre> <span class="token comment">// This example checks if 'this' accounts is the same </span></pre></td></tr><tr><td data-num="55"></td><td><pre> <span class="token comment">// as other's accounts </span></pre></td></tr><tr><td data-num="56"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>other<span class="token punctuation">.</span>m_accounts <span class="token operator">!=</span> m_accounts<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="57"></td><td><pre> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="58"></td><td><pre> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// Objects are equal </span></pre></td></tr><tr><td data-num="59"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="60"></td><td><pre> <span class="token comment">// Override GetHashCode since we override Equals </span></pre></td></tr><tr><td data-num="61"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">Int32</span> <span class="token function">GetHashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="62"></td><td><pre> <span class="token keyword">return</span> <span class="token punctuation">(</span>Int32<span class="token punctuation">)</span> m_accounts<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="63"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Accounts</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Accounts<span class="token punctuation">.</span>Savings<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">ChildAccount</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="67"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Accounts</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Accounts<span class="token punctuation">.</span>Savings <span class="token operator">|</span> Accounts<span class="token punctuation">.</span>Checking <span class="token operator">|</span> Accounts<span class="token punctuation">.</span>Brokerage<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">AdultAccount</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="69"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="70"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="71"></td><td><pre> <span class="token function">CanWriteCheck</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ChildAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="72"></td><td><pre> <span class="token function">CanWriteCheck</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">AdultAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="73"></td><td><pre> <span class="token comment">// This just demonstrates that the method works correctly on a </span></pre></td></tr><tr><td data-num="74"></td><td><pre> <span class="token comment">// type that doesn't have the AccountsAttribute applied to it. </span></pre></td></tr><tr><td data-num="75"></td><td><pre> <span class="token function">CanWriteCheck</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Program</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="76"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="77"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CanWriteCheck</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="78"></td><td><pre> <span class="token comment">// Construct an instance of the attribute type and initialize it </span></pre></td></tr><tr><td data-num="79"></td><td><pre> <span class="token comment">// to what we are explicitly looking for. </span></pre></td></tr><tr><td data-num="80"></td><td><pre> <span class="token class-name">Attribute</span> checking <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AccountsAttribute</span><span class="token punctuation">(</span>Accounts<span class="token punctuation">.</span>Checking<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="81"></td><td><pre> <span class="token comment">// Construct the attribute instance that was applied to the type </span></pre></td></tr><tr><td data-num="82"></td><td><pre> <span class="token class-name">Attribute</span> validAccounts <span class="token operator">=</span></pre></td></tr><tr><td data-num="83"></td><td><pre> obj<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCustomAttribute</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AccountsAttribute<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="84"></td><td><pre> <span class="token comment">// If the attribute was applied to the type AND the </span></pre></td></tr><tr><td data-num="85"></td><td><pre> <span class="token comment">// attribute specifies the "Checking" account, then the </span></pre></td></tr><tr><td data-num="86"></td><td><pre> <span class="token comment">// type can write a check </span></pre></td></tr><tr><td data-num="87"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>validAccounts <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> checking<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span>validAccounts<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="88"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"&#123;0&#125; types can write checks."</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="89"></td><td><pre> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="90"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"&#123;0&#125; types can NOT write checks."</span><span class="token punctuation">,</span> obj<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="91"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="92"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="93"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Building and running this application yields the following output.</p></blockquote><pre><code class="language-cmd">ChildAccount types can NOT write checks. 
AdultAccount types can write checks. 
Program types can NOT write checks.
</code></pre><p>ğŸ’¡å°ç»“ï¼š <code>System.Attribute</code> é‡å†™äº† <code>Object</code> çš„ <code>Equals</code> æ–¹æ³•ï¼Œä¼šåœ¨å†…éƒ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„ç±»å‹ã€‚ä¸ä¸€è‡´ä¼šè¿”å› falseã€‚å¦‚æœä¸€è‡´ï¼Œ <code>Equals</code> ä¼šåˆ©ç”¨åå°„æ¥æ¯”è¾ƒä¸¤ä¸ªç‰¹æ€§å¯¹è±¡ä¸­çš„å­—æ®µå€¼ï¼ˆä¸ºæ¯ä¸ªå­—æ®µéƒ½è°ƒç”¨ <code>Equals</code> ï¼‰ã€‚æ‰€æœ‰å­—æ®µéƒ½åŒ¹é…å°±è¿”å› trueï¼›å¦åˆ™è¿”å› falseã€‚å¯åœ¨è‡ªå·±çš„å®šåˆ¶ç‰¹æ€§ä¸­é‡å†™ <code>Equals</code> æ¥ç§»é™¤åå°„çš„ä½¿ç”¨ï¼Œä»è€Œæå‡æ€§èƒ½ã€‚ <code>System.Attribute</code> è¿˜å…¬å¼€äº†è™šæ–¹æ³• <code>Match</code> ï¼Œå¯é‡å†™å®ƒæ¥æä¾›æ›´ä¸°å¯Œçš„è¯­ä¹‰ã€‚ <code>Match</code> çš„é»˜è®¤å®ç°åªæ˜¯è°ƒç”¨ <code>Equals</code> æ–¹æ³•æ¥è¿”å›å®ƒçš„ç»“æœã€‚</p><h2 id="detecting-the-use-of-a-custom-attribute-without-creating-attribute-derived-objects"><a class="anchor" href="#detecting-the-use-of-a-custom-attribute-without-creating-attribute-derived-objects">#</a> Detecting the Use of a Custom Attribute Without Creating Attribute-Derived Objects</h2><blockquote><p>In this section, I discuss an alternate technique for detecting custom attributes applied to a metadata entry. In some security-conscious scenarios, this alternate technique ensures that no code in an Attribute-derived class will execute. After all, when you call Attributeâ€™s GetCustomAttribute(s) methods, internally, these methods call the attribute classâ€™s constructor and can also call property set accessor methods. In addition, the first access to a type causes the CLR to invoke the typeâ€™s type constructor (if it exists). The constructor, set accessor, and type constructor methods could contain code that will execute whenever code is just looking for an attribute. This allows unknown code to run in the AppDomain, and this is a potential security vulnerability.</p></blockquote><blockquote><p>To discover attributes without allowing attribute class code to execute, you use the System. Reflection.CustomAttributeData class. This class defines one static method for retrieving the attributes associated with a target: GetCustomAttributes. This method has four overloads: one that takes an Assembly, one that takes a Module, one that takes a ParameterInfo, and one that takes a MemberInfo. This class is defined in the System.Reflection namespace, which is discussed in Chapter 23. Typically, youâ€™ll use the CustomAttributeData class to analyze attributes in metadata for an assembly that is loaded via Assemblyâ€™s static ReflectionOnlyLoad method (also discussed in Chapter 23). Briefly, ReflectionOnlyLoad loads an assembly in such a way that prevents the CLR from executing any code in it; this includes type constructors.</p></blockquote><blockquote><p>CustomAttributeDataâ€™s GetCustomAttributes method acts as a factory. That is, when you call it, it returns a collection of CustomAttributeData objects in an object of type IList. The collection contains one element per custom attribute applied to the specified target. For each CustomAttributeData object, you can query some read-only properties to determine how the attribute object would be constructed and initialized. Specifically, the Constructor property indicates which constructor method would be called, the ConstructorArguments property returns the arguments that would be passed to this constructor as an instance of IList, and the NamedArguments property returns the fields/properties that would be set as an instance of IList. Notice that I say â€œwould beâ€ in the previous sentences because the constructor and set accessor methods will not actually be calledâ€”we get the added security by preventing any attribute class methods from executing.</p></blockquote><blockquote><p>Hereâ€™s a modified version of a previous code sample that uses the CustomAttributeData class to securely obtain the attributes applied to various targets.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Diagnostics</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Reflection</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">CLSCompliant</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Serializable</span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DefaultMemberAttribute</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Main"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DebuggerDisplayAttribute</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Richter"</span><span class="token punctuation">,</span> Name<span class="token operator">=</span><span class="token string">"Jeff"</span><span class="token punctuation">,</span> Target<span class="token operator">=</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Program</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Conditional</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Debug"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Conditional</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Release"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token keyword">public</span> <span class="token function">Program</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CLSCompliant</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">STAThread</span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token comment">// Show the set of attributes applied to this type </span></pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token function">ShowAttributes</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Program</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token comment">// Get the set of methods associated with the type </span></pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token class-name">MemberInfo<span class="token punctuation">[</span><span class="token punctuation">]</span></span> members <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Program</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FindMembers</span><span class="token punctuation">(</span> </pre></td></tr><tr><td data-num="22"></td><td><pre> MemberTypes<span class="token punctuation">.</span>Constructor <span class="token operator">|</span> MemberTypes<span class="token punctuation">.</span>Method<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="23"></td><td><pre> BindingFlags<span class="token punctuation">.</span>DeclaredOnly <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>Instance <span class="token operator">|</span> </pre></td></tr><tr><td data-num="24"></td><td><pre> BindingFlags<span class="token punctuation">.</span>Public <span class="token operator">|</span> BindingFlags<span class="token punctuation">.</span>Static<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="25"></td><td><pre> Type<span class="token punctuation">.</span>FilterName<span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">MemberInfo</span> member <span class="token keyword">in</span> members<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token comment">// Show the set of attributes applied to this member </span></pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token function">ShowAttributes</span><span class="token punctuation">(</span>member<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="30"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="31"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ShowAttributes</span><span class="token punctuation">(</span><span class="token class-name">MemberInfo</span> attributeTarget<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="32"></td><td><pre> <span class="token class-name">IList<span class="token punctuation">&lt;</span>CustomAttributeData<span class="token punctuation">></span></span> attributes <span class="token operator">=</span> </pre></td></tr><tr><td data-num="33"></td><td><pre> CustomAttributeData<span class="token punctuation">.</span><span class="token function">GetCustomAttributes</span><span class="token punctuation">(</span>attributeTarget<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="34"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Attributes applied to &#123;0&#125;: &#123;1&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="35"></td><td><pre> attributeTarget<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> <span class="token punctuation">(</span>attributes<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">?</span> <span class="token string">"None"</span> <span class="token punctuation">:</span> String<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="36"></td><td><pre> <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">CustomAttributeData</span> attribute <span class="token keyword">in</span> attributes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="37"></td><td><pre> <span class="token comment">// Display the type of each applied attribute </span></pre></td></tr><tr><td data-num="38"></td><td><pre> <span class="token class-name">Type</span> t <span class="token operator">=</span> attribute<span class="token punctuation">.</span>Constructor<span class="token punctuation">.</span>DeclaringType<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="39"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" &#123;0&#125;"</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="40"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" Constructor called=&#123;0&#125;"</span><span class="token punctuation">,</span> attribute<span class="token punctuation">.</span>Constructor<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="41"></td><td><pre> <span class="token class-name">IList<span class="token punctuation">&lt;</span>CustomAttributeTypedArgument<span class="token punctuation">></span></span> posArgs <span class="token operator">=</span> attribute<span class="token punctuation">.</span>ConstructorArguments<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="42"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" Positional arguments passed to constructor:"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num="43"></td><td><pre> <span class="token punctuation">(</span><span class="token punctuation">(</span>posArgs<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token string">" None"</span> <span class="token punctuation">:</span> String<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="44"></td><td><pre> <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">CustomAttributeTypedArgument</span> pa <span class="token keyword">in</span> posArgs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="45"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" Type=&#123;0&#125;, Value=&#123;1&#125;"</span><span class="token punctuation">,</span> pa<span class="token punctuation">.</span>ArgumentType<span class="token punctuation">,</span> pa<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="46"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="47"></td><td><pre> <span class="token class-name">IList<span class="token punctuation">&lt;</span>CustomAttributeNamedArgument<span class="token punctuation">></span></span> namedArgs <span class="token operator">=</span> attribute<span class="token punctuation">.</span>NamedArguments<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="48"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" Named arguments set after construction:"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num="49"></td><td><pre> <span class="token punctuation">(</span><span class="token punctuation">(</span>namedArgs<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token string">" None"</span> <span class="token punctuation">:</span> String<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="50"></td><td><pre> <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token class-name">CustomAttributeNamedArgument</span> na <span class="token keyword">in</span> namedArgs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="51"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" Name=&#123;0&#125;, Type=&#123;1&#125;, Value=&#123;2&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="52"></td><td><pre> na<span class="token punctuation">.</span>MemberInfo<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> na<span class="token punctuation">.</span>TypedValue<span class="token punctuation">.</span>ArgumentType<span class="token punctuation">,</span> na<span class="token punctuation">.</span>TypedValue<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="53"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="54"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="55"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="56"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="57"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Building and running this application yields the following output.</p></blockquote><pre><code class="language-cmd">Attributes applied to Program: 
 System.SerializableAttribute 
 Constructor called=Void .ctor() 
 Positional arguments passed to constructor: None 
 Named arguments set after construction: None 
 
 System.Diagnostics.DebuggerDisplayAttribute 
 Constructor called=Void .ctor(System.String) 
 Positional arguments passed to constructor: 
 Type=System.String, Value=Richter 
 Named arguments set after construction: 
 Name=Name, Type=System.String, Value=Jeff 
 Name=Target, Type=System.Type, Value=Program 
 
 System.Reflection.DefaultMemberAttribute 
 Constructor called=Void .ctor(System.String) 
 Positional arguments passed to constructor: 
 Type=System.String, Value=Main 
 Named arguments set after construction: None 

Attributes applied to DoSomething: 
 System.Diagnostics.ConditionalAttribute 
 Constructor called=Void .ctor(System.String) 
 Positional arguments passed to constructor: 
 Type=System.String, Value=Release 
 Named arguments set after construction: None 
 
 System.Diagnostics.ConditionalAttribute 
 Constructor called=Void .ctor(System.String) 
 Positional arguments passed to constructor: 
 Type=System.String, Value=Debug 
 Named arguments set after construction: None 

Attributes applied to Main: 
 System.CLSCompliantAttribute 
 Constructor called=Void .ctor(Boolean) 
 Positional arguments passed to constructor: 
 Type=System.Boolean, Value=True 
 Named arguments set after construction: None 
 
 System.STAThreadAttribute 
 Constructor called=Void .ctor() 
 Positional arguments passed to constructor: None 
 Named arguments set after construction: None

Attributes applied to .ctor: None
</code></pre><p>ğŸ’¡å°ç»“ï¼šè°ƒç”¨ <code>Attribute</code> çš„ <code>GetCustomAttribute</code> æˆ–è€… <code>GetCustomAttributes</code> æ–¹æ³•æ—¶ï¼Œè¿™äº›æ–¹æ³•ä¼šåœ¨å†…éƒ¨è°ƒç”¨ç‰¹æ€§ç±»çš„æ„é€ å™¨ï¼Œè€Œä¸”å¯èƒ½è°ƒç”¨å±æ€§çš„ <code>set</code> è®¿é—®å™¨ã€‚æ­¤å¤–ï¼Œé¦–æ¬¡è®¿é—®ç±»å‹ä¼šé€ æˆ CLR è°ƒç”¨ç±»å‹çš„ç±»å‹æ„é€ å™¨ (å¦‚æœæœ‰çš„è¯)ã€‚åœ¨æ„é€ å™¨ã€ <code>set</code> è®¿é—®å™¨æ–¹æ³•ä»¥åŠç±»å‹æ„é€ å™¨ä¸­ï¼Œå¯èƒ½åŒ…å«æ¯æ¬¡æŸ¥æ‰¾ç‰¹æ€§éƒ½è¦æ‰§è¡Œçš„ä»£ç ã€‚è¿™å°±ç›¸å½“äºå…è®¸æœªçŸ¥ä»£ç åœ¨ <code>AppDomain</code> ä¸­è¿è¡Œï¼Œæ‰€ä»¥å­˜åœ¨å®‰å…¨éšæ‚£ã€‚å¯ç”¨ <code>System.Reflection.CustomAttributeData</code> ç±»åœ¨æŸ¥æ‰¾ç‰¹æ€§çš„åŒæ—¶ç¦æ­¢æ‰§è¡Œç‰¹æ€§ç±»ä¸­çš„ä»£ç ã€‚é€šè¿‡ï¼Œå…ˆç”¨ <code>Assembly</code> çš„é™æ€æ–¹æ³• <code>ReflectionOnlyLoad</code> (ä¹Ÿåœ¨ç¬¬ 23 ç« è®¨è®º) åŠ è½½ç¨‹åºé›†ï¼Œå†ç”¨ <code>CustomAttributeData</code> ç±»åˆ†æè¿™ä¸ªç¨‹åºé›†çš„å…ƒæ•°æ®ä¸­çš„ç‰¹æ€§ã€‚ç®€å•åœ°è¯´ï¼Œ <code>ReflectionOnlyLoad</code> ä»¥ç‰¹æ®Šæ–¹å¼åŠ è½½ç¨‹åºé›†ï¼ŒæœŸé—´ä¼šç¦æ­¢ CLR æ‰§è¡Œç¨‹åºé›†ä¸­çš„ä»»ä½•ä»£ç ï¼›å…¶ä¸­åŒ…æ‹¬ç±»å‹æ„é€ å™¨ã€‚ <code>CustomAttributeData</code> çš„ <code>GetCustomAttributes</code> æ–¹æ³•æ˜¯ä¸€ä¸ªå·¥å‚ (factory) æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè°ƒç”¨å®ƒä¼šè¿”å›ä¸€ä¸ª <code>IList&lt;CustomAttributeData&gt;</code> ç±»å‹çš„å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†ç”± <code>CustomAttributeData</code> å¯¹è±¡æ„æˆçš„é›†åˆã€‚é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯åº”ç”¨äºæŒ‡å®šç›®æ ‡çš„ä¸€ä¸ªå®šåˆ¶ç‰¹æ€§ã€‚å¯æŸ¥è¯¢æ¯ä¸ª <code>CustomAttributeData</code> å¯¹è±¡çš„åªè¯»å±æ€§ï¼Œåˆ¤æ–­ç‰¹æ€§å¯¹è±¡å¦‚ä½•æ„é€ å’Œåˆå§‹åŒ–ã€‚å…·ä½“åœ°è¯´ï¼Œ <code>Constructor</code> å±æ€§æŒ‡å‡ºæ„é€ å™¨æ–¹æ³•å°†å¦‚ä½•è°ƒç”¨ã€‚ <code>ConstructorArguments</code> å±æ€§ä»¥ä¸€ä¸ª <code>IList&lt;CustomAttributeTypedArgument&gt;</code> å®ä¾‹çš„å½¢å¼è¿”å›å°†ä¼ ç»™è¿™ä¸ªæ„é€ å™¨çš„å®å‚ã€‚è€Œ <code>NamedArguments</code> å±æ€§ä»¥ä¸€ä¸ª <code>IList&lt;CustomAttributeNamedArgument&gt;</code> å®ä¾‹çš„å½¢å¼ï¼Œè¿”å›å°†è®¾ç½®çš„å­—æ®µ / å±æ€§ã€‚æ³¨æ„ï¼Œä¹‹æ‰€ä»¥è¯´ â€œå°†â€ï¼Œæ˜¯å› ä¸ºä¸ä¼šå®é™…åœ°è°ƒç”¨æ„é€ å™¨å’Œ <code>set</code> è®¿é—®å™¨æ–¹æ³•ã€‚ç¦æ­¢æ‰§è¡Œç‰¹æ€§ç±»çš„ä»»ä½•æ–¹æ³•å¢å¼ºäº†å®‰å…¨æ€§ã€‚</p><h2 id="conditional-attribute-classes"><a class="anchor" href="#conditional-attribute-classes">#</a> Conditional Attribute Classes</h2><blockquote><p>Over time, the ease of defining, applying, and reflecting over attributes has caused developers to use them more and more. Using attributes is also a very easy way to annotate your code while simultaneously implementing rich features. Lately, developers have been using attributes to assist them with design time and debugging. For example, the Microsoft Visual Studio code analysis tool (FxCopCmd.exe) offers a System.Diagnostics.CodeAnalysis.SuppressMessageAttribute that you can apply to types and members in order to suppress the reporting of a specific static analysis tool rule violation. This attribute is only looked for by the code analysis utility; the attribute is never looked for when the program is running normally. When not using code analysis, having SuppressMessage attributes sitting in the metadata just bloats the metadata, which makes your file bigger, increases your processâ€™s working set, and hurts your applicationâ€™s performance. It would be great if there were an easy way to have the compiler emit the SuppressMessage attributes only when you intend to use the code analysis tool. Fortunately, there is a way to do this by using conditional attribute classes.</p></blockquote><blockquote><p>An attribute class that has the System.Diagnostics.ConditionalAttribute applied to it is called a conditional attribute class. Here is an example.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//#define TEST </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token preprocessor property">#<span class="token directive keyword">define</span> VERIFY </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Diagnostics</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Conditional</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"TEST"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Conditional</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"VERIFY"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">CondAttribute</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Attribute</span></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Cond</span></span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"CondAttribute is &#123;0&#125;applied to Program type."</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> Attribute<span class="token punctuation">.</span><span class="token function">IsDefined</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Program</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">CondAttribute</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token string">""</span> <span class="token punctuation">:</span> <span class="token string">"not "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>When a compiler sees an instance of the CondAttribute being applied to a target, the compiler will emit the attribute information into the metadata only if the TEST or VERIFY symbol is defined when the code containing the target is compiled. However, the attribute class definition metadata and implementation is still present in the assembly.</p></blockquote><p>ğŸ’¡å°ç»“ï¼šç‰¹æ€§ç®€åŒ–äº†å¯¹ä»£ç çš„æ³¨é‡Šï¼Œè¿˜èƒ½å®ç°ä¸°å¯Œçš„åŠŸèƒ½ã€‚ä½†æœ‰æ—¶ä¸€äº›æš‚æ—¶ç”¨ä¸ä¸Šçš„ç‰¹æ€§ç•™åœ¨å…ƒæ•°æ®ä¸­ä¼šä½¿å…ƒæ•°æ®æ— è°“åœ°è†¨èƒ€ï¼Œè¿™ä¼šä½¿æ–‡ä»¶å˜å¾—æ›´å¤§ï¼Œå¢å¤§è¿›ç¨‹çš„å·¥ä½œé›†ï¼ŒæŸå®³åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚å‡å¦‚æœ‰ä¸€ç§ç®€å•çš„æ–¹å¼ï¼Œä½¿ç¼–è¯‘å™¨åªæœ‰åœ¨ä½¿ç”¨ä»£ç åˆ†æå·¥å…·æ—¶æ‰ç”Ÿæˆ <code>SuppressMessage</code> ç‰¹æ€§ï¼Œç»“æœä¼šå¥½å¾ˆå¤šã€‚åˆ©ç”¨æ¡ä»¶ç‰¹æ€§å°±èƒ½åšåˆ°è¿™ä¸€ç‚¹ã€‚åº”ç”¨äº† <code>System.Diagnostics.ConditionalAttribute</code> çš„ç‰¹æ€§ç±»ç§°ä¸ºæ¡ä»¶ç‰¹æ€§ç±»ã€‚ç¼–è¯‘å™¨å¦‚æœå‘ç°å‘ç›®æ ‡å…ƒç´ åº”ç”¨äº†æŒ‡å®šäº† <code>Conditional</code> ç‰¹æ€§çš„è‡ªå®šä¹‰ç‰¹æ€§çš„å®ä¾‹ï¼Œé‚£ä¹ˆå½“å«æœ‰ç›®æ ‡å…ƒç´ çš„ä»£ç ç¼–è¯‘æ—¶ï¼Œåªæœ‰åœ¨å®šä¹‰äº†æŒ‡å®šç¬¦å·çš„å‰æä¸‹ï¼Œç¼–è¯‘å™¨æ‰ä¼šåœ¨å…ƒæ•°æ®ä¸­ç”Ÿæˆç‰¹æ€§ä¿¡æ¯ã€‚ä¸è¿‡ï¼Œç‰¹æ€§ç±»çš„å®šä¹‰å…ƒæ•°æ®å’Œå®ç°ä»ç„¶å­˜åœ¨äºç¨‹åºé›†ä¸­ã€‚</p><div class="tags"><a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag"><i class="ic i-tag"></i> è¯»ä¹¦ç¬”è®°</a> <a href="/tags/C/" rel="tag"><i class="ic i-tag"></i> C#</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2022-11-23 10:57:58" itemprop="dateModified" datetime="2022-11-23T10:57:58+08:00">2022-11-23</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(ï¿£â–½ï¿£)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Sakupinera WeChat Pay"><p>WeChat Pay</p></div><div><img data-src="/images/alipay.png" alt="Sakupinera Alipay"><p>Alipay</p></div><div><img data-src="/images/paypal.png" alt="Sakupinera PayPal"><p>PayPal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Sakupinera <i class="ic i-at"><em>@</em></i>Sakupinera</li><li class="link"><strong>Post link: </strong><a href="http://sakupinera.github.io/2022/11/22/csharp/clr-via-csharp/Chapter%2018%20Custom%20Attributes/" title="CLR via C# - Chapter 18 Custom Attributes">http://sakupinera.github.io/2022/11/22/csharp/clr-via-csharp/Chapter 18 Custom Attributes/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/11/21/csharp/clr-via-csharp/Chapter%2017%20Delegates/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;03&#x2F;08&#x2F;cNIvjwsl174ibOo.png" title="CLR via C# - Chapter 17 Delegates"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i> CLR-via-CSharp</span><h3>CLR via C# - Chapter 17 Delegates</h3></a></div><div class="item right"><a href="/2022/11/23/csharp/clr-via-csharp/Chapter%2019%20Nullable%20Value%20Types/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;03&#x2F;08&#x2F;W1a6ViLoBQPTj2C.jpg" title="CLR via C# - Chapter 19 Nullable Value Types"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i> CLR-via-CSharp</span><h3>CLR via C# - Chapter 19 Nullable Value Types</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#chapter-18-custom-attributes"><span class="toc-number">1.</span> <span class="toc-text">Chapter 18 Custom Attributes</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#using-custom-attributes"><span class="toc-number">1.1.</span> <span class="toc-text">Using Custom Attributes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#defining-your-own-attribute-class"><span class="toc-number">1.2.</span> <span class="toc-text">Defining Your Own Attribute Class</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#attribute-constructor-and-fieldproperty-data-types"><span class="toc-number">1.3.</span> <span class="toc-text">Attribute Constructor and Field&#x2F;Property Data Types</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#detecting-the-use-of-a-custom-attribute"><span class="toc-number">1.4.</span> <span class="toc-text">Detecting the Use of a Custom Attribute</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#matching-two-attribute-instances-against-each-other"><span class="toc-number">1.5.</span> <span class="toc-text">Matching Two Attribute Instances Against Each Other</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#detecting-the-use-of-a-custom-attribute-without-creating-attribute-derived-objects"><span class="toc-number">1.6.</span> <span class="toc-text">Detecting the Use of a Custom Attribute Without Creating Attribute-Derived Objects</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#conditional-attribute-classes"><span class="toc-number">1.7.</span> <span class="toc-text">Conditional Attribute Classes</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%201%20The%20CLR%E2%80%99s%20Execution%20Model/" rel="bookmark" title="CLR via C# - Chapter 1 The CLRâ€™s Execution Model">CLR via C# - Chapter 1 The CLRâ€™s Execution Model</a></li><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%202%20Building,%20Packaging,%20Deploying,%20and%20Administering%20Applications%20and%20Types/" rel="bookmark" title="CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types">CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types</a></li><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%203%20Shared%20Assemblies%20and%20Strongly%20Named%20Assemblies/" rel="bookmark" title="CLR via C# - Chapter 3 Shared Assemblies and Strongly Named Assemblies">CLR via C# - Chapter 3 Shared Assemblies and Strongly Named Assemblies</a></li><li><a href="/2022/09/27/csharp/clr-via-csharp/Chapter%204%20Type%20Fundamentals/" rel="bookmark" title="CLR via C# - Chapter 4 Type Fundamentals">CLR via C# - Chapter 4 Type Fundamentals</a></li><li><a href="/2022/10/15/csharp/clr-via-csharp/Chapter%205%20Primitive,%20Reference,%20and%20Value%20%20Types/" rel="bookmark" title="CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals">CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals</a></li><li><a href="/2022/10/21/csharp/clr-via-csharp/Chapter%206%20Type%20and%20Member%20Basics/" rel="bookmark" title="CLR via C# - Chapter 6 Type and Member Basics">CLR via C# - Chapter 6 Type and Member Basics</a></li><li><a href="/2022/10/24/csharp/clr-via-csharp/Chapter%207%20Constants%20and%20Fields/" rel="bookmark" title="CLR via C# - Chapter 7 Constants and Fields">CLR via C# - Chapter 7 Constants and Fields</a></li><li><a href="/2022/10/25/csharp/clr-via-csharp/Chapter%208%20Methods/" rel="bookmark" title="CLR via C# - Chapter 8 Methods">CLR via C# - Chapter 8 Methods</a></li><li><a href="/2022/10/27/csharp/clr-via-csharp/Chapter%209%20Parameters/" rel="bookmark" title="CLR via C# - Chapter 9 Parameters">CLR via C# - Chapter 9 Parameters</a></li><li><a href="/2022/10/28/csharp/clr-via-csharp/Chapter%2010%20Properties/" rel="bookmark" title="CLR via C# - Chapter 10 Properties">CLR via C# - Chapter 10 Properties</a></li><li><a href="/2022/10/29/csharp/clr-via-csharp/Chapter%2011%20Events/" rel="bookmark" title="CLR via C# - Chapter 11 Events">CLR via C# - Chapter 11 Events</a></li><li><a href="/2022/11/02/csharp/clr-via-csharp/Chapter%2012%20Generics/" rel="bookmark" title="CLR via C# - Chapter 12 Generics">CLR via C# - Chapter 12 Generics</a></li><li><a href="/2022/11/04/csharp/clr-via-csharp/Chapter%2013%20Interfaces/" rel="bookmark" title="CLR via C# - Chapter 13 Interfaces">CLR via C# - Chapter 13 Interfaces</a></li><li><a href="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/" rel="bookmark" title="CLR via C# - Chapter 14 Chars, Strings, and Working with Text">CLR via C# - Chapter 14 Chars, Strings, and Working with Text</a></li><li><a href="/2022/11/17/csharp/clr-via-csharp/Chapter%2015%20Enumerated%20Types%20and%20Bit%20Flags/" rel="bookmark" title="CLR via C# - Chapter 15 Enumerated Types and Bit Flags">CLR via C# - Chapter 15 Enumerated Types and Bit Flags</a></li><li><a href="/2022/11/19/csharp/clr-via-csharp/Chapter%2016%20Arrays/" rel="bookmark" title="CLR via C# - Chapter 16 Arrays">CLR via C# - Chapter 16 Arrays</a></li><li><a href="/2022/11/21/csharp/clr-via-csharp/Chapter%2017%20Delegates/" rel="bookmark" title="CLR via C# - Chapter 17 Delegates">CLR via C# - Chapter 17 Delegates</a></li><li class="active"><a href="/2022/11/22/csharp/clr-via-csharp/Chapter%2018%20Custom%20Attributes/" rel="bookmark" title="CLR via C# - Chapter 18 Custom Attributes">CLR via C# - Chapter 18 Custom Attributes</a></li><li><a href="/2022/11/23/csharp/clr-via-csharp/Chapter%2019%20Nullable%20Value%20Types/" rel="bookmark" title="CLR via C# - Chapter 19 Nullable Value Types">CLR via C# - Chapter 19 Nullable Value Types</a></li><li><a href="/2022/11/25/csharp/clr-via-csharp/Chapter%2020%20Exceptions%20and%20State%20Management/" rel="bookmark" title="CLR via C# - Chapter 20 Exceptions and State Management">CLR via C# - Chapter 20 Exceptions and State Management</a></li><li><a href="/2022/11/27/csharp/clr-via-csharp/Chapter%2021%20The%20Managed%20Heap%20and%20Garbage%20%20Collection/" rel="bookmark" title="CLR via C# - Chapter 21 The Managed Heap and Garbage  Collection">CLR via C# - Chapter 21 The Managed Heap and Garbage Collection</a></li><li><a href="/2022/11/28/csharp/clr-via-csharp/Chapter%2022%20CLR%20Hosting%20and%20AppDomains/" rel="bookmark" title="CLR via C# - Chapter 22 CLR Hosting and AppDomains">CLR via C# - Chapter 22 CLR Hosting and AppDomains</a></li><li><a href="/2022/11/29/csharp/clr-via-csharp/Chapter%2023%20Assembly%20Loading%20and%20Reflection/" rel="bookmark" title="CLR via C# - Chapter 23 Assembly Loading and Reflection">CLR via C# - Chapter 23 Assembly Loading and Reflection</a></li><li><a href="/2022/11/30/csharp/clr-via-csharp/Chapter%2024%20Runtime%20Serialization/" rel="bookmark" title="CLR via C# - Chapter 24 Runtime Serialization">CLR via C# - Chapter 24 Runtime Serialization</a></li><li><a href="/2022/12/06/csharp/clr-via-csharp/Chapter%2025%20Interoperating%20with%20WinRT%20%20Components/" rel="bookmark" title="CLR via C# - Chapter 25 Interoperating with WinRT Components">CLR via C# - Chapter 25 Interoperating with WinRT Components</a></li><li><a href="/2023/02/06/csharp/clr-via-csharp/Chapter%2026%20Thread%20Basics/" rel="bookmark" title="CLR via C# - Chapter 26 Thread Basics">CLR via C# - Chapter 26 Thread Basics</a></li><li><a href="/2023/02/07/csharp/clr-via-csharp/Chapter%2027%20Compute-Bound%20Asynchronous%20Operations/" rel="bookmark" title="CLR via C# - Chapter 27 Compute-Bound Asynchronous Operations">CLR via C# - Chapter 27 Compute-Bound Asynchronous Operations</a></li><li><a href="/2023/02/08/csharp/clr-via-csharp/Chapter%2028%20IO-Bound%20Asynchronous%20Operations/" rel="bookmark" title="CLR via C# - Chapter 28 IO-Bound Asynchronous Operations">CLR via C# - Chapter 28 IO-Bound Asynchronous Operations</a></li><li><a href="/2023/02/09/csharp/clr-via-csharp/Chapter%2029%20Primitive%20Thread%20Synchronization%20Constructs/" rel="bookmark" title="CLR via C# - Chapter 29 Primitive Thread Synchronization">CLR via C# - Chapter 29 Primitive Thread Synchronization</a></li><li><a href="/2023/02/10/csharp/clr-via-csharp/Chapter%2030%20Hybrid%20Thread%20Synchronization%20Constructs/" rel="bookmark" title="CLR via C# - Chapter 30 Hybrid Thread Synchronization">CLR via C# - Chapter 30 Hybrid Thread Synchronization</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Sakupinera" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Sakupinera</p><div class="description" itemprop="description">ä¿æŒä½ çš„å†³å¿ƒï¼</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">86</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">13</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">6</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Nha3VwaW5lcmE=" title="https:&#x2F;&#x2F;github.com&#x2F;sakupinera"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9zYWt1cGluZXJh" title="https:&#x2F;&#x2F;twitter.com&#x2F;sakupinera"><i class="ic i-twitter"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTQwNzIyOTA3MQ==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;407229071"><i class="ic i-cloud-music"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjIzMDczOTg/c3BtX2lkX2Zyb209MzMzLjEwMDcuMC4w" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;22307398?spm_id_from&#x3D;333.1007.0.0"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li><li class="item"><a href="/games/" rel="section"><i class="ic i-flag"></i>Games</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-person"></i>About</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/11/21/csharp/clr-via-csharp/Chapter%2017%20Delegates/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/11/23/csharp/clr-via-csharp/Chapter%2019%20Nullable%20Value%20Types/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Computer-Graphics/" title="In Computer-Graphics">Computer-Graphics</a> <i class="ic i-angle-right"></i> <a href="/categories/Computer-Graphics/GAMES101/" title="In GAMES101">GAMES101</a></div><span><a href="/2022/09/18/computer-graphics/games101/%E5%8F%98%E6%8D%A2/" title="GAMES101 - Transformationï¼ˆå˜æ¢ï¼‰">GAMES101 - Transformationï¼ˆå˜æ¢ï¼‰</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Cpp/" title="In Cpp">Cpp</a> <i class="ic i-angle-right"></i> <a href="/categories/Cpp/Cpp-Primer/" title="In Cpp-Primer">Cpp-Primer</a></div><span><a href="/2023/01/11/cpp/cpp-primer/Chapter%2019%20Specialized%20Tools%20and%20Techniques/" title="C++ Primer - Chapter 19 Specialized Tools and Techniques">C++ Primer - Chapter 19 Specialized Tools and Techniques</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/10/15/csharp/clr-via-csharp/Chapter%205%20Primitive,%20Reference,%20and%20Value%20%20Types/" title="CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals">CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Computer-Graphics/" title="In Computer-Graphics">Computer-Graphics</a> <i class="ic i-angle-right"></i> <a href="/categories/Computer-Graphics/GAMES101/" title="In GAMES101">GAMES101</a></div><span><a href="/2022/09/22/computer-graphics/games101/%E5%85%89%E6%A0%85%E5%8C%96/" title="GAMES101 - Rasterizationï¼ˆå…‰æ …åŒ–ï¼‰">GAMES101 - Rasterizationï¼ˆå…‰æ …åŒ–ï¼‰</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/10/28/csharp/clr-via-csharp/Chapter%2010%20Properties/" title="CLR via C# - Chapter 10 Properties">CLR via C# - Chapter 10 Properties</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CSharp-in-a-Nutshell/" title="In CSharp-in-a-Nutshell">CSharp-in-a-Nutshell</a></div><span><a href="/2022/08/29/csharp/csharp-in-a-nutshell/%E7%AC%AC3%E7%AB%A0%20%E5%9C%A8CSharp%E4%B8%AD%E5%88%9B%E5%BB%BA%E7%B1%BB%E5%9E%8B/" title="C# in a Nutshell - ç¬¬3ç«  åœ¨C#ä¸­åˆ›å»ºç±»å‹">C# in a Nutshell - ç¬¬3ç«  åœ¨C#ä¸­åˆ›å»ºç±»å‹</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="In Linux">Linux</a> <i class="ic i-angle-right"></i> <a href="/categories/Linux/Learn-Linux/" title="In Learn-Linux">Learn-Linux</a></div><span><a href="/2022/09/04/linux/learn-linux/Shell%E7%BC%96%E7%A8%8B/" title="LearnLinux - Shellç¼–ç¨‹">LearnLinux - Shellç¼–ç¨‹</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CSharp-in-a-Nutshell/" title="In CSharp-in-a-Nutshell">CSharp-in-a-Nutshell</a></div><span><a href="/2022/08/29/csharp/csharp-in-a-nutshell/%E7%AC%AC2%E7%AB%A0%20%E5%9C%A8CSharp%E4%B8%AD%E5%88%9B%E5%BB%BA%E7%B1%BB%E5%9E%8B/" title="C# in a Nutshell - ç¬¬2ç«  C#è¯­è¨€åŸºç¡€">C# in a Nutshell - ç¬¬2ç«  C#è¯­è¨€åŸºç¡€</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/" title="CLR via C# - Chapter 14 Chars, Strings, and Working with Text">CLR via C# - Chapter 14 Chars, Strings, and Working with Text</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="In Linux">Linux</a> <i class="ic i-angle-right"></i> <a href="/categories/Linux/Learn-Linux/" title="In Learn-Linux">Learn-Linux</a></div><span><a href="/2022/09/05/linux/learn-linux/%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D/" title="LearnLinux - å¤‡ä»½ä¸æ¢å¤">LearnLinux - å¤‡ä»½ä¸æ¢å¤</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 â€“ <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Sakupinera @ Hanamai Sora</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">2.2m words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">33:30</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/11/22/csharp/clr-via-csharp/Chapter 18 Custom Attributes/",favicon:{show:"ï¼ˆâ—Â´3ï½€â—ï¼‰Goooood",hide:"(Â´Ğ”ï½€)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/assets/shifuku.model.json"},display:{position:"left",width:250,height:500},mobile:{show:!1},react:{opacity:.9},log:!1})</script></body></html>
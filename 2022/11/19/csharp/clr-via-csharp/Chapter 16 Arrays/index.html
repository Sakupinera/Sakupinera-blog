<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Sakupinera" href="http://sakupinera.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Sakupinera" href="http://sakupinera.github.io/atom.xml"><link rel="alternate" type="application/json" title="Sakupinera" href="http://sakupinera.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="è¯»ä¹¦ç¬”è®°,C#"><link rel="canonical" href="http://sakupinera.github.io/2022/11/19/csharp/clr-via-csharp/Chapter%2016%20Arrays/"><title>CLR via C# - Chapter 16 Arrays - CLR-via-CSharp - CSharp | Hanamai Sora = Sakupinera</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">CLR via C# - Chapter 16 Arrays</h1><div class="meta"><span class="item" title="Created: 2022-11-19 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2022-11-19T00:00:00+08:00">2022-11-19</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>38k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>34 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Hanamai Sora</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://s2.loli.net/2023/03/08/Z2QTWRnpq3aDLdM.png"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/OQq9sc7VlKfnvGL.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/lrzLEXqhHuVUcP2.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/utEsOX73wkq1ycI.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/Rft6Y9pgTV5E17J.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/03/08/Z2usRnE64TXN1Lp.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CSharp/" itemprop="item" rel="index" title="In CSharp"><span itemprop="name">CSharp</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CSharp/CLR-via-CSharp/" itemprop="item" rel="index" title="In CLR-via-CSharp"><span itemprop="name">CLR-via-CSharp</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="http://sakupinera.github.io/2022/11/19/csharp/clr-via-csharp/Chapter%2016%20Arrays/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Sakupinera"><meta itemprop="description" content=", ä¿æŒä½ çš„å†³å¿ƒï¼"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sakupinera"></span><div class="body md" itemprop="articleBody"><h1 id="chapter-16-arrays"><a class="anchor" href="#chapter-16-arrays">#</a> Chapter 16 Arrays</h1><blockquote><p>Arrays are mechanisms that allow you to treat several items as a single collection. The Microsoft .NET common language runtime (CLR) supports single-dimensional arrays, multi-dimensional arrays, and jagged arrays (that is, arrays of arrays). All array types are implicitly derived from the <code>System.Array</code> abstract class, which itself is derived from <code>System.Object</code> . This means that arrays are always reference types that are allocated on the managed heap and that your applicationâ€™s variable or field contains a reference to the array and not the elements of the array itself. The following code makes this clearer.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> myIntegers<span class="token punctuation">;</span> <span class="token comment">// Declares a reference to an array </span></pre></td></tr><tr><td data-num="2"></td><td><pre>myIntegers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Creates an array of 100 Int32s</span></pre></td></tr></table></figure><blockquote><p>On the first line, myIntegers is a variable thatâ€™s capable of pointing to a single-dimensional array of Int32s. Initially, myIntegers will be set to null because I havenâ€™t allocated an array. The second line of code allocates an array of 100 Int32 values; all of the Int32s are initialized to 0. Because arrays are reference types, the memory block required to hold the 100 unboxed Int32s is allocated on the managed heap. Actually, in addition to the arrayâ€™s elements, the memory block occupied by an array object also contains a type object pointer, a sync block index, and some additional overhead members as well. The address of this arrayâ€™s memory block is returned and saved in the variable myIntegers.</p></blockquote><blockquote><p>You can also create arrays of reference types.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Control<span class="token punctuation">[</span><span class="token punctuation">]</span></span> myControls<span class="token punctuation">;</span> <span class="token comment">// Declares a reference to an array </span></pre></td></tr><tr><td data-num="2"></td><td><pre>myControls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Control</span><span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Creates an array of 50 Control references</span></pre></td></tr></table></figure><blockquote><p>On the first line, myControls is a variable capable of pointing to a single-dimensional array of Control references. Initially, myControls will be set to null because I havenâ€™t allocated an array. The second line allocates an array of 50 Control references; all of these references are initialized to null. Because Control is a reference type, creating the array creates only a bunch of references; the actual objects arenâ€™t created at this time. The address of this memory block is returned and saved in the variable myControls.</p></blockquote><blockquote><p>Figure 16-1 shows how arrays of value types and arrays of reference types look in the managed heap.</p></blockquote><p><img data-src="/2022/11/19/csharp/clr-via-csharp/Chapter%2016%20Arrays/image-20221118120658511.png" alt="image-20221118120658511"></p><blockquote><p>In the figure, the Controls array shows the result after the following lines have executed.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre>myControls<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>myControls<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TextBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>myControls<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> myControls<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Two elements refer to the same object. </span></pre></td></tr><tr><td data-num="4"></td><td><pre>myControls<span class="token punctuation">[</span><span class="token number">46</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataGrid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre>myControls<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ComboBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>myControls<span class="token punctuation">[</span><span class="token number">49</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>Common Language Specification (CLS) compliance requires all arrays to be zero-based. This allows a method written in C# to create an array and pass the arrayâ€™s reference to code written in another language, such as Microsoft Visual Basic .NET. In addition, because zero-based arrays are, by far, the most common arrays, Microsoft has spent a lot of time optimizing their performance. However, the CLR does support non-zeroâ€“based arrays even though their use is discouraged. For those of you who donâ€™t care about a slight performance penalty or cross-language portability, Iâ€™ll demonstrate how to create and use non-zeroâ€“based arrays later in this chapter.</p></blockquote><blockquote><p>Notice in Figure 16-1 that each array has some additional overhead information associated with it. This information contains the rank of the array (number of dimensions), the lower bounds for each dimension of the array (almost always 0), and the length of each dimension. The overhead also contains the arrayâ€™s element type. Iâ€™ll mention the methods that allow you to query this overhead information later in this chapter.</p></blockquote><blockquote><p>So far, Iâ€™ve shown examples demonstrating how to create single-dimensional arrays. When possible, you should stick with single-dimensional, zero-based arrays, sometimes referred to as SZ arrays, or vectors. Vectors give the best performance because you can use specific Intermediate Language (IL) instructionsâ€”such as newarr, ldelem, ldelema, ldlen, and stelemâ€”to manipulate them. However, if you prefer to work with multi-dimensional arrays, you can. Here are some examples of multi-dimensional arrays.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Create a two-dimensional array of Doubles. </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Double<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> myDoubles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Double</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// Create a three-dimensional array of String references. </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> myStrings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">String</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>The CLR also supports jagged arrays, which are arrays of arrays. Zero-based, single-dimensional jagged arrays have the same performance as normal vectors. However, accessing the elements of a jagged array means that two or more array accesses must occur. Here are some examples of how to create an array of polygons with each polygon consisting of an array of Point instances.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Create a single-dimensional array of Point arrays. </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Point<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> myPolygons <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// myPolygons[0] refers to an array of 10 Point instances. </span></pre></td></tr><tr><td data-num="4"></td><td><pre>myPolygons<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// myPolygons[1] refers to an array of 20 Point instances. </span></pre></td></tr><tr><td data-num="6"></td><td><pre>myPolygons<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// myPolygons[2] refers to an array of 30 Point instances. </span></pre></td></tr><tr><td data-num="8"></td><td><pre>myPolygons<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Point</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// Display the Points in the first polygon. </span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> myPolygons<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Length<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>myPolygons<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">x</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>ğŸ’¡æ³¨æ„ï¼šCLR ä¼šéªŒè¯æ•°ç»„ç´¢å¼•çš„æœ‰æ•ˆæ€§ã€‚æ¢å¥è¯è¯´ï¼Œä¸èƒ½åˆ›å»ºå«æœ‰ 100 ä¸ªå…ƒç´ çš„æ•°ç»„ (ç´¢å¼•ç¼–å· 0 åˆ° 99)ï¼Œç„¶åè¯•å›¾è®¿é—®ç´¢å¼•ä¸º -5 æˆ– 100 çš„å…ƒç´ ã€‚è¿™æ ·åšä¼šå¯¼è‡´ <code>System.IndexOutOfRangeException</code> å¼‚å¸¸ã€‚å…è®¸è®¿é—®æ•°ç»„èŒƒå›´ä¹‹å¤–çš„å†…å­˜ä¼šç ´åç±»å‹å®‰å…¨æ€§ï¼Œè€Œä¸”ä¼šé€ æˆæ½œåœ¨çš„å®‰å…¨æ¼æ´ï¼Œæ‰€ä»¥ CLR ä¸å…è®¸å¯éªŒè¯çš„ä»£ç è¿™ä¹ˆåšã€‚é€šå¸¸ï¼Œç´¢å¼•èŒƒå›´æ£€æŸ¥å¯¹æ€§èƒ½çš„å½±å“å¾®ä¹å…¶å¾®ï¼Œå› ä¸º JIT ç¼–è¯‘å™¨é€šå¸¸åªåœ¨å¾ªç¯å¼€å§‹ä¹‹å‰æ£€æŸ¥ä¸€æ¬¡æ•°ç»„è¾¹ç•Œï¼Œè€Œä¸æ˜¯æ¯æ¬¡å¾ªç¯è¿­ä»£éƒ½æ£€æŸ¥ &lt;sup&gt;â‘ &lt;/sup&gt;ã€‚ä¸è¿‡ï¼Œå¦‚æœä»ç„¶æ‹…å¿ƒ CLR ç´¢å¼•æ£€æŸ¥é€ æˆçš„æ€§èƒ½æŸå¤±ï¼Œå¯ä»¥åœ¨ C# ä¸­ä½¿ç”¨ unsafe ä»£ç æ¥è®¿é—®æ•°ç»„ã€‚16.7 èŠ‚ â€œæ•°ç»„çš„å†…éƒ¨å·¥ä½œåŸç†â€ å°†æ¼”ç¤ºå…·ä½“åšæ³•ã€‚</p><p>â‘  ä¸è¦æ··æ·† â€œå¾ªç¯â€ å’Œ â€œå¾ªç¯è¿­ä»£â€ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š</p><pre><code class="language-C#">Int32[] myArray = new Int32[100];
for (Int32 i = 0; i &lt; myArray.Length; i++) myArray[i] = i;
</code></pre><p>â€œ <code>for</code> å¾ªç¯â€ æ€»å…±è¦ â€œå¾ªç¯è¿­ä»£ 100 æ¬¡â€ï¼Œæœ‰æ—¶ä¹Ÿç®€å•åœ°è¯´ â€œè¿­ä»£ 100 æ¬¡â€ã€‚</p><p>ğŸ’¡å°ç»“ï¼šæ‰€æœ‰æ•°ç»„ç±»å‹éƒ½éšå¼åœ°ä» <code>System.Array</code> æŠ½è±¡ç±»æ´¾ç”Ÿï¼Œåè€…åˆæ´¾ç”Ÿè‡ª <code>System.Object</code> ã€‚è¿™æ„å‘³ç€æ•°ç»„å§‹ç»ˆæ˜¯å¼•ç”¨ç±»å‹ï¼Œæ˜¯åœ¨æ‰˜ç®¡å †ä¸Šåˆ†é…çš„ã€‚å®é™…ä¸Šï¼Œé™¤äº†æ•°ç»„å…ƒç´ ï¼Œæ•°ç»„å¯¹è±¡å æ®çš„å†…å­˜å—è¿˜åŒ…å«ä¸€ä¸ªç±»å‹å¯¹è±¡æŒ‡é’ˆã€ä¸€ä¸ªåŒæ­¥å—ç´¢å¼•å’Œä¸€äº›é¢å¤–çš„æˆå‘˜ã€‚ä¸ºäº†ç¬¦åˆ â€œå…¬å…±è¯­è¨€è§„èŒƒâ€ï¼ˆCommon Language Specificationï¼ŒCLSï¼‰çš„è¦æ±‚ï¼Œæ‰€æœ‰æ•°ç»„éƒ½å¿…é¡»æ˜¯ 0 åŸºæ•°ç»„ï¼ˆå³æœ€å°ç´¢å¼•ä¸º 0ï¼‰ã€‚è¿™æ ·å°±å¯ä»¥ç”¨ C# çš„æ–¹æ³•åˆ›å»ºæ•°ç»„ï¼Œå¹¶å°†è¯¥æ•°ç»„çš„å¼•ç”¨ä¼ ç»™å…¶ä»–è¯­è¨€ï¼ˆæ¯”å¦‚ Microsoft Visual Basic .NETï¼‰å†™çš„ä»£ç ã€‚ä¸è¿‡ CLR ç¡®å®æ”¯æŒé 0 åŸºæ•°ç»„ï¼Œåªæ˜¯ä¸æå€¡ä½¿ç”¨ã€‚æ¯ä¸ªæ•°ç»„éƒ½å…³è”äº†ä¸€äº›é¢å¤–çš„å¼€é”€ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯åŒ…æ‹¬æ•°ç»„çš„ç§©ï¼ˆå³ rankï¼Œæˆ–ç§°æ•°ç»„çš„ç»´æ•°ï¼‰ã€æ•°ç»„æ¯ä¸€ç»´çš„ä¸‹é™ï¼ˆå‡ ä¹æ€»æ˜¯ 0ï¼‰å’Œæ¯ä¸€ç»´çš„é•¿åº¦ã€‚å¼€é”€ä¿¡æ¯è¿˜åŒ…å«æ•°ç»„çš„å…ƒç´ ç±»å‹ã€‚åº”å°½å¯èƒ½ä½¿ç”¨ä¸€ç»´ 0 åŸºæ•°ç»„ï¼Œæœ‰æ—¶ä¹Ÿå°†è¿™ç§æ•°ç»„ç§°ä¸º SZï¼ˆsingle-dimensionï¼Œzero-basedï¼‰æ•°ç»„æˆ–å‘é‡ï¼ˆvectorï¼‰ã€‚å‘é‡çš„æ€§èƒ½æ˜¯æœ€ä½³çš„ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„ IL æŒ‡ä»¤ï¼ˆæ¯”å¦‚ newarrï¼Œldelemï¼Œldelemaï¼Œldlen å’Œ stelemï¼‰æ¥å¤„ç†ã€‚å¿…è¦æ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šç»´æ•°ç»„ã€‚CLR è¿˜æ”¯æŒäº¤é”™æ•°ç»„ï¼ˆjagged arrayï¼‰ï¼Œå³æ•°ç»„æ„æˆçš„æ•°ç»„ã€‚0 åŸºä¸€ç»´äº¤é”™æ•°ç»„çš„æ€§èƒ½å’Œæ™®é€šå‘é‡ä¸€æ ·å¥½ã€‚ä¸è¿‡ï¼Œè®¿é—®äº¤é”™æ•°ç»„çš„å…ƒç´ æ„å‘³ç€å¿…é¡»è¿›è¡Œä¸¤æ¬¡æˆ–æ›´å¤šæ¬¡æ•°ç»„è®¿é—®ã€‚</p><h2 id="initializing-array-elements"><a class="anchor" href="#initializing-array-elements">#</a> Initializing Array Elements</h2><blockquote><p>In the previous section, I showed how to create an array object and then I showed how to initialize the elements of the array. C# offers syntax that allows you to do these two operations in one statement. The following shows an example.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> names <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token string">"Aidan"</span><span class="token punctuation">,</span> <span class="token string">"Grant"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>The comma-separated set of tokens contained within the braces is called an array initializer. Each token can be an arbitrarily complex expression or, in the case of a multi-dimensional array, a nested array initializer. In the preceding example, I used just two simple String expressions.</p></blockquote><blockquote><p>If you are declaring a local variable in a method to refer to the initialized array, then you can use C#â€™s implicitly typed local variable (var) feature to simplify the code a little.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Using C#â€™s implicitly typed local variable feature:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name"><span class="token keyword">var</span></span> names <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token string">"Aidan"</span><span class="token punctuation">,</span> <span class="token string">"Grant"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>Here, the compiler is inferring that the names local variable should be of the String[] type because that is the type of the expression on the right of the assignment operator (=).</p></blockquote><blockquote><p>You can use C#â€™s implicitly typed array feature to have the compiler infer the type of the arrayâ€™s elements. Notice the following line has no type specified between new and [].</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Using C#â€™s implicitly typed local variable and implicitly typed array features:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name"><span class="token keyword">var</span></span> names <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token string">"Aidan"</span><span class="token punctuation">,</span> <span class="token string">"Grant"</span><span class="token punctuation">,</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>In the preceding line, the compiler examines the types of the expressions being used inside the array to initialize the arrayâ€™s elements, and the compiler chooses the closest base class that all the elements have in common to determine the type of the array. In this example, the compiler sees two Strings and null. Because null is implicitly castable to any reference type (including String), the compiler infers that it should be creating and initializing an array of String references.</p></blockquote><blockquote><p>If you had this code:</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Using C#â€™s implicitly typed local variable &amp; implicitly typed array features: (error)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name"><span class="token keyword">var</span></span> names <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token string">"Aidan"</span><span class="token punctuation">,</span> <span class="token string">"Grant"</span><span class="token punctuation">,</span> <span class="token number">123</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>the compiler would issue the message error CS0826: No best type found for implicitlytyped array. This is because the base type in common between the two Strings and the Int32 is Object, which would mean that the compiler would have to create an array of Object references and then box the 123 and have the last array element refer to a boxed Int32 with a value of 123. The C# compiler team thinks that boxing array elements is too heavy-handed for the compiler to do for you implicitly, and that is why the compiler issues the error.</p></blockquote><blockquote><p>As an added syntactical bonus when initializing an array, you can write the following.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> names <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"Aidan"</span><span class="token punctuation">,</span> <span class="token string">"Grant"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>Notice that on the right of the assignment operator (=), only the array initializer expression is given with no new, no type, and no []s. This syntax is nice, but unfortunately, the C# compiler does not allow you to use implicitly typed local variables with this syntax.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// This is a local variable now (error)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name"><span class="token keyword">var</span></span> names <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">"Aidan"</span><span class="token punctuation">,</span> <span class="token string">"Grant"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>If you try to compile the preceding line of code, the compiler issues two messages: error CS0820: Cannot initialize an implicitly-typed local variable with an array initializer and error CS0622: Can only use array initializer expressions to assign to array types. Try using a new expression instead. Although the compiler could make this work, the C# team thought that the compiler would be doing too much for you here. It would be inferring the type of the array, newâ€™ing the array, initializing the array, and inferring the type of the local variable, too.</p></blockquote><blockquote><p>The last thing Iâ€™d like to show you is how to use implicitly typed arrays with anonymous types and implicitly typed local variables. Anonymous types and how type identity applies to them are discussed in Chapter 10, â€œProperties.â€ Examine the following code.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Using C#â€™s implicitly typed local, implicitly typed array, and anonymous type features:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name"><span class="token keyword">var</span></span> kids <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token keyword">new</span> <span class="token punctuation">&#123;</span> Name<span class="token operator">=</span><span class="token string">"Aidan"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token punctuation">&#123;</span> Name<span class="token operator">=</span><span class="token string">"Grant"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// Sample usage (with another implicitly typed local variable):</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> kid <span class="token keyword">in</span> kids<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>kid<span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>In this example, I am using an array initializer that has two expressions for the array elements. Each expression represents an anonymous type (because no type name is specified after the new operator). Because the two anonymous types have the identical structure (one field called Name of type String), the compiler knows that these two objects are of the exact same type. Now, I use C#â€™s implicitly typed array feature (no type specified between the new and the []s) so that the compiler will infer the type of the array itself, construct this array object, and initialize its references to the two instances of the one anonymous type.1 Finally, a reference to this array object is assigned to the kids local variable, the type of which is inferred by the compiler due to C#â€™s implicitly typed local variable feature.</p></blockquote><blockquote><p>I show the foreach loop as an example of how to use this array that was just created and initialized with the two anonymous type objects. I have to use an implicitly typed local variable (kid) for the loop, too. When I run this code, I get the following output.</p></blockquote><pre><code class="language-cmd">Aidan
Grant
</code></pre><p>ğŸ’¡å°ç»“ï¼šC# å…è®¸ç”¨ä¸€ä¸ªè¯­å¥åˆ›å»ºæ•°ç»„å¯¹è±¡å¹¶åˆå§‹åŒ–æ•°ç»„ä¸­çš„å…ƒç´ ã€‚å¤§æ‹¬å·ä¸­çš„ä»¥é€—å·åˆ†éš”çš„æ•°æ®é¡¹ç§°ä¸ºæ•°ç»„åˆå§‹åŒ–å™¨ï¼ˆarray initializerï¼‰ã€‚æ¯ä¸ªæ•°æ®é¡¹éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªä»»æ„å¤æ‚åº¦çš„è¡¨è¾¾å¼ï¼›åœ¨å¤šç»´æ•°ç»„çš„æƒ…å†µä¸‹ï¼Œåˆ™å¯ä»¥æ˜¯ä¸€ä¸ªåµŒå¥—çš„æ•°ç»„åˆå§‹åŒ–å™¨ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ C# çš„ â€œéšå¼ç±»å‹çš„å±€éƒ¨å˜é‡â€ æˆ–è€… C# çš„éšå¼ç±»å‹çš„æ•°ç»„åŠŸèƒ½æ¥ç®€åŒ–ä»£ç ã€‚ä½œä¸ºåˆå§‹åŒ–æ•°ç»„æ—¶çš„ä¸€ä¸ªé¢å¤–çš„è¯­æ³•å¥–åŠ±ï¼Œèµ‹å€¼æ“ä½œç¬¦ï¼ˆ=ï¼‰å³ä¾§åªç»™å‡ºäº†ä¸€ä¸ªåˆå§‹åŒ–å™¨ï¼Œæ²¡æœ‰ newï¼Œæ²¡æœ‰ç±»å‹ï¼Œæ²¡æœ‰ []ã€‚è¿™ä¸ªè¯­æ³•å¯è¯»æ€§å¾ˆå¥½ï¼Œä¸è¿‡ C# ç¼–è¯‘å™¨ä¸å…è®¸åœ¨è¿™ç§è¯­æ³•ä¸­ä½¿ç”¨éšå¼ç±»å‹çš„å±€éƒ¨å˜é‡ï¼Œå› ä¸º C# å›¢é˜Ÿè®¤ä¸ºç¼–è¯‘å™¨åœ¨è¿™é‡Œä¼šä¸ºä½ åšå¤ªå¤šçš„å·¥ä½œã€‚å®ƒè¦æ¨æ–­æ•°ç»„ç±»å‹ï¼Œæ–°å»ºæ•°ç»„å¯¹è±¡ï¼Œåˆå§‹åŒ–æ•°ç»„ï¼Œè¿˜è¦æ¨æ–­å±€éƒ¨å˜é‡çš„ç±»å‹ã€‚</p><h2 id="casting-arrays"><a class="anchor" href="#casting-arrays">#</a> Casting Arrays</h2><blockquote><p>For arrays with reference type elements, the CLR allows you to implicitly cast the source arrayâ€™s element type to a target type. For the cast to succeed, both array types must have the same number of dimensions, and an implicit or explicit conversion from the source element type to the target element type must exist. The CLR doesnâ€™t allow the casting of arrays with value type elements to any other type. (However, by using the <code>Array.Copy</code> method, you can create a new array and populate its elements in order to obtain the desired effect.) The following code demonstrates how array casting works.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Create a two-dimensional FileStream array. </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">FileStream<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> fs2dim <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FileStream</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// Implicit cast to a two-dimensional Object array </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">Object<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> o2dim <span class="token operator">=</span> fs2dim<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// Can't cast from two-dimensional array to one-dimensional array </span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// Compiler error CS0030: Cannot convert type 'object[*,*]' to </span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// 'System.IO.Stream[]' </span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token class-name">Stream<span class="token punctuation">[</span><span class="token punctuation">]</span></span> s1dim <span class="token operator">=</span> <span class="token punctuation">(</span>Stream<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> o2dim<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// Explicit cast to two-dimensional Stream array </span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token class-name">Stream<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> s2dim <span class="token operator">=</span> <span class="token punctuation">(</span>Stream<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span> o2dim<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// Explicit cast to two-dimensional String array </span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// Compiles but throws InvalidCastException at runtime</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> st2dim <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span> o2dim<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// Create a one-dimensional Int32 array (value types). </span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> i1dim <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">// Can't cast from array of value types to anything else </span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// Compiler error CS0030: Cannot convert type 'int[]' to 'object[]' </span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token class-name">Object<span class="token punctuation">[</span><span class="token punctuation">]</span></span> o1dim <span class="token operator">=</span> <span class="token punctuation">(</span>Object<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> i1dim<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">// Create a new array, then use Array.Copy to coerce each element in the </span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">// source array to the desired type in the destination array. </span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">// The following code creates an array of references to boxed Int32s. </span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token class-name">Object<span class="token punctuation">[</span><span class="token punctuation">]</span></span> ob1dim <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Object</span><span class="token punctuation">[</span>i1dim<span class="token punctuation">.</span>Length<span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="23"></td><td><pre>Array<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>i1dim<span class="token punctuation">,</span> ob1dim<span class="token punctuation">,</span> i1dim<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>The <code>Array.Copy</code> method is not just a method that copies elements from one array to another. The Copy method handles overlapping regions of memory correctly, as does Câ€™s <code>memmove</code> function. Câ€™s <code>memcpy</code> function, on the other hand, doesnâ€™t handle overlapping regions correctly. The Copy method can also convert each array element as it is copied if conversion is required. The Copy method is capable of performing the following conversions:</p><ul><li><p>Boxing value type elements to reference type elements, such as copying an Int32[] to an Object[].</p></li><li><p>Unboxing reference type elements to value type elements, such as copying an Object[] to an Int32[].</p></li><li><p>Widening CLR primitive value types, such as copying elements from an Int32[] to a Double[].</p></li><li><p>Downcasting elements when copying between array types that canâ€™t be proven to be compatible based on the arrayâ€™s type, such as when casting from an Object[] to an <code>IFormattable[]</code> . If every object in the Object[] implements <code>IFormattable</code> , Copy will succeed.</p></li></ul></blockquote><blockquote><p>Hereâ€™s another example showing the usefulness of Copy.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Define a value type that implements an interface. </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">struct</span> <span class="token class-name">MyValueType</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IComparable</span></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name">Int32</span> <span class="token function">CompareTo</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token range operator">..</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token comment">// Create an array of 100 value types. </span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token class-name">MyValueType<span class="token punctuation">[</span><span class="token punctuation">]</span></span> src <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyValueType</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token comment">// Create an array of IComparable references. </span></pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token class-name">IComparable<span class="token punctuation">[</span><span class="token punctuation">]</span></span> dest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IComparable</span><span class="token punctuation">[</span>src<span class="token punctuation">.</span>Length<span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token comment">// Initialize an array of IComparable elements to refer to boxed </span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token comment">// versions of elements in the source array. </span></pre></td></tr><tr><td data-num="15"></td><td><pre> Array<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> src<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>As you might imagine, the Framework Class Library (FCL) takes advantage of Arrayâ€™s Copy method quite frequently.</p></blockquote><blockquote><p>In some situations, it is useful to cast an array from one type to another. This kind of functionality is called array covariance. When you take advantage of array covariance, you should be aware of an associated performance penalty. Letâ€™s say you have the following code.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> sa <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">String</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Object<span class="token punctuation">[</span><span class="token punctuation">]</span></span> oa <span class="token operator">=</span> sa<span class="token punctuation">;</span> <span class="token comment">// oa refers to an array of String elements </span></pre></td></tr><tr><td data-num="3"></td><td><pre>oa<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Jeff"</span><span class="token punctuation">;</span> <span class="token comment">// Perf hit: CLR checks oa's element type for String; OK </span></pre></td></tr><tr><td data-num="4"></td><td><pre>oa<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// Perf hit: CLR checks oa's element type for Int32; throws </span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token comment">// ArrayTypeMismatchException</span></pre></td></tr></table></figure><blockquote><p>In the preceding code, the oa variable is typed as an Object[]; however, it really refers to a String[]. The compiler will allow you to write code that attempts to put a 5 into an array element because 5 is an Int32, which is derived from Object. Of course, the CLR must ensure type safety, and when assigning to an array element, the CLR must ensure that the assignment is legal. So the CLR must check at run time whether the array contains Int32 elements. In this case, it doesnâ€™t, and the assignment cannot be allowed; the CLR will throw an ArrayTypeMismatchException.</p></blockquote><p>ğŸ’¡æ³¨æ„ï¼šå¦‚æœåªæ˜¯éœ€è¦å°†æ•°ç»„çš„æŸäº›å…ƒç´ å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ•°ç»„ï¼Œå¯é€‰æ‹© <code>System.Buffer</code> çš„ <code>BlockCopy</code> æ–¹æ³•ï¼Œå®ƒæ¯” <code>Array</code> çš„ <code>Copy</code> æ–¹æ³•å¿«ã€‚ä½† <code>Buffer</code> çš„ <code>BlockCopy</code> æ–¹æ³•åªæ”¯æŒåŸºäºç±»å‹ï¼Œä¸æä¾›åƒ <code>Array</code> çš„ <code>Copy</code> æ–¹æ³•é‚£æ ·çš„è½¬å‹èƒ½åŠ›ã€‚æ–¹æ³•çš„ <code>Int32</code> å‚æ•°ä»£è¡¨çš„æ˜¯æ•°ç»„ä¸­çš„å­—èŠ‚åç§»é‡ï¼Œè€Œéå…ƒç´ ç´¢å¼•ã€‚è®¾è®¡ <code>BlockCopy</code> çš„ç›®çš„å®é™…æ˜¯å°†æŒ‰ä½å…¼å®¹ (bitwise-compatible)&lt;sup&gt;â‘ &lt;/sup &gt; çš„æ•°æ®ä»ä¸€ä¸ªæ•°ç»„ç±»å‹å¤åˆ¶åˆ°å¦ä¸€ä¸ªæŒ‰ä½å…¼å®¹çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚å°†åŒ…å« Unicode å­—ç¬¦çš„ä¸€ä¸ª <code>Byte[]</code> (æŒ‰å­—èŠ‚çš„æ­£ç¡®é¡ºåº) å¤åˆ¶åˆ°ä¸€ä¸ª <code>Char[]</code> ä¸­ï¼Œè¯¥æ–¹æ³•ä¸€å®šç¨‹åº¦ä¸Šå¼¥è¡¥äº†ä¸èƒ½å°†æ•°ç»„å½“ä½œä»»æ„ç±»å‹çš„å†…å­˜å—æ¥å¤„ç†çš„ä¸è¶³ã€‚</p><p>è¦å°†ä¸€ä¸ªæ•°ç»„çš„å…ƒç´ å¯é åœ°å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ•°ç»„ï¼Œåº”è¯¥ä½¿ç”¨ <code>System.Array</code> çš„ <code>ConstrainedCopy</code> æ–¹æ³•ã€‚è¯¥æ–¹æ³•è¦ä¹ˆå®Œæˆå¤åˆ¶ï¼Œè¦ä¹ˆæŠ›å‡ºå¼‚å¸¸ï¼Œæ€»ä¹‹ä¸ä¼šç ´åç›®æ ‡æ•°ç»„ä¸­çš„æ•°æ®ã€‚è¿™å°±å…è®¸ <code>ConstrainedCopy</code> åœ¨çº¦æŸæ‰§è¡ŒåŒºåŸŸ (Constrained Execution Region, CER) ä¸­æ‰§è¡Œã€‚ä¸ºäº†æä¾›è¿™ç§ä¿è¯ï¼Œ <code>ConstrainedCopy</code> è¦æ±‚æºæ•°ç»„çš„å…ƒç´ ç±»å‹è¦ä¹ˆä¸ç›®æ ‡æ•°ç»„çš„å…ƒç´ ç±»å‹ç›¸åŒï¼Œè¦ä¹ˆæ´¾ç”Ÿè‡ªç›®æ ‡æ•°ç»„çš„å…ƒç´ ç±»å‹ã€‚å¦å¤–ï¼Œå®ƒä¸æ‰§è¡Œä»»ä½•è£…ç®±ã€æ‹†ç®±æˆ–å‘ä¸‹ç±»å‹è½¬å‹ã€‚</p><p>ğŸ’¡å°ç»“ï¼šå¯¹äºå…ƒç´ ä¸ºå¼•ç”¨ç±»å‹çš„æ•°ç»„ï¼ŒCLR å…è®¸å°†æ•°ç»„å…ƒç´ ä»ä¸€ç§ç±»å‹è½¬å‹ä¸ºå¦ä¸€ç§ã€‚æˆåŠŸè½¬å‹è¦æ±‚æ•°ç»„ç»´æ•°ç›¸åŒï¼Œè€Œä¸”å¿…é¡»å­˜åœ¨ä»å…ƒç´ æºç±»å‹åˆ°ç›®æ ‡ç±»å‹çš„éšå¼æˆ–æ˜¾å¼è½¬æ¢ã€‚CLR ä¸å…è®¸å°†å€¼ç±»å‹å…ƒç´ çš„æ•°ç»„è½¬å‹ä¸ºå…¶ä»–ä»»ä½•ç±»å‹ã€‚ä¸è¿‡ï¼Œå¯ç”¨ <code>Array.Copy</code> æ–¹æ³•åˆ›å»ºæ–°æ•°ç»„å¹¶åœ¨å…¶ä¸­å¡«å……å…ƒç´ æ¥æ¨¡æ‹Ÿè¿™ç§æ•ˆæœã€‚Copy æ–¹æ³•è¿˜èƒ½æ­£ç¡®å¤„ç†å†…å­˜çš„é‡å åŒºåŸŸï¼Œå°±åƒ C çš„ <code>memmove</code> å‡½æ•°ä¸€æ ·ã€‚Copy æ–¹æ³•è¿˜èƒ½åœ¨å¤åˆ¶æ¯ä¸ªæ•°ç»„å…ƒç´ æ—¶è¿›è¡Œå¿…è¦çš„ç±»å‹è½¬æ¢ã€‚æœ‰æ—¶ç¡®å®éœ€è¦å°†æ•°ç»„ä»ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ã€‚è¿™ç§åŠŸèƒ½ç§°ä¸ºæ•°ç»„åå˜æ€§ï¼ˆarray covarianceï¼‰ã€‚ä½†åœ¨åˆ©ç”¨å®ƒæ—¶è¦æ¸…æ¥šç”±æ­¤è€Œæ¥çš„æ€§èƒ½æŸå¤±ã€‚</p><h2 id="all-arrays-are-implicitly-derived-from-systemarray"><a class="anchor" href="#all-arrays-are-implicitly-derived-from-systemarray">#</a> All Arrays Are Implicitly Derived from System.Array</h2><blockquote><p>When you declare an array variable like this:</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">FileStream<span class="token punctuation">[</span><span class="token punctuation">]</span></span> fsArray<span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>then the CLR automatically creates a FileStream[] type for the AppDomain. This type will be implicitly derived from the System.Array type, and therefore, all of the instance methods and properties defined on the System.Array type will be inherited by the FileStream[] type, allowing these methods and properties to be called using the fsArray variable. This makes working with arrays extremely convenient because there are many helpful instance methods and properties defined by System.Array, such as Clone, CopyTo, GetLength, GetLongLength, GetLowerBound, GetUpperBound, Length, Rank, and others.</p></blockquote><blockquote><p>The System.Array type also exposes a large number of extremely useful static methods that operate on arrays. These methods all take a reference to an array as a parameter. Some of the useful static methods are AsReadOnly, BinarySearch, Clear, ConstrainedCopy, ConvertAll, Copy, Exists, Find, FindAll, FindIndex, FindLast, FindLastIndex, ForEach, IndexOf, LastIndexOf, Resize, Reverse, Sort, and TrueForAll. There are many overloads for each of these methods. In fact, many of the methods provide generic overloads for compile-time type safety as well as good performance. I encourage you to examine the SDK documentation to get an understanding of how useful and powerful these methods are.</p></blockquote><p>ğŸ’¡å°ç»“ï¼šå£°æ˜ XXX ç±»å‹æ•°ç»„å˜é‡æ—¶ï¼ŒCLR ä¼šè‡ªåŠ¨ä¸º <code>AppDomain</code> åˆ›å»ºä¸€ä¸ª <code>XXX[]</code> ç±»å‹ã€‚è¯¥ç±»å‹éšå¼æ´¾ç”Ÿè‡ª <code>System.Array</code> ç±»å‹ï¼›å› æ­¤ï¼Œ <code>System.Array</code> ç±»å‹å®šä¹‰çš„æ‰€æœ‰å®ä¾‹æ–¹æ³•å’Œå±æ€§éƒ½å°†ç”± <code>XXX[]</code> ç»§æ‰¿ã€‚</p><h2 id="all-arrays-implicitly-implement-ienumerable-icollection-and-ilist"><a class="anchor" href="#all-arrays-implicitly-implement-ienumerable-icollection-and-ilist">#</a> All Arrays Implicitly Implement IEnumerable, ICollection, and IList</h2><blockquote><p>There are many methods that operate on various collection objects because the methods are declared with parameters such as IEnumerable, ICollection, and IList. It is possible to pass arrays to these methods because System.Array also implements these three interfaces. System.Array implements these non-generic interfaces because they treat all elements as System.Object. However, it would be nice to have System.Array implement the generic equivalent of these interfaces, providing better compile-time type safety as well as better performance.</p></blockquote><blockquote><p>The CLR team didnâ€™t want System.Array to implement IEnumerable, ICollection, and IList, though, because of issues related to multi-dimensional arrays and non-zeroâ€“based arrays. Defining these interfaces on System.Array would have enabled these interfaces for all array types. Instead, the CLR performs a little trick: when a single-dimensional, zeroâ€“lower bound array type is created, the CLR automatically makes the array type implement IEnumerable, ICollection, and IList (where T is the arrayâ€™s element type) and also implements the three interfaces for all of the array typeâ€™s base types as long as they are reference types. The following hierarchy diagram helps make this clear.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token return-type class-name">Object</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> Array <span class="token punctuation">(</span>non<span class="token operator">-</span><span class="token class-name">generic</span> IEnumerable<span class="token punctuation">,</span> ICollection<span class="token punctuation">,</span> IList<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> 	Object<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>IEnumerable<span class="token punctuation">,</span> ICollection<span class="token punctuation">,</span> IList <span class="token class-name">of</span> Object<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> 		String<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>IEnumerable<span class="token punctuation">,</span> ICollection<span class="token punctuation">,</span> IList <span class="token class-name">of</span> String<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> 		Stream<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>IEnumerable<span class="token punctuation">,</span> ICollection<span class="token punctuation">,</span> IList <span class="token class-name">of</span> Stream<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> 			FileStream<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>IEnumerable<span class="token punctuation">,</span> ICollection<span class="token punctuation">,</span> IList <span class="token class-name">of</span> FileStream<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> 		<span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> 		<span class="token punctuation">.</span>		 <span class="token punctuation">(</span>other arrays of <span class="token class-name">reference</span> types<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="9"></td><td><pre>		<span class="token punctuation">.</span></pre></td></tr></table></figure><blockquote><p>So, for example, if you have the following line of code:</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">FileStream<span class="token punctuation">[</span><span class="token punctuation">]</span></span> fsArray<span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>then when the CLR creates the FileStream[] type, it will cause this type to automatically implement the IEnumerable, ICollection, and IList interfaces. Furthermore, the FileStream[] type will also implement the interfaces for the base types: IEnumerable, IEnumerable, ICollection, ICollection, IList, and IList. Because all of these interfaces are automatically implemented by the CLR, the fsArray variable could be used wherever any of these interfaces exist. For example, the fsArray variable could be passed to methods that have any of the following prototypes.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">M1</span><span class="token punctuation">(</span><span class="token class-name">IList<span class="token punctuation">&lt;</span>FileStream<span class="token punctuation">></span></span> fsList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> â€¦ <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">M2</span><span class="token punctuation">(</span><span class="token class-name">ICollection<span class="token punctuation">&lt;</span>Stream<span class="token punctuation">></span></span> sCollection<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> â€¦ <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">M3</span><span class="token punctuation">(</span><span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span>Object<span class="token punctuation">></span></span> oEnumerable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> â€¦ <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Note that if the array contains value type elements, the array type will not implement the interfaces for the elementâ€™s base types. For example, if you have the following line of code:</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">DateTime<span class="token punctuation">[</span><span class="token punctuation">]</span></span> dtArray<span class="token punctuation">;</span> <span class="token comment">// An array of value types</span></pre></td></tr></table></figure><blockquote><p>then the DateTime[] type will implement IEnumerable, ICollection, and IList only; it will not implement versions of these interfaces that are generic over System.ValueType or System.Object. This means that the dtArray variable cannot be passed as an argument to the M3 method shown earlier. The reason for this is because arrays of value types are laid out in memory differently than arrays of reference types. Array memory layout was discussed earlier in this chapter.</p></blockquote><p>ğŸ’¡å°ç»“ï¼š <code>System.Array</code> å®ç°äº† <code>IEnumerable</code> ï¼Œ <code>ICollection</code> å’Œ <code>IList</code> è¿™äº›éæ³›å‹æ¥å£ï¼Œæ˜¯å› ä¸ºè¿™äº›æ¥å£å°†æ‰€æœ‰å…ƒç´ éƒ½è§†ä¸º <code>System.Object</code> ã€‚è¦æƒ³è®© <code>System.Array</code> å®ç°è¿™äº›æ¥å£çš„æ³›å‹å½¢å¼ï¼Œæä¾›æ›´å¥½çš„ç¼–è¯‘æ—¶ç±»å‹å®‰å…¨æ€§å’Œæ›´å¥½çš„æ€§èƒ½ï¼ŒCLR è€äº†ä¸€ä¸ªå°èŠ±æ‹›ï¼šåˆ›å»ºä¸€ç»´ 0 åŸºæ•°ç»„ç±»å‹æ—¶ï¼ŒCLR è‡ªåŠ¨ä½¿æ•°ç»„ç±»å‹å®ç° <code>IEnumerable&lt;T&gt;</code> ï¼Œ <code>ICollection&lt;T&gt;</code> å’Œ <code>IList&lt;T&gt;</code> ï¼ˆT æ˜¯æ•°ç»„å…ƒç´ çš„ç±»å‹ï¼‰ã€‚åŒæ—¶ï¼Œè¿˜ä¸ºæ•°ç»„ç±»å‹çš„æ‰€æœ‰åŸºç±»å‹å®ç°è¿™ä¸‰ä¸ªæ¥å£ï¼Œåªè¦å®ƒä»¬æ˜¯å¼•ç”¨ç±»å‹ã€‚æ³¨æ„ï¼Œå¦‚æœæ•°ç»„åŒ…å«å€¼ç±»å‹çš„å…ƒç´ ï¼Œæ•°ç»„ç±»å‹ä¸ä¼šä¸ºå…ƒç´ çš„åŸºç±»å‹å®ç°æ¥å£ã€‚</p><h2 id="passing-and-returning-arrays"><a class="anchor" href="#passing-and-returning-arrays">#</a> Passing and Returning Arrays</h2><blockquote><p>When passing an array as an argument to a method, you are really passing a reference to that array. Therefore, the called method is able to modify the elements in the array. If you donâ€™t want to allow this, you must make a copy of the array and pass the copy into the method. Note that the Array.Copy method performs a shallow copy, and therefore, if the arrayâ€™s elements are reference types, the new array refers to the already existing objects.</p></blockquote><blockquote><p>Similarly, some methods return a reference to an array. If the method constructs and initializes the array, returning a reference to the array is fine. But if the method wants to return a reference to an internal array maintained by a field, you must decide if you want the methodâ€™s caller to have direct access to this array and its elements. If you do, just return the arrayâ€™s reference. But most often, you wonâ€™t want the methodâ€™s caller to have such access, so the method should construct a new array and call Array.Copy, returning a reference to the new array. Again, be aware that Array.Copy makes a shallow copy of the original array.</p></blockquote><blockquote><p>If you define a method that returns a reference to an array, and if that array has no elements in it, your method can return either null or a reference to an array with zero elements in it. When youâ€™re implementing this kind of method, Microsoft strongly recommends that you implement the method by having it return a zero-length array because doing so simplifies the code that a developer calling the method must write. For example, this easy-to-understand code runs correctly even if there are no appointments to iterate over.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// This code is easier to write and understand. </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Appointment<span class="token punctuation">[</span><span class="token punctuation">]</span></span> appointments <span class="token operator">=</span> <span class="token function">GetAppointmentsForToday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> a <span class="token operator">&lt;</span> appointments<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> a<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token range operator">..</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>The following code also runs correctly if there are no appointments to iterate over. However, this code is slightly more difficult to write and understand.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// This code is harder to write and understand. </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Appointment<span class="token punctuation">[</span><span class="token punctuation">]</span></span> appointments <span class="token operator">=</span> <span class="token function">GetAppointmentsForToday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>appointments <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> a <span class="token operator">&lt;</span> appointments<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> a<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token comment">// Do something with appointments[a] </span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>If you design your methods to return arrays with zero elements instead of null, callers of your methods will have an easier time working with them. By the way, you should do the same for fields. If your type has a field thatâ€™s a reference to an array, you should consider having the field refer to an array even if the array has no elements in it.</p></blockquote><p>ğŸ’¡å°ç»“ï¼šæ•°ç»„ä½œä¸ºå®å‚ä¼ ç»™æ–¹æ³•æ—¶ï¼Œå®é™…ä¼ é€’çš„æ˜¯å¯¹è¯¥æ•°ç»„çš„å¼•ç”¨ã€‚å› æ­¤ï¼Œè¢«è°ƒç”¨çš„æ–¹æ³•èƒ½ä¿®æ”¹æ•°ç»„ä¸­çš„å…ƒç´ ã€‚å¦‚æœä¸æƒ³è¢«ä¿®æ”¹ï¼Œå¿…é¡»ç”Ÿæˆæ•°ç»„çš„æ‹·è´å¹¶å°†æ‹·è´ä¼ ç»™æ–¹æ³•ã€‚ <code>Array.Copy</code> æ–¹æ³•æ‰§è¡Œçš„æ˜¯æµ…æ‹·è´ã€‚æ¢è¨€ä¹‹ï¼Œå¦‚æœæ•°ç»„å…ƒç´ æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ–°æ•°ç»„å°†å¼•ç”¨ç°æœ‰çš„å¯¹è±¡ã€‚å¦‚æœå®šä¹‰è¿”å›æ•°ç»„å¼•ç”¨çš„æ–¹æ³•ï¼Œè€Œä¸”æ•°ç»„ä¸­ä¸åŒ…å«å…ƒç´ ï¼Œé‚£ä¹ˆæ–¹æ³•æ—¢å¯ä»¥è¿”å› nullï¼Œä¹Ÿå¯ä»¥è¿”å›å¯¹åŒ…å«é›¶ä¸ªå…ƒç´ çš„ä¸€ä¸ªæ•°ç»„çš„å¼•ç”¨ã€‚å®ç°è¿™ç§æ–¹æ³•æ—¶ï¼ŒMicrosoft å¼ºçƒˆå»ºè®®è®©å®ƒè¿”å›åè€…ï¼Œå› ä¸ºè¿™æ ·èƒ½ç®€åŒ–è°ƒç”¨è¯¥æ–¹æ³•æ—¶éœ€è¦å†™çš„ä»£ç ã€‚å°†æ–¹æ³•è®¾è®¡ä¸ºè¿”å›å¯¹å«æœ‰ 0 ä¸ªå…ƒç´ çš„ä¸€ä¸ªæ•°ç»„çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯è¿”å› nullï¼Œè¯¥æ–¹æ³•çš„è°ƒç”¨è€…å°±èƒ½æ›´è½»æ¾åœ°ä½¿ç”¨è¯¥æ–¹æ³•ã€‚é¡ºä¾¿æä¸€å¥ï¼Œå¯¹å­—æ®µä¹Ÿåº”å¦‚æ­¤ã€‚å¦‚æœç±»å‹ä¸­æœ‰ä¸€ä¸ªå­—æ®µæ˜¯æ•°ç»„å¼•ç”¨ï¼Œåº”è€ƒè™‘è®©è¿™ä¸ªå­—æ®µå§‹ç»ˆå¼•ç”¨æ•°ç»„ï¼Œå³ä½¿æ•°ç»„ä¸­ä¸åŒ…å«ä»»ä½•å…ƒç´ ã€‚</p><h2 id="creating-non-zero-lower-bound-arrays"><a class="anchor" href="#creating-non-zero-lower-bound-arrays">#</a> Creating Non-Zero Lower Bound Arrays</h2><blockquote><p>Earlier I mentioned that itâ€™s possible to create and work with arrays that have non-zero lower bounds. You can dynamically create your own arrays by calling Arrayâ€™s static CreateInstance method. Several overloads of this method exist, allowing you to specify the type of the elements in the array, the number of dimensions in the array, the lower bounds of each dimension, and the number of elements in each dimension. CreateInstance allocates memory for the array, saves the parameter information in the overhead portion of the arrayâ€™s memory block, and returns a reference to the array. If the array has two or more dimensions, you can cast the reference returned from CreateInstance to an ElementType[] variable (where ElementType is some type name), making it easier for you to access the elements in the array. If the array has just one dimension, in C#, you have to use Arrayâ€™s GetValue and SetValue methods to access the elements of the array.</p></blockquote><blockquote><p>Hereâ€™s some code that demonstrates how to dynamically create a two-dimensional array of System.Decimal values. The first dimension represents calendar years from 2005 to 2009 inclusive, and the second dimension represents quarters from 1 to 4 inclusive. The code iterates over all the elements in the dynamic array. I could have hard-coded the arrayâ€™s bounds into the code, which would have given better performance, but I decided to use System.Arrayâ€™s GetLowerBound and GetUpperBound methods to demonstrate their use.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DynamicArrays</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token comment">// I want a two-dimensional array [2005..2009][1..4]. </span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> lowerBounds <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> lengths <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token class-name">Decimal<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> quarterlyRevenue <span class="token operator">=</span> <span class="token punctuation">(</span>Decimal<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> Array<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Decimal</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lengths<span class="token punctuation">,</span> lowerBounds<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"&#123;0,4&#125; &#123;1,9&#125; &#123;2,9&#125; &#123;3,9&#125; &#123;4,9&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token string">"Year"</span><span class="token punctuation">,</span> <span class="token string">"Q1"</span><span class="token punctuation">,</span> <span class="token string">"Q2"</span><span class="token punctuation">,</span> <span class="token string">"Q3"</span><span class="token punctuation">,</span> <span class="token string">"Q4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token class-name">Int32</span> firstYear <span class="token operator">=</span> quarterlyRevenue<span class="token punctuation">.</span><span class="token function">GetLowerBound</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token class-name">Int32</span> lastYear <span class="token operator">=</span> quarterlyRevenue<span class="token punctuation">.</span><span class="token function">GetUpperBound</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token class-name">Int32</span> firstQuarter <span class="token operator">=</span> quarterlyRevenue<span class="token punctuation">.</span><span class="token function">GetLowerBound</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token class-name">Int32</span> lastQuarter <span class="token operator">=</span> quarterlyRevenue<span class="token punctuation">.</span><span class="token function">GetUpperBound</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> year <span class="token operator">=</span> firstYear<span class="token punctuation">;</span> year <span class="token operator">&lt;=</span> lastYear<span class="token punctuation">;</span> year<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>year <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> quarter <span class="token operator">=</span> firstQuarter<span class="token punctuation">;</span> quarter <span class="token operator">&lt;=</span> lastQuarter<span class="token punctuation">;</span> quarter<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"&#123;0,9:C&#125; "</span><span class="token punctuation">,</span> quarterlyRevenue<span class="token punctuation">[</span>year<span class="token punctuation">,</span> quarter<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="20"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>If you compile and run this code, you get the following output.</p></blockquote><pre><code class="language-cmd">Year Q1 Q2 Q3 Q4 
2005 $0.00 $0.00 $0.00 $0.00 
2006 $0.00 $0.00 $0.00 $0.00 
2007 $0.00 $0.00 $0.00 $0.00 
2008 $0.00 $0.00 $0.00 $0.00 
2009 $0.00 $0.00 $0.00 $0.00
</code></pre><p>ğŸ’¡å°ç»“ï¼šè°ƒç”¨æ•°ç»„çš„é™æ€ <code>CreateInstance</code> æ–¹æ³•å¯ä»¥åŠ¨æ€åˆ›å»ºå’Œæ“ä½œä¸‹é™é 0 çš„æ•°ç»„ã€‚è¯¥æ–¹æ³•æœ‰è‹¥å¹²ä¸ªé‡è½½ç‰ˆæœ¬ï¼Œå…è®¸æŒ‡å®šæ•°ç»„å…ƒç´ çš„ç±»å‹ã€æ•°ç»„çš„ç»´æ•°ã€æ¯ä¸€ç»´çš„ä¸‹é™å’Œæ¯ä¸€ç»´çš„å…ƒç´ æ•°ç›®ã€‚ <code>CreateInstance</code> ä¸ºæ•°ç»„åˆ†é…å†…å­˜ï¼Œå°†å‚æ•°ä¿¡æ¯ä¿å­˜åˆ°æ•°ç»„çš„å†…å­˜å—çš„å¼€é”€ï¼ˆoverloadï¼‰éƒ¨åˆ†ï¼Œç„¶åè¿”å›å¯¹è¯¥æ•°ç»„çš„å¼•ç”¨ã€‚å¦‚æœæ•°ç»„çš„ç»´æ•°æ˜¯ 2 æˆ– 2 ä»¥ä¸Šï¼Œå°±å¯ä»¥æŠŠ <code>CreateInstance</code> è¿”å›çš„å¼•ç”¨è½¬å‹ä¸ºä¸€ä¸ª <code>ElementType[]</code> å˜é‡ï¼ˆ <code>ElementType</code> è¦æ›¿æ¢ä¸ºç±»å‹åç§°ï¼‰ï¼Œä»¥ç®€åŒ–å¯¹æ•°ç»„ä¸­çš„å…ƒç´ çš„è®¿é—®ã€‚å¦‚æœåªæœ‰ä¸€ç»´ï¼ŒC# è¦æ±‚å¿…é¡»ä½¿ç”¨è¯¥ <code>Array</code> çš„ <code>GetValue</code> å’Œ <code>SetValue</code> æ–¹æ³•è®¿é—®æ•°ç»„å…ƒç´ ã€‚</p><h2 id="array-internals"><a class="anchor" href="#array-internals">#</a> Array Internals</h2><blockquote><p>Internally, the CLR actually supports two different kinds of arrays:</p><ul><li><p>Single-dimensional arrays with a lower bound of 0. These arrays are sometimes called SZ (for single-dimensional, zero-based) arrays or vectors.</p></li><li><p>Single-dimensional and multi-dimensional arrays with an unknown lower bound.</p></li></ul></blockquote><blockquote><p>You can actually see the different kinds of arrays by executing the following code (the output is shown in the codeâ€™s comments).</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token class-name">Array</span> a<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token comment">// Create a 1-dim, 0-based array, with no elements in it </span></pre></td></tr><tr><td data-num="6"></td><td><pre> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">String</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "System.String[]" </span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token comment">// Create a 1-dim, 0-based array, with no elements in it </span></pre></td></tr><tr><td data-num="9"></td><td><pre> a <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "System.String[]" </span></pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token comment">// Create a 1-dim, 1-based array, with no elements in it </span></pre></td></tr><tr><td data-num="13"></td><td><pre> a <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "System.String[*]" &lt;-- INTERESTING! </span></pre></td></tr><tr><td data-num="16"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token comment">// Create a 2-dim, 0-based array, with no elements in it </span></pre></td></tr><tr><td data-num="18"></td><td><pre> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">String</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "System.String[,]" </span></pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token comment">// Create a 2-dim, 0-based array, with no elements in it </span></pre></td></tr><tr><td data-num="21"></td><td><pre> a <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="23"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "System.String[,]" </span></pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token comment">// Create a 2-dim, 1-based array, with no elements in it </span></pre></td></tr><tr><td data-num="25"></td><td><pre> a <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="27"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "System.String[,]" </span></pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Next to each Console.WriteLine is a comment that indicates the output. For the singledimensional arrays, the zero-based arrays display a type name of System.String[], whereas the 1-based array displays a type name of System.String[<em>]. The * indicates that the CLR knows that this array is not zero-based. Note that C# does not allow you to declare a variable of type String[</em>], and therefore it is not possible to use C# syntax to access a single-dimensional, non-zeroâ€“based array. Although you can call Arrayâ€™s GetValue and SetValue methods to access the elements of the array, this access will be slow due to the overhead of the method call.</p></blockquote><blockquote><p>For multi-dimensional arrays, the zero-based and 1-based arrays all display the same type name: System.String[,]. The CLR treats all multi-dimensional arrays as though they are not zero-based at run time. This would make you think that the type name should display as System.String[<em>,</em>]; however, the CLR doesnâ€™t use the *s for multi-dimensional arrays because they would always be present, and the asterisks would just confuse most developers.</p></blockquote><blockquote><p>Accessing the elements of a single-dimensional, zero-based array is slightly faster than accessing the elements of a non-zeroâ€“based, single-dimensional array or a multi-dimensional array. There are several reasons for this. First, there are specific IL instructionsâ€”such as newarr, ldelem, ldelema, ldlen, and stelemâ€”to manipulate single-dimensional, zero-based arrays, and these special IL instructions cause the JIT compiler to emit optimized code. For example, the JIT compiler will emit code that assumes that the array is zero-based, and this means that an offset doesnâ€™t have to be subtracted from the specified index when accessing an element. Second, in common situations, the JIT compiler is able to hoist the index rangeâ€“checking code out of the loop, causing it to execute just once. For example, look at the following commonly written code.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Int32</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token comment">// Do something with a[index] </span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>The first thing to notice about this code is the call to the arrayâ€™s Length property in the for loopâ€™s test expression. Because Length is a property, querying the length actually represents a method call. However, the JIT compiler knows that Length is a property on the Array class, and the JIT compiler will actually generate code that calls the property just once and stores the result in a temporary variable that will be checked with each iteration of the loop. The result is that the JITted code is fast. In fact, some developers have underestimated the abilities of the JIT compiler and have tried to write â€œclever codeâ€ in an attempt to help the JIT compiler. However, any clever attempts that you come up with will almost certainly impact performance negatively and make your code harder to read, reducing its maintainability. You are better off leaving the call to the arrayâ€™s Length property in the preceding code instead of attempting to cache it in a local variable yourself.</p></blockquote><blockquote><p>The second thing to notice about the preceding code is that the JIT compiler knows that the for loop is accessing array elements 0 through Length - 1. So the JIT compiler produces code that, at run time, tests that all array accesses will be within the arrayâ€™s valid range. Specifically, the JIT compiler produces code to check if (0 &gt;= a.GetLowerBound(0)) &amp;&amp; ((Length â€“ 1) &lt;= a.GetUpperBound(0)). This check occurs just before the loop. If the check is good, the JIT compiler will not generate code inside the loop to verify that each array access is within the valid range. This allows array access within the loop to be very fast.</p></blockquote><blockquote><p>Unfortunately, as I alluded to earlier in this chapter, accessing elements of a non-zeroâ€“based single-dimensional array or of a multi-dimensional array is much slower than a single-dimensional, zerobased array. For these array types, the JIT compiler doesnâ€™t hoist index checking outside of loops, so each array access validates the specified indexes. In addition, the JIT compiler adds code to subtract the arrayâ€™s lower bounds from the specified index, which also slows the code down, even if youâ€™re using a multi-dimensional array that happens to be zero-based. So if performance is a concern to you, you might want to consider using an array of arrays (a jagged array) instead of a rectangular array.</p></blockquote><blockquote><p>C# and the CLR also allow you to access an array by using unsafe (non-verifiable) code, which is, in effect, a technique that allows you to turn off the index bounds checking when accessing an array. Note that this unsafe array manipulation technique is usable with arrays whose elements are SByte, Byte, Int16, UInt16, Int32, UInt32, Int64, UInt64, Char, Single, Double, Decimal, Boolean, an enumerated type, or a value type structure whose fields are any of the aforementioned types.</p></blockquote><blockquote><p>This is a very powerful feature that should be used with extreme caution because it allows you to perform direct memory accesses. If these memory accesses are outside the bounds of the array, an exception will not be thrown; instead, you will be corrupting memory, violating type safety, and possibly opening a security hole! For this reason, the assembly containing the unsafe code must either be granted full trust or at least have the Security Permission with Skip Verification turned on.</p></blockquote><blockquote><p>This is a very powerful feature that should be used with extreme caution because it allows you to perform direct memory accesses. If these memory accesses are outside the bounds of the array, an exception will not be thrown; instead, you will be corrupting memory, violating type safety, and possibly opening a security hole! For this reason, the assembly containing the unsafe code must either be granted full trust or at least have the Security Permission with Skip Verification turned on.</p></blockquote><blockquote><p>The following C# code demonstrates three techniques (safe, jagged, and unsafe), for accessing a two-dimensional array.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Diagnostics</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token class-name">Int32</span> c_numElements <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token comment">// Declare a two-dimensional array</span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> a2Dim <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32</span><span class="token punctuation">[</span>c_numElements<span class="token punctuation">,</span> c_numElements<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token comment">// Declare a two-dimensional array as a jagged array (a vector of vectors)</span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> aJagged <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32</span><span class="token punctuation">[</span>c_numElements<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> c_numElements<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre> aJagged<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Int32</span><span class="token punctuation">[</span>c_numElements<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token comment">// 1: Access all elements of the array using the usual, safe technique</span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token function">Safe2DimArrayAccess</span><span class="token punctuation">(</span>a2Dim<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token comment">// 2: Access all elements of the array using the jagged array technique</span></pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token function">SafeJaggedArrayAccess</span><span class="token punctuation">(</span>aJagged<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token comment">// 3: Access all elements of the array using the unsafe technique</span></pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token function">Unsafe2DimArrayAccess</span><span class="token punctuation">(</span>a2Dim<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">Safe2DimArrayAccess</span><span class="token punctuation">(</span><span class="token class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token class-name">Int32</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> c_numElements<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> c_numElements<span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre> sum <span class="token operator">+=</span> a<span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token keyword">return</span> sum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">SafeJaggedArrayAccess</span><span class="token punctuation">(</span><span class="token class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token class-name">Int32</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> c_numElements<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> c_numElements<span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre> sum <span class="token operator">+=</span> a<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">y</span></span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre> <span class="token keyword">return</span> sum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">unsafe</span> <span class="token return-type class-name">Int32</span> <span class="token function">Unsafe2DimArrayAccess</span><span class="token punctuation">(</span><span class="token class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">]</span></span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre> <span class="token class-name">Int32</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre> <span class="token keyword">fixed</span> <span class="token punctuation">(</span>Int32<span class="token operator">*</span> pi <span class="token operator">=</span> a<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> c_numElements<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre> <span class="token class-name">Int32</span> baseOfDim <span class="token operator">=</span> x <span class="token operator">*</span> c_numElements<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> c_numElements<span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre> sum <span class="token operator">+=</span> pi<span class="token punctuation">[</span>baseOfDim <span class="token operator">+</span> y<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre> <span class="token keyword">return</span> sum<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>The Unsafe2DimArrayAccess method is marked with the unsafe modifier, which is required to use C#â€™s fixed statement. To compile this code, youâ€™ll have to specify the /unsafe switch when invoking the C# compiler or select the Allow Unsafe Code check box on the Build tab of the Project Properties pane in Microsoft Visual Studio.</p></blockquote><blockquote><p>Obviously, the unsafe technique has a time and place when it can best be used by your own code, but beware that there are three serious downsides to using this technique:</p><ul><li><p>The code that manipulates the array elements is more complicated to read and write than that which manipulates the elements using the other techniques because you are using C#â€™s fixed statement and performing memory-address calculations.</p></li><li><p>If you make a mistake in the calculation, you are accessing memory that is not part of the array. This can result in an incorrect calculation, corruption of memory, a type-safety violation, and a potential security hole.</p></li><li><p>Due to the potential problems, the CLR forbids unsafe code from running in reduced-security environments (like Microsoft Silverlight).</p></li></ul></blockquote><p>ğŸ’¡å°ç»“ï¼šCLR å†…éƒ¨æ”¯æŒä¸¤ç§ä¸åŒçš„æ•°ç»„ï¼Œä¸€ç§æ˜¯ SZ æ•°ç»„ï¼Œå¦ä¸€ç§æ˜¯ä¸‹é™æœªçŸ¥çš„ä¸€ç»´æˆ–å¤šç»´æ•°ç»„ã€‚CLR ä½¿ç”¨ * ç¬¦å·è¡¨ç¤ºçŸ¥é“è¯¥æ•°ç»„ä¸æ˜¯ä¸€ç»´ 0 åŸºæ•°ç»„ã€‚C# ä¸å…è®¸å£°æ˜ <code>String[*]</code> ç±»å‹çš„å˜é‡ï¼Œå› æ­¤ä¸èƒ½ä½¿ç”¨ C# è¯­æ³•æ¥è®¿é—®ä¸€ç»´é 0 åŸºæ•°ç»„ã€‚å°½ç®¡å¯ä»¥è°ƒç”¨ <code>Array</code> çš„ <code>GetValue</code> å’Œ <code>SetValue</code> æ–¹æ³•æ¥è®¿é—®è¿™ç§æ•°ç»„çš„å…ƒç´ ï¼Œä½†é€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ï¼Œå› ä¸ºæœ‰æ–¹æ³•è°ƒç”¨çš„å¼€é”€ã€‚å¯¹äºå¤šç»´æ•°ç»„ï¼Œ0 åŸºå’Œ 1 åŸºæ•°ç»„ä¼šæ˜¾å¼åŒæ ·çš„ç±»å‹åç§°ï¼š <code>System.String[,]</code> ã€‚åœ¨è¿è¡Œæ—¶ï¼ŒCLR å°†æ‰€æœ‰å¤šç»´æ•°ç»„éƒ½è§†ä¸ºé 0 åŸºæ•°ç»„ã€‚å¯¹äºå¤šç»´æ•°ç»„ï¼ŒCLR å†³å®šä¸ä½¿ç”¨ * ç¬¦å·ã€‚è®¿é—®ä¸€ç»´ 0 åŸºæ•°ç»„çš„å…ƒç´ æ¯”è®¿é—®é 0 åŸºä¸€ç»´æˆ–å¤šç»´æ•°ç»„çš„å…ƒç´ ç¨å¿«ã€‚è¿™æ˜¯å¤šæ–¹é¢çš„åŸå› é€ æˆçš„ã€‚é¦–å…ˆï¼Œæœ‰ä¸€äº›ç‰¹æ®Š IL æŒ‡ä»¤ï¼Œæ¯”å¦‚ <code>newarr</code> ï¼Œ <code>ledlem</code> ï¼Œ <code>ldelema</code> ï¼Œ <code>ldlen</code> å’Œ <code>stelem</code> ï¼Œç”¨äºå¤„ç†ä¸€ç»´ 0 åŸºæ•°ç»„ï¼Œè¿™äº›ç‰¹æ®Š IL æŒ‡ä»¤ä¼šå¯¼è‡´ JIT ç¼–è¯‘å™¨ç”Ÿæˆä¼˜åŒ–ä»£ç ã€‚å…¶æ¬¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒJIT ç¼–è¯‘å™¨èƒ½å°†ç´¢å¼•èŒƒå›´æ£€æŸ¥ä»£ç ä»å¾ªç¯ä¸­æ‹¿å‡ºï¼Œå¯¼è‡´å®ƒåªæ‰§è¡Œä¸€æ¬¡ã€‚å¯¹äºé 0 åŸºä¸€ç»´æ•°ç»„è€Œè¨€ï¼ŒJIT ç¼–è¯‘å™¨ä¸ä¼šå°†ç´¢å¼•æ£€æŸ¥ä»å¾ªç¯ä¸­æ‹¿å‡ºæ¥ï¼Œæ‰€ä»¥æ¯æ¬¡æ•°ç»„è®¿é—®éƒ½è¦éªŒè¯æŒ‡å®šçš„ç´¢å¼•ã€‚æ­¤å¤–ï¼ŒJIT ç¼–è¯‘å™¨è¿˜è¦æ·»åŠ ä»£ç ä»æŒ‡å®šç´¢å¼•ä¸­å‡å»æ•°ç»„ä¸‹é™ï¼Œè¿™è¿›ä¸€æ­¥å½±å“äº†ä»£ç æ‰§è¡Œé€Ÿåº¦ï¼Œå³ä½¿æ­¤æ—¶ä½¿ç”¨çš„å¤šç»´æ•°ç»„ç¢°å·§æ˜¯ 0 åŸºæ•°ç»„ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¾ˆå…³å¿ƒæ€§èƒ½ï¼Œè€ƒè™‘ç”¨ç”±æ•°ç»„æ„æˆçš„æ•°ç»„ï¼ˆåŸºéª„å‚²é”™æ•°ç»„ï¼‰ä»£æ›¿çŸ©å½¢æ•°ç»„ã€‚C# å’Œ CLR è¿˜å…è®¸ä½¿ç”¨ unsafeï¼ˆä¸å¯éªŒè¯ï¼‰ä»£ç è®¿é—®æ•°ç»„ã€‚è¿™ç§æŠ€æœ¯å®é™…åœ¨è®¿é—®æ•°ç»„æ—¶å…³é—­ç´¢å¼•ä¸Šä¸‹é™æ£€æŸ¥ã€‚è¿™ç§åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œä½†ä½¿ç”¨é¡»è°¨æ…ï¼Œå› ä¸ºå®ƒå…è®¸ç›´æ¥å†…å­˜è®¿é—®ã€‚è®¿é—®è¶Šç•Œï¼ˆè¶…å‡ºæ•°ç»„ä¸Šä¸‹é™ï¼‰ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†ä¼šæŸåå†…å­˜ä¸­çš„æ•°æ®ï¼Œç ´åç±»å‹å®‰å…¨æ€§ï¼Œå¹¶å¯èƒ½é€ æˆå®‰å…¨æ¼æ´ï¼Œæœ‰é‰´äºæ­¤ï¼ŒåŒ…å« unsafe ä»£ç çš„ç¨‹åºé›†å¿…é¡»è¢«èµ‹äºˆå®Œå…¨ä¿¡ä»»ï¼Œæˆ–è‡³å°‘å¯ç”¨ â€œè·³è¿‡éªŒè¯â€ å®‰å…¨æƒé™ã€‚æ­¤å¤–ï¼Œunsafe ä¿®é¥°ç¬¦å¸¸ä¸ fixed å…³é”®å­—æ­é…ä½¿ç”¨ã€‚</p><h2 id="unsafe-array-access-and-fixed-size-array"><a class="anchor" href="#unsafe-array-access-and-fixed-size-array">#</a> Unsafe Array Access and Fixed-Size Array</h2><blockquote><p>Unsafe array access is very powerful because it allows you to access:</p><ul><li><p>Elements within a managed array object that resides on the heap (as the previous section demonstrated).</p></li><li><p>Elements within an array that resides on an unmanaged heap. The SecureString example in Chapter 14, â€œChars, Strings, and Working with Text,â€ demonstrated using unsafe array access on an array returned from calling the System.Runtime.InteropServices.Marshal classâ€™s SecureStringToCoTaskMemUnicode method.</p></li><li><p>Elements within an array that resides on the threadâ€™s stack.</p></li></ul></blockquote><blockquote><p>In cases in which performance is extremely critical, you could avoid allocating a managed array object on the heap and instead allocate the array on the threadâ€™s stack by using C#â€™s stackalloc statement (which works a lot like Câ€™s alloca function). The stackalloc statement can be used to create a single-dimensional, zero-based array of value type elements only, and the value type must not contain any reference type fields. Really, you should think of this as allocating a block of memory that you can manipulate by using unsafe pointers, and therefore, you cannot pass the address of this memory buffer to the vast majority of FCL methods. Of course, the stack-allocated memory (array) will automatically be freed when the method returns; this is where we get the performance improvement. Using this feature also requires you to specify the /unsafe switch to the C# compiler.</p></blockquote><blockquote><p>The StackallocDemo method in the following code shows an example of how to use C#â€™s stackalloc statement.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token function">StackallocDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token function">InlineArrayDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">StackallocDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token keyword">unsafe</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token keyword">const</span> <span class="token class-name">Int32</span> width <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> Char<span class="token operator">*</span> pc <span class="token operator">=</span> <span class="token keyword">stackalloc</span> Char<span class="token punctuation">[</span>width<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Allocates array on stack </span></pre></td></tr><tr><td data-num="11"></td><td><pre> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"Jeffrey Richter"</span><span class="token punctuation">;</span> <span class="token comment">// 15 characters </span></pre></td></tr><tr><td data-num="13"></td><td><pre> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> width<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> pc<span class="token punctuation">[</span>width <span class="token operator">-</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> </pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> s<span class="token punctuation">.</span>Length<span class="token punctuation">)</span> <span class="token punctuation">?</span> s<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token char">'.'</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token comment">// The following line displays ".....rethciR yerffeJ" </span></pre></td></tr><tr><td data-num="19"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">String</span><span class="token punctuation">(</span>pc<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">InlineArrayDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token keyword">unsafe</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token class-name">CharArray</span> ca<span class="token punctuation">;</span> <span class="token comment">// Allocates array on stack </span></pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token class-name">Int32</span> widthInBytes <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">CharArray</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token class-name">Int32</span> width <span class="token operator">=</span> widthInBytes <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"Jeffrey Richter"</span><span class="token punctuation">;</span> <span class="token comment">// 15 characters </span></pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> width<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="29"></td><td><pre> ca<span class="token punctuation">.</span>Characters<span class="token punctuation">[</span>width <span class="token operator">-</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> </pre></td></tr><tr><td data-num="30"></td><td><pre> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> s<span class="token punctuation">.</span>Length<span class="token punctuation">)</span> <span class="token punctuation">?</span> s<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token char">'.'</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="31"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="32"></td><td><pre> <span class="token comment">// The following line displays ".....rethciR yerffeJ" </span></pre></td></tr><tr><td data-num="33"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">String</span><span class="token punctuation">(</span>ca<span class="token punctuation">.</span>Characters<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="34"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="35"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">unsafe</span> <span class="token keyword">struct</span> <span class="token class-name">CharArray</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="38"></td><td><pre> <span class="token comment">// This array is embedded inline inside the structure </span></pre></td></tr><tr><td data-num="39"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">fixed</span> Char Characters<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Normally, because arrays are reference types, an array field defined in a structure is really just a pointer or reference to an array; the array itself lives outside of the structureâ€™s memory. However, it is possible to embed an array directly inside a structure as shown by the CharArray structure in the preceding code. To embed an array directly inside a structure, there are several requirements:</p><ul><li><p>The type must be a structure (value type); you cannot embed an array inside a class (reference type).</p></li><li><p>The field or its defining structure must be marked with the unsafe keyword.</p></li><li><p>The array field must be marked with the fixed keyword.</p></li><li><p>The array must be single-dimensional and zero-based.</p></li><li><p>The arrayâ€™s element type must be one of the following types: Boolean, Char, SByte, Byte, Int16, UInt16, Int32, UInt32, Int64, UInt64, Single, or Double.</p></li></ul></blockquote><blockquote><p>Inline arrays are typically used for scenarios that involve interoperating with unmanaged code where the unmanaged data structure also has an inline array. However, inline arrays can be used in other scenarios as well. The InlineArrayDemo method in the code shown earlier offers an example of how to use an inline array. The InlineArrayDemo method performs the same function as the StackallocDemo method; it just does it in a different way.</p></blockquote><p>ğŸ’¡å°ç»“ï¼šä¸å®‰å…¨çš„æ•°ç»„è®¿é—®éå¸¸å¼ºå¤§ï¼Œå®ƒä¸ä»…å¯ä»¥è®¿é—®å †ä¸Šçš„æ‰˜ç®¡æ•°ç»„å¯¹è±¡ä¸­çš„å…ƒç´ ï¼Œè¿˜èƒ½è®¿é—®éæ‰˜ç®¡å †ä¸Šçš„æ•°ç»„ä¸­çš„å…ƒç´ ä»¥åŠçº¿ç¨‹æ ˆä¸Šçš„æ•°ç»„ä¸­çš„å…ƒç´ ã€‚éæ‰˜ç®¡å †ä¸Šçš„æ•°ç»„å¯ä»¥å‚è€ƒå®‰å…¨å­—ç¬¦ä¸²çš„ä¾‹å­ï¼Œè€Œåœ¨çº¿ç¨‹æ ˆä¸Šåˆ†é…æ•°ç»„æ˜¯é€šè¿‡ C# çš„ <code>stackalloc</code> è¯­å¥æ¥å®Œæˆçš„ï¼ˆå®ƒå¾ˆå¤§ç¨‹åº¦ä¸Šç±»ä¼¼äº C çš„ <code>alloca</code> å‡½æ•°ï¼‰ã€‚ <code>stackalloc</code> è¯­å¥åªèƒ½åˆ›å»ºä¸€ç»´ 0 åŸºã€ç”±å€¼å…ƒç´ æ„æˆçš„æ•°ç»„ï¼Œè€Œä¸”å€¼ç±»å‹ç»å¯¹ä¸èƒ½åŒ…å«ä»»ä½•å¼•ç”¨ç±»å‹çš„å­—æ®µã€‚å®é™…ä¸Šï¼Œåº”è¯¥æŠŠå®ƒçš„ä½œç”¨çœ‹æˆæ˜¯åˆ†é…ä¸€ä¸ªå†…å­˜å—ï¼Œè¿™ä¸ªå†…å­˜å—å¯ä»¥ä½¿ç”¨ä¸å®‰å…¨çš„æŒ‡é’ˆæ¥æ“çºµã€‚æ‰€ä»¥ï¼Œä¸èƒ½å°†è¿™ä¸ªå†…å­˜ç¼“å†²åŒºçš„åœ°å€ä¼ ç»™å¤§éƒ¨åˆ† FCL æ–¹æ³•ã€‚é€šå¸¸ï¼Œç”±äºæ•°ç»„æ˜¯å¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥ç»“æ„ä¸­å®šä¹‰çš„æ•°ç»„å­—æ®µå®é™…åªæ˜¯æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼›æ•°ç»„æœ¬èº«åœ¨ç»“æ„çš„å†…å­˜çš„å¤–éƒ¨ã€‚ä¸è¿‡ï¼Œä¹Ÿå¯ä»¥å‘ä¸Šè¿°ä¾‹å­ä¸­é‚£æ ·ï¼Œç›´æ¥å°†æ•°ç»„åµŒå…¥ç»“æ„ã€‚åœ¨ç»“æ„ä¸­åµŒå…¥æ•°ç»„éœ€æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼š1. ç±»å‹å¿…é¡»æ˜¯ç»“æ„ï¼ˆå€¼ç±»å‹ï¼‰ï¼›ä¸èƒ½åœ¨ç±»ï¼ˆå¼•ç”¨ç±»å‹ï¼‰ä¸­åµŒå…¥æ•°ç»„ã€‚2. å­—æ®µæˆ–å…¶å®šä¹‰ç»“æ„å¿…é¡»ç”¨ unsafe å…³é”®å­—æ ‡è®°ã€‚3. æ•°ç»„å­—æ®µå¿…é¡»ç”¨ fixed å…³é”®å­—æ ‡è®°ã€‚4. æ•°ç»„å¿…é¡»æ˜¯ä¸€ç»´ 0 åŸºæ•°ç»„ã€‚5. æ•°ç»„çš„å…ƒç´ ç±»å‹å¿…é¡»æ˜¯ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š <code>Boolean</code> ï¼Œ <code>Char</code> ï¼Œ <code>SByte</code> ï¼Œ <code>Byte</code> ï¼Œ <code>Int16</code> ï¼Œ <code>Int32</code> ï¼Œ <code>UInt16</code> ï¼Œ <code>UInt32</code> ï¼Œ <code>Int64</code> ï¼Œ <code>Single</code> æˆ– <code>Double</code> ã€‚è¦å’Œéæ‰˜ç®¡ä»£ç è¿›è¡Œäº’æ“ä½œï¼Œè€Œä¸”éæ‰˜ç®¡æ•°æ®ç»“æ„ä¹Ÿæœ‰ä¸€ä¸ªå†…è”æ•°ç»„ï¼Œå°±ç‰¹åˆ«é€‚åˆä½¿ç”¨å†…è”çš„æ•°ç»„ã€‚</p><div class="tags"><a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag"><i class="ic i-tag"></i> è¯»ä¹¦ç¬”è®°</a> <a href="/tags/C/" rel="tag"><i class="ic i-tag"></i> C#</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2022-11-19 19:22:57" itemprop="dateModified" datetime="2022-11-19T19:22:57+08:00">2022-11-19</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(ï¿£â–½ï¿£)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Sakupinera WeChat Pay"><p>WeChat Pay</p></div><div><img data-src="/images/alipay.png" alt="Sakupinera Alipay"><p>Alipay</p></div><div><img data-src="/images/paypal.png" alt="Sakupinera PayPal"><p>PayPal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Sakupinera <i class="ic i-at"><em>@</em></i>Sakupinera</li><li class="link"><strong>Post link: </strong><a href="http://sakupinera.github.io/2022/11/19/csharp/clr-via-csharp/Chapter%2016%20Arrays/" title="CLR via C# - Chapter 16 Arrays">http://sakupinera.github.io/2022/11/19/csharp/clr-via-csharp/Chapter 16 Arrays/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/11/17/csharp/clr-via-csharp/Chapter%2015%20Enumerated%20Types%20and%20Bit%20Flags/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;03&#x2F;08&#x2F;Z2usRnE64TXN1Lp.jpg" title="CLR via C# - Chapter 15 Enumerated Types and Bit Flags"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i> CLR-via-CSharp</span><h3>CLR via C# - Chapter 15 Enumerated Types and Bit Flags</h3></a></div><div class="item right"><a href="/2022/11/21/csharp/clr-via-csharp/Chapter%2017%20Delegates/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;03&#x2F;08&#x2F;r1VBTR45h8jQWZA.jpg" title="CLR via C# - Chapter 17 Delegates"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i> CLR-via-CSharp</span><h3>CLR via C# - Chapter 17 Delegates</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#chapter-16-arrays"><span class="toc-number">1.</span> <span class="toc-text">Chapter 16 Arrays</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#initializing-array-elements"><span class="toc-number">1.1.</span> <span class="toc-text">Initializing Array Elements</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#casting-arrays"><span class="toc-number">1.2.</span> <span class="toc-text">Casting Arrays</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#all-arrays-are-implicitly-derived-from-systemarray"><span class="toc-number">1.3.</span> <span class="toc-text">All Arrays Are Implicitly Derived from System.Array</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#all-arrays-implicitly-implement-ienumerable-icollection-and-ilist"><span class="toc-number">1.4.</span> <span class="toc-text">All Arrays Implicitly Implement IEnumerable, ICollection, and IList</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#passing-and-returning-arrays"><span class="toc-number">1.5.</span> <span class="toc-text">Passing and Returning Arrays</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#creating-non-zero-lower-bound-arrays"><span class="toc-number">1.6.</span> <span class="toc-text">Creating Non-Zero Lower Bound Arrays</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#array-internals"><span class="toc-number">1.7.</span> <span class="toc-text">Array Internals</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unsafe-array-access-and-fixed-size-array"><span class="toc-number">1.8.</span> <span class="toc-text">Unsafe Array Access and Fixed-Size Array</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%201%20The%20CLR%E2%80%99s%20Execution%20Model/" rel="bookmark" title="CLR via C# - Chapter 1 The CLRâ€™s Execution Model">CLR via C# - Chapter 1 The CLRâ€™s Execution Model</a></li><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%202%20Building,%20Packaging,%20Deploying,%20and%20Administering%20Applications%20and%20Types/" rel="bookmark" title="CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types">CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types</a></li><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%203%20Shared%20Assemblies%20and%20Strongly%20Named%20Assemblies/" rel="bookmark" title="CLR via C# - Chapter 3 Shared Assemblies and Strongly Named Assemblies">CLR via C# - Chapter 3 Shared Assemblies and Strongly Named Assemblies</a></li><li><a href="/2022/09/27/csharp/clr-via-csharp/Chapter%204%20Type%20Fundamentals/" rel="bookmark" title="CLR via C# - Chapter 4 Type Fundamentals">CLR via C# - Chapter 4 Type Fundamentals</a></li><li><a href="/2022/10/15/csharp/clr-via-csharp/Chapter%205%20Primitive,%20Reference,%20and%20Value%20%20Types/" rel="bookmark" title="CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals">CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals</a></li><li><a href="/2022/10/21/csharp/clr-via-csharp/Chapter%206%20Type%20and%20Member%20Basics/" rel="bookmark" title="CLR via C# - Chapter 6 Type and Member Basics">CLR via C# - Chapter 6 Type and Member Basics</a></li><li><a href="/2022/10/24/csharp/clr-via-csharp/Chapter%207%20Constants%20and%20Fields/" rel="bookmark" title="CLR via C# - Chapter 7 Constants and Fields">CLR via C# - Chapter 7 Constants and Fields</a></li><li><a href="/2022/10/25/csharp/clr-via-csharp/Chapter%208%20Methods/" rel="bookmark" title="CLR via C# - Chapter 8 Methods">CLR via C# - Chapter 8 Methods</a></li><li><a href="/2022/10/27/csharp/clr-via-csharp/Chapter%209%20Parameters/" rel="bookmark" title="CLR via C# - Chapter 9 Parameters">CLR via C# - Chapter 9 Parameters</a></li><li><a href="/2022/10/28/csharp/clr-via-csharp/Chapter%2010%20Properties/" rel="bookmark" title="CLR via C# - Chapter 10 Properties">CLR via C# - Chapter 10 Properties</a></li><li><a href="/2022/10/29/csharp/clr-via-csharp/Chapter%2011%20Events/" rel="bookmark" title="CLR via C# - Chapter 11 Events">CLR via C# - Chapter 11 Events</a></li><li><a href="/2022/11/02/csharp/clr-via-csharp/Chapter%2012%20Generics/" rel="bookmark" title="CLR via C# - Chapter 12 Generics">CLR via C# - Chapter 12 Generics</a></li><li><a href="/2022/11/04/csharp/clr-via-csharp/Chapter%2013%20Interfaces/" rel="bookmark" title="CLR via C# - Chapter 13 Interfaces">CLR via C# - Chapter 13 Interfaces</a></li><li><a href="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/" rel="bookmark" title="CLR via C# - Chapter 14 Chars, Strings, and Working with Text">CLR via C# - Chapter 14 Chars, Strings, and Working with Text</a></li><li><a href="/2022/11/17/csharp/clr-via-csharp/Chapter%2015%20Enumerated%20Types%20and%20Bit%20Flags/" rel="bookmark" title="CLR via C# - Chapter 15 Enumerated Types and Bit Flags">CLR via C# - Chapter 15 Enumerated Types and Bit Flags</a></li><li class="active"><a href="/2022/11/19/csharp/clr-via-csharp/Chapter%2016%20Arrays/" rel="bookmark" title="CLR via C# - Chapter 16 Arrays">CLR via C# - Chapter 16 Arrays</a></li><li><a href="/2022/11/21/csharp/clr-via-csharp/Chapter%2017%20Delegates/" rel="bookmark" title="CLR via C# - Chapter 17 Delegates">CLR via C# - Chapter 17 Delegates</a></li><li><a href="/2022/11/22/csharp/clr-via-csharp/Chapter%2018%20Custom%20Attributes/" rel="bookmark" title="CLR via C# - Chapter 18 Custom Attributes">CLR via C# - Chapter 18 Custom Attributes</a></li><li><a href="/2022/11/23/csharp/clr-via-csharp/Chapter%2019%20Nullable%20Value%20Types/" rel="bookmark" title="CLR via C# - Chapter 19 Nullable Value Types">CLR via C# - Chapter 19 Nullable Value Types</a></li><li><a href="/2022/11/25/csharp/clr-via-csharp/Chapter%2020%20Exceptions%20and%20State%20Management/" rel="bookmark" title="CLR via C# - Chapter 20 Exceptions and State Management">CLR via C# - Chapter 20 Exceptions and State Management</a></li><li><a href="/2022/11/27/csharp/clr-via-csharp/Chapter%2021%20The%20Managed%20Heap%20and%20Garbage%20%20Collection/" rel="bookmark" title="CLR via C# - Chapter 21 The Managed Heap and Garbage  Collection">CLR via C# - Chapter 21 The Managed Heap and Garbage Collection</a></li><li><a href="/2022/11/28/csharp/clr-via-csharp/Chapter%2022%20CLR%20Hosting%20and%20AppDomains/" rel="bookmark" title="CLR via C# - Chapter 22 CLR Hosting and AppDomains">CLR via C# - Chapter 22 CLR Hosting and AppDomains</a></li><li><a href="/2022/11/29/csharp/clr-via-csharp/Chapter%2023%20Assembly%20Loading%20and%20Reflection/" rel="bookmark" title="CLR via C# - Chapter 23 Assembly Loading and Reflection">CLR via C# - Chapter 23 Assembly Loading and Reflection</a></li><li><a href="/2022/11/30/csharp/clr-via-csharp/Chapter%2024%20Runtime%20Serialization/" rel="bookmark" title="CLR via C# - Chapter 24 Runtime Serialization">CLR via C# - Chapter 24 Runtime Serialization</a></li><li><a href="/2022/12/06/csharp/clr-via-csharp/Chapter%2025%20Interoperating%20with%20WinRT%20%20Components/" rel="bookmark" title="CLR via C# - Chapter 25 Interoperating with WinRT Components">CLR via C# - Chapter 25 Interoperating with WinRT Components</a></li><li><a href="/2023/02/06/csharp/clr-via-csharp/Chapter%2026%20Thread%20Basics/" rel="bookmark" title="CLR via C# - Chapter 26 Thread Basics">CLR via C# - Chapter 26 Thread Basics</a></li><li><a href="/2023/02/07/csharp/clr-via-csharp/Chapter%2027%20Compute-Bound%20Asynchronous%20Operations/" rel="bookmark" title="CLR via C# - Chapter 27 Compute-Bound Asynchronous Operations">CLR via C# - Chapter 27 Compute-Bound Asynchronous Operations</a></li><li><a href="/2023/02/08/csharp/clr-via-csharp/Chapter%2028%20IO-Bound%20Asynchronous%20Operations/" rel="bookmark" title="CLR via C# - Chapter 28 IO-Bound Asynchronous Operations">CLR via C# - Chapter 28 IO-Bound Asynchronous Operations</a></li><li><a href="/2023/02/09/csharp/clr-via-csharp/Chapter%2029%20Primitive%20Thread%20Synchronization%20Constructs/" rel="bookmark" title="CLR via C# - Chapter 29 Primitive Thread Synchronization">CLR via C# - Chapter 29 Primitive Thread Synchronization</a></li><li><a href="/2023/02/10/csharp/clr-via-csharp/Chapter%2030%20Hybrid%20Thread%20Synchronization%20Constructs/" rel="bookmark" title="CLR via C# - Chapter 30 Hybrid Thread Synchronization">CLR via C# - Chapter 30 Hybrid Thread Synchronization</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Sakupinera" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Sakupinera</p><div class="description" itemprop="description">ä¿æŒä½ çš„å†³å¿ƒï¼</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">86</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">13</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">6</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Nha3VwaW5lcmE=" title="https:&#x2F;&#x2F;github.com&#x2F;sakupinera"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9zYWt1cGluZXJh" title="https:&#x2F;&#x2F;twitter.com&#x2F;sakupinera"><i class="ic i-twitter"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTQwNzIyOTA3MQ==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;407229071"><i class="ic i-cloud-music"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjIzMDczOTg/c3BtX2lkX2Zyb209MzMzLjEwMDcuMC4w" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;22307398?spm_id_from&#x3D;333.1007.0.0"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li><li class="item"><a href="/games/" rel="section"><i class="ic i-flag"></i>Games</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-person"></i>About</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/11/17/csharp/clr-via-csharp/Chapter%2015%20Enumerated%20Types%20and%20Bit%20Flags/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/11/21/csharp/clr-via-csharp/Chapter%2017%20Delegates/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="In Linux">Linux</a> <i class="ic i-angle-right"></i> <a href="/categories/Linux/Learn-Linux/" title="In Learn-Linux">Learn-Linux</a></div><span><a href="/2022/09/04/linux/learn-linux/Shell%E7%BC%96%E7%A8%8B/" title="LearnLinux - Shellç¼–ç¨‹">LearnLinux - Shellç¼–ç¨‹</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/10/29/csharp/clr-via-csharp/Chapter%2011%20Events/" title="CLR via C# - Chapter 11 Events">CLR via C# - Chapter 11 Events</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Computer-Graphics/" title="In Computer-Graphics">Computer-Graphics</a> <i class="ic i-angle-right"></i> <a href="/categories/Computer-Graphics/GAMES101/" title="In GAMES101">GAMES101</a></div><span><a href="/2022/10/14/computer-graphics/games101/%E6%9D%90%E8%B4%A8%E4%B8%8E%E5%A4%96%E8%A7%82/" title="GAMES101 - Materials and Appearancesï¼ˆæè´¨ä¸å¤–è§‚ï¼‰">GAMES101 - Materials and Appearancesï¼ˆæè´¨ä¸å¤–è§‚ï¼‰</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Computer-Graphics/" title="In Computer-Graphics">Computer-Graphics</a> <i class="ic i-angle-right"></i> <a href="/categories/Computer-Graphics/GAMES101/" title="In GAMES101">GAMES101</a></div><span><a href="/2022/10/03/computer-graphics/games101/%E5%87%A0%E4%BD%95/" title="GAMES101 - Geometryï¼ˆå‡ ä½•ï¼‰">GAMES101 - Geometryï¼ˆå‡ ä½•ï¼‰</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="In Linux">Linux</a> <i class="ic i-angle-right"></i> <a href="/categories/Linux/Learn-Linux/" title="In Learn-Linux">Learn-Linux</a></div><span><a href="/2022/09/02/linux/learn-linux/Shell%E5%9F%BA%E7%A1%80/" title="LearnLinux - ShellåŸºç¡€">LearnLinux - ShellåŸºç¡€</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%202%20Building,%20Packaging,%20Deploying,%20and%20Administering%20Applications%20and%20Types/" title="CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types">CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CSharp-in-a-Nutshell/" title="In CSharp-in-a-Nutshell">CSharp-in-a-Nutshell</a></div><span><a href="/2022/08/30/csharp/csharp-in-a-nutshell/%E7%AC%AC8%E7%AB%A0%20LINQ%E6%9F%A5%E8%AF%A2/" title="C# in a Nutshell - ç¬¬8ç«  LINQæŸ¥è¯¢">C# in a Nutshell - ç¬¬8ç«  LINQæŸ¥è¯¢</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="In Linux">Linux</a> <i class="ic i-angle-right"></i> <a href="/categories/Linux/Learn-Linux/" title="In Learn-Linux">Learn-Linux</a></div><span><a href="/2022/08/28/linux/learn-linux/%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8Vim/" title="LearnLinux - æ–‡æœ¬ç¼–è¾‘å™¨Vim">LearnLinux - æ–‡æœ¬ç¼–è¾‘å™¨Vim</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/11/23/csharp/clr-via-csharp/Chapter%2019%20Nullable%20Value%20Types/" title="CLR via C# - Chapter 19 Nullable Value Types">CLR via C# - Chapter 19 Nullable Value Types</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="In Linux">Linux</a> <i class="ic i-angle-right"></i> <a href="/categories/Linux/Learn-Linux/" title="In Learn-Linux">Learn-Linux</a></div><span><a href="/2022/09/05/linux/learn-linux/%E5%90%AF%E5%8A%A8%E7%AE%A1%E7%90%86/" title="LearnLinux - å¯åŠ¨ç®¡ç†">LearnLinux - å¯åŠ¨ç®¡ç†</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 â€“ <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Sakupinera @ Hanamai Sora</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">2.2m words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">33:30</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/11/19/csharp/clr-via-csharp/Chapter 16 Arrays/",favicon:{show:"ï¼ˆâ—Â´3ï½€â—ï¼‰Goooood",hide:"(Â´Ğ”ï½€)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/assets/shifuku.model.json"},display:{position:"left",width:250,height:500},mobile:{show:!1},react:{opacity:.9},log:!1})</script></body></html>
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Sakupinera" href="http://sakupinera.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Sakupinera" href="http://sakupinera.github.io/atom.xml"><link rel="alternate" type="application/json" title="Sakupinera" href="http://sakupinera.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="è¯»ä¹¦ç¬”è®°,C#"><link rel="canonical" href="http://sakupinera.github.io/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/"><title>CLR via C# - Chapter 14 Chars, Strings, and Working with Text - CLR-via-CSharp - CSharp | Hanamai Sora = Sakupinera</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">CLR via C# - Chapter 14 Chars, Strings, and Working with Text</h1><div class="meta"><span class="item" title="Created: 2022-11-16 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2022-11-16T00:00:00+08:00">2022-11-16</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>96k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>1:27</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Hanamai Sora</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipexj2jgzj20zk0m8b09.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gicljitigmj20zk0m87fp.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipev1x5e4j20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipewr8iypj20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipey0a334j20zk0m8qpt.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclh3brzpj20zk0m8ann.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CSharp/" itemprop="item" rel="index" title="In CSharp"><span itemprop="name">CSharp</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/CSharp/CLR-via-CSharp/" itemprop="item" rel="index" title="In CLR-via-CSharp"><span itemprop="name">CLR-via-CSharp</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="http://sakupinera.github.io/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Sakupinera"><meta itemprop="description" content=", ä¿æŒä½ çš„å†³å¿ƒï¼"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sakupinera"></span><div class="body md" itemprop="articleBody"><h1 id="chapter-14-chars-strings-and-working-with-text"><a class="anchor" href="#chapter-14-chars-strings-and-working-with-text">#</a> Chapter 14 Chars, Strings, and Working with Text</h1><h2 id="characters"><a class="anchor" href="#characters">#</a> Characters</h2><blockquote><p>In the .NET Framework, characters are always represented in 16-bit Unicode code values, easing the development of global applications. A character is represented with an instance of the <code>System.Char</code> structure (a value type). The <code>System.Char</code> type is pretty simple. It offers two public read-only constant fields: <code>MinValue</code> , defined as '\0', and <code>MaxValue</code> , defined as '\uffff'.</p></blockquote><blockquote><p>Given an instance of a Char, you can call the static <code>GetUnicodeCategory</code> method, which returns a value of the <code>System.Globalization.UnicodeCategory</code> enumerated type. This value indicates whether the character is a control character, a currency symbol, a lowercase letter, an uppercase letter, a punctuation character, a math symbol, or another character (as defined by the Unicode standard).</p></blockquote><blockquote><p>To ease developing, the Char type also offers several static methods, such as <code>IsDigit</code> , <code>IsLetter</code> , <code>IsWhiteSpace</code> , <code>IsUpper</code> , <code>IsLower</code> , <code>IsPunctuation</code> , <code>IsLetterOrDigit</code> , <code>IsControl</code> , <code>IsNumber</code> , <code>IsSeparator</code> , <code>IsSurrogate</code> , <code>IsLowSurrogate</code> , <code>IsHighSurrogate</code> , and <code>IsSymbol</code> . Most of these methods call <code>GetUnicodeCategory</code> internally and simply return true or false accordingly. Note that all of these methods take either a single character for a parameter or a String and the index of a character within the String as parameters.</p></blockquote><blockquote><p>In addition, you can convert a single character to its lowercase or uppercase equivalent in a culture-agnostic way by calling the static <code>ToLowerInvariant</code> or <code>ToUpperInvariant</code> method. Alternatively, the <code>ToLower</code> and <code>ToUpper</code> methods convert the character by using the culture information associated with the calling thread (which the methods obtain internally by querying the static <code>CurrentCulture</code> property of the <code>System.Globalization.CultureInfo</code> class). You can also specify a particular culture by passing an instance of the <code>CultureInfo</code> class to these methods. <code>ToLower</code> and <code>ToUpper</code> require culture information because letter casing is a culture-dependent operation. For example, Turkish considers the uppercase of U+0069 (LATIN LOWERCASE LETTER I) to be U+0130 (LATIN UPPERCASE LETTER I WITH DOT ABOVE), whereas other cultures consider the result to be U+0049 (LATIN CAPITAL LETTER I).</p></blockquote><blockquote><p>Besides these static methods, the Char type also offers a few instance methods of its own. The Equals method returns true if two Char instances represent the same 16-bit Unicode code point. The <code>CompareTo</code> methods (defined by the <code>IComparable</code> / <code>IComparable</code> interfaces) return a comparison of two Char instances; this comparison is not culture-sensitive. The ConvertFromUtf32 method produces a string consisting of one or two UTF-16 characters from a single UTF-32 character. The ConvertToUtf32 produces a UTF-32 character from a low/high surrogate pair or from a string. The <code>ToString</code> method returns a String consisting of a single character. The opposite of <code>ToString</code> is <code>Parse</code> / <code>TryParse</code> , which takes a single-character String and returns its UTF-16 code point.</p></blockquote><blockquote><p>The last method, <code>GetNumericValue</code> , returns the numeric equivalent of a character. I demonstrate this method in the following code.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token class-name">Double</span> d<span class="token punctuation">;</span> <span class="token comment">// '\u0033' is the "digit 3" </span></pre></td></tr><tr><td data-num="5"></td><td><pre> d <span class="token operator">=</span> Char<span class="token punctuation">.</span><span class="token function">GetNumericValue</span><span class="token punctuation">(</span><span class="token char">'\u0033'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '3' would work too </span></pre></td></tr><tr><td data-num="6"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Displays "3" </span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token comment">// '\u00bc' is the "vulgar fraction one quarter ('Â¼')" </span></pre></td></tr><tr><td data-num="8"></td><td><pre> d <span class="token operator">=</span> Char<span class="token punctuation">.</span><span class="token function">GetNumericValue</span><span class="token punctuation">(</span><span class="token char">'\u00bc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Displays "0.25" </span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token comment">// 'A' is the "Latin capital letter A" </span></pre></td></tr><tr><td data-num="11"></td><td><pre> d <span class="token operator">=</span> Char<span class="token punctuation">.</span><span class="token function">GetNumericValue</span><span class="token punctuation">(</span><span class="token char">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Displays "-1" </span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Finally, three techniques allow you to convert between various numeric types to Char instances and vice versa. The techniques are listed here in order of preference:</p><ul><li><p>Casting The easiest way to convert a Char to a numeric value such as an Int32 is simply by casting. Of the three techniques, this is the most efficient because the compiler emits Intermediate Language (IL) instructions to perform the conversion, and no methods have to be called. In addition, some languages (such as C#) allow you to indicate whether the conversion should be performed using checked or unchecked code (discussed in Chapter 5, â€œPrimitive, Reference, and Value Typesâ€).</p></li><li><p>Use the Convert type The <code>System.Convert</code> type offers several static methods that are capable of converting a Char to a numeric type and vice versa. All of these methods perform the conversion as a checked operation, causing an <code>OverflowException</code> to be thrown if the conversion results in the loss of data.</p></li><li><p>Use the <code>IConvertible</code> interface The Char type and all of the numeric types in the .NET Framework Class Library (FCL) implement the <code>IConvertible</code> interface. This interface defines methods such as ToUInt16 and <code>ToChar</code> . This technique is the least efficient of the three because calling an interface method on a value type requires that the instance be boxedâ€” Char and all of the numeric types are value types. The methods of <code>IConvertible</code> throw a <code>System.InvalidCastException</code> if the type canâ€™t be converted (such as converting a Char to a Boolean) or if the conversion results in a loss of data. Note that many types (including the FCLâ€™s Char and numeric types) implement <code>IConvertible</code> â€™s methods as explicit interface member implementations (described in Chapter 13, â€œInterfacesâ€). This means that you must explicitly cast the instance to an <code>IConvertible</code> before you can call any of the interfaceâ€™s methods. All of the methods of <code>IConvertible</code> except <code>GetTypeCode</code> accept a reference to an object that implements the <code>IFormatProvider</code> interface. This parameter is useful if for some reason the conversion needs to take culture information into account. For most conversions, you can pass null for this parameter because it would be ignored anyway.</p></li></ul></blockquote><blockquote><p>The following code demonstrates how to use these three techniques.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token class-name">Char</span> c<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token class-name">Int32</span> n<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token comment">// Convert number &lt;-> character using C# casting </span></pre></td></tr><tr><td data-num="7"></td><td><pre> c <span class="token operator">=</span> <span class="token punctuation">(</span>Char<span class="token punctuation">)</span> <span class="token number">65</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Displays "A" </span></pre></td></tr><tr><td data-num="9"></td><td><pre> n <span class="token operator">=</span> <span class="token punctuation">(</span>Int32<span class="token punctuation">)</span> c<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Displays "65" </span></pre></td></tr><tr><td data-num="11"></td><td><pre> c <span class="token operator">=</span> <span class="token keyword">unchecked</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Char<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">65536</span> <span class="token operator">+</span> <span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Displays "A" </span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token comment">// Convert number &lt;-> character using Convert </span></pre></td></tr><tr><td data-num="14"></td><td><pre> c <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToChar</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Displays "A" </span></pre></td></tr><tr><td data-num="16"></td><td><pre> n <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Displays "65" </span></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token comment">// This demonstrates Convert's range checking </span></pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token keyword">try</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="20"></td><td><pre> c <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToChar</span><span class="token punctuation">(</span><span class="token number">70000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Too big for 16 bits </span></pre></td></tr><tr><td data-num="21"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Doesn't execute </span></pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">OverflowException</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="24"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Can't convert 70000 to a Char."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token comment">// Convert number &lt;-> character using IConvertible </span></pre></td></tr><tr><td data-num="27"></td><td><pre> c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>IConvertible<span class="token punctuation">)</span> <span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToChar</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="28"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Displays "A" </span></pre></td></tr><tr><td data-num="29"></td><td><pre> n <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>IConvertible<span class="token punctuation">)</span> c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="30"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Displays "65" </span></pre></td></tr><tr><td data-num="31"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ğŸ’¡å°ç»“ï¼š<span class="exturl" data-url="aHR0cDovL3huLS0zZHMuTkVU">åœ¨.NET</span> Framework ä¸­ï¼Œå­—ç¬¦æ€»æ˜¯è¡¨ç¤ºæˆ 16 ä½ Unicode ä»£ç å€¼ï¼Œè¿™ç®€åŒ–äº†å›½é™…åŒ–åº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚å¯è°ƒç”¨é™æ€æ–¹æ³• <code>ToLowerInvariant</code> æˆ–è€… <code>ToUpperInvariant</code> ï¼Œä»¥å¿½ç•¥è¯­è¨€æ–‡åŒ–ï¼ˆcultureï¼‰çš„æ–¹å¼å°†å­—ç¬¦è½¬æ¢ä¸ºå°å†™æˆ–å¤§å†™å½¢å¼ã€‚ <code>ToLower</code> å’Œ <code>ToUpper</code> ä¹‹æ‰€ä»¥éœ€è¦è¯­è¨€æ–‡åŒ–ä¿¡æ¯ï¼Œæ˜¯å› ä¸ºå­—æ¯çš„å¤§å°å†™è½¬æ¢æ˜¯ä¸€ç§ä¾èµ–äºè¯­è¨€æ–‡åŒ–çš„æ“ä½œã€‚é™¤äº†é™æ€æ–¹æ³•ä¹‹å¤–ï¼ŒChar ç±»å‹è¿˜æœ‰è‡ªå·±çš„å®ä¾‹æ–¹æ³•ã€‚ å…¶ä¸­ï¼Œ <code>Equals</code> æ–¹æ³•åœ¨ä¸¤ä¸ª Char å®ä¾‹ä»£è¡¨åŒä¸€ä¸ª 16 ä½ Unicode ç ä½çš„å‰æä¸‹è¿”å› trueã€‚ï¼ˆåœ¨å­—ç¬¦ç¼–ç æœ¯è¯­ä¸­ï¼Œç ä½æˆ–ç§°ç¼–ç ä½ç½®ï¼Œå³è‹±æ–‡çš„ code point æˆ– code positionï¼Œæ˜¯ç»„æˆç ç©ºé—´ï¼ˆæˆ–ä»£ç é¡µï¼‰çš„æ•°å€¼ã€‚ä¾‹å¦‚ï¼ŒASCII ç åŒ…å« 128 ä¸ªç ä½ã€‚å¯ä»¥ä½¿ç”¨ä¸‰ç§æŠ€æœ¯å®ç°å„ç§æ•°å€¼ç±»å‹ä¸ Char å®ä¾‹çš„ç›¸äº’è½¬æ¢ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šè½¬å‹ï¼ˆå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼‰ï¼Œè¿™ç§æ•ˆç‡æœ€é«˜ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸­é—´è¯­è¨€ï¼ˆILï¼‰æŒ‡ä»¤æ¥æ‰§è¡Œè½¬æ¢ï¼Œè€Œä¸”ä¸å¿…è°ƒç”¨æ–¹æ³•ï¼›ä½¿ç”¨ <code>Convert</code> ç±»å‹ï¼Œæ‰€æœ‰è½¬æ¢éƒ½ä»¥ checked æ–¹å¼æ‰§è¡Œï¼Œå‘ç°è½¬æ¢å°†é€ æˆæ•°æ®ä¸¢å¤±å°±æŠ›å‡ºå¼‚å¸¸ï¼›ä½¿ç”¨ <code>IConvertible</code> æ¥å£ï¼ŒChar ç±»å‹å’Œ FCL ä¸­çš„æ‰€æœ‰æ•°å€¼ç±»å‹éƒ½å®ç°äº† <code>IConvertible</code> æ¥å£ã€‚è¿™ç§æ•ˆç‡æœ€å·®ï¼Œå› ä¸ºåœ¨å€¼ç±»å‹ä¸Šè°ƒç”¨æ¥å£æ–¹æ³•è¦æ±‚å¯¹å®ä¾‹è¿›è¡Œè£…ç®± â€”â€”Char å’Œæ‰€æœ‰æ•°å€¼ç±»å‹éƒ½æ˜¯å€¼ç±»å‹ã€‚æ³¨æ„ï¼Œè®¸å¤šç±»å‹ï¼ˆåŒ…æ‹¬ FCL çš„ Char å’Œæ•°å€¼ç±»å‹ï¼‰éƒ½å°† <code>IConvertible</code> çš„æ–¹æ³•å®ç°ä¸ºæ˜¾å¼æ¥å£æˆå‘˜ã€‚è¿™æ„å‘³ç€ä¸ºäº†è°ƒç”¨æ¥å£çš„ä»»ä½•æ–¹æ³•ï¼Œéƒ½å¿…é¡»å…ˆå°†å®ä¾‹æ˜¾å¼è½¬å‹ä¸ºä¸€ä¸ª <code>IConvertible</code> ã€‚ <code>IConvertible</code> çš„æ‰€æœ‰æ–¹æ³•ï¼ˆ <code>GetTypeCode</code> é™¤å¤–ï¼‰éƒ½æ¥å—å¯¹å®ç°äº† <code>IFormatProvider</code> æ¥å£çš„ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚å¦‚æœè½¬æ¢æ—¶éœ€è¦è€ƒè™‘è¯­è¨€æ–‡åŒ–ä¿¡æ¯ï¼Œè¯¥å‚æ•°å°±å¾ˆæœ‰ç”¨ã€‚ä½†å¤§å¤šæ•°æ—¶å€™éƒ½å¯ä»¥å¿½ç•¥è¯­è¨€æ–‡åŒ–ï¼Œä¸ºè¿™ä¸ªå‚æ•°ä¼ é€’ null å€¼ã€‚</p><h2 id="the-systemstring-type"><a class="anchor" href="#the-systemstring-type">#</a> The System.String Type</h2><blockquote><p>One of the most used types in any application is System.String. A String represents an immutable sequence of characters. The String type is derived immediately from Object, making it a reference type, and therefore, String objects (its array of characters) always live in the heap, never on a threadâ€™s stack. The String type also implements several interfaces (IComparable/ IComparable, ICloneable, IConvertible, IEnumerable/IEnumerable, and IEquatable).</p></blockquote><h3 id="constructing-strings"><a class="anchor" href="#constructing-strings">#</a> Constructing Strings</h3><blockquote><p>Many programming languages (including C#) consider String to be a primitive typeâ€”that is, the compiler lets you express literal strings directly in your source code. The compiler places these literal strings in the moduleâ€™s metadata, and they are then loaded and referenced at run time.</p></blockquote><blockquote><p>In C#, you canâ€™t use the new operator to construct a String object from a literal string.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">String</span><span class="token punctuation">(</span><span class="token string">"Hi there."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-- Error </span></pre></td></tr><tr><td data-num="5"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Instead, you must use the following simplified syntax.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"Hi there."</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>If you compile this code and examine its IL (using ILDasm.exe), youâ€™d see the following.</p></blockquote><figure class="highlight clike"><figcaption data-lang="C-like"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">.</span>method public hidebysig static void <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> cil managed </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token punctuation">.</span>entrypoint </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token comment">// Code size 13 (0xd) </span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token punctuation">.</span>maxstack <span class="token number">1</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token punctuation">.</span>locals init <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> string s<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> IL_0000<span class="token punctuation">:</span> ldstr <span class="token string">"Hi there."</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> IL_0005<span class="token punctuation">:</span> stloc<span class="token punctuation">.</span><span class="token number">0</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> IL_0006<span class="token punctuation">:</span> ldloc<span class="token punctuation">.</span><span class="token number">0</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> IL_0007<span class="token punctuation">:</span> call void <span class="token punctuation">[</span>mscorlib<span class="token punctuation">]</span>System<span class="token punctuation">.</span>Console<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> IL_000c<span class="token punctuation">:</span> ret </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token comment">// end of method Program::Main</span></pre></td></tr></table></figure><blockquote><p>The newobj IL instruction constructs a new instance of an object. However, no newobj instruction appears in the IL code example. Instead, you see the special ldstr (load string) IL instruction, which constructs a String object by using a literal string obtained from metadata. This shows you that the common language runtime (CLR) does, in fact, have a special way of constructing literal String objects.</p></blockquote><blockquote><p>If you are using unsafe code, you can construct a String object from a Char* or SByte*. To accomplish this, you would use C#â€™s new operator and call one of the constructors provided by the String type that takes Char* or SByte* parameters. These constructors create a String object, initializing the string from an array of Char instances or signed bytes. The other constructors donâ€™t have any pointer parameters and can be called using safe (verifiable) code written in any managed programming language.</p></blockquote><blockquote><p>C# offers some special syntax to help you enter literal strings into the source code. For special characters such as new lines, carriage returns, and backspaces, C# uses the escape mechanism familiar to C/C++ developers.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// String containing carriage-return and newline characters </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"Hi\r\nthere."</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>ğŸ’¡é‡è¦æç¤ºï¼šä¸Šä¾‹è™½ç„¶åœ¨å­—ç¬¦ä¸²ä¸­ç¡¬ç¼–ç äº†å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦ï¼Œä½†ä¸€èˆ¬ä¸å»ºè®®è¿™æ ·åšã€‚ç›¸åï¼Œ <code>System.Environment</code> ç±»å‹å®šä¹‰äº†åªè¯» <code>NewLine</code> å±æ€§ã€‚åº”ç”¨ç¨‹åºåœ¨ Microsoft Windows ä¸Šè¿è¡Œæ—¶ï¼Œè¯¥å±æ€§è¿”å›ç”±å›è½¦ç¬¦å’Œæ¢æ¢è¡Œç¬¦æ„æˆçš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå°†å…¬å…±è¯­è¨€åŸºç¡€ç»“æ„ (CLI) ç§»æ¤åˆ° UNIX ç³»ç»Ÿï¼Œ <code>NewLine</code> å±æ€§å°†è¿”å›ç”±å•å­—ç¬¦ `\nâ€˜æ„æˆçš„å­—ç¬¦ä¸²ã€‚ä»¥ä¸‹æ‰æ˜¯å®šä¹‰ä¸Šè¿°å­—ç¬¦ä¸²çš„æ­£ç¡®æ–¹å¼ï¼Œå®ƒåœ¨ä»»ä½•å¹³å°ä¸Šéƒ½èƒ½æ­£ç¡®å·¥ä½œï¼š</p><p><code>String s = &quot;Hi&quot; + Environment.NewLine + &quot;there.&quot;</code> ï¼›</p><blockquote><p>You can concatenate several strings to form a single string by using C#â€™s + operator as follows.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Three literal strings concatenated to form a single literal string </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"Hi"</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token string">"there."</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>In this code, because all of the strings are literal strings, the C# compiler concatenates them at compile time and ends up placing just one stringâ€”&quot;Hi there.&quot;â€”in the moduleâ€™s metadata. Using the + operator on nonliteral strings causes the concatenation to be performed at run time. To concatenate several strings together at run time, avoid using the + operator because it creates multiple string objects on the garbage-collected heap. Instead, use the System.Text.StringBuilder type (which Iâ€™ll explain later in this chapter).</p></blockquote><blockquote><p>Finally, C# also offers a special way to declare a string in which all characters between quotes are considered part of the string. These special declarations are called verbatim strings and are typically used when specifying the path of a file or directory or when working with regular expressions. Here is some code showing how to declare the same string with and without using the verbatim string character (@).</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Specifying the pathname of an application </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">String</span> file <span class="token operator">=</span> <span class="token string">"C:\\Windows\\System32\\Notepad.exe"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// Specifying the pathname of an application by using a verbatim string </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">String</span> file <span class="token operator">=</span> <span class="token string">@"C:\Windows\System32\Notepad.exe"</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>You could use either one of the preceding code lines in a program because they produce identical strings in the assemblyâ€™s metadata. However, the @ symbol before the string on the second line tells the compiler that the string is a verbatim string. In effect, this tells the compiler to treat backslash characters as backslash characters instead of escape characters, making the path much more readable in your source code.</p></blockquote><blockquote><p>Now that youâ€™ve seen how to construct a string, letâ€™s talk about some of the operations you can perform on String objects.</p></blockquote><h3 id="strings-are-immutable"><a class="anchor" href="#strings-are-immutable">#</a> Strings Are Immutable</h3><blockquote><p>The most important thing to know about a String object is that it is immutable. That is, once created, a string can never get longer, get shorter, or have any of its characters changed. Having immutable strings offers several benefits. First, it allows you to perform operations on a string without actually changing the string.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">ToUpperInvariant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">EndsWith</span><span class="token punctuation">(</span><span class="token string">"EXE"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token range operator">..</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Here, ToUpperInvariant returns a new string; it doesnâ€™t modify the characters of the string s. Substring operates on the string returned by ToUpperInvariant and also returns a new string, which is then examined by EndsWith. The two temporary strings created by ToUpperInvariant and Substring are not referenced for long by the application code, and the garbage collector will reclaim their memory at the next collection. If you perform a lot of string manipulations, you end up creating a lot of String objects on the heap, which causes more frequent garbage collections, thus hurting your applicationâ€™s performance.</p></blockquote><blockquote><p>Having immutable strings also means that there are no thread synchronization issues when manipulating or accessing a string. In addition, itâ€™s possible for the CLR to share multiple identical String contents through a single String object. This can reduce the number of strings in the systemâ€”thereby conserving memory usageâ€”and it is what string interning (discussed later in the chapter) is all about.</p></blockquote><blockquote><p>For performance reasons, the String type is tightly integrated with the CLR. Specifically, the CLR knows the exact layout of the fields defined within the String type, and the CLR accesses these fields directly. This performance and direct access come at a small development cost: the String class is sealed, which means that you cannot use it as a base class for your own type. If you were able to define your own type, using String as a base type, you could add your own fields, which would break the CLRâ€™s assumptions. In addition, you could break some assumptions that the CLR team has made about String objects being immutable.</p></blockquote><h3 id="comparing-strings"><a class="anchor" href="#comparing-strings">#</a> Comparing Strings</h3><blockquote><p>Comparing is probably the most common operation performed on strings. There are two reasons to compare two strings with each other. We compare two strings to determine equality or to sort them (usually for presentation to a user).</p></blockquote><blockquote><p>In determining string equality or when comparing strings for sorting, it is highly recommended that you call one of these methods (defined by the String class).</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token return-type class-name">Boolean</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name">StringComparison</span> comparisonType<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">static</span> <span class="token return-type class-name">Boolean</span> <span class="token function">Equals</span><span class="token punctuation">(</span><span class="token class-name">String</span> a<span class="token punctuation">,</span> <span class="token class-name">String</span> b<span class="token punctuation">,</span> <span class="token class-name">StringComparison</span> comparisonType<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">Compare</span><span class="token punctuation">(</span><span class="token class-name">String</span> strA<span class="token punctuation">,</span> <span class="token class-name">String</span> strB<span class="token punctuation">,</span> <span class="token class-name">StringComparison</span> comparisonType<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">Compare</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> strA<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> strB<span class="token punctuation">,</span> <span class="token class-name">Boolean</span> ignoreCase<span class="token punctuation">,</span> <span class="token class-name">CultureInfo</span> culture<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">Compare</span><span class="token punctuation">(</span><span class="token class-name">String</span> strA<span class="token punctuation">,</span> <span class="token class-name">String</span> strB<span class="token punctuation">,</span> <span class="token class-name">CultureInfo</span> culture<span class="token punctuation">,</span> <span class="token class-name">CompareOptions</span> options<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">Compare</span><span class="token punctuation">(</span><span class="token class-name">String</span> strA<span class="token punctuation">,</span> <span class="token class-name">Int32</span> indexA<span class="token punctuation">,</span> <span class="token class-name">String</span> strB<span class="token punctuation">,</span> <span class="token class-name">Int32</span> indexB<span class="token punctuation">,</span> <span class="token class-name">Int32</span> length<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token class-name">StringComparison</span> comparisonType<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">Compare</span><span class="token punctuation">(</span><span class="token class-name">String</span> strA<span class="token punctuation">,</span> <span class="token class-name">Int32</span> indexA<span class="token punctuation">,</span> <span class="token class-name">String</span> strB<span class="token punctuation">,</span> <span class="token class-name">Int32</span> indexB<span class="token punctuation">,</span> <span class="token class-name">Int32</span> length<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token class-name">CultureInfo</span> culture<span class="token punctuation">,</span> <span class="token class-name">CompareOptions</span> options<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">Compare</span><span class="token punctuation">(</span><span class="token class-name">String</span> strA<span class="token punctuation">,</span> <span class="token class-name">Int32</span> indexA<span class="token punctuation">,</span> <span class="token class-name">String</span> strB<span class="token punctuation">,</span> <span class="token class-name">Int32</span> indexB<span class="token punctuation">,</span> <span class="token class-name">Int32</span> length<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token class-name">Boolean</span> ignoreCase<span class="token punctuation">,</span> <span class="token class-name">CultureInfo</span> culture<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token return-type class-name">Boolean</span> <span class="token function">StartsWith</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name">StringComparison</span> comparisonType<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token return-type class-name">Boolean</span> <span class="token function">StartsWith</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token keyword">value</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token class-name">Boolean</span> ignoreCase<span class="token punctuation">,</span> <span class="token class-name">CultureInfo</span> culture<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token return-type class-name">Boolean</span> <span class="token function">EndsWith</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name">StringComparison</span> comparisonType<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token return-type class-name">Boolean</span> <span class="token function">EndsWith</span><span class="token punctuation">(</span><span class="token class-name">String</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name">Boolean</span> ignoreCase<span class="token punctuation">,</span> <span class="token class-name">CultureInfo</span> culture<span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p>When sorting, you should always perform case-sensitive comparisons. The reason is that if two strings differing only by case are considered to be equal, they could be ordered differently each time you sort them; this would confuse the user.</p></blockquote><blockquote><p>The comparisonType argument (in most of the preceding methods) is one of the values defined by the StringComparison enumerated type, which is defined as follows.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">StringComparison</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> CurrentCulture <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> CurrentCultureIgnoreCase <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> InvariantCulture <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> InvariantCultureIgnoreCase <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> Ordinal <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> OrdinalIgnoreCase <span class="token operator">=</span> <span class="token number">5</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>The options argument (in two of the preceding methods) is one of the values defined by the CompareOptions enumerator type.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Flags</span></span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">CompareOptions</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre> None <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre> IgnoreCase <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre> IgnoreNonSpace <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre> IgnoreSymbols <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre> IgnoreKanaType <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre> IgnoreWidth <span class="token operator">=</span> <span class="token number">0x00000010</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre> Ordinal <span class="token operator">=</span> <span class="token number">0x40000000</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre> OrdinalIgnoreCase <span class="token operator">=</span> <span class="token number">0x10000000</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre> StringSort <span class="token operator">=</span> <span class="token number">0x20000000</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Methods that accept a CompareOptions argument also force you to explicitly pass in a culture. When passing in the Ordinal or OrdinalIgnoreCase flag, these Compare methods ignore the specified culture.</p></blockquote><blockquote><p>Many programs use strings for internal programmatic purposes such as path names, file names, URLs, registry keys and values, environment variables, reflection, Extensible Markup Language (XML) tags, XML attributes, and so on. Often, these strings are not shown to a user and are used only within the program. When comparing programmatic strings, you should always use StringComparison.Ordinal or StringComparison.OrdinalIgnoreCase. This is the fastest way to perform a comparison that is not to be affected in any linguistic way because culture information is not taken into account when performing the comparison.</p></blockquote><blockquote><p>On the other hand, when you want to compare strings in a linguistically correct manner (usually for display to an end user), you should use StringComparison.CurrentCulture or StringComparison.CurrentCultureIgnoreCase.</p></blockquote><p>ğŸ’¡é‡è¦æç¤ºï¼š <code>StringComparison.InvariantCulture</code> å’Œ <code>StringComparison.InvariantCultureIgnoreCase</code> å¹³æ—¶æœ€å¥½ä¸è¦ç”¨ã€‚è™½ç„¶è¿™ä¸¤ä¸ªå€¼ä¿è¯æ¯”è¾ƒæ—¶çš„è¯­è¨€æ–‡åŒ–æ­£ç¡®æ€§ï¼Œä½†ç”¨æ¥æ¯”è¾ƒå†…éƒ¨ç¼–ç¨‹æ‰€éœ€çš„å­—ç¬¦ä¸²ï¼Œæ‰€èŠ±çš„æ—¶é—´è¿œè¶…å‡ºåºå·æ¯”è¾ƒ &lt;sup&gt;â‘ &lt;/sup&gt;ã€‚æ­¤å¤–ï¼Œå¦‚æœä¼ é€’ <code>StringComparison.InvariantCulture</code> (å›ºå®šè¯­è¨€æ–‡åŒ–)ï¼Œå…¶å®å°±æ˜¯ä¸ä½¿ç”¨ä»»ä½•å…·ä½“çš„è¯­è¨€æ–‡åŒ–ã€‚æ‰€ä»¥åœ¨å¤„ç†è¦å‘ç”¨æˆ·æ˜¾ç¤ºçš„å­—ç¬¦ä¸²æ—¶ï¼Œé€‰æ‹©å®ƒå¹¶ä¸æ°å½“ã€‚</p><p>â‘  ä¼ é€’ <code>StringComparison.Ordinal</code> æ‰§è¡Œçš„å°±æ˜¯åºå·æ¯”è¾ƒï¼Œä¹Ÿå°±æ˜¯ä¸è€ƒè™‘è¯­è¨€æ–‡åŒ–ä¿¡æ¯ï¼Œåªæ¯”è¾ƒå­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ª <code>Char</code> çš„ Unicode ç ä½ã€‚</p><p>ğŸ’¡é‡è¦æç¤ºï¼šè¦åœ¨åºå·æ¯”è¾ƒå‰æ›´æ”¹å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦çš„å¤§å°å†™ï¼Œåº”è¯¥ä½¿ç”¨ <code>String</code> çš„ <code>ToUpperInvariant</code> æˆ– <code>ToLowerInvariant</code> æ–¹æ³•ã€‚å¼ºçƒˆå»ºè®®ç”¨ <code>ToUpperInvariant</code> æ–¹æ³•å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ­£è§„åŒ– (normalizing)ï¼Œè€Œä¸è¦ç”¨ <code>ToLowerInvariant</code> ï¼Œå› ä¸º Microsoft å¯¹æ‰§è¡Œå¤§å†™æ¯”è¾ƒçš„ä»£ç è¿›è¡Œäº†ä¼˜åŒ–ã€‚äº‹å®ä¸Šï¼Œæ‰§è¡Œä¸åŒºåˆ†å¤§å°å†™çš„æ¯”è¾ƒä¹‹å‰ï¼ŒFCL ä¼šè‡ªåŠ¨å°†å­—ç¬¦ä¸²æ­£è§„åŒ–ä¸ºå¤§å†™å½¢å¼ã€‚ä¹‹æ‰€ä»¥è¦ç”¨ <code>ToUpperInvariant</code> å’Œ <code>ToLowerInvariant</code> æ–¹æ³•ï¼Œæ˜¯å› ä¸º <code>String</code> ç±»æ²¡æœ‰æä¾› <code>ToUpperOrdinal</code> å’Œ <code>ToLowerOrdinal</code> æ–¹æ³•ã€‚ä¹‹æ‰€ä»¥ä¸ç”¨ <code>ToUpper</code> å’Œ <code>ToLower</code> æ–¹æ³•ï¼Œæ˜¯å› ä¸ºå®ƒä»¬å¯¹è¯­è¨€æ–‡åŒ–æ•æ„Ÿã€‚</p><blockquote><p>Sometimes, when you compare strings in a linguistically correct manner, you want to specify a specific culture rather than use a culture that is associated with the calling thread. In this case, you can use the overloads of the StartsWith, EndsWith, and Compare methods shown earlier, all of which take Boolean and CultureInfo arguments.</p></blockquote><p>ğŸ’¡é‡è¦æç¤ºï¼šé™¤äº†å‰é¢åˆ—å‡ºä¹‹å¤–ï¼Œ <code>String</code> ç±»å‹è¿˜ä¸º <code>Equals</code> ï¼Œ <code>StartsWith</code> , <code>EndsWith</code> å’Œ <code>Compare</code> æ–¹æ³•å®šä¹‰äº†å…¶ä»–å‡ ä¸ªé‡è½½ç‰ˆæœ¬ã€‚ä½†æ˜¯ï¼ŒMicrosoft å»ºè®®é¿å…ä½¿ç”¨è¿™äº›é¢å¤–çš„ç‰ˆæœ¬ (ä¹Ÿå°±æ˜¯æœ¬ä¹¦æ²¡æœ‰åˆ—å‡ºçš„ç‰ˆæœ¬)ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ <code>String</code> çš„å…¶ä»–æ¯”è¾ƒæ–¹æ³• â€”â€” <code>CompareTo</code> ( <code>IComparable</code> æ¥å£æ‰€è¦æ±‚çš„)ã€ç”¨è¿™äº›æ–¹æ³•å’Œæ“ä½œç¬¦ï¼Œæ˜¯å› ä¸ºè°ƒç”¨è€…ä¸æ˜¾å¼æŒ‡å‡ºä»¥ä»€ä¹ˆæ–¹å¼æ‰§è¡Œå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œè€Œä½ æ— æ³•ä»æ–¹æ³•åçœ‹å‡ºé»˜è®¤æ¯”è¾ƒæ–¹å¼ã€‚ä¾‹å¦‚ï¼Œ <code>CompareTo</code> é»˜è®¤æ‰§è¡Œå¯¹è¯­è¨€æ–‡åŒ–æ•æ„Ÿçš„æ¯”è¾ƒï¼Œè€Œ <code>Equals</code> æ‰§è¡Œæ™®é€šçš„åºå· (ordinal) æ¯”è¾ƒã€‚å¦‚æœæ€»æ˜¯æ˜¾å¼åœ°æŒ‡å‡ºä»¥ä»€ä¹ˆæ–¹å¼æ‰§è¡Œå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œä»£ç å°†æ›´å®¹æ˜“é˜…è¯»å’Œç»´æŠ¤ã€‚</p><blockquote><p>Now, letâ€™s talk about how to perform linguistically correct comparisons. The .NET Framework uses the System.Globalization.CultureInfo type to represent a language/country pair (as described by the RFC 1766 standard). For example, â€œen-USâ€ identifies English as written in the United States, â€œenAUâ€ identifies English as written in Australia, and â€œde-DEâ€ identifies German as written in Germany. In the CLR, every thread has two properties associated with it. Each of these properties refers to a CultureInfo object. The two properties are:</p><ul><li><p>CurrentUICulture This property is used to obtain resources that are shown to an end user. It is most useful for GUI or Web Forms applications because it indicates the language that should be used when displaying UI elements such as labels and buttons. By default, when you create a thread, this thread property is set to a CultureInfo object, which identifies the language of the Windows version the application is running on using the Win32 GetUserDefaultUILanguage function. If youâ€™re running a Multilingual User Interface (MUI) version of Windows, you can set this via the Regional And Language Options Control Panel Settings dialog box. On a non-MUI version of Windows, the language is determined by the localized version of the operating system installed (or the installed language pack) and the language is not changeable.</p></li><li><p>CurrentCulture This property is used for everything that CurrentUICulture isnâ€™t used for, including number and date formatting, string casing, and string comparing. When formatting, both the language and country parts of the CultureInfo object are used. By default, when you create a thread, this thread property is set to a CultureInfo object, whose value is determined by calling the Win32 GetUserDefaultLCID method, whose value is set in the Regional And Language Control Panel applet.</p></li></ul></blockquote><blockquote><p>For the two thread properties mentioned above, you can override the default value used by the system when a new thread gets created with AppDomain defaults by setting CultureInfoâ€™s static DefaultThreadCurrentCulture and DefaultThreadCurrentUICulture properties.</p></blockquote><blockquote><p>On many computers, a threadâ€™s CurrentUICulture and CurrentCulture properties will be set to the same CultureInfo object, which means that they both use the same language/country information. However, they can be set differently. For example: an application running in the United States could use Spanish for all of its menu items and other GUI elements while properly displaying all of the currency and date formatting for the United States. To do this, the threadâ€™s CurrentUICulture property should be set to a CultureInfo object initialized with a language of â€œesâ€ (for Spanish), while the threadâ€™s CurrentCulture property should be set to a CultureInfo object initialized with a language/country pair of â€œen-US.â€</p></blockquote><blockquote><p>Internally, a CultureInfo object has a field that refers to a System.Globalization.CompareInfo object, which encapsulates the cultureâ€™s character-sorting table information as defined by the Unicode standard. The following code demonstrates the difference between performing an ordinal comparison and a culturally aware string comparison.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Globalization</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"Strasse"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"StraÃŸe"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token class-name">Boolean</span> eq<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token comment">// CompareOrdinal returns nonzero. </span></pre></td></tr><tr><td data-num="9"></td><td><pre> eq <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">Compare</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> StringComparison<span class="token punctuation">.</span>Ordinal<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Ordinal comparison: '&#123;0&#125;' &#123;2&#125; '&#123;1&#125;'"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> eq <span class="token punctuation">?</span> <span class="token string">"=="</span> <span class="token punctuation">:</span> <span class="token string">"!="</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token comment">// Compare Strings appropriately for people </span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token comment">// who speak German (de) in Germany (DE) </span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token class-name">CultureInfo</span> ci <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CultureInfo</span><span class="token punctuation">(</span><span class="token string">"de-DE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token comment">// Compare returns zero. </span></pre></td></tr><tr><td data-num="16"></td><td><pre> eq <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">Compare</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> ci<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Cultural comparison: '&#123;0&#125;' &#123;2&#125; '&#123;1&#125;'"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> eq <span class="token punctuation">?</span> <span class="token string">"=="</span> <span class="token punctuation">:</span> <span class="token string">"!="</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Building and running this code produces the following output.</p></blockquote><pre><code class="language-cmd">Ordinal comparison: 'Strasse' != 'StraÃŸe' 
Cultural comparison: 'Strasse' == 'StraÃŸe'
</code></pre><p>ğŸ’¡æ³¨æ„ï¼š <code>Compare</code> æ–¹æ³•å¦‚æœæ‰§è¡Œçš„ä¸æ˜¯åºå·æ¯”è¾ƒå°±ä¼šè¿›è¡Œ â€œå­—ç¬¦å±•å¼€â€(character expansion)ï¼Œä¹Ÿå°±æ˜¯å°†ä¸€ä¸ªå­—ç¬¦å±•å¼€æˆå¿½è§†è¯­è¨€æ–‡åŒ–çš„å¤šä¸ªå­—ç¬¦ã€‚åœ¨å‰ä¾‹ä¸­ï¼Œå¾·è¯­ Eszet å­—ç¬¦ â€œÃŸâ€ æ€»æ˜¯å±•å¼€æˆ â€œssâ€ã€‚ç±»ä¼¼åœ°ï¼Œâ€œÃ†â€ è¿å­—æ€»æ˜¯å±•å¼€æˆ â€œAEâ€ã€‚æ‰€ä»¥åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæ— è®ºä¼ é€’ä»€ä¹ˆè¯­è¨€æ–‡åŒ–ï¼Œå¯¹ <code>Compare</code> çš„ç¬¬äºŒä¸ªè°ƒç”¨å§‹ç»ˆè¿”å› 0ã€‚</p><blockquote><p>In some rare circumstances, you may need to have even more control when comparing strings for equality or for sorting. This could be necessary when comparing strings consisting of Japanese characters. This additional control can be accessed via the CultureInfo objectâ€™s CompareInfo property. As mentioned earlier, a CompareInfo object encapsulates a cultureâ€™s character comparison tables, and there is just one CompareInfo object per culture.</p></blockquote><blockquote><p>When you call Stringâ€™s Compare method, if the caller specifies a culture, the specified culture is used, or if no culture is specified, the value in the calling threadâ€™s CurrentCulture property is used. Internally, the Compare method obtains the reference to the CompareInfo object for the appropriate culture and calls the Compare method of the CompareInfo object, passing along the appropriate options (such as case insensitivity). Naturally, you could call the Compare method of a specific CompareInfo object yourself if you need the additional control.</p></blockquote><blockquote><p>The Compare method of the CompareInfo type takes as a parameter a value from the CompareOptions enumerated type (as shown earlier). You can OR these bit flags together to gain significantly greater control when performing string comparisons. For a complete description of these symbols, consult the .NET Framework documentation.</p></blockquote><blockquote><p>The following code demonstrates how important culture is to sorting strings and shows various ways of performing string comparisons.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Globalization</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token class-name">String</span> output <span class="token operator">=</span> String<span class="token punctuation">.</span>Empty<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> symbol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">&#123;</span> <span class="token string">"&lt;"</span><span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">,</span> <span class="token string">">"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token class-name">Int32</span> x<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token class-name">CultureInfo</span> ci<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token comment">// The code below demonstrates how strings compare </span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token comment">// differently for different cultures. </span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"cotÃ©"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"cÃ´te"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token comment">// Sorting strings for French in France. </span></pre></td></tr><tr><td data-num="17"></td><td><pre> ci <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CultureInfo</span><span class="token punctuation">(</span><span class="token string">"fr-FR"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>ci<span class="token punctuation">.</span>CompareInfo<span class="token punctuation">.</span><span class="token function">Compare</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre> output <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"&#123;0&#125; Compare: &#123;1&#125; &#123;3&#125; &#123;2&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="20"></td><td><pre> ci<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> symbol<span class="token punctuation">[</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="21"></td><td><pre> output <span class="token operator">+=</span> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token comment">// Sorting strings for Japanese in Japan. </span></pre></td></tr><tr><td data-num="23"></td><td><pre> ci <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CultureInfo</span><span class="token punctuation">(</span><span class="token string">"ja-JP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="24"></td><td><pre> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>ci<span class="token punctuation">.</span>CompareInfo<span class="token punctuation">.</span><span class="token function">Compare</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="25"></td><td><pre> output <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"&#123;0&#125; Compare: &#123;1&#125; &#123;3&#125; &#123;2&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="26"></td><td><pre> ci<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> symbol<span class="token punctuation">[</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="27"></td><td><pre> output <span class="token operator">+=</span> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token comment">// Sorting strings for the thread's culture </span></pre></td></tr><tr><td data-num="29"></td><td><pre> ci <span class="token operator">=</span> Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>CurrentCulture<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="30"></td><td><pre> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>ci<span class="token punctuation">.</span>CompareInfo<span class="token punctuation">.</span><span class="token function">Compare</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="31"></td><td><pre> output <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"&#123;0&#125; Compare: &#123;1&#125; &#123;3&#125; &#123;2&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="32"></td><td><pre> ci<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> symbol<span class="token punctuation">[</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="33"></td><td><pre> output <span class="token operator">+=</span> Environment<span class="token punctuation">.</span>NewLine <span class="token operator">+</span> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="34"></td><td><pre> <span class="token comment">// The code below demonstrates how to use CompareInfo.Compare's </span></pre></td></tr><tr><td data-num="35"></td><td><pre> <span class="token comment">// advanced options with 2 Japanese strings. One string represents </span></pre></td></tr><tr><td data-num="36"></td><td><pre> <span class="token comment">// the word "shinkansen" (the name for the Japanese high-speed </span></pre></td></tr><tr><td data-num="37"></td><td><pre> <span class="token comment">// train) in hiragana (one subtype of Japanese writing), and the </span></pre></td></tr><tr><td data-num="38"></td><td><pre> <span class="token comment">// other represents the same word in katakana (another subtype of </span></pre></td></tr><tr><td data-num="39"></td><td><pre> <span class="token comment">// Japanese writing). </span></pre></td></tr><tr><td data-num="40"></td><td><pre> s1 <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token comment">// ("\u3057\u3093\u304B\u3093\u305b\u3093")</span></pre></td></tr><tr><td data-num="41"></td><td><pre> s2 <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token comment">// ("\u30b7\u30f3\u30ab\u30f3\u30bb\u30f3")</span></pre></td></tr><tr><td data-num="42"></td><td><pre> <span class="token comment">// Here is the result of a default comparison </span></pre></td></tr><tr><td data-num="43"></td><td><pre> ci <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CultureInfo</span><span class="token punctuation">(</span><span class="token string">"ja-JP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="44"></td><td><pre> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">Compare</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> ci<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="45"></td><td><pre> output <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"Simple &#123;0&#125; Compare: &#123;1&#125; &#123;3&#125; &#123;2&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="46"></td><td><pre> ci<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> symbol<span class="token punctuation">[</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="47"></td><td><pre> output <span class="token operator">+=</span> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="48"></td><td><pre> <span class="token comment">// Here is the result of a comparison that ignores </span></pre></td></tr><tr><td data-num="49"></td><td><pre> <span class="token comment">// kana type (a type of Japanese writing) </span></pre></td></tr><tr><td data-num="50"></td><td><pre> <span class="token class-name">CompareInfo</span> compareInfo <span class="token operator">=</span> CompareInfo<span class="token punctuation">.</span><span class="token function">GetCompareInfo</span><span class="token punctuation">(</span><span class="token string">"ja-JP"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="51"></td><td><pre> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>compareInfo<span class="token punctuation">.</span><span class="token function">Compare</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> CompareOptions<span class="token punctuation">.</span>IgnoreKanaType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="52"></td><td><pre> output <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"Advanced &#123;0&#125; Compare: &#123;1&#125; &#123;3&#125; &#123;2&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="53"></td><td><pre> ci<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> symbol<span class="token punctuation">[</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="54"></td><td><pre> MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token string">"Comparing Strings For Sorting"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="55"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>ğŸ’¡æ³¨æ„ï¼šæºä»£ç ä¸è¦ç”¨ ANSI æ ¼å¼ä¿å­˜ï¼Œå¦åˆ™æ—¥è¯­å­—ç¬¦ä¼šä¸¢å¤±ã€‚è¦åœ¨ Microsoft Visual Studio ä¸­ä¿å­˜è¿™ä¸ªæ–‡ä»¶ï¼Œè¯·æ‰“å¼€ â€œå¦å­˜æ–‡ä»¶ä¸ºâ€ å¯¹è¯æ¡†ï¼Œå•å‡» â€œä¿å­˜â€ æŒ‰é’®å³ä¾§çš„ä¸‹ç®­å¤´ï¼Œé€‰æ‹© â€œç¼–ç ä¿å­˜â€ï¼Œå¹¶é€‰æ‹© â€œUnicode (UTF-8 å¸¦ç­¾å)- ä»£ç é¡µ 65001â€ã€‚Microsoft C# ç¼–è¯‘å™¨ç”¨è¿™ä¸ªä»£ç ä¹Ÿå°±èƒ½æˆåŠŸè§£ææºä»£ç æ–‡ä»¶äº†ã€‚</p><blockquote><p>Building and running this code produces the output shown in Figure 14-1.</p></blockquote><p><img data-src="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/image-20221107174021156-1668742125901-2.png" alt="image-20221107174021156"></p><p><strong>FIGURE 14-1</strong> String sorting results.</p><blockquote><p>In addition to Compare, the CompareInfo class offers the IndexOf, LastIndexOf, IsPrefix, and IsSuffix methods. Because all of these methods offer overloads that take a CompareOptions enumeration value as a parameter, they give you more control than the Compare, IndexOf, LastIndexOf, StartsWith, and EndsWith methods defined by the String class. Also, you should be aware that the FCL includes a System.StringComparer class that you can also use for performing string comparisons. This class is useful when you want to perform the same kind of comparison repeatedly for many different strings.</p></blockquote><h3 id="string-interning"><a class="anchor" href="#string-interning">#</a> String Interning</h3><blockquote><p>As I said in the preceding section, checking strings for equality is a common operation for many applicationsâ€”this task can hurt performance significantly. When performing an ordinal equality check, the CLR quickly tests to see if both strings have the same number of characters. If they donâ€™t, the strings are definitely not equal; if they do, the strings might be equal, and the CLR must then compare each individual character to determine for sure. When performing a culturally aware comparison, the CLR must always compare all of the individual characters because strings of different lengths might be considered equal.</p></blockquote><blockquote><p>In addition, if you have several instances of the same string duplicated in memory, youâ€™re wasting memory because strings are immutable. Youâ€™ll use memory much more efficiently if there is just one instance of the string in memory and all variables needing to refer to the string can just point to the single string object.</p></blockquote><blockquote><p>If your application frequently compares strings for equality by using case-sensitive, ordinal comparisons, or if you expect to have many string objects with the same value, you can enhance performance substantially if you take advantage of the string interning mechanism in the CLR. When the CLR initializes, it creates an internal hash table in which the keys are strings and the values are references to String objects in the managed heap. Initially, the table is empty (of course). The String class offers two methods that allow you to access this internal hash table.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">String</span> <span class="token function">Intern</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">String</span> <span class="token function">IsInterned</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>The first method, Intern, takes a String, obtains a hash code for it, and checks the internal hash table for a match. If an identical string already exists, a reference to the already existing String object is returned. If an identical string doesnâ€™t exist, a copy of the string is made, the copy is added to the internal hash table, and a reference to this copy is returned. If the application no longer holds a reference to the original String object, the garbage collector is able to free the memory of that string. Note that the garbage collector canâ€™t free the strings that the internal hash table refers to because the hash table holds the reference to those String objects. String objects referred to by the internal hash table canâ€™t be freed until the AppDomain is unloaded or the process terminates.</p></blockquote><blockquote><p>As does the Intern method, the IsInterned method takes a String and looks it up in the internal hash table. If a matching string is in the hash table, IsInterned returns a reference to the interned string object. If a matching string isnâ€™t in the hash table, however, IsInterned returns null; it doesnâ€™t add the string to the hash table.</p></blockquote><blockquote><p>By default, when an assembly is loaded, the CLR interns all of the literal strings described in the assemblyâ€™s metadata. Microsoft learned that this hurts performance significantly due to the additional hash table lookups, so it is now possible to turn this â€œfeatureâ€ off. If an assembly is marked with a System.Runtime.CompilerServices.CompilationRelaxationsAttribute specifying the System.Runtime.CompilerServices.CompilationRelaxations.NoStringInterning flag value, the CLR may, according to the ECMA specification, choose not to intern all of the strings defined in that assemblyâ€™s metadata. Note that, in an attempt to improve your applicationâ€™s performance, the C# compiler always specifies this attribute/flag whenever you compile an assembly.</p></blockquote><blockquote><p>Even if an assembly has this attribute/flag specified, the CLR may choose to intern the strings, but you should not count on this. In fact, you really should never write code that relies on strings being interned unless you have written code that explicitly calls the Stringâ€™s Intern method yourself.</p></blockquote><blockquote><p>The following code demonstrates string interning.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">String</span> s1 <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">String</span> s2 <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">ReferenceEquals</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Should be 'False' </span></pre></td></tr><tr><td data-num="4"></td><td><pre>s1 <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">Intern</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre>s2 <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">Intern</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">ReferenceEquals</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'True'</span></pre></td></tr></table></figure><blockquote><p>In the first call to the ReferenceEquals method, s1 refers to a &quot;Hello&quot; string object in the heap, and s2 refers to a different &quot;Hello&quot; string object in the heap. Because the references are different, False should be displayed. However, if you run this on version 4.5 of the CLR, youâ€™ll see that True is displayed. The reason is because this version of the CLR chooses to ignore the attribute/flag emitted by the C# compiler, and the CLR interns the literal &quot;Hello&quot; string when the assembly is loaded into the AppDomain. This means that s1 and s2 refer to the single &quot;Hello&quot; string in the heap. However, as mentioned previously, you should never write code that relies on this behavior because a future version of the CLR might honor the attribute/flag and not intern the &quot;Hello&quot; string. In fact, version 4.5 of the CLR does honor the attribute/flag when this assemblyâ€™s code has been compiled using the NGen.exe utility.</p></blockquote><blockquote><p>Before the second call to the ReferenceEquals method, the &quot;Hello&quot; string has been explicitly interned, and s1 now refers to an interned &quot;Hello&quot;. Then by calling Intern again, s2 is set to refer to the same &quot;Hello&quot; string as s1. Now, when ReferenceEquals is called the second time, we are guaranteed to get a result of True regardless of whether the assembly was compiled with the attribute/flag.</p></blockquote><blockquote><p>So now, letâ€™s look at an example to see how you can use string interning to improve performance and reduce memory usage. The NumTimesWordAppearsEquals method below takes two arguments: a word and an array of strings in which each array element refers to a single word. This method then determines how many times the specified word appears in the wordlist and returns this count.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">NumTimesWordAppearsEquals</span><span class="token punctuation">(</span><span class="token class-name">String</span> word<span class="token punctuation">,</span> <span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> wordlist<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token class-name">Int32</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> wordnum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> wordnum <span class="token operator">&lt;</span> wordlist<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> wordnum<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>word<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>wordlist<span class="token punctuation">[</span>wordnum<span class="token punctuation">]</span><span class="token punctuation">,</span> StringComparison<span class="token punctuation">.</span>Ordinal<span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> count<span class="token operator">++</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token keyword">return</span> count<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>As you can see, this method calls Stringâ€™s Equals method, which internally compares the stringsâ€™ individual characters and checks to ensure that all characters match. This comparison can be slow. In addition, the wordlist array might have multiple entries that refer to multiple String objects containing the same set of characters. This means that multiple identical strings might exist in the heap and are surviving ongoing garbage collections.</p></blockquote><blockquote><p>Now, letâ€™s look at a version of this method that was written to take advantage of string interning.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">NumTimesWordAppearsIntern</span><span class="token punctuation">(</span><span class="token class-name">String</span> word<span class="token punctuation">,</span> <span class="token class-name">String<span class="token punctuation">[</span><span class="token punctuation">]</span></span> wordlist<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token comment">// This method assumes that all entries in wordlist refer to interned strings. </span></pre></td></tr><tr><td data-num="3"></td><td><pre> word <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">Intern</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token class-name">Int32</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> wordnum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> wordnum <span class="token operator">&lt;</span> wordlist<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> wordnum<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">ReferenceEquals</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> wordlist<span class="token punctuation">[</span>wordnum<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> count<span class="token operator">++</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token keyword">return</span> count<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>This method interns the word and assumes that the wordlist contains references to interned strings. First, this version might be saving memory if a word appears in the wordlist multiple times because, in this version, wordlist would now contain multiple references to the same single String object in the heap. Second, this version will be faster because determining if the specified word is in the array is simply a matter of comparing pointers.</p></blockquote><blockquote><p>Although the NumTimesWordAppearsIntern method is faster than the NumTimesWordAppearsEquals method, the overall performance of the application might be slower when using the NumTimesWordAppearsIntern method because of the time it takes to intern all of the strings when they were added to the wordlist array (code not shown). The NumTimesWordAppearsIntern method will really show its performance and memory improvement if the application needs to call the method multiple times using the same wordlist. The point of this discussion is to make it clear that string interning is useful, but it should be used with care and caution. In fact, this is why the C# compiler indicates that it doesnâ€™t want string interning to be enabled.</p></blockquote><h3 id="string-pooling"><a class="anchor" href="#string-pooling">#</a> String Pooling</h3><blockquote><p>When compiling source code, your compiler must process each literal string and emit the string into the managed moduleâ€™s metadata. If the same literal string appears several times in your source code, emitting all of these strings into the metadata will bloat the size of the resulting file.</p></blockquote><blockquote><p>To remove this bloat, many compilers (including the C# compiler) write the literal string into the moduleâ€™s metadata only once. All code that references the string will be modified to refer to the one string in the metadata. This ability of a compiler to merge multiple occurrences of a single string into a single instance can reduce the size of a module substantially. This process is nothing newâ€”C/C++ compilers have been doing it for years. (Microsoftâ€™s C/C++ compiler calls this string pooling.) Even so, string pooling is another way to improve the performance of strings and just one more piece of knowledge that you should have in your repertoire.</p></blockquote><h3 id="examining-a-strings-characters-and-text-elements"><a class="anchor" href="#examining-a-strings-characters-and-text-elements">#</a> Examining a Stringâ€™s Characters and Text Elements</h3><blockquote><p>Although comparing strings is useful for sorting them or for detecting equality, sometimes you need just to examine the characters within a string. The String type offers several properties and methods to help you do this, including Length, Chars (an indexer in C#), GetEnumerator, ToCharArray, Contains, IndexOf, LastIndexOf, IndexOfAny, and LastIndexOfAny.</p></blockquote><blockquote><p>In reality, a System.Char represents a single 16-bit Unicode code value that doesnâ€™t necessarily equate to an abstract Unicode character. For example, some abstract Unicode characters are a combination of two code values. When combined, the U+0625 (the Arabic letter Alef with Hamza below) and U+0650 (the Arabic Kasra) characters form a single abstract character or text element.</p></blockquote><blockquote><p>In addition, some Unicode text elements require more than a 16-bit value to represent them. These text elements are represented using two 16-bit code values. The first code value is called the high surrogate, and the second code value is called the low surrogate. High surrogates have a value between U+D800 and U+DBFF, and low surrogates have a value between U+DC00 and U+DFFF. The use of surrogates allows Unicode to express more than a million different characters.</p></blockquote><blockquote><p>Surrogates are rarely used in the United States and Europe but are more commonly used in East Asia. To properly work with text elements, you should use the System.Globalization.StringInfo type. The easiest way to use this type is to construct an instance of it, passing its constructor a string. Then you can see how many text elements are in the string by querying the StringInfoâ€™s LengthInTextElements property. You can then call StringInfoâ€™s SubstringByTextElements method to extract the text element or the number of consecutive text elements that you desire.</p></blockquote><blockquote><p>In addition, the StringInfo class offers a static GetTextElementEnumerator method, which acquires a System.Globalization.TextElementEnumerator object that allows you to enumerate through all of the abstract Unicode characters contained in the string. Finally, you could call StringInfoâ€™s static ParseCombiningCharacters method to obtain an array of Int32 values. The length of the array indicates how many text elements are contained in the string. Each element of the array identifies an index into the string where the first code value for a new text element can be found.</p></blockquote><blockquote><p>The following code demonstrates the various ways of using the StringInfo class to manipulate a stringâ€™s text elements.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Globalization</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows<span class="token punctuation">.</span>Forms</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token comment">// The string below contains combining characters </span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"a\u0304\u0308bc\u0327"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token function">SubstringByTextElements</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token function">EnumTextElements</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token function">EnumTextElementIndexes</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SubstringByTextElements</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token class-name">String</span> output <span class="token operator">=</span> String<span class="token punctuation">.</span>Empty<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token class-name">StringInfo</span> si <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringInfo</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> element <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> element <span class="token operator">&lt;</span> si<span class="token punctuation">.</span>LengthInTextElements<span class="token punctuation">;</span> element<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> output <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token string">"Text element &#123;0&#125; is '&#123;1&#125;'&#123;2&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="19"></td><td><pre> element<span class="token punctuation">,</span> si<span class="token punctuation">.</span><span class="token function">SubstringByTextElements</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="20"></td><td><pre> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="22"></td><td><pre> MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token string">"Result of SubstringByTextElements"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EnumTextElements</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token class-name">String</span> output <span class="token operator">=</span> String<span class="token punctuation">.</span>Empty<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token class-name">TextElementEnumerator</span> charEnum <span class="token operator">=</span> </pre></td></tr><tr><td data-num="27"></td><td><pre> StringInfo<span class="token punctuation">.</span><span class="token function">GetTextElementEnumerator</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token keyword">while</span> <span class="token punctuation">(</span>charEnum<span class="token punctuation">.</span><span class="token function">MoveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="29"></td><td><pre> output <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span> </pre></td></tr><tr><td data-num="30"></td><td><pre> <span class="token string">"Character at index &#123;0&#125; is '&#123;1&#125;'&#123;2&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="31"></td><td><pre> charEnum<span class="token punctuation">.</span>ElementIndex<span class="token punctuation">,</span> charEnum<span class="token punctuation">.</span><span class="token function">GetTextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="32"></td><td><pre> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="33"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="34"></td><td><pre> MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token string">"Result of GetTextElementEnumerator"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="35"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="36"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">EnumTextElementIndexes</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="37"></td><td><pre> <span class="token class-name">String</span> output <span class="token operator">=</span> String<span class="token punctuation">.</span>Empty<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="38"></td><td><pre> <span class="token class-name">Int32<span class="token punctuation">[</span><span class="token punctuation">]</span></span> textElemIndex <span class="token operator">=</span> StringInfo<span class="token punctuation">.</span><span class="token function">ParseCombiningCharacters</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="39"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> textElemIndex<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="40"></td><td><pre> output <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span> </pre></td></tr><tr><td data-num="41"></td><td><pre> <span class="token string">"Character &#123;0&#125; starts at index &#123;1&#125;&#123;2&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="42"></td><td><pre> i<span class="token punctuation">,</span> textElemIndex<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="43"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="44"></td><td><pre> MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token string">"Result of ParseCombiningCharacters"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="45"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Building and running this code produces the message boxes shown in Figures 14-2, 14-3, and 14-4.</p></blockquote><p><img data-src="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/image-20221107174516896-1668742125901-1.png" alt="image-20221107174516896"></p><p><strong>FIGURE 14-2</strong> Result of <code>SubstringByTextElements</code> .</p><p><img data-src="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/image-20221107174527366-1668742125901-4.png" alt="image-20221107174527366"></p><p><strong>FIGURE 14-3</strong> Result of <code>GetTextElementEnumerator</code> .</p><p><img data-src="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/image-20221107174540551-1668742125901-3.png" alt="image-20221107174540551"></p><p><strong>FIGURE 14-4</strong> Result of <code>ParseCombiningCharacters</code> .</p><h3 id="other-string-operations"><a class="anchor" href="#other-string-operations">#</a> Other String Operations</h3><blockquote><p>The String type also offers methods that allow you to copy a string or parts of it. Table 14-1 summarizes these methods.</p></blockquote><p><img data-src="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/image-20221107174709067-1668742125901-5.png" alt="image-20221107174709067"></p><blockquote><p>In addition to these methods, String offers many static and instance methods that manipulate a string, such as Insert, Remove, PadLeft, Replace, Split, Join, ToLower, ToUpper, Trim, Concat, Format, and so on. Again, the important thing to remember about all of these methods is that they return new string objects; because strings are immutable, after theyâ€™re created, they canâ€™t be modified (using safe code).</p></blockquote><p>ğŸ’¡å°ç»“ï¼šä¸€ä¸ª String ä»£è¡¨ä¸€ä¸ªä¸å¯å˜ï¼ˆimmutableï¼‰çš„é¡ºåºå­—ç¬¦é›†ã€‚String ç±»å‹ç›´æ¥æ´¾ç”Ÿè‡ª Objectï¼Œæ‰€ä»¥æ˜¯å¼•ç”¨ç±»å‹ã€‚å› æ­¤ï¼ŒString å¯¹è±¡ï¼ˆå®ƒçš„å­—ç¬¦æ•°ç»„ï¼‰æ€»æ˜¯å­˜åœ¨äºå †ä¸Šï¼Œæ°¸è¿œä¸ä¼šè·‘åˆ°çº¿ç¨‹æ ˆã€‚è®¸å¤šç¼–ç¨‹è¯­è¨€ï¼ˆåŒ…æ‹¬ C#ï¼‰éƒ½å°† String è§†ä¸ºåŸºå…ƒç±»å‹ â€”â€” ä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨å…è®¸åœ¨æºä»£ç ä¸­ç›´æ¥ä½¿ç”¨å­—é¢å€¼ï¼ˆliteralï¼‰å­—ç¬¦ä¸²ã€‚C# ä¸å…è®¸ä½¿ç”¨ new æ“ä½œç¬¦ä»å­—é¢å€¼æ„é€  String å¯¹è±¡ï¼ˆåœ¨ <code>cmd</code> ç”¨ <code>csc.exe</code> ç¼–è¯‘ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ç”¨ VS å‘ç°å¯ä»¥ï¼Œå¯èƒ½æ˜¯è¢«ä¼˜åŒ–äº†ï¼‰ï¼Œè§‚å¯Ÿ IL ä»£ç ä¹Ÿçœ‹ä¸åˆ° <code>newobj</code> æŒ‡ä»¤ï¼Œåªæœ‰ä¸€ä¸ªç‰¹æ®Š <code>ldstr</code> ï¼ˆå³ load stringï¼‰æŒ‡ä»¤ï¼Œå®ƒä½¿ç”¨ä»å…ƒæ•°æ®è·å¾—çš„å­—é¢å€¼ï¼ˆliteralï¼‰å­—ç¬¦ä¸²æ„é€  String å¯¹è±¡ã€‚è¿™è¯æ˜ CLR å®é™…æ˜¯ç”¨ä¸€ç§ç‰¹æ®Šæ–¹å¼æ„é€ å­—é¢å€¼ String å¯¹è±¡ã€‚å¦‚æœä½¿ç”¨ä¸å®‰å…¨çš„ï¼ˆunsafeï¼‰ä»£ç ï¼Œå¯ä»¥ä»ä¸€ä¸ª <code>Char*</code> æˆ– <code>SByte*</code> æ„é€  String å¯¹è±¡ï¼Œè¿™æ—¶å°±å¯ä»¥ç”¨ new æ“ä½œç¬¦è°ƒç”¨ç”± String ç±»å‹æä¾›çš„ã€èƒ½æ¥å— <code>Char*</code> æˆ– <code>Sbyte*</code> å‚æ•°çš„æŸä¸ªæ„é€ å™¨ã€‚è®°ä½ï¼Œé™¤éæŒ‡å®šäº† /unsafe ç¼–è¯‘å™¨å¼€å…³ï¼Œå¦åˆ™ C# ä»£ç å¿…é¡»æ˜¯å®‰å…¨çš„æˆ–è€…è¯´å…·æœ‰å¯éªŒè¯æ€§ï¼Œç¡®ä¿ä»£ç ä¸ä¼šå¼•èµ·å®‰å…¨é£é™©å’Œç¨³å®šæ€§é£é™©ã€‚å…¶ä»–æ„é€ å™¨åˆ™ä¸å…è®¸æ¥å—ä»»ä½•æŒ‡é’ˆå‚æ•°ï¼Œç”¨ä»»ä½•æ‰˜ç®¡ç¼–ç¨‹è¯­è¨€å†™çš„å®‰å…¨ï¼ˆå¯éªŒè¯ï¼‰ä»£ç éƒ½èƒ½è°ƒç”¨å®ƒä»¬ã€‚å¦‚æœæ‰€æœ‰å­—ç¬¦ä¸²éƒ½æ˜¯å­—é¢å€¼ï¼Œä½¿ç”¨ + æ“ä½œç¬¦ C# ç¼–è¯‘å™¨èƒ½åœ¨ç¼–è¯‘æ—¶è¿æ¥å®ƒä»¬ï¼Œæœ€ç»ˆåªå°†å­—ç¬¦ä¸²æ”¾åˆ°æ¨¡å—çš„å…ƒæ•°æ®ä¸­ã€‚å¯¹éå­—é¢å€¼å­—ç¬¦ä¸²ä½¿ç”¨ + æ“ä½œç¬¦ï¼Œè¿æ¥åˆ™åœ¨è¿è¡Œæ—¶è¿›è¡Œã€‚è¿è¡Œæ—¶è¿æ¥ä¸è¦ä½¿ç”¨ + æ“ä½œç¬¦ï¼Œå› ä¸ºè¿™æ ·ä¼šåœ¨å †ä¸Šåˆ›å»ºå¤šä¸ªå­—ç¬¦ä¸²å¯¹è±¡ï¼Œè€Œå †æ˜¯éœ€è¦åƒåœ¾å›æ”¶çš„ï¼Œå¯¹æ€§èƒ½ç”±å½±å“ã€‚ç›¸åï¼Œåº”è¯¥ä½¿ç”¨ <code>System.Text.StringBuilder</code> ç±»å‹ã€‚åœ¨å­—ç¬¦ä¸²ä¹‹å‰æ·»åŠ  @ç¬¦å·ä½¿ç¼–è¯‘å™¨çŸ¥é“è¿™æ˜¯é€å­—å­—ç¬¦ä¸²ã€‚ç¼–è¯‘å™¨ä¼šå°†åæ–œæ å­—ç¬¦è§†ä¸ºå­—é¢å€¼ï¼ˆliteralï¼‰è€Œéè½¬ä¹‰ç¬¦ï¼Œä½¿æ–‡ä»¶è·¯å¾„åœ¨æºä»£ç ä¸­æ›´æ˜“è¯»ã€‚å­—ç¬¦ä¸²ä¸å¯å˜æ„å‘³ç€æ–¹æ³•é€šå¸¸ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œè¿™è¿˜æ„å‘³ç€åœ¨æ“çºµæˆ–è®¿é—®å­—ç¬¦ä¸²æ—¶ä¸ä¼šå‘ç”Ÿçº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚æ­¤å¤–ï¼ŒCLR å¯é€šè¿‡ä¸€ä¸ª String å¯¹è±¡å…±äº«å¤šä¸ªå®Œå…¨ä¸€è‡´çš„ String å†…å®¹ã€‚è¿™æ ·èƒ½å‡å°‘ç³»ç»Ÿä¸­çš„å­—ç¬¦ä¸²æ•°é‡ â€”â€” ä»è€ŒèŠ‚çœå†…å­˜ â€”â€” è¿™å°±æ˜¯æ‰€è°“çš„ â€œå­—ç¬¦ä¸²ç•™ç”¨ â€œï¼ˆstring interningï¼‰ã€‚å¤„äºå¯¹æ€§èƒ½çš„è€ƒè™‘ï¼ŒString ç±»å‹ä¸ CLR ç´§å¯†é›†æˆã€‚å…·ä½“åœ°è¯´ï¼ŒCLR çŸ¥é“ String ç±»å‹ä¸­å®šä¹‰çš„å­—æ®µå¦‚ä½•å¸ƒå±€ï¼Œä¼šç›´æ¥è®¿é—®è¿™äº›å­—æ®µã€‚ä½†ä¸ºäº†è·å¾—è¿™ç§æ€§èƒ½å’Œç›´æ¥è®¿é—®çš„å¥½å¤„ï¼ŒString åªèƒ½æ˜¯å¯†å°ç±»ã€‚å¦‚æœå…è®¸ String ä½œä¸ºåŸºç±»æ¥å®šä¹‰è‡ªå·±çš„ç±»å‹ï¼Œå°±èƒ½æ·»åŠ è‡ªå·±çš„å­—æ®µï¼Œä»è€Œç ´å CLR å¯¹äº String ç±»å‹çš„å„ç§é¢„è®¾ã€‚æ­¤å¤–ï¼Œè¿˜å¯èƒ½ç ´å CLR å›¢é˜Ÿå› ä¸º String å¯¹è±¡ â€œä¸å¯å˜â€ è€Œåšå‡ºçš„å„ç§é¢„è®¾ã€‚å­—ç¬¦ä¸²æ’åºæ—¶åº”è¯¥æ€»æ˜¯æ‰§è¡ŒåŒºåˆ†å¤§å°å†™çš„æ¯”è¾ƒã€‚åŸå› æ˜¯å‡å¦‚åªæ˜¯å¤§å°å†™ä¸åŒçš„ä¸¤ä¸ªå­—ç¬¦ä¸²è¢«è§†ä¸ºç›¸ç­‰ï¼Œé‚£ä¹ˆæ¯æ¬¡æ’åºéƒ½å¯èƒ½æŒ‰ä¸åŒé¡ºåºæ’åºï¼Œç”¨æˆ·ä¼šæ„Ÿåˆ°è¿·æƒ‘ã€‚å¤„äºç¼–ç¨‹ç›®çš„è€Œæ¯”è¾ƒå­—ç¬¦ä¸²æ—¶ï¼Œåº”è¯¥æ€»æ˜¯ä½¿ç”¨ <code>StringComparison.Ordinal</code> æˆ–è€… <code>StringComparison.OrdinalIgnoreCase</code> ï¼ˆåºå·æ¯”è¾ƒï¼Œå€¼æ¯”è¾ƒå­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ª Char å€¼çš„ Unicode ç ä½ï¼‰ã€‚å¿½ç•¥è¯­è¨€æ–‡åŒ–æ˜¯å­—ç¬¦ä¸²æ¯”è¾ƒæœ€å¿«çš„æ–¹å¼ã€‚å¦ä¸€æ–¹é¢ï¼Œè¦ä»¥è¯­è¨€æ–‡åŒ–æ­£ç¡®çš„æ–¹å¼æ¥æ¯”è¾ƒå­—ç¬¦ä¸²ï¼ˆé€šå¸¸ä¸ºäº†å‘ç”¨æˆ·æ˜¾ç¤ºï¼‰ï¼Œå°±åº”è¯¥ä½¿ç”¨ <code>StringComarison.CurrentCulture</code> æˆ–è€… <code>StringComparison.CurrentCultureIgnoreCase</code> ã€‚åœ¨ CLR ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å…³è”äº†ä¸¤ä¸ªç‰¹æ®Šå±æ€§ï¼Œæ¯ä¸ªå±æ€§éƒ½å¼•ç”¨ä¸€ä¸ª <code>CultureInfo</code> å¯¹è±¡ã€‚è¿™ä¸¤ä¸ªå±æ€§åˆ†åˆ«æ˜¯ <code>CurrentUICulture</code> å’Œ <code>CurrentCulture</code> ã€‚åœ¨è®¸å¤šè®¡ç®—æœºä¸Šï¼Œçº¿ç¨‹çš„ <code>CurrentUICulture</code> å’Œ <code>CurrentCulture</code> å±æ€§éƒ½è¢«è®¾ä¸ºåŒä¸€ä¸ª <code>CultureInfo</code> å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬ä½¿ç”¨ç›¸åŒçš„è¯­è¨€ / å›½å®¶ä¿¡æ¯ã€‚ä½†ä¹Ÿå¯ä»¥æŠŠå®ƒä»¬è®¾ä¸ºä¸åŒå¯¹è±¡ã€‚æ¯”è¾ƒå­—ç¬¦ä¸²ä»¥åˆ¤æ–­ç›¸ç­‰æ€§æˆ–æ‰§è¡Œæ’åºæ—¶ï¼Œå¶å°”éœ€è¦æ›´å¤šçš„æ§åˆ¶ã€‚é¢å¤–çš„æ§åˆ¶é€šè¿‡ <code>CultureInfo</code> å¯¹è±¡çš„ <code>CompareInfo</code> å±æ€§è·å¾—ã€‚ <code>CompareInfo</code> å¯¹è±¡å°è£…äº†ä¸€ç§è¯­è¨€æ–‡åŒ–çš„å­—ç¬¦æ¯”è¾ƒè¡¨ï¼Œæ¯ç§è¯­è¨€æ–‡åŒ–åªæœ‰ä¸€ä¸ª <code>CompareInfo</code> å¯¹è±¡ã€‚æ‰§è¡Œåºå·ï¼ˆordinalï¼‰ç›¸ç­‰æ€§æ£€æŸ¥æ—¶ï¼ŒCLR å¿«é€Ÿæµ‹è¯•ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦åŒ…å«ç›¸åŒæ•°é‡çš„å­—ç¬¦ã€‚ç­”æ¡ˆå¦å®šï¼Œå­—ç¬¦ä¸²è‚¯å®šä¸ç›¸ç­‰ï¼›ç­”æ¡ˆè‚¯å®šï¼Œå­—ç¬¦ä¸²åˆ™å¯èƒ½ç›¸ç­‰ã€‚ç„¶åï¼ŒCLR å¿…é¡»æ¯”è¾ƒæ¯ä¸ªå•ç‹¬çš„å­—ç¬¦æ‰èƒ½æœ€ç»ˆç¡®è®¤ã€‚è€Œæ‰§è¡Œå¯¹è¯­è¨€æ–‡åŒ–æ•æ„Ÿçš„æ¯”è¾ƒæ—¶ï¼ŒCLR å¿…é¡»æ¯”è¾ƒæ‰€æœ‰å•ç‹¬çš„å­—ç¬¦ï¼Œå› ä¸ºä¸¤ä¸ªå­—ç¬¦ä¸²å³ä½¿é•¿åº¦ä¸åŒä¹Ÿå¯èƒ½ç›¸ç­‰ã€‚å¦‚æœåº”ç”¨ç¨‹åºç»å¸¸å¯¹å­—ç¬¦ä¸²è¿›è¡ŒåŒºåˆ†å¤§å°å†™çš„åºå·æ¯”è¾ƒï¼Œæˆ–è€…äº‹å…ˆçŸ¥é“è®¸å¤šå­—ç¬¦ä¸²å¯¹è±¡éƒ½æœ‰ç›¸åŒçš„å€¼ï¼Œå°±å¯åˆ©ç”¨ CLR çš„å­—ç¬¦ä¸²ç•™ç”¨ï¼ˆstring interningï¼‰æœºåˆ¶æ¥æ˜¾è‘—æå‡æ€§èƒ½ã€‚CLR åˆå§‹åŒ–æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå†…éƒ¨å“ˆå¸Œè¡¨ã€‚åœ¨è¿™ä¸ªè¡¨ä¸­ï¼Œé”®ï¼ˆkeyï¼‰æ—¶å­—ç¬¦ä¸²ï¼Œè€Œå€¼ï¼ˆvalueï¼‰æ˜¯å¯¹æ‰˜ç®¡å †ä¸­çš„ String å¯¹è±¡çš„å¼•ç”¨ã€‚å“ˆå¸Œè¡¨æœ€å¼€å§‹æ˜¯ç©ºçš„ï¼ˆç†åº”å¦‚æ­¤ï¼‰ã€‚String æä¾›äº†ä¸¤ä¸ªæ–¹æ³•è®¿é—®è¿™ä¸ªå†…éƒ¨å“ˆå¸Œè¡¨ã€‚ <code>String.Intern</code> è·å–ä¸€ä¸ª Stringï¼Œå¦‚æœä¸å­˜åœ¨å®Œå…¨ç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œå°±åˆ›å»ºå­—ç¬¦ä¸²çš„å‰¯æœ¬ï¼Œå°†å‰¯æœ¬æ·»åŠ åˆ°å†…éƒ¨å“ˆå¸Œè¡¨ä¸­ï¼Œè¿”å›å¯¹è¯¥å‰¯æœ¬çš„å¼•ç”¨ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸åœ¨ä¿æŒå¯¹åŸå§‹ String å¯¹è±¡çš„å¼•ç”¨ï¼Œåƒåœ¾å›æ”¶å™¨å°±å¯é‡Šæ”¾é‚£ä¸ªå­—ç¬¦ä¸²çš„å†…å­˜ã€‚æ³¨æ„åƒåœ¾å›æ”¶å™¨ä¸èƒ½é‡Šæ”¾å†…éƒ¨å“ˆå¸Œè¡¨å†…éƒ¨å“ˆå¸Œè¡¨å¼•ç”¨çš„å­—ç¬¦ä¸²ï¼Œå› ä¸ºå“ˆå¸Œè¡¨æ­£åœ¨å®¹çº³å¯¹å®ƒä»¬çš„å¼•ç”¨ã€‚é™¤éå¸è½½ <code>AppDomain</code> æˆ–è¿›ç¨‹ç»ˆæ­¢ï¼Œå¦åˆ™å†…éƒ¨å“ˆå¸Œè¡¨å¼•ç”¨çš„ String å¯¹è±¡ä¸èƒ½è¢«é‡Šæ”¾ã€‚ <code>String.IsInterned</code> ä¼šåœ¨ä¸å­˜åœ¨å­—ç¬¦ä¸²æ—¶è¿”å› nullï¼Œä¸ä¼šå°†å­—ç¬¦ä¸²æ·»åŠ åˆ°å“ˆå¸Œè¡¨ä¸­ã€‚ç¨‹åºé›†åŠ è½½æ—¶ï¼ŒCLR é»˜è®¤ç•™ç”¨ç¨‹åºé›†çš„å…ƒæ•°æ®ä¸­æè¿°çš„æ‰€æœ‰å­—é¢å€¼ï¼ˆliteralï¼‰å­—ç¬¦ä¸²ã€‚Microsoft çŸ¥é“å¯èƒ½å› ä¸ºé¢å¤–çš„å“ˆå¸Œè¡¨æŸ¥æ‰¾è€Œæ˜¾è‘—å½±å“æ€§èƒ½ï¼Œä¸ºäº†æå‡åº”ç”¨ç¨‹åºæ€§èƒ½ï¼ŒC# ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ç¨‹åºé›†æ—¶æ€»æ˜¯æŒ‡å®šç›¸åº”çš„ç‰¹æ€§å’Œæ ‡å¿—ä¸ç•™ç”¨å­—ç¬¦ä¸²ï¼Œä½†æˆ‘ä»¬ä¸èƒ½ä¾èµ– CLR çš„è¿™ä¸ªè¡Œä¸ºï¼Œå› ä¸ºæœ‰çš„ CLR ç‰ˆæœ¬ä¼šé€‰æ‹©å¿½è§† C# ç¼–è¯‘å™¨æ’å…¥çš„ç‰¹æ€§çš„æ ‡å¿—ã€‚åŒä¸€ä¸ªå­—ç¬¦ä¸²å¦‚æœåœ¨æºä»£ç ä¸­å¤šæ¬¡å‡ºç°ï¼ŒæŠŠå®ƒä»¬éƒ½åµŒå…¥å…ƒæ•°æ®ä¼šä½¿ç”Ÿæˆçš„æ–‡ä»¶æ— è°“åœ°å¢å¤§ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®¸å¤šç¼–è¯‘å™¨ï¼ˆåŒ…æ‹¬ C# ç¼–è¯‘å™¨ï¼‰åªåœ¨æ¨¡å—çš„å…ƒæ•°æ®ä¸­å°†å­—é¢å€¼å†™å…¥ä¸€æ¬¡ã€‚å¼•ç”¨è¯¥å­—ç¬¦ä¸²çš„æ‰€æœ‰ä»£ç éƒ½è¢«ä¿®æ”¹æˆå¼•ç”¨å…ƒæ•°æ®ä¸­çš„åŒä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ç¼–è¯‘å™¨å°†å•ä¸ªå­—ç¬¦ä¸²çš„å¤šä¸ªå®ä¾‹åˆå¹¶æˆä¸€ä¸ªå®ä¾‹ï¼Œèƒ½æ˜¾è‘—å‡å°‘æ¨¡å—çš„å¤§å°ã€‚ <code>System.Char</code> å®é™…ä»£è¡¨ä¸€ä¸ª 16 ä½ Unicode ç å€¼ï¼Œè€Œä¸”è¯¥å€¼ä¸ä¸€å®šå°±ç­‰äºä¸€ä¸ªæŠ½è±¡ Unicode å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œæœ‰çš„æŠ½è±¡ Unicode å­—ç¬¦æ˜¯ä¸¤ä¸ªç å€¼çš„ç»„åˆã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæœ‰çš„ Unicode æ–‡æœ¬å…ƒç´ è¦æ±‚ç”¨ä¸¤ä¸ª 16 ä½å€¼è¡¨ç¤ºã€‚ç¬¬ä¸€ä¸ªç§°ä¸º â€œé«˜ä½ä»£ç†é¡¹â€ï¼ˆhigh surrogateï¼‰ï¼Œç¬¬äºŒä¸ªç§°ä¸º â€œä½ä½ä»£ç†é¡¹â€ï¼ˆlow surrogateï¼‰ã€‚æœ‰äº†ä»£ç†é¡¹ï¼ŒUnicode å°±èƒ½è¡¨ç¤º 100 ä¸‡ä¸ªä»¥ä¸Šä¸åŒçš„å­—ç¬¦ã€‚ä¸ºäº†æ­£ç¡®å¤„ç†æ–‡æœ¬å…ƒç´ ï¼Œåº”å½“ä½¿ç”¨ <code>System.Globalization.StringInfo</code> ç±»å‹ã€‚è¿˜å¯åˆ©ç”¨ String ç±»å‹æä¾›çš„ä¸€äº›æ–¹æ³•æ¥å¤åˆ¶å­—ç¬¦ä¸²ã€‚é™¤äº†è¿™äº›æ–¹æ³•ï¼ŒString è¿˜æä¾›äº†å¤šä¸ªå¤„ç†å­—ç¬¦ä¸²çš„é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ã€‚ä½¿ç”¨è¿™äº›æ–¹æ³•æ—¶éƒ½è¯·ç‰¢è®°ä¸€ç‚¹ï¼Œå®ƒä»¬è¿”å›çš„éƒ½æ˜¯æ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚è¿™æ˜¯ç”±äºå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ã€‚ä¸€ç»åˆ›å»ºï¼Œä¾¿ä¸èƒ½ä¿®æ”¹ï¼ˆä½¿ç”¨å®‰å…¨ä»£ç çš„è¯ï¼‰ã€‚</p><h2 id="constructing-a-string-efficiently"><a class="anchor" href="#constructing-a-string-efficiently">#</a> Constructing a String Efficiently</h2><blockquote><p>Because the String type represents an immutable string, the FCL provides another type, System. Text.StringBuilder, which allows you to perform dynamic operations efficiently with strings and characters to create a String. Think of StringBuilder as a fancy constructor to create a String that can be used with the rest of the framework. In general, you should design methods that take String parameters, not StringBuilder parameters.</p></blockquote><blockquote><p>Logically, a StringBuilder object contains a field that refers to an array of Char structures. StringBuilderâ€™s members allow you to manipulate this character array, effectively shrinking the string or changing the characters in the string. If you grow the string past the allocated array of characters, the StringBuilder automatically allocates a new, larger array, copies the characters, and starts using the new array. The previous array is garbage collected.</p></blockquote><blockquote><p>When finished using the StringBuilder object to construct your string, â€œconvertâ€ the StringBuilderâ€™s character array into a String simply by calling the StringBuilderâ€™s ToString method. This creates a new String object in the heap that contains the string that was in the StringBuilder at the time you called ToString. At this point, you can continue to manipulate the string inside the StringBuilder, and later you can call ToString again to convert it into another String object.</p></blockquote><h3 id="constructing-a-stringbuilder-object"><a class="anchor" href="#constructing-a-stringbuilder-object">#</a> Constructing a StringBuilder Object</h3><blockquote><p>Unlike with the String class, the CLR has no special information about the StringBuilder class. In addition, most languages (including C#) donâ€™t consider the StringBuilder class to be a primitive type. You construct a StringBuilder object as you would any other non-primitive type.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>The StringBuilder type offers many constructors. The job of each constructor is to allocate and initialize the state maintained by each StringBuilder object:</p><ul><li><p>Maximum capacity An Int32 value that specifies the maximum number of characters that can be placed in the string. The default is Int32.MaxValue (approximately 2 billion). Itâ€™s unusual to change this value. However, you might specify a smaller maximum capacity to ensure that you never create a string over a certain length. Once constructed, a StringBuilderâ€™s maximum capacity value canâ€™t be changed.</p></li><li><p>Capacity An Int32 value indicating the size of the character array being maintained by the StringBuilder. The default is 16. If you have some idea of how many characters youâ€™ll place in the StringBuilder, you should use this number to set the capacity when constructing the StringBuilder object. When appending characters to the character array, the StringBuilder detects if the array is trying to grow beyond the arrayâ€™s capacity. If it is, the StringBuilder automatically doubles the capacity field, allocates a new array (the size of the new capacity), and copies the characters from the original array into the new array. The original array will be garbage collected in the future. Dynamically growing the array hurts performance; avoid this by setting a good initial capacity.</p></li><li><p>Character array An array of Char structures that maintains the set of characters in the â€œstring.â€ The number of characters is always less than or equal to the capacity and maximum capacity values. You can use the StringBuilderâ€™s Length property to obtain the number of characters used in the array. The Length is always less than or equal to the StringBuilderâ€™s capacity value. When constructing a StringBuilder, you can pass a String to initialize the character array. If you donâ€™t specify a string, the array initially contains no charactersâ€”that is, the Length property returns 0.</p></li></ul></blockquote><h3 id="stringbuilder-members"><a class="anchor" href="#stringbuilder-members">#</a> StringBuilder Members</h3><blockquote><p>Unlike a String, a StringBuilder represents a mutable string. This means that most of StringBuilderâ€™s members change the contents in the array of characters and donâ€™t cause new objects to be allocated on the managed heap. A StringBuilder allocates a new object on only two occasions:</p><ul><li><p>You dynamically build a string whose length is longer than the capacity youâ€™ve set.</p></li><li><p>You call StringBuilderâ€™s ToString method.</p></li></ul></blockquote><p><img data-src="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/image-20221115111421381-1668742125901-6.png" alt="image-20221115111421381"></p><p><img data-src="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/image-20221115111440641-1668742125901-7.png" alt="image-20221115111440641"></p><blockquote><p>One important thing to note about StringBuilderâ€™s methods is that most of them return a reference to the same StringBuilder object. This allows a convenient syntax to chain several operations together.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">String</span> s <span class="token operator">=</span> sb<span class="token punctuation">.</span><span class="token function">AppendFormat</span><span class="token punctuation">(</span><span class="token string">"&#123;0&#125; &#123;1&#125;"</span><span class="token punctuation">,</span> <span class="token string">"Jeffrey"</span><span class="token punctuation">,</span> <span class="token string">"Richter"</span><span class="token punctuation">)</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token function">Replace</span><span class="token punctuation">(</span><span class="token char">' '</span><span class="token punctuation">,</span> <span class="token char">'-'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "Jeff-Richter"</span></pre></td></tr></table></figure><blockquote><p>Youâ€™ll notice that the String and StringBuilder classes donâ€™t have full method parity; that is, String has ToLower, ToUpper, EndsWith, PadLeft, PadRight, Trim, and so on. The StringBuilder class doesnâ€™t offer any of these methods. On the other hand, the StringBuilder class offers a richer Replace method that allows you to replace characters or strings in a portion of the string (not the whole string). Itâ€™s unfortunate that there isnâ€™t complete parity between these two classes because now you must convert between String and StringBuilder to accomplish certain tasks. For example, to build up a string, convert all characters to uppercase, and then insert a string requires code like the following.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Construct a StringBuilder to perform string manipulations. </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// Perform some string manipulations by using the StringBuilder. </span></pre></td></tr><tr><td data-num="4"></td><td><pre>sb<span class="token punctuation">.</span><span class="token function">AppendFormat</span><span class="token punctuation">(</span><span class="token string">"&#123;0&#125; &#123;1&#125;"</span><span class="token punctuation">,</span> <span class="token string">"Jeffrey"</span><span class="token punctuation">,</span> <span class="token string">"Richter"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// Convert the StringBuilder to a String in </span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// order to uppercase all the characters. </span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token class-name">String</span> s <span class="token operator">=</span> sb<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToUpper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// Clear the StringBuilder (allocates a new Char array). </span></pre></td></tr><tr><td data-num="9"></td><td><pre>sb<span class="token punctuation">.</span>Length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// Load the uppercase String into the StringBuilder, </span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// and perform more manipulations. </span></pre></td></tr><tr><td data-num="12"></td><td><pre>sb<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">"Marc-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// Convert the StringBuilder back to a String. </span></pre></td></tr><tr><td data-num="14"></td><td><pre>s <span class="token operator">=</span> sb<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">// Display the String to the user. </span></pre></td></tr><tr><td data-num="16"></td><td><pre>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "JEFFREY-Marc-RICHTER"</span></pre></td></tr></table></figure><blockquote><p>Itâ€™s inconvenient and inefficient to have to write this code just because StringBuilder doesnâ€™t offer all of the operations that String does. In the future, I hope that Microsoft will add more string operation methods to StringBuilder to make it a more complete class.</p></blockquote><p>ğŸ’¡å°ç»“ï¼šå’Œ String ä¸åŒï¼Œ <code>StringBuilder</code> ä»£è¡¨å¯å˜ï¼ˆmutableï¼‰å­—ç¬¦ä¸²ã€‚ä»é€»è¾‘ä¸Šè¯´ï¼Œ <code>StringBuilder</code> å¯¹è±¡åŒ…å«ä¸€ä¸ªå­—æ®µï¼Œè¯¥å­—æ®µå¼•ç”¨äº†ç”± <code>Char</code> ç»“æ„æ„æˆçš„æ•°ç»„ã€‚å’Œ String ç±»ä¸åŒï¼ŒCLR ä¸è§‰å¾— <code>StringBuilder</code> ç±»æœ‰ä»€ä¹ˆç‰¹åˆ«ã€‚æ­¤å¤–ï¼Œå¤§å¤šæ•°è¯­è¨€ï¼ˆåŒ…æ‹¬ C#ï¼‰éƒ½ä¸å°† <code>StringBuilder</code> ç±»è§†ä¸ºåŸºå…ƒç±»å‹ã€‚ <code>StringBuilder</code> çš„æœ€å¤§å®¹é‡æŒ‡å®šäº†èƒ½æ”¾åˆ°å­—ç¬¦ä¸²ä¸­çš„æœ€å¤§å­—ç¬¦æ•°ï¼Œå®¹é‡åˆ™æ˜¯ <code>StringBuilder</code> ç»´æŠ¤çš„å­—ç¬¦æ•°ç»„çš„é•¿åº¦ï¼Œè¿½åŠ å­—ç¬¦é€ æˆæ•°ç»„è¶…è¿‡è®¾å®šçš„å®¹é‡åˆ™ä¼šåŠ¨æ€æ‰©å®¹ï¼Œå°†åŸå§‹æ•°ç»„ä¸­çš„å­—ç¬¦å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ã€‚éšåï¼ŒåŸå§‹æ•°ç»„å¯ä»¥è¢«åƒåœ¾å›æ”¶ã€‚æ•°ç»„åŠ¨æ€æ‰©å®¹ä¼šæŸå®³æ€§èƒ½ã€‚è¦é¿å…å°±è¦è®¾ç½®ä¸€ä¸ªåˆé€‚çš„åˆå§‹å®¹é‡ã€‚ <code>StringBuilder</code> çš„å¤§å¤šæ•°æˆå‘˜éƒ½èƒ½æ›´æ”¹å­—ç¬¦æ•°ç»„çš„å†…å®¹ï¼ŒåŒæ—¶ä¸ä¼šé€ æˆåœ¨æ‰˜ç®¡å †ä¸Šåˆ†é…æ–°å¯¹è±¡ã€‚ <code>StringBuilder</code> åœ¨ä¸¤ç§æƒ…å†µä¸‹å›åˆ†é…æ–°å¯¹è±¡ã€‚1. åŠ¨æ€æ„é€ å­—ç¬¦ä¸²ï¼Œå…¶é•¿åº¦è¶…è¿‡äº†è®¾ç½®çš„ â€œå®¹é‡â€ã€‚2. è°ƒç”¨ <code>StringBuilder</code> çš„ <code>ToString</code> æ–¹æ³•ã€‚ <code>String</code> å’Œ <code>StringBuilder</code> ç±»æä¾›çš„æ–¹æ³•å¹¶ä¸å®Œå…¨å¯¹åº”ã€‚ç”±äºä¸¤ä¸ªç±»ä¸å®Œå…¨å¯¹åº”ï¼Œæ‰€ä»¥æœ‰æ—¶éœ€è¦åœ¨ <code>String</code> å’Œ <code>StringBuilder</code> ä¹‹é—´è½¬æ¢ä»¥å®Œæˆç‰¹å®šä»»åŠ¡ã€‚</p><h2 id="obtaining-a-string-representation-of-an-object-tostring"><a class="anchor" href="#obtaining-a-string-representation-of-an-object-tostring">#</a> Obtaining a String Representation of an Object: ToString</h2><blockquote><p>You frequently need to obtain a string representation of an object. Usually, this is necessary when you want to display a numeric type (such as Byte, Int32, and Single) or a DateTime object to the user. Because the .NET Framework is an object-oriented platform, every type is responsible for providing code that converts an instanceâ€™s value to a string equivalent. When designing how types should accomplish this, the designers of the FCL devised a pattern that would be used consistently throughout. In this section, Iâ€™ll describe this pattern.</p></blockquote><blockquote><p>You can obtain a string representation for any object by calling the ToString method. A public, virtual, parameterless ToString method is defined by System.Object and is therefore callable using an instance of any type. Semantically, ToString returns a string representing the objectâ€™s current value, and this string should be formatted for the calling threadâ€™s current culture; that is, the string representation of a number should use the proper decimal separator, digit-grouping symbol, and other elements associated with the culture assigned to the calling thread.</p></blockquote><blockquote><p>System.Objectâ€™s implementation of ToString simply returns the full name of the objectâ€™s type. This value isnâ€™t particularly useful, but it is a reasonable default for the many types that canâ€™t offer a sensible string. For example, what should a string representation of a FileStream or a Hashtable object look like?</p></blockquote><blockquote><p>All types that want to offer a reasonable way to obtain a string representing the current value of the object should override the ToString method. Many of the core types built into the FCL (Byte, Int32, UInt64, Double, and so on) override their ToString method and return a culturally aware string. In the Visual Studio debugger, a datatip is displayed when the mouse is placed over a particular variable. The text shown in the datatip is obtained by calling the objectâ€™s ToString method. So, when you define a class, you should always override the ToString method so that you get good debugging support.</p></blockquote><h3 id="specific-formats-and-cultures"><a class="anchor" href="#specific-formats-and-cultures">#</a> Specific Formats and Cultures</h3><blockquote><p>The parameterless ToString method has two problems. First, the caller has no control over the formatting of the string. For example, an application might want to format a number into a currency string, decimal string, percent string, or hexadecimal string. Second, the caller canâ€™t easily choose to format a string by using a specific culture. This second problem is more troublesome for server-side application code than for client-side code. On rare occasions, an application needs to format a string by using a culture other than the culture associated with the calling thread. To have more control over string formatting, you need a version of the ToString method that allows you to specify precise formatting and culture information.</p></blockquote><blockquote><p>Types that offer the caller a choice in formatting and culture implement the System.IFormattable interface.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IFormattable</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token return-type class-name">String</span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token class-name">String</span> format<span class="token punctuation">,</span> <span class="token class-name">IFormatProvider</span> formatProvider<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>In the FCL, all of the base types (Byte, SByte, Int16/UInt16, Int32/UInt32, Int64/UInt64, Single, Double, Decimal, and DateTime) implement this interface. In addition, some other types, such as Guid, implement it. Finally, every enumerated type definition will automatically implement the IFormattable interface so that a meaningful string symbol from an instance of the enumerated type can be obtained.</p></blockquote><blockquote><p>IFormattableâ€™s ToString method takes two parameters. The first, format, is a string that tells the method how the object should be formatted. ToStringâ€™s second parameter, formatProvider, is an instance of a type that implements the System.IFormatProvider interface. This type supplies specific culture information to the ToString method. Iâ€™ll discuss how shortly.</p></blockquote><blockquote><p>The type implementing the IFormattable interfaceâ€™s ToString method determines which format strings itâ€™s going to recognize. If you pass a format string that the type doesnâ€™t recognize, the type is supposed to throw a System.FormatException.</p></blockquote><blockquote><p>Many of the types Microsoft has defined in the FCL recognize several formats. For example, the DateTime type supports â€œdâ€ for short date, â€œDâ€ for long date, â€œgâ€ for general, â€œMâ€ for month/day, â€œsâ€ for sortable, â€œTâ€ for long time, â€œuâ€ for universal time in ISO 8601 format, â€œUâ€ for universal time in full date format, â€œYâ€ for year/month, and others. All enumerated types support â€œGâ€ for general, â€œFâ€ for flags, â€œDâ€ for decimal, and â€œXâ€ for hexadecimal. Iâ€™ll cover formatting enumerated types in more detail in Chapter 15, â€œEnumerated Types and Bit Flags.â€</p></blockquote><blockquote><p>Also, all of the built-in numeric types support â€œCâ€ for currency, â€œDâ€ for decimal, â€œEâ€ for exponential (scientific) notation, â€œFâ€ for fixed-point, â€œGâ€ for general, â€œNâ€ for number, â€œPâ€ for percent, â€œRâ€ for round-trip, and â€œXâ€ for hexadecimal. In fact, the numeric types also support picture format strings just in case the simple format strings donâ€™t offer you exactly what youâ€™re looking for. Picture format strings contain special characters that tell the typeâ€™s ToString method exactly how many digits to show, exactly where to place a decimal separator, exactly how many digits to place after the decimal separator, and so on. For complete information about format strings, see â€œFormatting Typesâ€ in the .NET Framework SDK.</p></blockquote><blockquote><p>For most types, calling ToString and passing null for the format string is identical to calling ToString and passing â€œGâ€ for the format string. In other words, objects format themselves using the â€œGeneral formatâ€ by default. When implementing a type, choose a format that you think will be the most commonly used format; this format is the â€œGeneral format.â€ By the way, the ToString method that takes no parameters assumes that the caller wants the â€œGeneral format.â€</p></blockquote><blockquote><p>So now that format strings are out of the way, letâ€™s turn to culture information. By default, strings are formatted using the culture information associated with the calling thread. The parameterless ToString method certainly does this, and so does IFormattableâ€™s ToString if you pass null for the formatProvider parameter.</p></blockquote><blockquote><p>Culture-sensitive information applies when youâ€™re formatting numbers (including currency, integers, floating point, percentages, dates, and times). The Guid type has a ToString method that returns only a string representing its value. Thereâ€™s no need to consider a culture when generating the Guidâ€™s string because GUIDs are used for programmatic purposes only.</p></blockquote><blockquote><p>When formatting a number, the ToString method sees what youâ€™ve passed for the formatProvider parameter. If null is passed, ToString determines the culture associated with the calling thread by reading the System.Globalization.CultureInfo.CurrentCulture property. This property returns an instance of the System.Globalization.CultureInfo type.</p></blockquote><blockquote><p>Using this object, ToString reads its NumberFormat or DateTimeFormat property, depending on whether a number or date/time is being formatted. These properties return an instance of System.Globalization.NumberFormatInfo or System.Globalization.DateTimeFormatInfo, respectively. The NumberFormatInfo type defines a bunch of properties, such as CurrencyDecimalSeparator, CurrencySymbol, NegativeSign, NumberGroupSeparator, and PercentSymbol. Likewise, the DateTimeFormatInfo type defines an assortment of properties, such as Calendar, DateSeparator, DayNames, LongDatePattern, ShortTimePattern, and TimeSeparator. ToString reads these properties when constructing and formatting a string.</p></blockquote><blockquote><p>When calling IFormattableâ€™s ToString method, instead of passing null, you can pass a reference to an object whose type implements the IFormatProvider interface.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IFormatProvider</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token return-type class-name">Object</span> <span class="token function">GetFormat</span><span class="token punctuation">(</span><span class="token class-name">Type</span> formatType<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Hereâ€™s the basic idea behind the IFormatProvider interface: when a type implements this interface, it is saying that an instance of the type is able to provide culture-specific formatting information and that the culture information associated with the calling thread should be ignored.</p></blockquote><blockquote><p>The System.Globalization.CultureInfo type is one of the very few types defined in the FCL that implements the IFormatProvider interface. If you want to format a string for, say, Vietnam, youâ€™d construct a CultureInfo object and pass that object in as ToStringâ€™s formatProvider parameter. The following code obtains a string representation of a Decimal numeric value formatted as currency appropriate for Vietnam.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Decimal</span> price <span class="token operator">=</span> <span class="token number">123.54M</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">String</span> s <span class="token operator">=</span> price<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CultureInfo</span><span class="token punctuation">(</span><span class="token string">"vi-VN"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>If you build and run this code, the message box shown in Figure 14-5 appears.</p></blockquote><p><img data-src="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/image-20221115200310845-1668742125901-8.png" alt="image-20221115200310845"></p><p><strong>FIGURE 14-5</strong> Numeric value formatted correctly to represent Vietnamese currency.</p><blockquote><p>Internally, Decimalâ€™s ToString method sees that the formatProvider argument is not null and calls the objectâ€™s GetFormat method as follows.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">NumberFormatInfo</span> nfi <span class="token operator">=</span> <span class="token punctuation">(</span>NumberFormatInfo<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> formatProvider<span class="token punctuation">.</span><span class="token function">GetFormat</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">NumberFormatInfo</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>This is how ToString requests the appropriate number-formatting information from the (CultureInfo) object. Number types (such as Decimal) request only number-formatting information. But other types (such as DateTime) could call GetFormat like the following</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">DateTimeFormatInfo</span> dtfi <span class="token operator">=</span> <span class="token punctuation">(</span>DateTimeFormatInfo<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> formatProvider<span class="token punctuation">.</span><span class="token function">GetFormat</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">DateTimeFormatInfo</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>Actually, because GetFormatâ€™s parameter can identify any type, the method is flexible enough to allow any type of format information to be requested. The types in the .NET Framework call GetFormat, requesting only number or date/time information; in the future, other kinds of formatting information could be requested.</p></blockquote><blockquote><p>By the way, if you want to obtain a string for an object that isnâ€™t formatted for any particular culture, you should call System.Globalization.CultureInfoâ€™s static InvariantCulture property and pass the object returned as ToStringâ€™s formatProvider parameter.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Decimal</span> price <span class="token operator">=</span> <span class="token number">123.54M</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">String</span> s <span class="token operator">=</span> price<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">,</span> CultureInfo<span class="token punctuation">.</span>InvariantCulture<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>If you build and run this code, the message box shown in Figure 14-6 appears. Notice the first character in the resulting string: Â¤. This is the international sign for currency (U+00A4).</p></blockquote><p><img data-src="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/image-20221115200214296-1668742125901-9.png" alt="image-20221115200214296"></p><p><strong>FIGURE 14-6</strong> Numeric value formatted to represent a culture-neutral currency.</p><blockquote><p>Normally, you wouldnâ€™t display a string formatted by using the invariant culture to a user. Typically, youâ€™d just save this string in a data file so that it could be parsed later.</p></blockquote><blockquote><p>In the FCL, just three types implement the IFormatProvider interface. The first is CultureInfo, which Iâ€™ve already explained. The other two are NumberFormatInfo and DateTimeFormatInfo. When GetFormat is called on a NumberFormatInfo object, the method checks whether the type being requested is a NumberFormatInfo. If it is, this is returned; if itâ€™s not, null is returned. Similarly, calling GetFormat on a DateTimeFormatInfo object returns this if a DateTimeFormatInfo is requested and null if itâ€™s not. These two types implement this interface simply as a programming convenience. When trying to obtain a string representation of an object, the caller commonly specifies a format and uses the culture associated with the calling thread. For this reason, you often call ToString, passing a string for the format parameter and null for the formatProvider parameter. To make calling ToString easier for you, many types offer several overloads of the ToString method. For example, the Decimal type offers four different ToString methods.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// This version calls ToString(null, null). </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// Meaning: General numeric format, thread's culture information </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name">String</span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// This version is where the actual implementation of ToString goes. </span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// This version implements IFormattable's ToString method. </span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// Meaning: Caller-specified format and culture information </span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name">String</span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token class-name">String</span> format<span class="token punctuation">,</span> <span class="token class-name">IFormatProvider</span> formatProvider<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// This version simply calls ToString(format, null). </span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// Meaning: Caller-specified format, thread's culture information </span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name">String</span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token class-name">String</span> format<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// This version simply calls ToString(null, formatProvider). </span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// This version implements IConvertible's ToString method. </span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// Meaning: General format, caller-specified culture information </span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name">String</span> <span class="token function">ToString</span><span class="token punctuation">(</span><span class="token class-name">IFormatProvider</span> formatProvider<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="formatting-multiple-objects-into-a-single-string"><a class="anchor" href="#formatting-multiple-objects-into-a-single-string">#</a> Formatting Multiple Objects into a Single String</h3><blockquote><p>So far, Iâ€™ve explained how an individual type formats its own objects. At times, however, you want to construct strings consisting of many formatted objects. For example, the following string has a date, a personâ€™s name, and an age.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">String</span> s <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"On &#123;0&#125;, &#123;1&#125; is &#123;2&#125; years old."</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DateTime</span><span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Aidan"</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>If you build and run this code where â€œen-USâ€ is the threadâ€™s current culture, youâ€™ll see the following line of output.</p></blockquote><pre><code class="language-cmd">On 4/22/2012 2:35:05 PM, Aidan is 9 years old.
</code></pre><blockquote><p>Stringâ€™s static Format method takes a format string that identifies replaceable parameters by using numbers in braces. The format string used in this example tells the Format method to replace {0} with the first parameter after the format string (the date/time), replace {1} with the second parameter after the format string (â€œAidanâ€), and replace {2} with the third parameter after the format string (9).</p></blockquote><blockquote><p>Internally, the Format method calls each objectâ€™s ToString method to obtain a string representation for the object. Then the returned strings are all appended and the complete, final string is returned. This is all fine and good, but it means that all of the objects are formatted by using their general format and the calling threadâ€™s culture information.</p></blockquote><blockquote><p>You can have more control when formatting an object if you specify format information within braces. For example, the following code is identical to the previous example except that Iâ€™ve added formatting information to replaceable parameters 0 and 2.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">String</span> s <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"On &#123;0:D&#125;, &#123;1&#125; is &#123;2:E&#125; years old."</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DateTime</span><span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Aidan"</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>If you build and run this code where â€œen-USâ€ is the threadâ€™s current culture, youâ€™ll see the following line of output.</p></blockquote><pre><code class="language-cmd">On Sunday, April 22, 2012, Aidan is 9.000000E+000 years old.
</code></pre><blockquote><p>When the Format method parses the format string, it sees that replaceable parameter 0 should have its IFormattable interfaceâ€™s ToString method called passing &quot;D&quot; and null for its two parameters. Likewise, Format calls replaceable parameter 2â€™s IFormattable ToString method, passing &quot;E&quot; and null. If the type doesnâ€™t implement the IFormattable interface, Format calls its parameterless ToString method inherited from Object (and possibly overridden), and the default format is appended into the resulting string.</p></blockquote><blockquote><p>The String class offers several overloads of the static Format method. One version takes an object that implements the IFormatProvider interface so that you can format all of the replaceable parameters by using caller-specified culture information. Obviously, Format calls each objectâ€™s IFormattable.ToString method, passing it whatever IFormatProvider object was passed to Format.</p></blockquote><blockquote><p>If youâ€™re using StringBuilder instead of String to construct a string, you can call StringBuilderâ€™s AppendFormat method. This method works exactly as Stringâ€™s Format method except that it formats a string and appends to the StringBuilderâ€™s character array. As does Stringâ€™s Format, AppendFormat takes a format string, and thereâ€™s a version that takes an IFormatProvider.</p></blockquote><blockquote><p>System.Console offers Write and WriteLine methods that also take format strings and replaceable parameters. However, there are no overloads of Consoleâ€™s Write and WriteLine methods that allow you to pass an IFormatProvider. If you want to format a string for a specific culture, you have to call Stringâ€™s Format method, first passing the desired IFormatProvider object and then passing the resulting string to Consoleâ€™s Write or WriteLine method. This shouldnâ€™t be a big deal because, as I said earlier, itâ€™s rare for client-side code to format a string by using a culture other than the one associated with the calling thread.</p></blockquote><h3 id="providing-your-own-custom-formatter"><a class="anchor" href="#providing-your-own-custom-formatter">#</a> Providing Your Own Custom Formatter</h3><blockquote><p>By now it should be clear that the formatting capabilities in the .NET Framework were designed to offer you a great deal of flexibility and control. However, weâ€™re not quite finished. Itâ€™s possible for you to define a method that StringBuilderâ€™s AppendFormat method will call whenever any object is being formatted into a string. In other words, instead of calling ToString for each object, AppendFormat can call a function you define, allowing you to format any or all of the objects in any way you want. What Iâ€™m about to describe also works with Stringâ€™s Format method.</p></blockquote><blockquote><p>Let me explain this mechanism by way of an example. Letâ€™s say that youâ€™re formatting HTML text that a user will view in an Internet browser. You want all Int32 values to appear in bold. To accomplish this, every time an Int32 value is formatted into a String, you want to surround the string with HTML bold tags: <strong>and</strong> . The following code demonstrates how easy it is to do this.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> sb<span class="token punctuation">.</span><span class="token function">AppendFormat</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">BoldInt32s</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&#123;0&#125; &#123;1&#125; &#123;2:M&#125;"</span><span class="token punctuation">,</span> <span class="token string">"Jeff"</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>sb<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">internal</span> <span class="token keyword">sealed</span> <span class="token keyword">class</span> <span class="token class-name">BoldInt32s</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IFormatProvider</span><span class="token punctuation">,</span> <span class="token class-name">ICustomFormatter</span></span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name">Object</span> <span class="token function">GetFormat</span><span class="token punctuation">(</span><span class="token class-name">Type</span> formatType<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>formatType <span class="token operator">==</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">ICustomFormatter</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token keyword">return</span> Thread<span class="token punctuation">.</span>CurrentThread<span class="token punctuation">.</span>CurrentCulture<span class="token punctuation">.</span><span class="token function">GetFormat</span><span class="token punctuation">(</span>formatType<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token keyword">public</span> <span class="token return-type class-name">String</span> <span class="token function">Format</span><span class="token punctuation">(</span><span class="token class-name">String</span> format<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">,</span> <span class="token class-name">IFormatProvider</span> formatProvider<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token class-name">String</span> s<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token class-name">IFormattable</span> formattable <span class="token operator">=</span> arg <span class="token keyword">as</span> <span class="token class-name">IFormattable</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>formattable <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> s <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token keyword">else</span> s <span class="token operator">=</span> formattable<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> formatProvider<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>arg<span class="token punctuation">.</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Int32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token keyword">return</span> <span class="token string">"&lt;B>"</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">"&lt;/B>"</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token keyword">return</span> s<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>When you compile and run this code where â€œen-USâ€ is the threadâ€™s current culture, it displays the following output (your date may be different, of course).</p></blockquote><pre><code class="language-cmd">Jeff &lt;B&gt;123&lt;/B&gt; September 1
</code></pre><blockquote><p>In Main, Iâ€™m constructing an empty StringBuilder and then appending a formatted string into it. When I call AppendFormat, the first parameter is an instance of the BoldInt32s class. This class implements the IFormatProvider interface that I discussed earlier. In addition, this class implements the ICustomFormatter interface.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ICustomFormatter</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token return-type class-name">String</span> <span class="token function">Format</span><span class="token punctuation">(</span><span class="token class-name">String</span> format<span class="token punctuation">,</span> <span class="token class-name">Object</span> arg<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token class-name">IFormatProvider</span> formatProvider<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>This interfaceâ€™s Format method is called whenever StringBuilderâ€™s AppendFormat needs to obtain a string for an object. You can do some pretty clever things inside this method that give you a great deal of control over string formatting. Letâ€™s look inside the AppendFormat method to see exactly how it works. The following pseudocode shows how AppendFormat works.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name">StringBuilder</span> <span class="token function">AppendFormat</span><span class="token punctuation">(</span><span class="token class-name">IFormatProvider</span> formatProvider<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token class-name">String</span> format<span class="token punctuation">,</span> <span class="token keyword">params</span> <span class="token class-name">Object<span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token comment">// If an IFormatProvider was passed, find out </span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token comment">// whether it offers an ICustomFormatter object. </span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token class-name">ICustomFormatter</span> cf <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>formatProvider <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> cf <span class="token operator">=</span> <span class="token punctuation">(</span>ICustomFormatter<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> formatProvider<span class="token punctuation">.</span><span class="token function">GetFormat</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">ICustomFormatter</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token comment">// Keep appending literal characters (not shown in this pseudocode) </span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token comment">// and replaceable parameters to the StringBuilder's character array. </span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token class-name">Boolean</span> MoreReplaceableArgumentsToAppend <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token keyword">while</span> <span class="token punctuation">(</span>MoreReplaceableArgumentsToAppend<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token comment">// argFormat refers to the replaceable format string obtained </span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token comment">// from the format parameter </span></pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token class-name">String</span> argFormat <span class="token operator">=</span> <span class="token comment">/* ... */</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token comment">// argObj refers to the corresponding element </span></pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token comment">// from the args array parameter </span></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token class-name">Object</span> argObj <span class="token operator">=</span> <span class="token comment">/* ... */</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token comment">// argStr will refer to the formatted string to be appended </span></pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token comment">// to the final, resulting string </span></pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token class-name">String</span> argStr <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token comment">// If a custom formatter is available, let it format the argument. </span></pre></td></tr><tr><td data-num="23"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>cf <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="24"></td><td><pre> argStr <span class="token operator">=</span> cf<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>argFormat<span class="token punctuation">,</span> argObj<span class="token punctuation">,</span> formatProvider<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token comment">// If there is no custom formatter or if it didn't format </span></pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token comment">// the argument, try something else. </span></pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>argStr <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token comment">// Does the argument's type support rich formatting? </span></pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token class-name">IFormattable</span> formattable <span class="token operator">=</span> argObj <span class="token keyword">as</span> <span class="token class-name">IFormattable</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="30"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>formattable <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="31"></td><td><pre> <span class="token comment">// Yes; pass the format string and provider to </span></pre></td></tr><tr><td data-num="32"></td><td><pre> <span class="token comment">// the type's IFormattable ToString method. </span></pre></td></tr><tr><td data-num="33"></td><td><pre> argStr <span class="token operator">=</span> formattable<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>argFormat<span class="token punctuation">,</span> formatProvider<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="34"></td><td><pre> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="35"></td><td><pre> <span class="token comment">// No; get the default format by using </span></pre></td></tr><tr><td data-num="36"></td><td><pre> <span class="token comment">// the thread's culture information. </span></pre></td></tr><tr><td data-num="37"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>argObj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> argStr <span class="token operator">=</span> argObj<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="38"></td><td><pre> <span class="token keyword">else</span> argStr <span class="token operator">=</span> String<span class="token punctuation">.</span>Empty<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="39"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="40"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="41"></td><td><pre> <span class="token comment">// Append argStr's characters to the character array field member. </span></pre></td></tr><tr><td data-num="42"></td><td><pre> <span class="token comment">/* ... */</span> </pre></td></tr><tr><td data-num="43"></td><td><pre> <span class="token comment">// Check if any remaining parameters to format </span></pre></td></tr><tr><td data-num="44"></td><td><pre> MoreReplaceableArgumentsToAppend <span class="token operator">=</span> <span class="token comment">/* ... */</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="45"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="46"></td><td><pre> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>When Main calls AppendFormat, AppendFormat calls my format providerâ€™s GetFormat method, passing it the ICustomFormatter type. The GetFormat method defined in my BoldInt32s type sees that the ICustomFormatter is being requested and returns a reference to itself because it implements this interface. If my GetFormat method is called and is passed any other type, I call the GetFormat method of the CultureInfo object associated with the calling thread.</p></blockquote><blockquote><p>Whenever AppendFormat needs to format a replaceable parameter, it calls ICustomFormatterâ€™s Format method. In my example, AppendFormat calls the Format method defined by my BoldInt32s type. In my Format method, I check whether the object being formatted supports rich formatting via the IFormattable interface. If the object doesnâ€™t, I then call the simple, parameterless ToString method (inherited from Object) to format the object. If the object does support IFormattable, I then call the rich ToString method, passing it the format string and the format provider.</p></blockquote><blockquote><p>Now that I have the formatted string, I check whether the corresponding object is an Int32 type, and if it is, I wrap the formatted string in &lt;B&gt;and&lt;/B&gt; HTML tags and return the new string. If the object is not an Int32, I simply return the formatted string without any further processing.</p></blockquote><p>ğŸ’¡å°ç»“ï¼šæ— å‚ <code>ToString</code> æ–¹æ³•è™½ç„¶èƒ½ç»™è®¸å¤šä¸èƒ½æä¾›æœ‰æ„ä¹‰çš„å­—ç¬¦ä¸²çš„ç±»å‹çš„ç±»å‹ä¸€ä¸ªåˆç†çš„é»˜è®¤å€¼ã€‚ä½†è°ƒç”¨è€…æ— æ³•æ§åˆ¶å­—ç¬¦ä¸²çš„æ ¼å¼ï¼Œä¾‹å¦‚è´§å¸ã€åè¿›åˆ¶ã€ç™¾åˆ†æ¯”æˆ–è€…åå…­è¿›åˆ¶å­—ç¬¦ä¸²ä¹‹ç±»çš„è¡¨ç¤ºï¼Œæ­¤å¤–è°ƒç”¨è€…ä¸èƒ½æ–¹ä¾¿åœ°é€‰æ‹©ä¸€ç§ç‰¹å®šè¯­è¨€æ–‡åŒ–æ¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚ç›¸è¾ƒäºå®¢æˆ·ç«¯ä»£ç ï¼ŒæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºåœ¨ç¬¬äºŒä¸ªé—®é¢˜ä¸Šå°¤å…¶éº»çƒ¦ã€‚ä¸ºäº†ä½¿è°ƒç”¨è€…èƒ½é€‰æ‹©æ ¼å¼å’Œè¯­è¨€æ–‡åŒ–ï¼Œç±»å‹åº”è¯¥å®ç° <code>System.IFormattable</code> æ¥å£ã€‚FCL çš„æ‰€æœ‰åŸºå…ƒå€¼ç±»å‹éƒ½å®ç°äº†è¿™ä¸ªæ¥å£ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰å¦ä¸€äº›ç±»å‹ï¼ˆæ¯”å¦‚ <code>Guid</code> ï¼‰ä¹Ÿå®ç°äº†å®ƒã€‚æœ€åï¼Œæ¯ä¸ªæšä¸¾ç±»å‹éƒ½è‡ªåŠ¨å®ç° <code>IFormattable</code> æ¥å£ï¼Œä»¥ä¾¿ä»æšä¸¾ç±»å‹çš„å®ä¾‹è·å–ä¸€ä¸ªæœ‰æ„ä¹‰çš„å­—ç¬¦ä¸²ç¬¦å·ã€‚ <code>IFormattable</code> çš„ <code>ToString</code> æ–¹æ³•è·å–ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•° <code>format</code> æä¾›ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ä¸²å‘Šè¯‰æ–¹æ³•å¦‚ä½•æ ¼å¼åŒ–å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•° <code>formatProvider</code> æä¾›ä¸€ä¸ªå®ç° <code>System.IFormatProvider</code> æ¥å£çš„ä¸€ä¸ªç±»å‹çš„å®ä¾‹ã€‚å®ç° <code>IFormattable</code> æ¥å£çš„ <code>ToString</code> æ–¹æ³•çš„ç±»å‹å†³å®šå“ªäº›æ ¼å¼å­—ç¬¦ä¸²èƒ½è¢«è¯†åˆ«ã€‚Microsoft åœ¨ FCL ä¸­å®šä¹‰çš„è®¸å¤šç±»å‹éƒ½èƒ½åŒæ—¶è¯†åˆ«å‡ ç§æ ¼å¼ã€‚å¯¹äºå¤§å¤šæ•°ç±»å‹ï¼Œè°ƒç”¨ <code>ToString</code> å¹¶ä¸ºæ ¼å¼å­—ç¬¦ä¸²ä¼ é€’ null å€¼å®Œå…¨ç­‰ä»·äºè°ƒç”¨ <code>ToString</code> å¹¶ä¸ºæ ¼å¼å­—ç¬¦ä¸²ä¼ é€’ â€œGâ€ã€‚å­—ç¬¦ä¸²é»˜è®¤ä½¿ç”¨ä¸è°ƒç”¨çº¿ç¨‹å…³è”çš„è¯­è¨€æ–‡åŒ–ä¿¡æ¯è¿›è¡Œæ ¼å¼åŒ–ï¼Œå¦‚æœä¸º <code>formatProvider</code> å‚æ•°ä¼ é€’ null å€¼ï¼Œ <code>IFormattable</code> çš„ <code>ToString</code> ä¹Ÿä¼šè¿™ä¹ˆåšã€‚ç”Ÿæˆ <code>Guid</code> çš„å­—ç¬¦ä¸²æ—¶ä¸å¿…è€ƒè™‘è¯­è¨€æ–‡åŒ–ï¼Œå› ä¸º <code>Guid</code> åªç”¨äºç¼–ç¨‹ã€‚ <code>IFormatProvider</code> æ¥å£çš„åŸºæœ¬æ€è·¯æ˜¯ï¼šå½“ä¸€ä¸ªç±»å‹å®ç°äº†è¯¥æ¥å£ï¼Œå°±è®¤ä¸ºè¯¥ç±»å‹çš„å®ä¾‹èƒ½æä¾›å¯¹è¯­è¨€æ–‡åŒ–æ•æ„Ÿçš„æ ¼å¼ä¿¡æ¯ï¼Œä¸è°ƒç”¨çº¿ç¨‹å…³è”çš„è¯­è¨€æ–‡åŒ–åº”è¢«å¿½ç•¥ã€‚FCL çš„ç±»å‹åªæœ‰å°‘æ•°å®ç°äº† <code>IFormatProvider</code> æ¥å£ã€‚ <code>System.Globalization.CultureInfo</code> ç±»å‹å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚.NET Framework ä¸­çš„ç±»å‹åœ¨è°ƒç”¨ <code>GetFormat</code> æ—¶ï¼Œæš‚æ—¶åªä¼šè¯·æ±‚æ•°å­—æˆ–æ—¥æœŸ / æ—¶é—´ä¿¡æ¯ï¼Œä½†æœªæ¥å¯èƒ½ä¼šè¯·æ±‚å…¶ä»–æ ¼å¼ä¿¡æ¯ã€‚å¦å¤–ä¸¤ä¸ªå®ç°äº† <code>IFormatProvider</code> æ¥å£çš„æ˜¯ <code>NumberFormatInfo</code> å’Œ <code>DateTimeFormatInfo</code> ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•ä¼šæ£€æŸ¥è¢«è¯·æ±‚çš„ç±»å‹æ˜¯ä¸æ˜¯è‡ªå·±ï¼Œå¦‚æœæ˜¯å°±è¿”å› thisï¼Œå¦åˆ™è¿”å› nullã€‚String çš„é™æ€ Format æ–¹æ³•è·å–ä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸²ã€‚åœ¨æ ¼å¼å­—ç¬¦ä¸²ä¸­ï¼Œå¤§æ‹¬å·ä¸­çš„æ•°å­—æŒ‡å®šäº†å¯ä¾›æ›¿æ¢çš„å‚æ•°ã€‚åœ¨å†…éƒ¨ï¼Œ <code>Format</code> æ–¹æ³•ä¼šè°ƒç”¨æ¯ä¸ªå¯¹è±¡çš„ <code>ToString</code> æ–¹æ³•æ¥è·å–å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚åœ¨å¤§æ‹¬å·å†…æŒ‡å®šæ ¼å¼ä¿¡æ¯ï¼Œå¯ä»¥æ›´å…¨é¢åœ°æ§åˆ¶å¯¹è±¡æ ¼å¼åŒ–ã€‚ä¹‹å <code>Format</code> æ–¹æ³•ä¼šè°ƒç”¨å¯æ›¿æ¢çš„å‚æ•°çš„ <code>IFormattable</code> æ¥å£çš„ <code>ToString</code> æ–¹æ³•ã€‚å‡å¦‚å¯æ›¿æ¢å‚æ•°æ²¡æœ‰å®ç° <code>IFormattable</code> æ¥å£ï¼Œ <code>Format</code> ä¼šè°ƒç”¨ä» <code>Object</code> ç»§æ‰¿ï¼ˆè€Œä¸”æœ‰å¯èƒ½é‡å†™ï¼‰çš„æ— å‚ <code>ToString</code> æ–¹æ³•ï¼Œå¹¶å°†é»˜è®¤æ ¼å¼é™„åŠ åˆ°æœ€ç»ˆç”Ÿæˆçš„å­—ç¬¦ä¸²ä¸­ã€‚å¦‚æœä½¿ç”¨ <code>StringBuilder</code> è€Œä¸æ˜¯ String æ¥æ„é€ å­—ç¬¦ä¸²ï¼Œå¯ä»¥è°ƒç”¨ <code>StringBuilder</code> çš„ <code>AppendFormat</code> æ–¹æ³•ã€‚å®ƒçš„åŸç†ä¸ <code>String</code> çš„ <code>Format</code> æ–¹æ³•ç±»ä¼¼ï¼Œåªæ˜¯ä¼šæ ¼å¼åŒ–å­—ç¬¦ä¸²å¹¶å°†å…¶é™„åŠ åˆ° <code>StringBuilder</code> çš„å­—ç¬¦æ•°ç»„ä¸­ã€‚ <code>System.Console</code> çš„ <code>Write</code> å’Œ <code>WriteLine</code> æ–¹æ³•ä¹Ÿèƒ½è·å–æ ¼å¼å­—ç¬¦ä¸²å’Œå¯æ›¿æ¢å‚æ•°ã€‚ä½† <code>Console</code> çš„ <code>Write</code> å’Œ <code>WriteLine</code> æ–¹æ³•æ²¡æœ‰é‡è½½ç‰ˆæœ¬èƒ½è·å–ä¸€ä¸ª <code>IFormatProvider</code> ã€‚æˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨ä»»ä½•å¯¹è±¡éœ€è¦æ ¼å¼åŒ–æˆå­—ç¬¦ä¸²çš„æ—¶å€™ç”± <code>StringBuilder</code> çš„ <code>AppendFormat</code> æ–¹æ³•è°ƒç”¨è¯¥æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ <code>AppendFormat</code> ä¸æ˜¯ä¸ºæ¯ä¸ªå¯¹è±¡è°ƒç”¨ <code>ToString</code> ï¼Œè€Œæ˜¯è°ƒç”¨å®šåˆ¶çš„æ–¹æ³•ï¼ŒæŒ‰ç…§æˆ‘ä»¬å¸Œæœ›çš„ä»»ä½•æ–¹å¼æ ¼å¼åŒ–éƒ¨åˆ†æˆ–å…¨éƒ¨å¯¹è±¡ã€‚ä»»ä½•æ—¶å€™åªè¦ <code>StringBuilder</code> çš„ <code>AppendFormat</code> æ–¹æ³•éœ€è¦è·å–å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªæ¥å£çš„ <code>Format</code> æ–¹æ³•ã€‚å¯åœ¨æ–¹æ³•å†…éƒ¨é€šè¿‡ä¸€äº›å·§å¦™çš„æ“ä½œå¯¹å­—ç¬¦ä¸²æ ¼å¼åŒ–è¿›è¡Œå…¨é¢æ§åˆ¶ã€‚</p><h2 id="parsing-a-string-to-obtain-an-object-parse"><a class="anchor" href="#parsing-a-string-to-obtain-an-object-parse">#</a> Parsing a String to Obtain an Object: Parse</h2><blockquote><p>In the preceding section, I explained how to take an object and obtain a string representation of that object. In this section, Iâ€™ll talk about the opposite: how to take a string and obtain an object representation of it. Obtaining an object from a string isnâ€™t a very common operation, but it does occasionally come in handy. Microsoft felt it necessary to formalize a mechanism by which strings can be parsed into objects.</p></blockquote><blockquote><p>Any type that can parse a string offers a public, static method called Parse. This method takes a String and returns an instance of the type; in a way, Parse acts as a factory. In the FCL, a Parse method exists on all of the numeric types as well as for DateTime, TimeSpan, and a few other types (such as the SQL data types).</p></blockquote><blockquote><p>Letâ€™s look at how to parse a string into a number type. Almost all of the numeric types (Byte, SByte, Int16/UInt16, Int32/UInt32, Int64/UInt64, Single, Double, Decimal, and BigInteger) offer at least one Parse method. Here Iâ€™ll show you just the Parse method defined by the Int32 type. (The Parse methods for the other numeric types work similarly to Int32â€™s Parse method.)</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">Parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token class-name">NumberStyles</span> style<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token class-name">IFormatProvider</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>Just from looking at the prototype, you should be able to guess exactly how this method works. The String parameter, s, identifies a string representation of a number you want parsed into an Int32 object. The System.Globalization.NumberStyles parameter, style, is a set of bit flags that identify characters that Parse should expect to find in the string. And the IFormatProvider parameter, provider, identifies an object that the Parse method can use to obtain culture-specific information, as discussed earlier in this chapter.</p></blockquote><blockquote><p>For example, the following code causes Parse to throw a System.FormatException because the string being parsed contains a leading space.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Int32</span> x <span class="token operator">=</span> Int32<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">" 123"</span><span class="token punctuation">,</span> NumberStyles<span class="token punctuation">.</span>None<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>To allow Parse to skip over the leading space, change the style parameter as follows.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Int32</span> x <span class="token operator">=</span> Int32<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">" 123"</span><span class="token punctuation">,</span> NumberStyles<span class="token punctuation">.</span>AllowLeadingWhite<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>See the .NET Framework SDK documentation for a complete description of the bit symbols and common combinations that the NumberStyles enumerated type defines.</p></blockquote><blockquote><p>Hereâ€™s a code fragment showing how to parse a hexadecimal number.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">Int32</span> x <span class="token operator">=</span> Int32<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">"1A"</span><span class="token punctuation">,</span> NumberStyles<span class="token punctuation">.</span>HexNumber<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Displays "26"</span></pre></td></tr></table></figure><blockquote><p>This Parse method accepts three parameters. For convenience, many types offer additional overloads of Parse so you donâ€™t have to pass as many arguments. For example, Int32 offers four overloads of the Parse method.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Passes NumberStyles.Integer for style </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// and thread's culture's provider information. </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">Parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// Passes thread's culture's provider information. </span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">Parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token class-name">NumberStyles</span> style<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// Passes NumberStyles.Integer for the style parameter. </span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">Parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token class-name">IFormatProvider</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// This is the method I've been talking about in this section. </span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Int32</span> <span class="token function">Parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token class-name">NumberStyles</span> style<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token class-name">IFormatProvider</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>The DateTime type also offers a Parse method<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">DateTime</span> <span class="token function">Parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token class-name">IFormatProvider</span> provider<span class="token punctuation">,</span> <span class="token class-name">DateTimeStyles</span> styles<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>The DateTime type also offers a Parse method.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">DateTime</span> <span class="token function">Parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token class-name">IFormatProvider</span> provider<span class="token punctuation">,</span> <span class="token class-name">DateTimeStyles</span> styles<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>This method works just as the Parse method defined on the number types except that DateTimeâ€™s Parse method takes a set of bit flags defined by the System.Globalization.DateTimeStyles enumerated type instead of the NumberStyles enumerated type. See the .NET Framework SDK documentation for a complete description of the bit symbols and common combinations the DateTimeStyles type defines.</p></blockquote><blockquote><p>For convenience, the DateTime type offers three overloads of the Parse method.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// Passes thread's culture's provider information </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// and DateTimeStyles.None for the style </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">DateTime</span> <span class="token function">Parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// Passes DateTimeStyles.None for the style </span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">DateTime</span> <span class="token function">Parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token class-name">IFormatProvider</span> provider<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// This is the method I've been talking about in this section. </span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">DateTime</span> <span class="token function">Parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token class-name">IFormatProvider</span> provider<span class="token punctuation">,</span> <span class="token class-name">DateTimeStyles</span> styles<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><blockquote><p>Parsing dates and times is complex. Many developers have found the Parse method of the DateTime type too forgiving in that it sometimes parses strings that donâ€™t contain dates or times. For this reason, the DateTime type also offers a ParseExact method that accepts a picture format string that indicates exactly how the date/time string should be formatted and how it should be parsed. For more information about picture format strings, see the DateTimeFormatInfo class in the .NET Framework SDK.</p></blockquote><p>ğŸ’¡æ³¨æ„ï¼šä¸€äº›å¼€å‘äººå‘˜å‘ Microsoft æŠ¥å‘Šäº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœåº”ç”¨ç¨‹åºé¢‘ç¹è°ƒç”¨ <code>Parse</code> ï¼Œè€Œä¸” <code>Parse</code> é¢‘ç¹æŠ›å‡ºå¼‚å¸¸æ—¶ (ç”±äºæ— æ•ˆçš„ç”¨æˆ·è¾“å…¥)ï¼Œåº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¼šæ˜¾è‘—ä¸‹é™ã€‚ä¸ºæ­¤ï¼ŒMicrosoft åœ¨æ‰€æœ‰æ•°å€¼æ•°æ®ç±»å‹ã€ <code>DateTime</code> ç±»å‹ã€ <code>TimeSpan</code> ç±»å‹ã€ç”šè‡³ <code>IPAddress</code> ç±»å‹ä¸­åŠ å…¥äº† <code>TryParse</code> æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ <code>Int32</code> çš„ <code>TryParse</code> æ–¹æ³•çš„ä¸¤ä¸ªé‡è½½ç‰ˆæœ¬ä¹‹ä¸€ï¼š</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">Boolean</span> <span class="token function">TryParse</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">,</span> <span class="token class-name">NumberStyles</span> style<span class="token punctuation">,</span> <span class="token class-name">IFormatProvider</span> provider<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name">Int32</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œæ–¹æ³•ä¼šè¿”å› <code>true</code> æˆ– <code>false</code> ï¼ŒæŒ‡å‡ºä¼ é€’çš„å­—ç¬¦ä¸²æ˜¯å¦èƒ½è§£ææˆ <code>Int32</code> ã€‚å¦‚æœè¿”å› <code>true</code> ï¼Œä»¥ â€œä¼ å¼•ç”¨â€ çš„æ–¹å¼ä¼ ç»™ <code>result</code> å‚æ•°çš„å˜é‡å°†åŒ…å«è§£æå¥½çš„æ•°å€¼ï¼Œ <code>TryXXX</code> æ¨¡å¼çš„è¯¦æƒ…å°†åœ¨ç¬¬ 20 ç«  â€œå¼‚å¸¸å’ŒçŠ¶æ€ç®¡ç†â€ ä¸­è®¨è®ºã€‚</p><p>ğŸ’¡å°ç»“ï¼šèƒ½è§£æå­—ç¬¦ä¸²çš„ä»»ä½•ç±»å‹éƒ½æä¾›äº†å…¬å…±é™æ€æ–¹æ³• Parseã€‚æ–¹æ³•è·å–ä¸€ä¸ª <code>String</code> å¹¶è¿”å›ç±»å‹çš„å®ä¾‹ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œ <code>Parse</code> æ‰®æ¼”äº†ä¸€ä¸ªå·¥å‚ï¼ˆfactoryï¼‰çš„è§’è‰²ã€‚åœ¨ FCL ä¸­ï¼Œæ‰€æœ‰æ•°å€¼ç±»å‹ã€ <code>DateTime</code> ã€ <code>TimeSpan</code> ä»¥åŠå…¶ä»–ä¸€äº›ç±»å‹ï¼ˆæ¯”å¦‚å„ç§ SQL æ•°æ®ç±»å‹ï¼‰å‡æä¾›äº† Parse æ–¹æ³•ã€‚åœ¨æ•°å€¼ç±»å‹çš„ Parse æ–¹æ³•ä¸­ï¼Œ <code>System.Globalization.NumberStyles</code> å‚æ•° style æ˜¯ä½æ ‡å¿—ï¼ˆbit blagï¼‰é›†åˆï¼Œæ ‡è¯†äº† <code>Parse</code> åº”åœ¨å­—ç¬¦ä¸²æŸ¥æ‰¾çš„å­—ç¬¦ï¼ˆä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ä¸­å…è®¸çš„æ ·å¼ï¼Œæœ‰ä¸å…è®¸çš„æ ·å¼ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚æ­¤å¤–ï¼Œ <code>DateTime</code> è·å–çš„æ˜¯ç”± <code>System.Globalization.DateTimeStyles</code> æšä¸¾ç±»å‹å®šä¹‰çš„ä½æ ‡å¿—é›†åˆã€‚ <code>DateTime</code> ç±»å‹çš„ <code>Parse</code> æ–¹æ³•æ¯”è¾ƒå®½æ¾ï¼Œæœ‰æ—¶ä¼šè§£æä¸å«æ—¥æœŸæˆ–æ—¶é—´çš„å­—ç¬¦ä¸²ã€‚æœ‰é‰´äºæ­¤ï¼Œ <code>DateTime</code> ç±»å‹è¿˜æä¾›äº† <code>ParseExact</code> æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ª picture æ ¼å¼å­—ç¬¦ä¸²ï¼Œèƒ½å‡†ç¡®æè¿°åº”è¯¥å¦‚ä½•æ ¼å¼åŒ–æ—¥æœŸ / æ—¶é—´å­—ç¬¦ä¸²ï¼Œä»¥åŠå¦‚ä½•å¯¹å®ƒè¿›è¡Œè§£æã€‚</p><h2 id="encodings-converting-between-characters-and-bytes"><a class="anchor" href="#encodings-converting-between-characters-and-bytes">#</a> Encodings: Converting Between Characters and Bytes</h2><blockquote><p>In Win32, programmers all too frequently have to write code to convert Unicode characters and strings to Multi-Byte Character Set (MBCS) characters and strings. Iâ€™ve certainly written my share of this code, and itâ€™s very tedious to write and error-prone to use. In the CLR, all characters are represented as 16-bit Unicode code values and all strings are composed of 16-bit Unicode code values. This makes working with characters and strings easy at run time.</p></blockquote><blockquote><p>At times, however, you want to save strings to a file or transmit them over a network. If the strings consist mostly of characters readable by English-speaking people, saving or transmitting a set of 16- bit values isnâ€™t very efficient because half of the bytes written would contain zeros. Instead, it would be more efficient to encode the 16-bit values into a compressed array of bytes and then decode the array of bytes back into an array of 16-bit values.</p></blockquote><blockquote><p>Encodings also allow a managed application to interact with strings created by non-Unicode systems. For example, if you want to produce a file readable by an application running on a Japanese version of Windows 95, you have to save the Unicode text by using the Shift-JIS (code page 932) encoding. Likewise, y ouâ€™d use Shift-JIS encoding to read a text file produced on a Japanese Windows 95 system into the CLR.</p></blockquote><blockquote><p>Encoding is typically done when you want to send a string to a file or network stream by using the System.IO.BinaryWriter or System.IO.StreamWriter type. Decoding is typically done when you want to read a string from a file or network stream by using the System.IO.BinaryReader or System.IO.StreamReader type. If you donâ€™t explicitly select an encoding, all of these types default to using UTF-8. (UTF stands for Unicode Transformation Format.) However, at times, you might want to explicitly encode or decode a string. Even if you don't want to explicitly do this, this section will give you more insight into the reading and writing of strings from and to streams.</p></blockquote><blockquote><p>Fortunately, the FCL offers some types to make character encoding and decoding easy. The two most frequently used encodings are UTF-16 and UTF-8:</p><ul><li><p>UTF-16 encodes each 16-bit character as 2 bytes. It doesnâ€™t affect the characters at all, and no compression occursâ€”its performance is excellent. UTF-16 encoding is also referred to as Unicode encoding. Also note that UTF-16 can be used to convert from little-endian to big-endian and vice versa.</p></li><li><p>UTF-8 encodes some characters as 1 byte, some characters as 2 bytes, some characters as 3 bytes, and some characters as 4 bytes. Characters with a value below 0x0080 are compressed to 1 byte, which works very well for characters used in the United States. Characters between 0x0080 and 0x07FF are converted to 2 bytes, which works well for European and Middle Eastern languages. Characters of 0x0800 and above are converted to 3 bytes, which works well for East Asian languages. Finally, surrogate pairs are written out as 4 bytes. UTF-8 is an extremely popular encoding, but itâ€™s less efficient than UTF-16 if you encode many characters with values of 0x0800 or above.</p></li></ul></blockquote><blockquote><p>Although the UTF-16 and UTF-8 encodings are by far the most common, the FCL also supports some encodings that are used less frequently:</p><ul><li><p>UTF-32 encodes all characters as 4 bytes. This encoding is useful when you want to write a simple algorithm to traverse characters and you donâ€™t want to have to deal with characters taking a variable number of bytes. For example, with UTF-32, you do not need to think about surrogates because every character is 4 bytes. Obviously, UTF-32 is not an efficient encoding in terms of memory usage and is therefore rarely used for saving or transmitting strings to a file or network. This encoding is typically used inside the program itself. Also note that UTF-32 can be used to convert from little-endian to big-endian and vice versa.</p></li><li><p>UTF-7 encoding is typically used with older systems that work with characters that can be expressed using 7-bit values. You should avoid this encoding because it usually ends up expanding the data rather than compressing it. The Unicode Consortium has deprecated this encoding.</p></li><li><p>ASCII encodes the 16-bit characters into ASCII characters; that is, any 16-bit character with a value of less than 0x0080 is converted to a single byte. Any character with a value greater than 0x007F canâ€™t be converted, so that characterâ€™s value is lost. For strings consisting of characters in the ASCII range (0x00 to 0x7F), this encoding compresses the data in half and is very fast (because the high byte is just cut off). This encoding isnâ€™t appropriate if you have characters outside of the ASCII range because the characterâ€™s values will be lost.</p></li></ul></blockquote><blockquote><p>Finally, the FCL also allows you to encode 16-bit characters to an arbitrary code page. As with the ASCII encoding, encoding to a code page is dangerous because any character whose value canâ€™t be expressed in the specified code page is lost. You should always use UTF-16 or UTF-8 encoding unless you must work with some legacy files or applications that already use one of the other encodings.</p></blockquote><blockquote><p>When you need to encode or decode a set of characters, you should obtain an instance of a class derived from System.Text.Encoding. Encoding is an abstract base class that offers several static readonly properties, each of which returns an instance of an Encoding-derived class.</p></blockquote><blockquote><p>Hereâ€™s an example that encodes and decodes characters by using UTF-8.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token comment">// This is the string we're going to encode. </span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">"Hi there."</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token comment">// Obtain an Encoding-derived object that knows how </span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token comment">// to encode/decode using UTF8 </span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token class-name">Encoding</span> encodingUTF8 <span class="token operator">=</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token comment">// Encode a string into an array of bytes. </span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token class-name">Byte<span class="token punctuation">[</span><span class="token punctuation">]</span></span> encodedBytes <span class="token operator">=</span> encodingUTF8<span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token comment">// Show the encoded byte values. </span></pre></td></tr><tr><td data-num="13"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Encoded bytes: "</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> BitConverter<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>encodedBytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token comment">// Decode the byte array back to a string. </span></pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token class-name">String</span> decodedString <span class="token operator">=</span> encodingUTF8<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>encodedBytes<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token comment">// Show the decoded string. </span></pre></td></tr><tr><td data-num="18"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"Decoded string: "</span> <span class="token operator">+</span> decodedString<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>This code yields the following output.</p></blockquote><pre><code class="language-cmd">Encoded bytes: 48-69-20-74-68-65-72-65-2E 
Decoded string: Hi there.
</code></pre><blockquote><p>In addition to the UTF8 static property, the Encoding class also offers the following static properties: Unicode, BigEndianUnicode, UTF32, UTF7, ASCII, and Default. The Default property returns an object that is able to encode/decode using the userâ€™s code page as specified by the Language For Non-Unicode Programs option of the Region/Administrative dialog box in Control Panel. (See the GetACP Win32 function for more information.) However, using the Default property is discouraged because your applicationâ€™s behavior would be machine-setting dependent, so if you change the systemâ€™s default code page or if your application runs on another machine, your application will behave differently.</p></blockquote><blockquote><p>In addition to these properties, Encoding also offers a static GetEncoding method that allows you to specify a code page (by integer or by string) and returns an object that can encode/decode using the specified code page. You can call GetEncoding, passing &quot;Shift-JIS&quot; or 932, for example.</p></blockquote><blockquote><p>When you first request an encoding object, the Encoding classâ€™s property or GetEncoding method constructs a single object for the requested encoding and returns this object. If an alreadyrequested encoding object is requested in the future, the encoding class simply returns the object it previously constructed; it doesnâ€™t construct a new object for each request. This efficiency reduces the number of objects in the system and reduces pressure in the garbage-collected heap.</p></blockquote><blockquote><p>Instead of calling one of Encodingâ€™s static properties or its GetEncoding method, you could also construct an instance of one of the following classes: System.Text.UnicodeEncoding, System.Text.UTF8Encoding, System.Text.UTF32Encoding, System.Text.UTF7Encoding, or System.Text.ASCIIEncoding. However, keep in mind that constructing any of these classes creates new objects in the managed heap, which hurts performance.</p></blockquote><blockquote><p>Four of these classes, UnicodeEncoding, UTF8Encoding, UTF32Encoding, and UTF7Encoding, offer multiple constructors, providing you with more control over the encoding and preamble. (Preamble is sometimes referred to as a byte order mark or BOM.) The first three aforementioned classes also offer constructors that let you tell the class to throw exceptions when decoding an invalid byte sequence; you should use these constructors when you want your application to be secure and resistant to invalid incoming data.</p></blockquote><blockquote><p>You might want to explicitly construct instances of these encoding types when working with a BinaryWriter or a StreamWriter. The ASCIIEncoding class has only a single constructor and therefore doesnâ€™t offer any more control over the encoding. If you need an ASCIIEncoding object, always obtain it by querying Encodingâ€™s ASCII property; this returns a reference to a single ASCIIEncoding object. If you construct ASCIIEncoding objects yourself, you are creating more objects on the heap, which hurts your applicationâ€™s performance.</p></blockquote><blockquote><p>After you have an Encoding-derived object, you can convert a string or an array of characters to an array of bytes by calling the GetBytes method. (Several overloads of this method exist.) To convert an array of bytes to an array of characters or a string, call the GetChars method or the more useful GetString method. (Several overloads exist for both of these methods.) The preceding code demonstrated calls to the GetBytes and GetString methods.</p></blockquote><blockquote><p>All Encoding-derived types offer a GetByteCount method that obtains the number of bytes necessary to encode a set of characters without actually encoding. Although GetByteCount isnâ€™t especially useful, you can use this method to allocate an array of bytes. Thereâ€™s also a GetCharCount method that returns the number of characters that would be decoded without actually decoding them. These methods are useful if youâ€™re trying to save memory and reuse an array.</p></blockquote><blockquote><p>The GetByteCount/GetCharCount methods arenâ€™t that fast because they must analyze the array of characters/bytes in order to return an accurate result. If you prefer speed to an exact result, you can call the GetMaxByteCount or GetMaxCharCount method instead. Both methods take an integer specifying the number of bytes or number of characters and return a worst-case value.</p></blockquote><blockquote><p>Each Encoding-derived object offers a set of public read-only properties that you can query to obtain detailed information about the encoding. See the .NET Framework SDK documentation for a description of these properties.</p></blockquote><blockquote><p>To illustrate most of the properties and their meanings, I wrote the following program that displays the property values for several different encodings.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">EncodingInfo</span> ei <span class="token keyword">in</span> Encoding<span class="token punctuation">.</span><span class="token function">GetEncodings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token class-name">Encoding</span> e <span class="token operator">=</span> ei<span class="token punctuation">.</span><span class="token function">GetEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"&#123;1&#125;&#123;0&#125;"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token string">"\tCodePage=&#123;2&#125;, WindowsCodePage=&#123;3&#125;&#123;0&#125;"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token string">"\tWebName=&#123;4&#125;, HeaderName=&#123;5&#125;, BodyName=&#123;6&#125;&#123;0&#125;"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token string">"\tIsBrowserDisplay=&#123;7&#125;, IsBrowserSave=&#123;8&#125;&#123;0&#125;"</span> <span class="token operator">+</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token string">"\tIsMailNewsDisplay=&#123;9&#125;, IsMailNewsSave=&#123;10&#125;&#123;0&#125;"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> Environment<span class="token punctuation">.</span>NewLine<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> e<span class="token punctuation">.</span>EncodingName<span class="token punctuation">,</span> e<span class="token punctuation">.</span>CodePage<span class="token punctuation">,</span> e<span class="token punctuation">.</span>WindowsCodePage<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> e<span class="token punctuation">.</span>WebName<span class="token punctuation">,</span> e<span class="token punctuation">.</span>HeaderName<span class="token punctuation">,</span> e<span class="token punctuation">.</span>BodyName<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> e<span class="token punctuation">.</span>IsBrowserDisplay<span class="token punctuation">,</span> e<span class="token punctuation">.</span>IsBrowserSave<span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="16"></td><td><pre> e<span class="token punctuation">.</span>IsMailNewsDisplay<span class="token punctuation">,</span> e<span class="token punctuation">.</span>IsMailNewsSave<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Running this program yields the following output (abridged to conserve paper).</p></blockquote><pre><code class="language-cmd">IBM EBCDIC (US-Canada) 
 CodePage=37, WindowsCodePage=1252 
 WebName=IBM037, HeaderName=IBM037, BodyName=IBM037 
 IsBrowserDisplay=False, IsBrowserSave=False 
 IsMailNewsDisplay=False, IsMailNewsSave=False 
OEM United States 
 CodePage=437, WindowsCodePage=1252 
 WebName=IBM437, HeaderName=IBM437, BodyName=IBM437 
 IsBrowserDisplay=False, IsBrowserSave=False 
 IsMailNewsDisplay=False, IsMailNewsSave=False 
IBM EBCDIC (International) 
 CodePage=500, WindowsCodePage=1252 
 WebName=IBM500, HeaderName=IBM500, BodyName=IBM500 
 IsBrowserDisplay=False, IsBrowserSave=False 
 IsMailNewsDisplay=False, IsMailNewsSave=False 
Arabic (ASMO 708) 
 CodePage=708, WindowsCodePage=1256 
 WebName=ASMO-708, HeaderName=ASMO-708, BodyName=ASMO-708 
 IsBrowserDisplay=True, IsBrowserSave=True 
 IsMailNewsDisplay=False, IsMailNewsSave=False 
Unicode 
 CodePage=1200, WindowsCodePage=1200 
 WebName=utf-16, HeaderName=utf-16, BodyName=utf-16 
 IsBrowserDisplay=False, IsBrowserSave=True 
 IsMailNewsDisplay=False, IsMailNewsSave=False 
Unicode (Big-Endian) 
 CodePage=1201, WindowsCodePage=1200 
 WebName=unicodeFFFE, HeaderName=unicodeFFFE, BodyName=unicodeFFFE 
 IsBrowserDisplay=False, IsBrowserSave=False 
 IsMailNewsDisplay=False, IsMailNewsSave=False 
Western European (DOS) 
 CodePage=850, WindowsCodePage=1252 
 WebName=ibm850, HeaderName=ibm850, BodyName=ibm850 
 IsBrowserDisplay=False, IsBrowserSave=False 
 IsMailNewsDisplay=False, IsMailNewsSave=False 
Unicode (UTF-8) 
 CodePage=65001, WindowsCodePage=1200 
 WebName=utf-8, HeaderName=utf-8, BodyName=utf-8 
 IsBrowserDisplay=True, IsBrowserSave=True 
 IsMailNewsDisplay=True, IsMailNewsSave=True
</code></pre><blockquote><p>Table 14-3 covers the most commonly used methods offered by all Encoding-derived classes.</p></blockquote><p><img data-src="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/image-20221116115931131-1668742125902-11.png" alt="image-20221116115931131"></p><h3 id="encoding-and-decoding-streams-of-characters-and-bytes"><a class="anchor" href="#encoding-and-decoding-streams-of-characters-and-bytes">#</a> Encoding and Decoding Streams of Characters and Bytes</h3><blockquote><p>Imagine that youâ€™re reading a UTF-16 encoded string via a System.Net.Sockets.NetworkStream object. The bytes will very likely stream in as chunks of data. In other words, you might first read 5 bytes from the stream, followed by 7 bytes. In UTF-16, each character consists of 2 bytes. So calling Encodingâ€™s GetString method passing the first array of 5 bytes will return a string consisting of just two characters. If you later call GetString, passing in the next 7 bytes that come in from the stream, GetString will return a string consisting of three characters, and all of the code points will have the wrong values!</p></blockquote><blockquote><p>This data corruption problem occurs because none of the Encoding-derived classes maintains any state in between calls to their methods. If youâ€™ll be encoding or decoding characters/bytes in chunks, you must do some additional work to maintain state between calls, preventing any loss of data.</p></blockquote><blockquote><p>To decode chunks of bytes, you should obtain a reference to an Encoding-derived object (as described in the previous section) and call its GetDecoder method. This method returns a reference to a newly constructed object whose type is derived from the System.Text.Decoder class. Like the Encoding class, the Decoder class is an abstract base class. If you look in the .NET Framework SDK documentation, you wonâ€™t find any classes that represent concrete implementations of the Decoder class. However, the FCL does define a bunch of Decoder-derived classes. These classes are all internal to the FCL, but the GetDecoder method can construct instances of these classes and return them to your application code.</p></blockquote><blockquote><p>All Decoder-derived classes offer two important methods: GetChars and GetCharCount. Obviously, these methods are used for decoding an array of bytes and work similarly to Encodingâ€™s GetChars and GetCharCount methods, discussed earlier. When you call one of these methods, it decodes the byte array as much as possible. If the byte array doesnâ€™t contain enough bytes to complete a character, the leftover bytes are saved inside the decoder object. The next time you call one of these methods, the decoder object uses the leftover bytes plus the new byte array passed to itâ€”this ensures that the chunks of data are decoded properly. Decoder objects are very useful when reading bytes from a stream.</p></blockquote><blockquote><p>An Encoding-derived type can be used for stateless encoding and decoding. However, a Decoderderived type can be used only for decoding. If you want to encode strings in chunks, call GetEncoder instead of calling the Encoding objectâ€™s GetDecoder method. GetEncoder returns a newly constructed object whose type is derived from the abstract base class System.Text.Encoder. Again, the .NET Framework SDK documentation doesnâ€™t contain any classes representing concrete implementations of the Encoder class. However, the FCL does define some Encoder-derived classes. As with the Decoderderived classes, these classes are all internal to the FCL, but the GetEncoder method can construct instances of these classes and return them to your application code.</p></blockquote><blockquote><p>All Encoder-derived classes offer two important methods: GetBytes and GetByteCount. On each call, the Encoder-derived object maintains any leftover state information so that you can encode data in chunks.</p></blockquote><h3 id="base-64-string-encoding-and-decoding"><a class="anchor" href="#base-64-string-encoding-and-decoding">#</a> Base-64 String Encoding and Decoding</h3><blockquote><p>As of this writing, the UTF-16 and UTF-8 encodings are quite popular. It is also quite popular to encode a sequence of bytes to a base-64 string. The FCL does offer methods to do base-64 encoding and decoding, and you might expect that this would be accomplished via an Encoding-derived type. However, for some reason, base-64 encoding and decoding is done using some static methods offered by the System.Convert type.</p></blockquote><blockquote><p>To encode a base-64 string as an array of bytes, you call Convertâ€™s static FromBase64String or FromBase64CharArray method. Likewise, to decode an array of bytes as a base-64 string, you call Convertâ€™s static ToBase64String or ToBase64CharArray method. The following code demonstrates how to use some of these methods.</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token comment">// Get a set of 10 randomly generated bytes </span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token class-name">Byte<span class="token punctuation">[</span><span class="token punctuation">]</span></span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Byte</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">NextBytes</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token comment">// Display the bytes </span></pre></td></tr><tr><td data-num="8"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>BitConverter<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token comment">// Decode the bytes into a base-64 string and show the string </span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token class-name">String</span> s <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">ToBase64String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="12"></td><td><pre> <span class="token comment">// Encode the base-64 string back to bytes and show the bytes </span></pre></td></tr><tr><td data-num="13"></td><td><pre> bytes <span class="token operator">=</span> Convert<span class="token punctuation">.</span><span class="token function">FromBase64String</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>BitConverter<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>Compiling this code and running the executable file produces the following output (your output might vary from mine because of the randomly generated bytes).</p></blockquote><pre><code class="language-cmd">3B-B9-27-40-59-35-86-54-5F-F1 
O7knQFk1hlRf8Q== 
3B-B9-27-40-59-35-86-54-5F-F1
</code></pre><p>ğŸ’¡å°ç»“ï¼šWin32 å¼€å‘äººå‘˜ç»å¸¸è¦å†™ä»£ç å°† Unicode å­—ç¬¦å’Œå­—ç¬¦ä¸²è½¬æ¢æˆ â€œå¤šå­—èŠ‚å­—ç¬¦é›†â€ï¼ˆMulti-Byte Character Setï¼ŒMBCSï¼‰æ ¼å¼ã€‚åœ¨ CLR ä¸­ï¼Œæ‰€æœ‰å­—ç¬¦éƒ½è¡¨ç¤ºæˆ 16 ä½ Unicode ç å€¼ï¼Œè€Œæ‰€æœ‰å­—ç¬¦ä¸²éƒ½æœ‰ 16 ä½ Unicode ç å€¼æ„æˆï¼Œè¿™ç®€åŒ–äº†è¿è¡Œæ—¶çš„å­—ç¬¦å’Œå­—ç¬¦ä¸²å¤„ç†ã€‚ä½†å¦‚æœå­—ç¬¦ä¸²ä¸­çš„å¤§å¤šæ•°å­—ç¬¦éƒ½æ˜¯è‹±è¯­ç”¨æˆ·ç”¨çš„ï¼Œé‚£ä¹ˆä¿å­˜æˆ–ä¼ è¾“ä¸€ç³»åˆ— 16 ä½å€¼ï¼Œæ•ˆç‡å°±æ˜¾å¾—ä¸é‚£ä¹ˆç†æƒ³ï¼Œå› ä¸ºå†™å…¥çš„åŠæ•°å­—èŠ‚éƒ½ç”±é›¶æ„æˆã€‚ç›¸åï¼Œæ›´æœ‰æ•ˆçš„åšæ³•æ˜¯å°† 16 ä½å€¼ç¼–ç æˆå‹ç¼©çš„å­—èŠ‚æ•°ç»„ï¼Œä»¥åå†å°†å­—èŠ‚æ•°ç»„è§£ç å› 16 ä½å€¼çš„æ•°ç»„ã€‚ <code>System.IO</code> æä¾›çš„ç±»å‹é»˜è®¤ä½¿ç”¨ UTF-8 ç¼–ç ã€‚FCL æä¾›äº†ä¸€äº›ç±»å‹æ¥ç®€åŒ–å­—ç¬¦ç¼–ç å’Œè§£ç ã€‚UTF-16 å°†æ¯ä¸ª 16 ä½å­—ç¬¦ç¼–ç æˆ 2 ä¸ªå­—èŠ‚ã€‚ä¸å¯¹å­—ç¬¦äº§ç”Ÿä»»ä½•å½±å“ï¼Œä¹Ÿä¸å‘ç”Ÿå‹ç¼© â€”â€” æ€§èƒ½éå¸¸å‡ºè‰²ã€‚UTF-16 ç¼–ç ä¹Ÿç§°ä¸º â€œUnicodeâ€ ç¼–ç ã€‚è¿˜è¦æ³¨æ„ï¼ŒUTF-16 å¯ç”¨äºä» â€œä½ä½ä¼˜å…ˆâ€ï¼ˆlittle-endianï¼‰è½¬æ¢æˆ â€œé«˜ä½ä¼˜å…ˆâ€ï¼ˆbig-endianï¼‰ï¼Œæˆ–è€…ä» â€œé«˜ä½ä¼˜å…ˆâ€ è½¬æ¢æˆ â€œä½ä½ä¼˜å…ˆ â€œã€‚UTF-8 å°†éƒ¨åˆ†å­—ç¬¦ç¼–ç æˆ 1 ä¸ªå­—èŠ‚ï¼Œéƒ¨åˆ†ç¼–ç æˆ 2 ä¸ªå­—èŠ‚ï¼Œéƒ¨åˆ†ç¼–ç æˆ 3 ä¸ªå­—èŠ‚ï¼Œå†æœ‰éƒ¨åˆ†ç¼–ç æˆ 4 ä¸ªå­—èŠ‚ã€‚æœ€åï¼Œä»£ç†é¡¹å¯¹ï¼ˆsurrogate pairï¼‰è¡¨ç¤ºæˆ 4 ä¸ªå­—èŠ‚ã€‚UTF-8 ç¼–ç æ–¹æ³•éå¸¸æµè¡Œï¼Œä½†å¦‚æœç¼–ç çš„è®¸å¤šå­—ç¬¦éƒ½å…·æœ‰ 0x0800 æˆ–è€…ä¹‹ä¸Šçš„å€¼ï¼Œæ•ˆç‡åè€Œä¸å¦‚ UTF-16ã€‚UTF-16 å’Œ UTF-8 ç¼–ç æ˜¯ç›®å‰æœ€å¸¸ç”¨çš„ç¼–ç æ–¹æ³•ï¼Œæ­¤å¤– FCL è¿˜æ”¯æŒä¸å¸¸ç”¨çš„ UTF-32ã€UTF-7 ä»¥åŠ ASCII ç¼–ç ã€‚ASCII ç¼–ç æ–¹æ³•å°† 16 ä½å­—ç¬¦ç¼–ç æˆ ASCII å­—ç¬¦ã€‚æœ€åï¼ŒFCL è¿˜å…è®¸å°† 1 ä½å­—ç¬¦ç¼–ç åˆ°ä»»æ„ä»£ç é¡µã€‚å’Œ ASCII ä¸€æ ·ï¼Œç¼–ç åˆ°ä»£ç é¡µä¹Ÿæ˜¯å±é™©çš„ï¼Œå› ä¸ºä»£ç é¡µè¡¨ç¤ºä¸äº†çš„ä»»ä½•å­—ç¬¦éƒ½ä¼šä¸¢å¤±ã€‚é™¤éå¿…é¡»å’Œä½¿ç”¨å…¶ä»–ç¼–ç æ–¹æ¡ˆçš„é—ç•™æ–‡ä»¶æˆ–åº”ç”¨ç¨‹åºå…¼å®¹ï¼Œå¦åˆ™åº”è¯¥æ€»æ˜¯é€‰æ‹© UTF-16 æˆ– UTF-8 ç¼–ç ã€‚è¦ç¼–ç æˆ–è§£ç ä¸€ç»„å­—ç¬¦æ—¶ï¼Œåº”è·å–ä» <code>System.Text.Encoding</code> æ´¾ç”Ÿçš„ä¸€ä¸ªç±»çš„å®ä¾‹ã€‚é¦–æ¬¡è¯·æ±‚ä¸€ä¸ªç¼–ç å¯¹è±¡æ—¶ï¼Œ <code>Encoding</code> ç±»çš„å±æ€§æˆ–è€… <code>GetEncoding</code> æ–¹æ³•ä¼šä¸ºè¯·æ±‚çš„ç¼–ç æ–¹æ³•æ„é€ å¯¹è±¡ï¼Œå¹¶è¿”å›è¯¥å¯¹è±¡ã€‚å‡å¦‚è¯·æ±‚çš„ç¼–ç å¯¹è±¡ä»¥å‰è¯·æ±‚è¿‡ï¼Œ <code>Encoding</code> ç±»å›ç›´æ¥è¿”å›ä¹‹å‰æ„é€ å¥½çš„å¯¹è±¡ï¼›ä¸ä¼šä½æ¯ä¸ªè¯·æ±‚éƒ½æ„é€ æ–°å¯¹è±¡ã€‚é™¤äº†è°ƒç”¨ <code>Encoding</code> çš„æŸä¸ªé™æ€å±æ€§æˆ–è€…å®ƒçš„ <code>GetEncoding</code> æ–¹æ³•ï¼Œè¿˜å¯ä»¥æ„é€ å…·ä½“çš„ä¸€äº›ç¼–ç ç±»ï¼Œå®ƒä»¬æä¾›äº†å¤šä¸ªæ„é€ å™¨ï¼Œå…è®¸å¯¹ç¼–ç çš„å‰å¯¼ç è¿›è¡Œæ›´å¤šçš„æ§åˆ¶ï¼ˆè¿”å›ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼ŒæŒ‡å‡ºåœ¨å†™å…¥ä»»ä½•å·²ç¼–ç å­—èŠ‚ä¹‹å‰ï¼Œé¦–å…ˆåº”è¯¥åœ¨ä¸€ä¸ªæµä¸­å†™å…¥ä»€ä¹ˆå­—èŠ‚ï¼Œè¿™äº›å­—èŠ‚ç»å¸¸ç§°ä¸ºå‰å¯¼ç ï¼ˆpreambleï¼‰æˆ– â€œå­—èŠ‚é¡ºåºæ ‡è®°â€ï¼Œå³ Byte Order Mark æˆ–è€… BOMï¼Œå¼€å§‹ä»ä¸€ä¸ªæµä¸­è¯»å–æ—¶ï¼ŒBOM å­—èŠ‚è‡ªåŠ¨å¸®åŠ©æ£€æµ‹å½“åˆå†™å…¥æµæ—¶é‡‡ç”¨çš„ç¼–ç ï¼Œä»¥ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„è§£ç å™¨ï¼‰ã€‚ä½† <code>ASCIIEncoding</code> ç±»ä»…ä¸€ä¸ªæ„é€ å™¨ï¼Œæ²¡æœ‰æä¾›æ›´å¤šçš„ç¼–ç æ§åˆ¶ã€‚æ‰€ä»¥å¦‚æœéœ€è¦ <code>ASCIIEncoding</code> å¯¹è±¡ï¼Œæœ€å¥½æŸ¥è¯¢ <code>Encoding</code> çš„ <code>ASCII</code> å±æ€§æ¥è·å¾—ã€‚è‡ªå·±æ„é€  <code>ASCIIEncoding</code> å¯¹è±¡ä¼šåœ¨å †ä¸Šåˆ›å»ºæ›´å¤šçš„å¯¹è±¡ï¼Œæ— è°“åœ°æŸå®³åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚å­—èŠ‚æµé€šå¸¸ä»¥æ•°æ®å—ï¼ˆdata chunkï¼‰çš„å½¢å¼ä¼ è¾“ã€‚ä½† UTF-16 çš„æ¯ä¸ªå­—ç¬¦éƒ½ç”± 2 ä¸ªå­—èŠ‚æ„æˆï¼Œæ‰€ä»¥å¯èƒ½å›å‡ºç°æ•°æ®æŸåï¼Œæ˜¯ç”±äºæ‰€æœ‰ <code>Encoding</code> æ´¾ç”Ÿéƒ½ä¸ç»´æŠ¤å¤šä¸ªæ–¹æ³•è°ƒç”¨ä¹‹é—´çš„çŠ¶æ€ã€‚è¦ç¼–ç æˆ–è§£ç ä»¥æ•°æ®å—å½¢å¼ä¼ è¾“çš„å­—ç¬¦ / å­—èŠ‚ï¼Œå¿…é¡»è¿›è¡Œä¸€äº›é¢å¤–çš„å·¥ä½œæ¥ç»´æŠ¤æ–¹æ³•è°ƒç”¨ä¹‹é—´çš„çŠ¶æ€ï¼Œä»è€Œé˜²æ­¢ä¸¢å¤±æ•°æ®ã€‚å­—ç¬¦å—è§£ç é¦–å…ˆè¦è·å–ä¸€ä¸ª <code>Encoding</code> æ´¾ç”Ÿå¯¹è±¡å¼•ç”¨ï¼Œåœ¨è°ƒç”¨å…¶ <code>GetDecoder</code> æ–¹æ³•ã€‚æ–¹æ³•è¿”å›å¯¹ä¸€ä¸ªæ–°æ„é€ å¯¹è±¡çš„å¼•ç”¨ï¼Œè¯¥å¯¹è±¡çš„ç±»å‹ä» <code>System.Text.Decoder</code> ç±»æ´¾ç”Ÿã€‚å’Œ <code>Encoding</code> ç±»ä¸€æ ·ï¼Œ <code>Decoder</code> ä¹Ÿæ˜¯æŠ½è±¡åŸºç±»ã€‚ <code>Decoder</code> çš„æ‰€æœ‰æ´¾ç”Ÿç±»éƒ½æä¾›äº†ä¸¤ä¸ªé‡è¦çš„æ–¹æ³•ï¼š <code>GetChars</code> å’Œ <code>GetCharCount</code> ã€‚è°ƒç”¨å…¶ä¸­ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå®ƒä¼šå°½å¯èƒ½å¤šåœ°è§£æå­—èŠ‚æ•°ç»„ã€‚å‡å¦‚å­—èŠ‚æ•°ç»„åŒ…å«çš„å­—èŠ‚ä¸è¶³ä»¥å®Œæˆä¸€ä¸ªå­—ç¬¦ï¼Œå‰©ä½™çš„å­—èŠ‚ä¼šä¿å­˜åˆ° <code>Decoder</code> å¯¹è±¡å†…éƒ¨ã€‚ä¸‹æ¬¡è°ƒç”¨å…¶ä¸­ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œ <code>Decoder</code> å¯¹è±¡ä¼šåˆ©ç”¨ä¹‹å‰å‰©ä½™çš„å­—èŠ‚å†åŠ ä¸Šä¼ ç»™å®ƒçš„æ–°å­—èŠ‚æ•°ç»„ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥ç¡®ä¿å¯¹æ•°æ®å—è¿›è¡Œæ­£ç¡®è§£ç ã€‚ä» <code>Encoding</code> æ´¾ç”Ÿçš„ç±»å‹å¯ç”¨äºæ— çŠ¶æ€ï¼ˆä¸­é€”ä¸ä¿æŒçŠ¶æ€ï¼‰ç¼–ç å’Œè§£ç ã€‚è€Œä» <code>Decoder</code> æ´¾ç”Ÿçš„ç±»å‹åªèƒ½ç”¨äºè§£ç ã€‚ä»¥æˆå—çš„æ–¹å¼ç¼–ç å­—ç¬¦ä¸²éœ€è¦è°ƒç”¨ <code>GetEncoder</code> æ–¹æ³•ï¼Œè€Œä¸æ˜¯è°ƒç”¨ <code>Encoding</code> å¯¹è±¡çš„ <code>GetDecoder</code> æ–¹æ³•ã€‚å’Œä» <code>Decoder</code> æ´¾ç”Ÿçš„ç±»ä¸€æ ·ï¼Œè¿™äº›ç±»å…¨éƒ¨å† FCL å†…éƒ¨ä½¿ç”¨ï¼Œåªæ˜¯ <code>GetEncoder</code> æ–¹æ³•èƒ½æ„é€ è¿™äº›ç±»çš„å®ä¾‹ï¼Œå¹¶å°†è¿™äº›å®ä¾‹è¿”å›ç»™åº”ç”¨ç¨‹åºä»£ç ã€‚å¦ä¸€ä¸ªæµè¡Œçš„æ–¹æ¡ˆæ˜¯å°†å­—èŠ‚åºåˆ—ç¼–ç æˆ Base-64 å­—ç¬¦ä¸²ã€‚Base-64 ç¼–ç å’Œè§£ç ç”¨ <code>System.Convert</code> ç±»å‹æä¾›çš„ä¸€äº›é™æ€æ–¹æ³•æ¥è¿›è¡Œã€‚</p><h2 id="secure-strings"><a class="anchor" href="#secure-strings">#</a> Secure Strings</h2><blockquote><p>Often, String objects are used to contain sensitive data such as a userâ€™s password or credit-card information. Unfortunately, String objects contain an array of characters in memory, and if some unsafe or unmanaged code is allowed to execute, the unsafe/unmanaged code could snoop around the processâ€™s address space, locate the string containing the sensitive information, and use this data in an unauthorized way. Even if the String object is used for just a short time and then garbage collected, the CLR might not immediately reuse the String objectâ€™s memory (especially if the String object was in an older generation), leaving the Stringâ€™s characters in the processâ€™s memory, where the information could be compromised. In addition, because strings are immutable, as you manipulate them, the old copies linger in memory and you end up with different versions of the string scattered all over memory.</p></blockquote><blockquote><p>Some governmental departments have stringent security requirements that require very specific security guarantees. To meet these requirements, Microsoft added a more secure string class to the FCL: System.Security.SecureString. When you construct a SecureString object, it internally allocates a block of unmanaged memory that contains an array of characters. Unmanaged memory is used so that the garbage collector isnâ€™t aware of it.</p></blockquote><blockquote><p>These stringâ€™s characters are encrypted, protecting the sensitive information from any malicious unsafe/unmanaged code. You can append, insert, remove, or set a character in the secure string by using any of these methods: AppendChar, InsertAt, RemoveAt, and SetAt. Whenever you call any of these methods, internally, the method decrypts the characters, performs the operation in place, and then re-encrypts the characters. This means that the characters are in an unencrypted state for a very short period of time. This also means that the performance of each operation is less than stellar, so you should perform as few of these operations as possible.</p></blockquote><blockquote><p>The SecureString class implements the IDisposable interface to provide an easy way to deterministically destroy the stringâ€™s secured contents. When your application no longer needs the sensitive string information, you simply call SecureStringâ€™s Dispose method or use a SecureString instance in a using construct. Internally, Dispose zeroes out the contents of the memory buffer to make sure that the sensitive information is not accessible to malicious code, and then the buffer is freed. Internally, a SecureString object has a field to a SafeBuffer-derived object, which maintains the actual string. Because the SafeBuffer class is ultimately derived from CriticalFinalizerObject, discussed in Chapter 21, â€œThe Managed Heap and Garbage Collection,â€ the stringâ€™s characters are guaranteed to be zeroed out and have its buffer freed when it is finalized. Unlike a String object, when a SecureString object is finalized, the encrypted stringâ€™s characters will no longer be in memory.</p></blockquote><blockquote><p>Now that you know how to create and modify a SecureString object, letâ€™s talk about how to use one. Unfortunately, the most recent FCL has limited support for the SecureString class. In other words, there are only a few methods that accept a SecureString argument. In the .NET Framework 4, you can pass a SecureString as a password when</p><ul><li><p>Working with a cryptographic service provider (CSP). See the System.Security.Cryptography.CspParameters class.</p></li><li><p>Creating, importing, or exporting an X.509 certificate. See the System.Security.Cryptography.X509Certificates.X509Certificate and System.Security.Cryptography. X509Certificates.X509Certificate2 classes.</p></li><li><p>Starting a new process under a specific user account. See the System.Diagnostics. Process and System.Diagnostics.ProcessStartInfo classes.</p></li><li><p>Constructing an event log session. See the System.Diagnostics.Eventing.Reader. EventLogSession class.</p></li><li><p>Using the System.Windows.Controls.PasswordBox control. See this classâ€™s SecurePassword property.</p></li></ul></blockquote><blockquote><p>Finally, you can create your own methods that can accept a SecureString object parameter. Inside your method, you must have the SecureString object create an unmanaged memory buffer that contains the decrypted characters before your method uses the buffer. To keep the window of opportunity for malicious code to access the sensitive data as small as possible, your code should require access to the decrypted string for as short a period of time as possible. When finished using the string, your code should zero the buffer and free it as soon as possible. Also, never put the contents of a SecureString into a String: if you do, the String lives unencrypted in the heap and will not have its characters zeroed out until the memory is reused after a garbage collection. The SecureString class does not override the ToString method specifically to avoid exposing the sensitive data (which converting it to a String would do).</p></blockquote><blockquote><p>Here is some sample code demonstrating how to initialize and use a SecureString (when compiling this, youâ€™ll need to specify the /unsafe switch to the C# compiler).</p></blockquote><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Security</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>InteropServices</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SecureString</span> ss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SecureString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="7"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"Please enter password: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token class-name">ConsoleKeyInfo</span> cki <span class="token operator">=</span> Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>cki<span class="token punctuation">.</span>Key <span class="token operator">==</span> ConsoleKey<span class="token punctuation">.</span>Enter<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token comment">// Append password characters into the SecureString </span></pre></td></tr><tr><td data-num="12"></td><td><pre> ss<span class="token punctuation">.</span><span class="token function">AppendChar</span><span class="token punctuation">(</span>cki<span class="token punctuation">.</span>KeyChar<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="13"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="15"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="16"></td><td><pre> <span class="token comment">// Password entered, display it for demonstration purposes </span></pre></td></tr><tr><td data-num="17"></td><td><pre> <span class="token function">DisplaySecureString</span><span class="token punctuation">(</span>ss<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="19"></td><td><pre> <span class="token comment">// After 'using', the SecureString is Disposed; no sensitive data in memory </span></pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="21"></td><td><pre> <span class="token comment">// This method is unsafe because it accesses unmanaged memory </span></pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token keyword">private</span> <span class="token keyword">unsafe</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DisplaySecureString</span><span class="token punctuation">(</span><span class="token class-name">SecureString</span> ss<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="23"></td><td><pre> Char<span class="token operator">*</span> pc <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token keyword">try</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token comment">// Decrypt the SecureString into an unmanaged memory buffer </span></pre></td></tr><tr><td data-num="26"></td><td><pre> pc <span class="token operator">=</span> <span class="token punctuation">(</span>Char<span class="token operator">*</span><span class="token punctuation">)</span> Marshal<span class="token punctuation">.</span><span class="token function">SecureStringToCoTaskMemUnicode</span><span class="token punctuation">(</span>ss<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token comment">// Access the unmanaged memory buffer that </span></pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token comment">// contains the decrypted SecureString </span></pre></td></tr><tr><td data-num="29"></td><td><pre> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Int32</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> pc<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="30"></td><td><pre> Console<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>pc<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="31"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="32"></td><td><pre> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="33"></td><td><pre> <span class="token comment">// Make sure we zero and free the unmanaged memory buffer that contains </span></pre></td></tr><tr><td data-num="34"></td><td><pre> <span class="token comment">// the decrypted SecureString characters </span></pre></td></tr><tr><td data-num="35"></td><td><pre> <span class="token keyword">if</span> <span class="token punctuation">(</span>pc <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="36"></td><td><pre> Marshal<span class="token punctuation">.</span><span class="token function">ZeroFreeCoTaskMemUnicode</span><span class="token punctuation">(</span><span class="token punctuation">(</span>IntPtr<span class="token punctuation">)</span> pc<span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="37"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="38"></td><td><pre> <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>The System.Runtime.InteropServices.Marshal class offers five methods that you can call to decrypt a SecureStringâ€™s characters into an unmanaged memory buffer. All of these methods are static, all accept a SecureString argument, and all return an IntPtr. Each of these methods has a corresponding method that you must call in order to zero the internal buffer and free it. Table 14-4 shows the System.Runtime.InteropServices.Marshal classâ€™s methods to decrypt a SecureString into a memory buffer and the corresponding method to zero and free the buffer.</p></blockquote><p><img data-src="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/image-20221117101318334-1668742125901-10.png" alt="image-20221117101318334"></p><p>ğŸ’¡å°ç»“ï¼šString å¯¹è±¡åœ¨å†…å­˜ä¸­åŒ…å«ä¸€ä¸ªå­—ç¬¦æ•°ç»„ã€‚å¦‚æœå…è®¸æ‰§è¡Œä¸å®‰å…¨æˆ–è€…éæ‰˜ç®¡çš„ä»£ç ï¼Œè¿™äº›ä»£ç å°±å¯ä»¥æ‰«æè¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œæ‰¾åˆ°åŒ…å«æ•æ„Ÿæ•°æ®çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä»¥éæˆæƒçš„æ–¹å¼åŠ ä»¥åˆ©ç”¨ã€‚Microsoft åœ¨ FCL ä¸­å¢æ·»äº†ä¸€ä¸ªæ›´å®‰å…¨çš„å­—ç¬¦ä¸²ç±»ï¼Œå³ <code>System.Security.SecureString</code> ã€‚æ„é€  <code>SecureString</code> å¯¹è±¡æ—¶ï¼Œä¼šåœ¨å†…éƒ¨åˆ†é…ä¸€ä¸ªéæ‰˜ç®¡å†…å­˜å—ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå­—ç¬¦æ•°ç»„ã€‚ä½¿ç”¨éæ‰˜ç®¡å†…å­˜æ˜¯ä¸ºäº†é¿å¼€åƒåœ¾å›æ”¶å™¨çš„ â€œé­”çˆªâ€ã€‚è¿™äº›å­—ç¬¦ä¸²çš„å­—ç¬¦æ˜¯ç»è¿‡åŠ å¯†çš„ï¼Œèƒ½é˜²èŒƒä»»ä½•æ¶æ„çš„éå®‰å…¨ / éæ‰˜ç®¡ä»£ç è·å–æœºå¯†ä¿¡æ¯ã€‚å¯åœ¨å®‰å…¨å­—ç¬¦ä¸²ä¸­é™„åŠ ã€æ’å…¥ã€åˆ é™¤æˆ–è€…è®¾ç½®ä¸€ä¸ªå­—ç¬¦ã€‚è°ƒç”¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œæ–¹æ³•å†…éƒ¨ä¼šè§£å¯†å­—ç¬¦ï¼Œæ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼Œå†é‡æ–°åŠ å¯†å­—ç¬¦ã€‚è¿™æ„å‘³ç€å­—ç¬¦æœ‰ä¸€å°æ®µæ—¶é—´å¤„äºæœªåŠ å¯†çŠ¶æ€ã€‚è¿˜æ„å‘³ç€è¿™äº›æ“ä½œçš„æ€§èƒ½ä¼šæ¯”è¾ƒä¸€èˆ¬ã€‚æ‰€ä»¥ï¼Œåº”è¯¥å°½å¯èƒ½å°‘åœ°æ‰§è¡Œè¿™äº›æ“ä½œã€‚ <code>SecureString</code> ç±»å®ç°äº† <code>IDisposable</code> æ¥å£ï¼Œå…è®¸ä»¥ç®€å•çš„æ–¹å¼ç¡®å®šæ€§åœ°æ‘§æ¯å­—ç¬¦ä¸²ä¸­çš„å®‰å…¨å†…å®¹ã€‚åº”ç”¨ç¨‹åºä¸å†éœ€è¦æ•æ„Ÿçš„å­—ç¬¦ä¸²å†…å®¹æ—¶ï¼Œåªéœ€è°ƒç”¨ <code>SecureString</code> çš„ <code>Dispose</code> æ–¹æ³•ã€‚åœ¨å†…éƒ¨ï¼Œ <code>Disposse</code> ä¼šå¯¹å†…å­˜ç¼“å­˜åŒºçš„å†…å®¹è¿›è¡Œæ¸…é›¶ï¼Œç¡®ä¿æ¶æ„ä»£ç æ— æ³•è·å¾—æ•æ„Ÿä¿¡æ¯ï¼Œç„¶åé‡Šæ”¾ç¼“å†²åŒºã€‚ <code>SecureString</code> å¯¹è±¡å†…éƒ¨çš„ä¸€ä¸ªå­—æ®µå¼•ç”¨äº†ä¸€ä¸ªä» <code>SafeBuffer</code> æ´¾ç”Ÿçš„å¯¹è±¡ï¼Œå®ƒè´Ÿè´£ç»´æŠ¤å®é™…çš„å­—ç¬¦ä¸²ã€‚ç”±äº <code>SafeBuffer</code> ç±»æœ€ç»ˆä» <code>CriticalFinalizerObject</code> ç±»æ´¾ç”Ÿï¼Œæ‰€ä»¥å­—ç¬¦ä¸²åœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œå®ƒçš„å­—ç¬¦å†…å®¹ä¿è¯ä¼šè¢«æ¸…é›¶ï¼Œè€Œä¸”ç¼“å†²åŒºä¼šå¾—åˆ°é‡Šæ”¾ã€‚å’Œ String å¯¹è±¡ä¸åŒï¼Œ <code>SecureString</code> å¯¹è±¡åœ¨è¢«å›æ”¶ä¹‹åï¼ŒåŠ å¯†å­—ç¬¦ä¸²çš„å†…å®¹ä¸å†å­˜åœ¨äºå†…å­˜ä¸­ã€‚å¯ä»¥åˆ›å»ºè‡ªå·±çš„æ–¹æ³•æ¥æ¥å— <code>SecureString</code> å¯¹è±¡å‚æ•°ã€‚æ–¹æ³•å†…éƒ¨å¿…é¡»å…ˆè®© <code>SecureString</code> å¯¹è±¡åˆ›å»ºä¸€ä¸ªéæ‰˜ç®¡å†…å­˜ç¼“å†²åŒºï¼Œå®ƒå°†ç”¨äºåŒ…å«è§£å¯†è¿‡çš„å­—ç¬¦ï¼Œç„¶åæ‰èƒ½è®©è¯¥æ–¹æ³•ä½¿ç”¨ç¼“å†²åŒºã€‚ä¸ºäº†æœ€å¤§ç¨‹åº¦é™ä½æ¶æ„ä»£ç è·å–æ•æ„Ÿæ•°æ®çš„é£é™©ï¼Œä»£ç åœ¨è®¿é—®è§£å¯†è¿‡çš„å­—ç¬¦ä¸²æ—¶ï¼Œæ—¶é—´åº”å°½å¯èƒ½çŸ­ã€‚ç»“æŸä½¿ç”¨å­—ç¬¦ä¸²ä¹‹åï¼Œä»£ç åº”å°½å¿«æ¸…é›¶å¹¶é‡Šæ”¾ç¼“å†²åŒºã€‚æ­¤å¤–ï¼Œç»å¯¹ä¸è¦å°† <code>SecureString</code> çš„å†…å®¹æ”¾åˆ°ä¸€ä¸ª <code>String</code> ä¸­ã€‚å¦åˆ™ï¼ŒString ä¼šåœ¨å †ä¸­ä¿æŒæœªåŠ å¯†çŠ¶æ€ï¼Œåªæœ‰ç»è¿‡åƒåœ¾å›æ”¶ï¼Œè€Œä¸”å†…å­˜è¢«é‡ç”¨çš„æ—¶å€™ï¼Œå®ƒçš„å­—ç¬¦å†…å®¹æ‰ä¼šè¢«æ¸…é›¶ã€‚ <code>SecureString</code> ç±»ç‰¹åœ°æ²¡æœ‰é‡å†™ <code>ToString</code> æ–¹æ³•ï¼Œç›®çš„å°±æ˜¯é¿å…æ³„éœ²æ•æ„Ÿæ•°æ®ã€‚</p><div class="tags"><a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag"><i class="ic i-tag"></i> è¯»ä¹¦ç¬”è®°</a> <a href="/tags/C/" rel="tag"><i class="ic i-tag"></i> C#</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2022-11-18 11:29:04" itemprop="dateModified" datetime="2022-11-18T11:29:04+08:00">2022-11-18</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(ï¿£â–½ï¿£)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Sakupinera WeChat Pay"><p>WeChat Pay</p></div><div><img data-src="/images/alipay.png" alt="Sakupinera Alipay"><p>Alipay</p></div><div><img data-src="/images/paypal.png" alt="Sakupinera PayPal"><p>PayPal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>Sakupinera <i class="ic i-at"><em>@</em></i>Sakupinera</li><li class="link"><strong>Post link: </strong><a href="http://sakupinera.github.io/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/" title="CLR via C# - Chapter 14 Chars, Strings, and Working with Text">http://sakupinera.github.io/2022/11/16/csharp/clr-via-csharp/Chapter 14 Chars, Strings, and Working with Text/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/11/04/csharp/clr-via-csharp/Chapter%2013%20Interfaces/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipexoj0moj20zk0m8kgu.jpg" title="CLR via C# - Chapter 13 Interfaces"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i> CLR-via-CSharp</span><h3>CLR via C# - Chapter 13 Interfaces</h3></a></div><div class="item right"><a href="/2022/11/17/csharp/clr-via-csharp/Chapter%2015%20Enumerated%20Types%20and%20Bit%20Flags/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclhnx9glj20zk0m8npd.jpg" title="CLR via C# - Chapter 15 Enumerated Types and Bit Flags"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i> CLR-via-CSharp</span><h3>CLR via C# - Chapter 15 Enumerated Types and Bit Flags</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#chapter-14-chars-strings-and-working-with-text"><span class="toc-number">1.</span> <span class="toc-text">Chapter 14 Chars, Strings, and Working with Text</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#characters"><span class="toc-number">1.1.</span> <span class="toc-text">Characters</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#the-systemstring-type"><span class="toc-number">1.2.</span> <span class="toc-text">The System.String Type</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#constructing-strings"><span class="toc-number">1.2.1.</span> <span class="toc-text">Constructing Strings</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strings-are-immutable"><span class="toc-number">1.2.2.</span> <span class="toc-text">Strings Are Immutable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#comparing-strings"><span class="toc-number">1.2.3.</span> <span class="toc-text">Comparing Strings</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#string-interning"><span class="toc-number">1.2.4.</span> <span class="toc-text">String Interning</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#string-pooling"><span class="toc-number">1.2.5.</span> <span class="toc-text">String Pooling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#examining-a-strings-characters-and-text-elements"><span class="toc-number">1.2.6.</span> <span class="toc-text">Examining a Stringâ€™s Characters and Text Elements</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#other-string-operations"><span class="toc-number">1.2.7.</span> <span class="toc-text">Other String Operations</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#constructing-a-string-efficiently"><span class="toc-number">1.3.</span> <span class="toc-text">Constructing a String Efficiently</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#constructing-a-stringbuilder-object"><span class="toc-number">1.3.1.</span> <span class="toc-text">Constructing a StringBuilder Object</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stringbuilder-members"><span class="toc-number">1.3.2.</span> <span class="toc-text">StringBuilder Members</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#obtaining-a-string-representation-of-an-object-tostring"><span class="toc-number">1.4.</span> <span class="toc-text">Obtaining a String Representation of an Object: ToString</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#specific-formats-and-cultures"><span class="toc-number">1.4.1.</span> <span class="toc-text">Specific Formats and Cultures</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#formatting-multiple-objects-into-a-single-string"><span class="toc-number">1.4.2.</span> <span class="toc-text">Formatting Multiple Objects into a Single String</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#providing-your-own-custom-formatter"><span class="toc-number">1.4.3.</span> <span class="toc-text">Providing Your Own Custom Formatter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#parsing-a-string-to-obtain-an-object-parse"><span class="toc-number">1.5.</span> <span class="toc-text">Parsing a String to Obtain an Object: Parse</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#encodings-converting-between-characters-and-bytes"><span class="toc-number">1.6.</span> <span class="toc-text">Encodings: Converting Between Characters and Bytes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#encoding-and-decoding-streams-of-characters-and-bytes"><span class="toc-number">1.6.1.</span> <span class="toc-text">Encoding and Decoding Streams of Characters and Bytes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#base-64-string-encoding-and-decoding"><span class="toc-number">1.6.2.</span> <span class="toc-text">Base-64 String Encoding and Decoding</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#secure-strings"><span class="toc-number">1.7.</span> <span class="toc-text">Secure Strings</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%201%20The%20CLR%E2%80%99s%20Execution%20Model/" rel="bookmark" title="CLR via C# - Chapter 1 The CLRâ€™s Execution Model">CLR via C# - Chapter 1 The CLRâ€™s Execution Model</a></li><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%202%20Building,%20Packaging,%20Deploying,%20and%20Administering%20Applications%20and%20Types/" rel="bookmark" title="CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types">CLR via C# - Chapter 2 Building, Packaging, Deploying, and Administering Applications and Types</a></li><li><a href="/2022/08/28/csharp/clr-via-csharp/Chapter%203%20Shared%20Assemblies%20and%20Strongly%20Named%20Assemblies/" rel="bookmark" title="CLR via C# - Chapter 3 Shared Assemblies and Strongly Named Assemblies">CLR via C# - Chapter 3 Shared Assemblies and Strongly Named Assemblies</a></li><li><a href="/2022/09/27/csharp/clr-via-csharp/Chapter%204%20Type%20Fundamentals/" rel="bookmark" title="CLR via C# - Chapter 4 Type Fundamentals">CLR via C# - Chapter 4 Type Fundamentals</a></li><li><a href="/2022/10/15/csharp/clr-via-csharp/Chapter%205%20Primitive,%20Reference,%20and%20Value%20%20Types/" rel="bookmark" title="CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals">CLR via C# - Chapter 5 Primitive, Reference, and Value Types Fundamentals</a></li><li><a href="/2022/10/21/csharp/clr-via-csharp/Chapter%206%20Type%20and%20Member%20Basics/" rel="bookmark" title="CLR via C# - Chapter 6 Type and Member Basics">CLR via C# - Chapter 6 Type and Member Basics</a></li><li><a href="/2022/10/24/csharp/clr-via-csharp/Chapter%207%20Constants%20and%20Fields/" rel="bookmark" title="CLR via C# - Chapter 7 Constants and Fields">CLR via C# - Chapter 7 Constants and Fields</a></li><li><a href="/2022/10/25/csharp/clr-via-csharp/Chapter%208%20Methods/" rel="bookmark" title="CLR via C# - Chapter 8 Methods">CLR via C# - Chapter 8 Methods</a></li><li><a href="/2022/10/27/csharp/clr-via-csharp/Chapter%209%20Parameters/" rel="bookmark" title="CLR via C# - Chapter 9 Parameters">CLR via C# - Chapter 9 Parameters</a></li><li><a href="/2022/10/28/csharp/clr-via-csharp/Chapter%2010%20Properties/" rel="bookmark" title="CLR via C# - Chapter 10 Properties">CLR via C# - Chapter 10 Properties</a></li><li><a href="/2022/10/29/csharp/clr-via-csharp/Chapter%2011%20Events/" rel="bookmark" title="CLR via C# - Chapter 11 Events">CLR via C# - Chapter 11 Events</a></li><li><a href="/2022/11/02/csharp/clr-via-csharp/Chapter%2012%20Generics/" rel="bookmark" title="CLR via C# - Chapter 12 Generics">CLR via C# - Chapter 12 Generics</a></li><li><a href="/2022/11/04/csharp/clr-via-csharp/Chapter%2013%20Interfaces/" rel="bookmark" title="CLR via C# - Chapter 13 Interfaces">CLR via C# - Chapter 13 Interfaces</a></li><li class="active"><a href="/2022/11/16/csharp/clr-via-csharp/Chapter%2014%20Chars,%20Strings,%20and%20Working%20%20with%20Text/" rel="bookmark" title="CLR via C# - Chapter 14 Chars, Strings, and Working with Text">CLR via C# - Chapter 14 Chars, Strings, and Working with Text</a></li><li><a href="/2022/11/17/csharp/clr-via-csharp/Chapter%2015%20Enumerated%20Types%20and%20Bit%20Flags/" rel="bookmark" title="CLR via C# - Chapter 15 Enumerated Types and Bit Flags">CLR via C# - Chapter 15 Enumerated Types and Bit Flags</a></li><li><a href="/2022/11/19/csharp/clr-via-csharp/Chapter%2016%20Arrays/" rel="bookmark" title="CLR via C# - Chapter 16 Arrays">CLR via C# - Chapter 16 Arrays</a></li><li><a href="/2022/11/21/csharp/clr-via-csharp/Chapter%2017%20Delegates/" rel="bookmark" title="CLR via C# - Chapter 17 Delegates">CLR via C# - Chapter 17 Delegates</a></li><li><a href="/2022/11/22/csharp/clr-via-csharp/Chapter%2018%20Custom%20Attributes/" rel="bookmark" title="CLR via C# - Chapter 18 Custom Attributes">CLR via C# - Chapter 18 Custom Attributes</a></li><li><a href="/2022/11/23/csharp/clr-via-csharp/Chapter%2019%20Nullable%20Value%20Types/" rel="bookmark" title="CLR via C# - Chapter 19 Nullable Value Types">CLR via C# - Chapter 19 Nullable Value Types</a></li><li><a href="/2022/11/25/csharp/clr-via-csharp/Chapter%2020%20Exceptions%20and%20State%20Management/" rel="bookmark" title="CLR via C# - Chapter 20 Exceptions and State Management">CLR via C# - Chapter 20 Exceptions and State Management</a></li><li><a href="/2022/11/27/csharp/clr-via-csharp/Chapter%2021%20The%20Managed%20Heap%20and%20Garbage%20%20Collection/" rel="bookmark" title="CLR via C# - Chapter 21 The Managed Heap and Garbage  Collection">CLR via C# - Chapter 21 The Managed Heap and Garbage Collection</a></li><li><a href="/2022/11/28/csharp/clr-via-csharp/Chapter%2022%20CLR%20Hosting%20and%20AppDomains/" rel="bookmark" title="CLR via C# - Chapter 22 CLR Hosting and AppDomains">CLR via C# - Chapter 22 CLR Hosting and AppDomains</a></li><li><a href="/2022/11/29/csharp/clr-via-csharp/Chapter%2023%20Assembly%20Loading%20and%20Reflection/" rel="bookmark" title="CLR via C# - Chapter 23 Assembly Loading and Reflection">CLR via C# - Chapter 23 Assembly Loading and Reflection</a></li><li><a href="/2022/11/30/csharp/clr-via-csharp/Chapter%2024%20Runtime%20Serialization/" rel="bookmark" title="CLR via C# - Chapter 24 Runtime Serialization">CLR via C# - Chapter 24 Runtime Serialization</a></li><li><a href="/2022/12/06/csharp/clr-via-csharp/Chapter%2025%20Interoperating%20with%20WinRT%20%20Components/" rel="bookmark" title="CLR via C# - Chapter 25 Interoperating with WinRT Components">CLR via C# - Chapter 25 Interoperating with WinRT Components</a></li><li><a href="/2023/02/06/csharp/clr-via-csharp/Chapter%2026%20Thread%20Basics/" rel="bookmark" title="CLR via C# - Chapter 26 Thread Basics">CLR via C# - Chapter 26 Thread Basics</a></li><li><a href="/2023/02/07/csharp/clr-via-csharp/Chapter%2027%20Compute-Bound%20Asynchronous%20Operations/" rel="bookmark" title="CLR via C# - Chapter 27 Compute-Bound Asynchronous Operations">CLR via C# - Chapter 27 Compute-Bound Asynchronous Operations</a></li><li><a href="/2023/02/08/csharp/clr-via-csharp/Chapter%2028%20IO-Bound%20Asynchronous%20Operations/" rel="bookmark" title="CLR via C# - Chapter 28 IO-Bound Asynchronous Operations">CLR via C# - Chapter 28 IO-Bound Asynchronous Operations</a></li><li><a href="/2023/02/09/csharp/clr-via-csharp/Chapter%2029%20Primitive%20Thread%20Synchronization%20Constructs/" rel="bookmark" title="CLR via C# - Chapter 29 Primitive Thread Synchronization">CLR via C# - Chapter 29 Primitive Thread Synchronization</a></li><li><a href="/2023/02/10/csharp/clr-via-csharp/Chapter%2030%20Hybrid%20Thread%20Synchronization%20Constructs/" rel="bookmark" title="CLR via C# - Chapter 30 Hybrid Thread Synchronization">CLR via C# - Chapter 30 Hybrid Thread Synchronization</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Sakupinera" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Sakupinera</p><div class="description" itemprop="description">ä¿æŒä½ çš„å†³å¿ƒï¼</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">89</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">17</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">8</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Nha3VwaW5lcmE=" title="https:&#x2F;&#x2F;github.com&#x2F;sakupinera"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9zYWt1cGluZXJh" title="https:&#x2F;&#x2F;twitter.com&#x2F;sakupinera"><i class="ic i-twitter"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTQwNzIyOTA3MQ==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;407229071"><i class="ic i-cloud-music"></i></span> <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMjIzMDczOTg/c3BtX2lkX2Zyb209MzMzLjEwMDcuMC4w" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;22307398?spm_id_from&#x3D;333.1007.0.0"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li><li class="item"><a href="/games/" rel="section"><i class="ic i-flag"></i>games</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-person"></i>About</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/11/04/csharp/clr-via-csharp/Chapter%2013%20Interfaces/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/11/17/csharp/clr-via-csharp/Chapter%2015%20Enumerated%20Types%20and%20Bit%20Flags/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Cpp/" title="In Cpp">Cpp</a> <i class="ic i-angle-right"></i> <a href="/categories/Cpp/Cpp-Primer/" title="In Cpp-Primer">Cpp-Primer</a></div><span><a href="/2023/01/02/cpp/cpp-primer/Chapter%2010%20Generic%20Algorithms/" title="C++ Primer - Chapter 10 Generic Algorithms">C++ Primer - Chapter 10 Generic Algorithms</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="In Linux">Linux</a> <i class="ic i-angle-right"></i> <a href="/categories/Linux/Learn-Linux/" title="In Learn-Linux">Learn-Linux</a></div><span><a href="/2022/08/28/linux/learn-linux/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" title="LearnLinux - Linuxå¸¸ç”¨å‘½ä»¤">LearnLinux - Linuxå¸¸ç”¨å‘½ä»¤</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/10/27/csharp/clr-via-csharp/Chapter%209%20Parameters/" title="CLR via C# - Chapter 9 Parameters">CLR via C# - Chapter 9 Parameters</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/10/24/csharp/clr-via-csharp/Chapter%207%20Constants%20and%20Fields/" title="CLR via C# - Chapter 7 Constants and Fields">CLR via C# - Chapter 7 Constants and Fields</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2023/02/07/csharp/clr-via-csharp/Chapter%2027%20Compute-Bound%20Asynchronous%20Operations/" title="CLR via C# - Chapter 27 Compute-Bound Asynchronous Operations">CLR via C# - Chapter 27 Compute-Bound Asynchronous Operations</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Computer-Graphics/" title="In Computer-Graphics">Computer-Graphics</a> <i class="ic i-angle-right"></i> <a href="/categories/Computer-Graphics/GAMES101/" title="In GAMES101">GAMES101</a></div><span><a href="/2022/09/18/computer-graphics/games101/%E5%8F%98%E6%8D%A2/" title="GAMES101 - Transformationï¼ˆå˜æ¢ï¼‰">GAMES101 - Transformationï¼ˆå˜æ¢ï¼‰</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Computer-Graphics/" title="In Computer-Graphics">Computer-Graphics</a> <i class="ic i-angle-right"></i> <a href="/categories/Computer-Graphics/GAMES101/" title="In GAMES101">GAMES101</a></div><span><a href="/2022/09/06/computer-graphics/games101/%E5%90%91%E9%87%8F%E5%92%8C%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" title="GAMES101 - å‘é‡å’Œçº¿æ€§ä»£æ•°">GAMES101 - å‘é‡å’Œçº¿æ€§ä»£æ•°</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/CSharp/" title="In CSharp">CSharp</a> <i class="ic i-angle-right"></i> <a href="/categories/CSharp/CLR-via-CSharp/" title="In CLR-via-CSharp">CLR-via-CSharp</a></div><span><a href="/2022/10/28/csharp/clr-via-csharp/Chapter%2010%20Properties/" title="CLR via C# - Chapter 10 Properties">CLR via C# - Chapter 10 Properties</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Language/" title="In Language">Language</a> <i class="ic i-angle-right"></i> <a href="/categories/Language/Japanese/" title="In Japanese">Japanese</a></div><span><a href="/2024/10/23/language/japanese/%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%81%AE%E5%8B%89%E5%BC%B7/" title="æ—¥æœ¬èªã®å‹‰å¼·">æ—¥æœ¬èªã®å‹‰å¼·</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="In Linux">Linux</a> <i class="ic i-angle-right"></i> <a href="/categories/Linux/Learn-Linux/" title="In Learn-Linux">Learn-Linux</a></div><span><a href="/2022/08/28/linux/learn-linux/Linux%E7%B3%BB%E7%BB%9F%E7%AE%80%E4%BB%8B/" title="LearnLinux - Linuxç³»ç»Ÿç®€ä»‹">LearnLinux - Linuxç³»ç»Ÿç®€ä»‹</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 â€“ <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Sakupinera @ Hanamai Sora</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">2.2m words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">34:05</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/11/16/csharp/clr-via-csharp/Chapter 14 Chars, Strings, and Working  with Text/",favicon:{show:"ï¼ˆâ—Â´3ï½€â—ï¼‰Goooood",hide:"(Â´Ğ”ï½€)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/assets/shifuku.model.json"},display:{position:"left",width:250,height:500},mobile:{show:!1},react:{opacity:.9},log:!1})</script></body></html>